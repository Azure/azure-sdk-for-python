trigger:
  - master

jobs:

  - job: Validate_Nightly_Using_Python38
    variables:
      skipComponentGovernanceDetection: true

    timeoutInMinutes: 90

    pool:
      vmImage: 'ubuntu-18.04'

    steps:
      - task: UsePythonVersion@0
        displayName: 'Use Python 3.7 For Build Tools'
        inputs:
          versionSpec: '3.7'

      - script: |
          sudo apt-get update
          sudo add-apt-repository ppa:deadsnakes/ppa
          sudo apt-get update
          sudo apt install python3.8
          cd $(Build.SourcesDirectory)
          PATH=/home/vsts/bin:$PATH
          python3 --version
          echo $PATH
          cd /home/vsts
          ls
          cd bin
          echo 'home/vsts/bin'
          ls
          cd /home/vsts/hostedcache
          echo '/home/vsts/hostedcache'
          ls
          echo 'usr/lib/bin'
          cd /usr/lib/bin
          ls
          echo 'usr/local/bin'
          cd /usr/local/bin
          ls
          echo 'opt/bin'
          cd /opt/bin
          ls
          cd $(Build.SourcesDirectory)
          python3 -m ensurepip
          pip install packaging tox tox-monorepo
          python3 ./scripts/devops_tasks/setup_execute_tests.py -p python3 "azure-core" --junitxml="junit/test_results_38.xml" --toxenv="whl"
        displayName: 'Setup - Run Tests "Nightly" using Python 3.8'
        continueOnError: true

      - task: PublishTestResults@2
        condition: succeededOrFailed()
        inputs:
          testResultsFiles: '**/test_results_38.xml'
          testRunTitle: '$(OSName) Python $(PythonVersion)'