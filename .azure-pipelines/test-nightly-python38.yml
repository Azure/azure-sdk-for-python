trigger:
  - master

jobs:

  - job: Validate_Nightly_Using_Python38
    variables:
      skipComponentGovernanceDetection: true

    timeoutInMinutes: 90

    pool:
      vmImage: 'ubuntu-18.04'

    steps:
      - script: |
          sudo apt-get update
          sudo add-apt-repository ppa:deadsnakes/ppa
          sudo apt-get update
          sudo apt install python3.8
          sudo apt-get install build-essential libsqlite3-dev sqlite3 bzip2 libbz2-dev zlib1g-dev libssl-dev openssl libgdbm-dev liblzma-dev libreadline-dev libncursesw5-dev libffi-dev uuid-dev
          cd ~/
          git clone https://github.com/python/cpython.git
          cd cpython
          mkdir debug
          cd debug
          ../configure --enable-optimizations --prefix=$HOME
          make install
          cd $(Build.SourcesDirectory)
          PATH=/home/vsts/bin:$PATH
          PATH=/usr/bin:$PATH   
          sudo apt-get install python-packaging
          sudo apt install python3-distutils
          python3.8 -m pip install wheel
          python3.8 -m pip install python3-setuptools
          python3.8 -m pip install --user pathlib twine codecov beautifulsoup4 tox tox-monorepo packaging setuptools
          python3 -m ensurepip
          python3 -m pip distutils wheel setuptools pathlib twine codecov beautifulsoup4 tox tox-monorepo
          python3.8 -m pip freeze
          #tox -e whl -c ../../../eng/tox/tox.ini
          #python3.8 ./scripts/devops_tasks/setup_execute_tests.py -p python "azure-core" --junitxml="junit/test_results_38.xml" --toxenv="whl"
        displayName: 'Setup - Run Tests "Nightly" using Python 3.8'
        continueOnError: true

      - task: PublishTestResults@2
        condition: succeededOrFailed()
        inputs:
          testResultsFiles: '**/test_results_38.xml'
          testRunTitle: '$(OSName) Python $(PythonVersion)'