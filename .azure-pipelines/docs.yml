trigger:
  - master

variables:
  PythonVersion: '3.6'

jobs:
  - job: 'DocGen'

    pool:
      vmImage: 'ubuntu-16.04'

    steps:
      - task: UsePythonVersion@0
        displayName: 'Use Python $(PythonVersion)'
        inputs:
          versionSpec: $(PythonVersion)

      - task: PythonScript@0
        displayName: 'Install All Packages'
        inputs:
          scriptPath: 'scripts/dev_setup.py'

      - powershell: |
          cd $(Build.SourcesDirectory)/doc/
          pip install -r requirements.txt
          ./make.bat html
          xcopy $(Build.SourcesDirectory)/doc/_build/html/ $(Build.ArtifactStagingDirectory)/sphinx/ /E /H /K
          Copy-Item -Path $(Build.SourcesDirectory)/doc/_build/html/* -Destination $(Build.ArtifactStagingDirectory)/sphinx/ -Recurse -Force
        displayName: 'Generate Sphinx Docs'

      - task: PublishBuildArtifacts@1
        condition: succeededOrFailed()
        displayName: 'Publish Artifacts'
        inputs:
          artifactName: docfolder
