jobs:
- job: Special_Python_Distro_Tests
  dependsOn:
  - 'Build_Target_Packages'
  pool:
    vmImage: 'ubuntu-16.04'
  steps:
  - script: 'pypy3 scripts/dev_setup.py'
    displayName: 'Setup Tests'
    continueOnError: true

  - powershell: |
     $inputFilterSet="$(build_targeting_string)"
     
     if ($inputFilterSet -eq "")
     {
         $inputFilterSet = "azure-*"
     }
     
     foreach($inputFilter in "$inputFilterSet".split(","))
     {
        $folderCombination = (Get-ChildItem -Directory -Filter "$inputFilter"  | %{ "$(Build.SourcesDirectory)/$_/" }) -join " "
     
        pypy3 -m pytest $folderCombination --ignore=local_install 
     }
    displayName: 'Run Test Subset'
    continueOnError: true

  - script: |
     pypy3 ./setup.py check -r -s
    displayName: 'Check Setup.py Files'
    continueOnError: true