jobs:
- job: Special_Python_Distro_Tests
  dependsOn:
  - 'Build_Target_Packages'
  pool:
    vmImage: 'ubuntu-16.04'
  steps:
  - powershell: |
     cd ~/
     wget https://bitbucket.org/pypy/pypy/downloads/pypy3-v6.0.0-linux64.tar.bz2
     tar xf pypy3-v6.0.0-linux64.tar.bz2
     cd $(Build.SourcesDirectory)
     
     ~/pypy3-v6.0.0-linux64/bin/pypy3 -m ensurepip
     ~/pypy3-v6.0.0-linux64/bin/pypy3 scripts/dev_setup.py
     
      $inputFilterSet="$(build_targeting_string)"
      
      if ($inputFilterSet -eq "")
      {
          $inputFilterSet = "azure-*"
      }
      
      foreach($inputFilter in "$inputFilterSet".split(","))
      {
         $folderCombination = (Get-ChildItem -Directory -Name -Filter "$inputFilter"  | %{ "$(Build.SourcesDirectory)/$_/" }) -join " "
      
         ~/pypy3-v6.0.0-linux64/bin/pypy3 -m pytest $folderCombination
      }
     
     ~/pypy3-v6.0.0-linux64/bin/pypy3 ./setup.py check -r -s
    displayName: 'Setup and Run Filtered Tests PyPy3'
    enabled: true