parameters:
  name: ''
  vmImage: ''

jobs:
- job: ${{ format('Test {0}', parameters.name ) }}
  dependsOn:
  - 'Publish'
  pool:
    vmImage: ${{ parameters.vmImage }}
  strategy:
    matrix:
      Python_2_7:
        python.version: '2.7'
      Python_3_4:
        python.version: '3.4'
      Python_3_5:
        python.version: '3.5'
      Python_3_6:
        python.version: '3.6'
    maxParallel: 3
  steps:
  - task: UsePythonVersion@0
    displayName: 'Use Python $(python.version)'
    inputs:
      versionSpec: '$(python.version)'

  - script: 'python scripts/dev_setup.py'
    displayName: 'Test Setup'

  - script: |
     pytest .
     python ./setup.py check -r -s
    displayName: 'Run Tests'

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifacts'