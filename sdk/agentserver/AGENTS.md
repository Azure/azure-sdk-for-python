# AGENTS.md

This file provides comprehensive guidance to Coding Agents(Codex, Claude Code, Github Copilot, etc.) when working with Python code in this repository.

## üèÜ Core Development Philosophy

### KISS (Keep It Simple, Stupid)

Simplicity should be a key goal in design. Choose straightforward solutions over complex ones whenever possible. Simple solutions are easier to understand, maintain, and debug.

### YAGNI (You Aren't Gonna Need It)

Avoid building functionality on speculation. Implement features only when they are needed, not when you anticipate they might be useful in the future.

### Design Principles

- **Dependency Inversion**: High-level modules should not depend on low-level modules. Both should depend on abstractions.
- **Open/Closed Principle**: Software entities should be open for extension but closed for modification.
- **Single Responsibility**: Each function, class, and module should have one clear purpose.
- **Fail Fast**: Check for potential errors early and raise exceptions immediately when issues occur.

## üß± Code Structure & Modularity
### üîÑ Project Awareness & Context

- **Always read `.agents/PLANNING.md`** at the start of a new conversation to understand the project's architecture, goals, style, and constraints.
- **Check `.agents/TASK.md`** before starting a new task. If the task isn't listed, add it with a brief description and today's date.
- **Use consistent naming conventions, file structure, and architecture patterns** as described in `.agents/PLANNING.md`.
- **Read the package READMEs**:
  - `sdk/agentserver/azure-ai-agentserver-core/README.md`
  - `sdk/agentserver/azure-ai-agentserver-agentframework/README.md`
  - `sdk/agentserver/azure-ai-agentserver-langgraph/README.md`
- **Read repo guidance**:
  - `CONTRIBUTING.md`
  - `doc/dev/tests.md`
  - `doc/eng_sys_checks.md`

### üèóÔ∏è Project Structure

#### Repository Structure

AgentServer is developed within **azure-sdk-for-python** at `sdk/agentserver/`:

- **azure-ai-agentserver-core**: Core library
  - Runtime/context
  - HTTP gateway
  - Foundry integrations
  - Responses API protocol (current)
- **azure-ai-agentserver-agentframework**: Agent Framework adapter
- **azure-ai-agentserver-langgraph**: LangGraph adapter

#### Architecture (Current vs Target)

- **Current**: OpenAI Responses API protocol lives in `azure-ai-agentserver-core` alongside core runtime and HTTP gateway code; framework adapters layer on top.
- **Target (Planned, not fully implemented)**:
  - Core layer: app/runtime/context, foundry integrations (tools, checkpointing), HTTP gateway
  - Protocol layer: Responses API in its own package
  - Framework layer: adapters (agentframework, langgraph, other frameworks)

## ‚úÖ Task Completion

- **Mark completed tasks in `.agents/TASK.md`** immediately after finishing them.
- Add new sub-tasks or TODOs discovered during development to `.agents/TASK.md` under a "Discovered During Work" section.
- **Update CHANGELOG.md only when required** by release policy.

## üìé Style & Conventions & Standards

### File and Function Limits

- **Never create a file longer than 500 lines of code**. If approaching this limit, refactor by splitting into modules.
- **Functions should be under 50 lines** with a single, clear responsibility.
- **Classes should be under 100 lines** and represent a single concept or entity.
- **Organize code into clearly separated modules**, grouped by feature or responsibility.
- **Line length should be max 100 characters** ruff rule in pyproject.toml
- **Use venv_linux** (the virtual environment) whenever executing Python commands, including for unit tests.
- **Keep modules focused and cohesive**; split by feature responsibility when a file grows large or mixes concerns.
- **Avoid drive-by refactors** unless required by the task.
- **Preserve public API stability** and match existing patterns in the package you touch.

### Naming Conventions

- **Variables and functions**: `snake_case`
- **Classes**: `PascalCase`
- **Constants**: `UPPER_SNAKE_CASE`
- **Private attributes/methods**: `_leading_underscore`
- **Type aliases**: `PascalCase`
- **Enum values**: `UPPER_SNAKE_CASE`

### Project File Conventions

- **Follow per-package `pyproject.toml`** and `[tool.azure-sdk-build]` settings.
- **Do not edit generated code**.
- **Do not edit files with the header** `Code generated by Microsoft (R) Python Code Generator.`
  - `sdk/agentserver/azure-ai-agentserver-core/azure/ai/agentserver/core/models/projects/`
  - `sdk/agentserver/azure-ai-agentserver-core/azure/ai/agentserver/core/_version.py`
  - `sdk/agentserver/azure-ai-agentserver-agentframework/azure/ai/agentserver/agentframework/_version.py`
  - `sdk/agentserver/azure-ai-agentserver-langgraph/azure/ai/agentserver/langgraph/_version.py`
- **Do not introduce secrets or credentials.**
- **Do not disable TLS/SSL verification** without explicit approval.
- **Keep logs free of sensitive data.**

### Python Code Standards

- **Follow existing package patterns** and Azure SDK for Python guidelines.
- **Type hints and async patterns** should match existing code.
- **Respect Ruff settings** (line length 120, isort rules) in each package `pyproject.toml`.
- **Avoid new dependencies** unless necessary and approved.

### Docstring Standards
Use reStructuredText (reST) / Sphinx Style docstrings for all public functions, classes, and modules:

```python
def calculate_discount(
    price: Decimal,
    discount_percent: float,
    min_amount: Decimal = Decimal("0.01")
) -> Decimal:
    """Calculate the discounted price for a product.
    
    :param price: The original price of the product.
    :type price: Decimal
    :param discount_percent: The discount percentage to apply (0-100).
    :type discount_percent: float
    :param min_amount: The minimum amount after discount (default is 0.01).
    :type min_amount: Decimal
    :return: The price after applying the discount, not less than min_amount.
    :rtype: Decimal
    :raises ValueError: If discount_percent is not between 0 and 100.
    
    Example:
        Calculate a 15% discount on a $100 product:
        
        .. code-block:: python
        
            calculate_discount(Decimal("100.00"), 15.0)
    """
```

### Error Handling Standards
...

#### Exception Best Practices

### Logging Standards
...

## ‚ö†Ô∏è Important Notes

- **NEVER ASSUME OR GUESS** - When in doubt, ask for clarification
- **Always verify file paths and module names** before use
- **Keep CLAUDE.md updated** when adding new patterns or dependencies
- **Test your code** - No feature is complete without tests
- **Document your decisions** - Future developers (including yourself) will thank you

## üìö Documentation & Explainability

- **Keep samples runnable** and focused on SDK usage.
- **Follow third-party dependency guidance** in `CONTRIBUTING.md`.

## üõ†Ô∏è Development Environment

### ‚úÖ Testing & Quality Gates (tox)

Run from a package root (e.g., `sdk/agentserver/azure-ai-agentserver-core`).

- `tox run -e sphinx -c ../../../eng/tox/tox.ini --root .`
  - Docs output: `.tox/sphinx/tmp/dist/site/index.html`
- `tox run -e pylint -c ../../../eng/tox/tox.ini --root .`
  - Uses repo `pylintrc`; `next-pylint` uses `eng/pylintrc`
- `tox run -e mypy -c ../../../eng/tox/tox.ini --root .`
- `tox run -e pyright -c ../../../eng/tox/tox.ini --root .`
- `tox run -e verifytypes -c ../../../eng/tox/tox.ini --root .`
- `tox run -e whl -c ../../../eng/tox/tox.ini --root .`
- `tox run -e sdist -c ../../../eng/tox/tox.ini --root .`
- `tox run -e samples -c ../../../eng/tox/tox.ini --root .` (runs all samples)
- `tox run -e apistub -c ../../../eng/tox/tox.ini --root .`

Check each package `pyproject.toml` under `[tool.azure-sdk-build]` to see which checks are enabled/disabled.
