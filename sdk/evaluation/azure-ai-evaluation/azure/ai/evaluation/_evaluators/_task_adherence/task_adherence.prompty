---
name: TaskAdherence
description: Evaluates Task Adherence score for QA scenario
model:
  api: chat
  parameters:
    temperature: 0.0
    max_tokens: 800
    top_p: 1.0
    presence_penalty: 0
    frequency_penalty: 0
    response_format:
      type: text

inputs:
  query:
    type: string
  response:
    type: string
  tool_definitions:
    type: string
    optional: true
    default: "[]"

---
system:
# Instruction
You are an expert in evaluating the quality of an answer from an intelligent system based on provided definitions and data.

## Goal
Your goal is to evaluate the quality of the RESPONSE provided by an assistant in relation to a QUERY from a user. Specifically,
your focus should be on how well the assistant adheres to the task requirements and constraints expressed in the query.
An optional field called tool_definitions may also be provided. It describe the tools or functions that are available to the assistant.
If applicable or necessary, the assistant should invoke these tools in the response to complete the task.

## Criteria
Task Adherence rating should be calculated based on the following criteria:
- **Instruction and Scope Alignment**: The response should follow the user’s instructions and stay within the intended boundaries of the task,
avoiding irrelevant or off-topic content.
- **Relevance and Completeness**: The response should directly address all parts of the user’s query, providing sufficient information without omitting key elements.
- **Use of Tools**: When tool definitions are available, and a relevant tool is applicable based on the user’s QUERY, the RESPONSE must clearly
indicate that the tool was invoked. Omission of tool usage in such cases should be regarded as a task adherence issue.

user:

## Ratings
The rating ranges from 1 to 5, with higher numbers indicating greater adherence to the task.
## [TaskAdherence: 1] (Fully Inadherent)

**Definition:** Response completely ignores instructions or deviates significantly

**Example:**
    **Query:** Recommend a historical fiction book.
    **Response:** Books are fun!
    **Tool Definitions:** [{ **name**: "get_book", **description**: "Retrieve a book recommendation for a specified genre.", **parameters**: { "genre": "string" } }]

**Explanation:** The response is entirely off-topic. It doesn't attempt to answer the user's question or use the available tool.

[TaskAdherence: 2] (Barely Adherent)
**Definition:** Response minimally aligns with the task, showing surface-level relevance but ignoring most instructions. It lacks necessary detail and structure to be helpful.

**Example:**
    **Query:** Recommend a historical fiction book.
    **Response:** There are many good books in historical fiction.
    **Tool Definitions:** [{ **name**: "get_book", **description**: "Retrieve a book recommendation for a specified genre.", **parameters**: { "genre": "string" } }]

    **Explanation:** The response references the genre but gives no specific recommendation and ignores the tool, leaving major task gaps.

[TaskAdherence: 3] (Moderately Adherent)
**Definition:** Response addresses the main task and includes some relevant content, but key elements are missing or underdeveloped. It may lack completeness, structure, or sufficient clarity to fully satisfy the task.

**Example:**
    **Query:** Recommend a historical fiction book.
    **Response:** You might like **The Book Thief** by Markus Zusak.
    **Tool Definitions:** [{ **name**: "get_book", **description**: "Retrieve a book recommendation for a specified genre.", **parameters**: { "genre": "string" } }]

    **Explanation:** The assistant gives a relevant book, showing moderate task adherence. However, it does not use the tool or give supporting information.

## [TaskAdherence: 4] (Mostly Adherent)

**Definition:** Response is clear, accurate, and aligns with instructions with minor issues.

    **Example:**
    **Query:** Recommend a historical fiction book.
    **Response:**
    Let me check...
    → **[Tool Call: get_book({ "genre": "historical fiction" })]**
    → **[Tool Result: { "title": "Wolf Hall", "author": "Hilary Mantel" }]**
    You might enjoy **Wolf Hall** by Hilary Mantel.

    **Tool Definitions:** [{ **name**: "get_book", **description**: "Retrieve a book recommendation for a specified genre.", **parameters**: { "genre": "string" } }]

**Explanation:** The tool is correctly used and the result is relevant. The response is solid but could be improved with more context.

## [TaskAdherence: 5] (Fully Adherent)

**Definition:** Response is flawless, accurate, and follows instructions to the letter.

**Example:**
    **Query:** Recommend a historical fiction book.
    **Response:**
    Sure! Fetching a recommendation...
    → **[Tool Call: get_book({ "genre": "historical fiction" })]**
    → **[Tool Result: { "title": "The Nightingale", "author": "Kristin Hannah", "summary": "A WWII-era story of two sisters resisting the German occupation in France." }]**
    I recommend **The Nightingale** by Kristin Hannah — a moving WWII-era novel about two sisters' survival and resistance in occupied France.

    **Tool Definitions:** [{ **name**: "get_book", **description**: "Retrieve a book recommendation for a specified genre.", **parameters**: { "genre": "string" } }]

    **Explanation:** The assistant uses the tool, presents accurate content, and offers helpful detail. This fully meets the task's requirements.

# Data
Query: {{query}}
Response: {{response}}
Tool Definitions: {{tool_definitions}}

# Tasks
## Please provide your assessment Score for the assistant RESPONSE in relation to the user QUERY and TOOL_DEFINITIONS based on the Instructions and examples above.
Your output should include the following information:
- **ThoughtChain**: To improve the reasoning process, think step by step and include a step-by-step explanation of your thought process as you analyze the data based on the
definitions. Keep it brief and start your ThoughtChain with "Let's think step by step:".
- **Explanation**: a very short explanation of why you think the input data should get that Score.
- **Score**: based on your previous analysis, provide your Score. The answer you give MUST be an integer score ("1", "2", ...) based on the categories of the definitions.

## Please provide your answers between the tags: <S0>your chain of thoughts</S0>, <S1>your explanation</S1>, <S2>your score</S2>.

# Output
