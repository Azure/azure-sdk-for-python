{
  "Entries": [
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94?api-version=2022-05-01",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "379",
        "Content-Type": "application/json",
        "User-Agent": "azure-ai-ml/1.6.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)"
      },
      "RequestBody": {
        "properties": {
          "isAnonymous": true,
          "isArchived": false,
          "condaFile": "channels:\n- defaults\ndependencies:\n- python=3.8.12\n- pip=21.2.2\n- pip:\n  - --extra-index-url=https://azuremlsdktestpypi.azureedge.net/sdk-cli-v2\n  - mldesigner==0.0.71974906\n  - mlflow\n  - azureml-mlflow\nname: example-environment\n",
          "image": "mcr.microsoft.com/azureml/openmpi3.1.2-ubuntu18.04"
        }
      },
      "StatusCode": 201,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "1170",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Mon, 24 Apr 2023 03:22:07 GMT",
        "Expires": "-1",
        "Location": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94?api-version=2022-05-01",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-580be169d30419a50ac65a78d6a7fcb8-d6455a6c50c1bc73-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "fb43cced-a419-4a20-b083-d7376f82cda7",
        "x-ms-ratelimit-remaining-subscription-writes": "1197",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "CANADACENTRAL:20230424T032208Z:fb43cced-a419-4a20-b083-d7376f82cda7",
        "x-request-time": "0.626"
      },
      "ResponseBody": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94",
        "name": "7926e182b294d8644f987381c0081e94",
        "type": "Microsoft.MachineLearningServices/workspaces/environments/versions",
        "properties": {
          "description": null,
          "tags": {},
          "properties": {},
          "isArchived": false,
          "isAnonymous": true,
          "environmentType": "UserCreated",
          "image": "mcr.microsoft.com/azureml/openmpi3.1.2-ubuntu18.04",
          "condaFile": "{\n  \u0022channels\u0022: [\n    \u0022defaults\u0022\n  ],\n  \u0022dependencies\u0022: [\n    \u0022python=3.8.12\u0022,\n    \u0022pip=21.2.2\u0022,\n    {\n      \u0022pip\u0022: [\n        \u0022--extra-index-url=https://azuremlsdktestpypi.azureedge.net/sdk-cli-v2\u0022,\n        \u0022mldesigner==0.0.71974906\u0022,\n        \u0022mlflow\u0022,\n        \u0022azureml-mlflow\u0022\n      ]\n    }\n  ],\n  \u0022name\u0022: \u0022example-environment\u0022\n}",
          "osType": "Linux"
        },
        "systemData": {
          "createdAt": "2023-04-22T06:51:47.9654855\u002B00:00",
          "createdBy": "Firstname Lastname",
          "createdByType": "User",
          "lastModifiedAt": "2023-04-22T06:51:47.9654855\u002B00:00",
          "lastModifiedBy": "Firstname Lastname",
          "lastModifiedByType": "User"
        }
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94?api-version=2022-05-01",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "379",
        "Content-Type": "application/json",
        "User-Agent": "azure-ai-ml/1.6.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)"
      },
      "RequestBody": {
        "properties": {
          "isAnonymous": true,
          "isArchived": false,
          "condaFile": "channels:\n- defaults\ndependencies:\n- python=3.8.12\n- pip=21.2.2\n- pip:\n  - --extra-index-url=https://azuremlsdktestpypi.azureedge.net/sdk-cli-v2\n  - mldesigner==0.0.71974906\n  - mlflow\n  - azureml-mlflow\nname: example-environment\n",
          "image": "mcr.microsoft.com/azureml/openmpi3.1.2-ubuntu18.04"
        }
      },
      "StatusCode": 201,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "1170",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Mon, 24 Apr 2023 03:22:07 GMT",
        "Expires": "-1",
        "Location": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94?api-version=2022-05-01",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-8511e5f0dcb546eea7f44233ee52da67-40e46b6ac5f1aef1-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "d859d2ff-aa5e-4be1-a537-739e7a31d5c1",
        "x-ms-ratelimit-remaining-subscription-writes": "1196",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "CANADACENTRAL:20230424T032208Z:d859d2ff-aa5e-4be1-a537-739e7a31d5c1",
        "x-request-time": "0.215"
      },
      "ResponseBody": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94",
        "name": "7926e182b294d8644f987381c0081e94",
        "type": "Microsoft.MachineLearningServices/workspaces/environments/versions",
        "properties": {
          "description": null,
          "tags": {},
          "properties": {},
          "isArchived": false,
          "isAnonymous": true,
          "environmentType": "UserCreated",
          "image": "mcr.microsoft.com/azureml/openmpi3.1.2-ubuntu18.04",
          "condaFile": "{\n  \u0022channels\u0022: [\n    \u0022defaults\u0022\n  ],\n  \u0022dependencies\u0022: [\n    \u0022python=3.8.12\u0022,\n    \u0022pip=21.2.2\u0022,\n    {\n      \u0022pip\u0022: [\n        \u0022--extra-index-url=https://azuremlsdktestpypi.azureedge.net/sdk-cli-v2\u0022,\n        \u0022mldesigner==0.0.71974906\u0022,\n        \u0022mlflow\u0022,\n        \u0022azureml-mlflow\u0022\n      ]\n    }\n  ],\n  \u0022name\u0022: \u0022example-environment\u0022\n}",
          "osType": "Linux"
        },
        "systemData": {
          "createdAt": "2023-04-22T06:51:47.9654855\u002B00:00",
          "createdBy": "Firstname Lastname",
          "createdByType": "User",
          "lastModifiedAt": "2023-04-22T06:51:47.9654855\u002B00:00",
          "lastModifiedBy": "Firstname Lastname",
          "lastModifiedByType": "User"
        }
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94?api-version=2022-05-01",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "379",
        "Content-Type": "application/json",
        "User-Agent": "azure-ai-ml/1.6.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)"
      },
      "RequestBody": {
        "properties": {
          "isAnonymous": true,
          "isArchived": false,
          "condaFile": "channels:\n- defaults\ndependencies:\n- python=3.8.12\n- pip=21.2.2\n- pip:\n  - --extra-index-url=https://azuremlsdktestpypi.azureedge.net/sdk-cli-v2\n  - mldesigner==0.0.71974906\n  - mlflow\n  - azureml-mlflow\nname: example-environment\n",
          "image": "mcr.microsoft.com/azureml/openmpi3.1.2-ubuntu18.04"
        }
      },
      "StatusCode": 201,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "1170",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Mon, 24 Apr 2023 03:22:08 GMT",
        "Expires": "-1",
        "Location": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94?api-version=2022-05-01",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-35455600829c7c7ef397abeee591737b-360016fcd323e152-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "cdfebb1c-163e-4cdb-ad08-349b61632cb3",
        "x-ms-ratelimit-remaining-subscription-writes": "1195",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "CANADACENTRAL:20230424T032209Z:cdfebb1c-163e-4cdb-ad08-349b61632cb3",
        "x-request-time": "0.175"
      },
      "ResponseBody": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94",
        "name": "7926e182b294d8644f987381c0081e94",
        "type": "Microsoft.MachineLearningServices/workspaces/environments/versions",
        "properties": {
          "description": null,
          "tags": {},
          "properties": {},
          "isArchived": false,
          "isAnonymous": true,
          "environmentType": "UserCreated",
          "image": "mcr.microsoft.com/azureml/openmpi3.1.2-ubuntu18.04",
          "condaFile": "{\n  \u0022channels\u0022: [\n    \u0022defaults\u0022\n  ],\n  \u0022dependencies\u0022: [\n    \u0022python=3.8.12\u0022,\n    \u0022pip=21.2.2\u0022,\n    {\n      \u0022pip\u0022: [\n        \u0022--extra-index-url=https://azuremlsdktestpypi.azureedge.net/sdk-cli-v2\u0022,\n        \u0022mldesigner==0.0.71974906\u0022,\n        \u0022mlflow\u0022,\n        \u0022azureml-mlflow\u0022\n      ]\n    }\n  ],\n  \u0022name\u0022: \u0022example-environment\u0022\n}",
          "osType": "Linux"
        },
        "systemData": {
          "createdAt": "2023-04-22T06:51:47.9654855\u002B00:00",
          "createdBy": "Firstname Lastname",
          "createdByType": "User",
          "lastModifiedAt": "2023-04-22T06:51:47.9654855\u002B00:00",
          "lastModifiedBy": "Firstname Lastname",
          "lastModifiedByType": "User"
        }
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/codes/000000000000000000000/versions?api-version=2023-04-01\u0026hash=634b294c48adbaa95bcf5efb308a0fcad4c9a1e4a5e7dcf6a44403430acd7a9a\u0026hashVersion=202208",
      "RequestMethod": "GET",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "User-Agent": "azure-ai-ml/1.6.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)"
      },
      "RequestBody": null,
      "StatusCode": 200,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Encoding": "gzip",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Mon, 24 Apr 2023 03:22:16 GMT",
        "Expires": "-1",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-9a8947c86a75e6fcd10bd572bcbb23e8-6e26cbb1347804e1-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "Transfer-Encoding": "chunked",
        "Vary": [
          "Accept-Encoding",
          "Accept-Encoding"
        ],
        "x-aml-cluster": "vienna-eastus-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "2f89f770-1784-4048-9a50-5d829a03afd2",
        "x-ms-ratelimit-remaining-subscription-reads": "11998",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "CANADACENTRAL:20230424T032216Z:2f89f770-1784-4048-9a50-5d829a03afd2",
        "x-request-time": "0.164"
      },
      "ResponseBody": {
        "value": [
          {
            "id": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/codes/08dc9b7a-d960-4b54-a48f-bca2e7bb841b/versions/1",
            "name": "1",
            "type": "Microsoft.MachineLearningServices/workspaces/codes/versions",
            "properties": {
              "description": null,
              "tags": {},
              "properties": {
                "hash_sha256": "634b294c48adbaa95bcf5efb308a0fcad4c9a1e4a5e7dcf6a44403430acd7a9a",
                "hash_version": "202208"
              },
              "isArchived": false,
              "isAnonymous": false,
              "codeUri": "https://samcw32zcnpjldw.blob.core.windows.net:443/72e8eff8-1-b5247b5a-62b7-5ea7-98f8-9212788d5c24/src",
              "provisioningState": "Succeeded"
            },
            "systemData": {
              "createdAt": "2023-04-22T06:52:09.0385486\u002B00:00",
              "createdBy": "Firstname Lastname",
              "createdByType": "User",
              "lastModifiedAt": "2023-04-22T06:52:09.0385486\u002B00:00",
              "lastModifiedBy": "Firstname Lastname",
              "lastModifiedByType": "User"
            }
          }
        ]
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/codes/08dc9b7a-d960-4b54-a48f-bca2e7bb841b/versions/1?api-version=2023-04-01",
      "RequestMethod": "GET",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "User-Agent": "azure-ai-ml/1.6.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)"
      },
      "RequestBody": null,
      "StatusCode": 200,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Encoding": "gzip",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Mon, 24 Apr 2023 03:22:16 GMT",
        "Expires": "-1",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-0d5d508867edfc4958c64b27367e140a-9175fd3d6453ef4d-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "Transfer-Encoding": "chunked",
        "Vary": [
          "Accept-Encoding",
          "Accept-Encoding"
        ],
        "x-aml-cluster": "vienna-eastus-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "af4db490-63d7-449e-a2b4-c219f417b196",
        "x-ms-ratelimit-remaining-subscription-reads": "11997",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "CANADACENTRAL:20230424T032216Z:af4db490-63d7-449e-a2b4-c219f417b196",
        "x-request-time": "0.043"
      },
      "ResponseBody": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/codes/08dc9b7a-d960-4b54-a48f-bca2e7bb841b/versions/1",
        "name": "1",
        "type": "Microsoft.MachineLearningServices/workspaces/codes/versions",
        "properties": {
          "description": null,
          "tags": {},
          "properties": {
            "hash_sha256": "0000000000000",
            "hash_version": "0000000000000"
          },
          "isArchived": false,
          "isAnonymous": false,
          "codeUri": "https://samcw32zcnpjldw.blob.core.windows.net:443/72e8eff8-1-b5247b5a-62b7-5ea7-98f8-9212788d5c24/src",
          "provisioningState": "Succeeded"
        },
        "systemData": {
          "createdAt": "2023-04-22T06:52:09.0385486\u002B00:00",
          "createdBy": "Firstname Lastname",
          "createdByType": "User",
          "lastModifiedAt": "2023-04-22T06:52:09.0385486\u002B00:00",
          "lastModifiedBy": "Firstname Lastname",
          "lastModifiedByType": "User"
        }
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/000000000000000000000?api-version=2022-10-01",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "1419",
        "Content-Type": "application/json",
        "User-Agent": "azure-ai-ml/1.6.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)"
      },
      "RequestBody": {
        "properties": {
          "properties": {},
          "tags": {},
          "isAnonymous": true,
          "isArchived": false,
          "componentSpec": {
            "command": "python basic_component.py $[[--component_in_number ${{inputs.component_in_number}}]] $[[--component_in_number_1 ${{inputs.component_in_number_1}}]] --component_in_path ${{inputs.component_in_path}} --output_in_path ${{outputs.output_in_path}}",
            "code": "azureml:/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/codes/08dc9b7a-d960-4b54-a48f-bca2e7bb841b/versions/1",
            "environment": "azureml:/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94",
            "name": "basic_component",
            "version": "0.0.1",
            "$schema": "https://azuremlschemas.azureedge.net/latest/commandComponent.schema.json",
            "display_name": "Basic component",
            "is_deterministic": true,
            "inputs": {
              "component_in_number": {
                "type": "integer",
                "optional": true
              },
              "component_in_number_1": {
                "type": "integer",
                "optional": true
              },
              "component_in_path": {
                "type": "uri_folder"
              }
            },
            "outputs": {
              "output_in_path": {
                "type": "uri_folder"
              },
              "output_in_number": {
                "type": "integer",
                "is_control": true
              },
              "is_number_larger_than_zero": {
                "type": "boolean",
                "is_control": true
              }
            },
            "type": "command",
            "_source": "YAML.COMPONENT"
          }
        }
      },
      "StatusCode": 201,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "1989",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Mon, 24 Apr 2023 03:22:24 GMT",
        "Expires": "-1",
        "Location": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/000000000000000000000?api-version=2022-10-01",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-b1a3ccb8be4b610cadd21e1a3acbde77-86b4ac77fbda8385-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "dec8891c-0cd6-490b-9431-50c9a516bc6f",
        "x-ms-ratelimit-remaining-subscription-writes": "1194",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "CANADACENTRAL:20230424T032224Z:dec8891c-0cd6-490b-9431-50c9a516bc6f",
        "x-request-time": "0.283"
      },
      "ResponseBody": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/cf16a3af-2aa5-4dfc-955d-350566f92393",
        "name": "cf16a3af-2aa5-4dfc-955d-350566f92393",
        "type": "Microsoft.MachineLearningServices/workspaces/components/versions",
        "properties": {
          "description": null,
          "tags": {},
          "properties": {},
          "isArchived": false,
          "isAnonymous": true,
          "componentSpec": {
            "$schema": "https://azuremlschemas.azureedge.net/latest/commandComponent.schema.json",
            "name": "basic_component",
            "version": "0.0.1",
            "display_name": "Basic component",
            "is_deterministic": "True",
            "type": "command",
            "inputs": {
              "component_in_path": {
                "type": "uri_folder",
                "optional": "False"
              },
              "component_in_number": {
                "type": "integer",
                "optional": "True"
              },
              "component_in_number_1": {
                "type": "integer",
                "optional": "True"
              }
            },
            "outputs": {
              "output_in_path": {
                "type": "uri_folder"
              },
              "output_in_number": {
                "type": "integer",
                "is_control": "True"
              },
              "is_number_larger_than_zero": {
                "type": "boolean",
                "is_control": "True"
              }
            },
            "code": "azureml:/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/codes/08dc9b7a-d960-4b54-a48f-bca2e7bb841b/versions/1",
            "environment": "azureml:/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94",
            "resources": {
              "instance_count": "1"
            },
            "command": "python basic_component.py $[[--component_in_number ${{inputs.component_in_number}}]] $[[--component_in_number_1 ${{inputs.component_in_number_1}}]] --component_in_path ${{inputs.component_in_path}} --output_in_path ${{outputs.output_in_path}}"
          }
        },
        "systemData": {
          "createdAt": "2023-04-22T06:52:17.5765013\u002B00:00",
          "createdBy": "Firstname Lastname",
          "createdByType": "User",
          "lastModifiedAt": "2023-04-22T06:52:17.6354956\u002B00:00",
          "lastModifiedBy": "Firstname Lastname",
          "lastModifiedByType": "User"
        }
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/000000000000000000000?api-version=2022-10-01",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "1415",
        "Content-Type": "application/json",
        "User-Agent": "azure-ai-ml/1.6.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)"
      },
      "RequestBody": {
        "properties": {
          "properties": {},
          "tags": {},
          "isAnonymous": true,
          "isArchived": false,
          "componentSpec": {
            "name": "do_while_body_pipeline_component",
            "display_name": "do_while_body_pipeline_component",
            "inputs": {
              "component_in_number": {
                "type": "integer",
                "optional": true
              },
              "component_in_path": {
                "type": "uri_folder"
              }
            },
            "outputs": {
              "output_in_path": {
                "type": "uri_folder"
              },
              "output_in_number": {
                "type": "integer",
                "is_control": true
              },
              "is_number_larger_than_zero": {
                "type": "boolean",
                "is_control": true
              }
            },
            "type": "pipeline",
            "jobs": {
              "basic_component": {
                "name": "basic_component",
                "type": "command",
                "inputs": {
                  "component_in_number": {
                    "job_input_type": "literal",
                    "value": "${{parent.inputs.component_in_number}}"
                  },
                  "component_in_path": {
                    "job_input_type": "literal",
                    "value": "${{parent.inputs.component_in_path}}"
                  }
                },
                "outputs": {
                  "output_in_path": {
                    "value": "${{parent.outputs.output_in_path}}",
                    "type": "literal"
                  },
                  "output_in_number": {
                    "value": "${{parent.outputs.output_in_number}}",
                    "type": "literal"
                  },
                  "is_number_larger_than_zero": {
                    "value": "${{parent.outputs.is_number_larger_than_zero}}",
                    "type": "literal"
                  }
                },
                "_source": "YAML.COMPONENT",
                "componentId": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/cf16a3af-2aa5-4dfc-955d-350566f92393"
              }
            },
            "_source": "DSL",
            "sourceJobId": null
          }
        }
      },
      "StatusCode": 201,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "1133",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Mon, 24 Apr 2023 03:22:26 GMT",
        "Expires": "-1",
        "Location": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/000000000000000000000?api-version=2022-10-01",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-c48fc104a5a898c12c7adf91c3ba6919-f7a31244ac8ed5d6-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "44fe6c48-8efe-457c-be9d-d6f2624461bb",
        "x-ms-ratelimit-remaining-subscription-writes": "1193",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "CANADACENTRAL:20230424T032226Z:44fe6c48-8efe-457c-be9d-d6f2624461bb",
        "x-request-time": "0.663"
      },
      "ResponseBody": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/6840d832-11ef-4d1a-97b1-5f55acfaf9e7",
        "name": "6840d832-11ef-4d1a-97b1-5f55acfaf9e7",
        "type": "Microsoft.MachineLearningServices/workspaces/components/versions",
        "properties": {
          "description": null,
          "tags": {},
          "properties": {},
          "isArchived": false,
          "isAnonymous": true,
          "componentSpec": {
            "name": "do_while_body_pipeline_component",
            "display_name": "do_while_body_pipeline_component",
            "is_deterministic": "False",
            "type": "pipeline",
            "inputs": {
              "component_in_path": {
                "type": "uri_folder",
                "optional": "False"
              },
              "component_in_number": {
                "type": "integer",
                "optional": "True"
              }
            },
            "outputs": {
              "output_in_path": {
                "type": "uri_folder"
              },
              "output_in_number": {
                "type": "integer",
                "is_control": "True"
              },
              "is_number_larger_than_zero": {
                "type": "boolean",
                "is_control": "True"
              }
            }
          }
        },
        "systemData": {
          "createdAt": "2023-04-24T03:22:26.1461023\u002B00:00",
          "createdBy": "Firstname Lastname",
          "createdByType": "User",
          "lastModifiedAt": "2023-04-24T03:22:26.1461023\u002B00:00",
          "lastModifiedBy": "Firstname Lastname",
          "lastModifiedByType": "User"
        }
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/datastores/workspaceblobstore?api-version=2022-10-01",
      "RequestMethod": "GET",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "User-Agent": "azure-ai-ml/1.6.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)"
      },
      "RequestBody": null,
      "StatusCode": 200,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Encoding": "gzip",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Mon, 24 Apr 2023 03:22:26 GMT",
        "Expires": "-1",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-969bd12c668abd0df7665a573bdf50be-7b4b4e67b763e6e8-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "Transfer-Encoding": "chunked",
        "Vary": [
          "Accept-Encoding",
          "Accept-Encoding"
        ],
        "x-aml-cluster": "vienna-eastus-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "18592455-9337-40b1-8382-0dd343797b11",
        "x-ms-ratelimit-remaining-subscription-reads": "11996",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "CANADACENTRAL:20230424T032226Z:18592455-9337-40b1-8382-0dd343797b11",
        "x-request-time": "0.112"
      },
      "ResponseBody": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/datastores/workspaceblobstore",
        "name": "workspaceblobstore",
        "type": "Microsoft.MachineLearningServices/workspaces/datastores",
        "properties": {
          "description": null,
          "tags": null,
          "properties": null,
          "isDefault": true,
          "credentials": {
            "credentialsType": "AccountKey"
          },
          "datastoreType": "AzureBlob",
          "accountName": "samcw32zcnpjldw",
          "containerName": "azureml-blobstore-72e8eff8-148b-4582-a07d-efc79559f19f",
          "endpoint": "core.windows.net",
          "protocol": "https",
          "serviceDataAccessAuthIdentity": "WorkspaceSystemAssignedIdentity"
        },
        "systemData": {
          "createdAt": "2023-04-22T04:25:24.8100138\u002B00:00",
          "createdBy": "779301c0-18b2-4cdc-801b-a0a3368fee0a",
          "createdByType": "Application",
          "lastModifiedAt": "2023-04-22T04:25:25.4215298\u002B00:00",
          "lastModifiedBy": "779301c0-18b2-4cdc-801b-a0a3368fee0a",
          "lastModifiedByType": "Application"
        }
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/datastores/workspaceblobstore/listSecrets?api-version=2022-10-01",
      "RequestMethod": "POST",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "0",
        "User-Agent": "azure-ai-ml/1.6.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)"
      },
      "RequestBody": null,
      "StatusCode": 200,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Encoding": "gzip",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Mon, 24 Apr 2023 03:22:26 GMT",
        "Expires": "-1",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-63a23cd094f0652fe3ad39e79d677c89-466248a777fc56ff-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "Transfer-Encoding": "chunked",
        "Vary": "Accept-Encoding",
        "x-aml-cluster": "vienna-eastus-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "a572ff0f-baec-483e-92e8-318f6c2b7be6",
        "x-ms-ratelimit-remaining-subscription-writes": "1198",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "CANADACENTRAL:20230424T032226Z:a572ff0f-baec-483e-92e8-318f6c2b7be6",
        "x-request-time": "0.116"
      },
      "ResponseBody": {
        "secretsType": "AccountKey",
        "key": "dGhpcyBpcyBmYWtlIGtleQ=="
      }
    },
    {
      "RequestUri": "https://samcw32zcnpjldw.blob.core.windows.net/azureml-blobstore-72e8eff8-148b-4582-a07d-efc79559f19f/LocalUpload/00000000000000000000000000000000/e2etests/__init__.py",
      "RequestMethod": "HEAD",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)",
        "x-ms-date": "Mon, 24 Apr 2023 03:22:25 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": null,
      "StatusCode": 404,
      "ResponseHeaders": {
        "Date": "Mon, 24 Apr 2023 03:22:26 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "Transfer-Encoding": "chunked",
        "x-ms-error-code": "BlobNotFound",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://samcw32zcnpjldw.blob.core.windows.net/azureml-blobstore-72e8eff8-148b-4582-a07d-efc79559f19f/LocalUpload/00000000000000000000000000000000/e2etests/__init__.py",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "0",
        "Content-Type": "application/octet-stream",
        "If-None-Match": "*",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)",
        "x-ms-blob-type": "BlockBlob",
        "x-ms-date": "Mon, 24 Apr 2023 03:22:25 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": null,
      "StatusCode": 201,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Content-MD5": "1B2M2Y8AsgTpgAmY7PhCfg==",
        "Date": "Mon, 24 Apr 2023 03:22:27 GMT",
        "ETag": "\u00220x8DB4473216E5FB1\u0022",
        "Last-Modified": "Mon, 24 Apr 2023 03:22:27 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-content-crc64": "AAAAAAAAAAA=",
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://samcw32zcnpjldw.blob.core.windows.net/azureml-blobstore-72e8eff8-148b-4582-a07d-efc79559f19f/LocalUpload/00000000000000000000000000000000/e2etests/test_dsl_pipeline_on_registry.py",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "4441",
        "Content-MD5": "w4/WwgQjAnQ92uQlPcU6MQ==",
        "Content-Type": "application/octet-stream",
        "If-None-Match": "*",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)",
        "x-ms-blob-type": "BlockBlob",
        "x-ms-date": "Mon, 24 Apr 2023 03:22:25 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": "ZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCgppbXBvcnQgcHl0ZXN0CmZyb20gYXp1cmUuY29yZS5leGNlcHRpb25zIGltcG9ydCBSZXNvdXJjZU5vdEZvdW5kRXJyb3IKCmZyb20gYXp1cmUuYWkubWwgaW1wb3J0IElucHV0LCBNTENsaWVudCwgbG9hZF9jb21wb25lbnQsIGxvYWRfbW9kZWwKZnJvbSBhenVyZS5haS5tbC5jb25zdGFudHMgaW1wb3J0IEFzc2V0VHlwZXMKZnJvbSBhenVyZS5haS5tbC5kc2wgaW1wb3J0IHBpcGVsaW5lCmZyb20gZGV2dG9vbHNfdGVzdHV0aWxzIGltcG9ydCBBenVyZVJlY29yZGVkVGVzdENhc2UsIGlzX2xpdmUKZnJvbSB0ZXN0X3V0aWxpdGllcy51dGlscyBpbXBvcnQgX1BZVEVTVF9USU1FT1VUX01FVEhPRCwgYXNzZXJ0X2pvYl9jYW5jZWwKZnJvbSAuLl91dGlsIGltcG9ydCBfRFNMX1RJTUVPVVRfU0VDT05ECgoKZGVmIGFzc2VydF9waXBlbGluZV9qb2JfY2FuY2VsKGNsaWVudDogTUxDbGllbnQsIHNjb3JlX2Z1bmMsIHBpcGVsaW5lX21vZGVsX2lucHV0LCBwaXBlbGluZV90ZXN0X2RhdGEpOgogICAgQHBpcGVsaW5lCiAgICBkZWYgc2NvcmVfcGlwZWxpbmUobW9kZWxfaW5wdXQsIHRlc3RfZGF0YSk6CiAgICAgICAgc2NvcmUgPSBzY29yZV9mdW5jKG1vZGVsX2lucHV0PW1vZGVsX2lucHV0LCB0ZXN0X2RhdGE9dGVzdF9kYXRhKSAgIyBub3FhOiBGODQxCiAgICAgICAgc2NvcmVfZHVwbGljYXRlID0gc2NvcmVfZnVuYyhtb2RlbF9pbnB1dD1tb2RlbF9pbnB1dCwgdGVzdF9kYXRhPXRlc3RfZGF0YSkgICMgbm9xYTogRjg0MQoKICAgIHBpcGVsaW5lX2pvYiA9IHNjb3JlX3BpcGVsaW5lKG1vZGVsX2lucHV0PXBpcGVsaW5lX21vZGVsX2lucHV0LCB0ZXN0X2RhdGE9cGlwZWxpbmVfdGVzdF9kYXRhKQogICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQoKCkBweXRlc3QubWFyay5za2lwaWYoY29uZGl0aW9uPW5vdCBpc19saXZlKCksIHJlYXNvbj0icmVnaXN0cnkgdGVzdCwgbWF5IGZhaWwgaW4gcGxheWJhY2sgbW9kZSIpCkBweXRlc3QubWFyay51c2VmaXh0dXJlcygiZW5hYmxlX3BpcGVsaW5lX3ByaXZhdGVfcHJldmlld19mZWF0dXJlcyIsICJyZWNvcmRlZF90ZXN0IikKQHB5dGVzdC5tYXJrLnRpbWVvdXQodGltZW91dD1fRFNMX1RJTUVPVVRfU0VDT05ELCBtZXRob2Q9X1BZVEVTVF9USU1FT1VUX01FVEhPRCkKQHB5dGVzdC5tYXJrLmUyZXRlc3QKQHB5dGVzdC5tYXJrLnBpcGVsaW5lX3Rlc3QKY2xhc3MgVGVzdERTTFBpcGVsaW5lT25SZWdpc3RyeShBenVyZVJlY29yZGVkVGVzdENhc2UpOgogICAgdGVzdF9kYXRhID0gSW5wdXQoCiAgICAgICAgdHlwZT1Bc3NldFR5cGVzLlVSSV9GSUxFLAogICAgICAgIHBhdGg9Ii4vdGVzdHMvdGVzdF9jb25maWdzL3BpcGVsaW5lX2pvYnMvam9iX3dpdGhfcmVnaXN0cnlfbW9kZWxfYXNfaW5wdXQvZGF0YS9zYW1wbGUxLmNzdiIsCiAgICApCgogICAgZGVmIHRlc3RfcGlwZWxpbmVfam9iX2NyZWF0ZV93aXRoX3JlZ2lzdGVyZWRfY29tcG9uZW50X29uX3JlZ2lzdHJ5KHNlbGYsIHBpcGVsaW5lc19yZWdpc3RyeV9jbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBsb2NhbF9jb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudCgiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9iYXNpY19jb21wb25lbnRfY29kZV9sb2NhbF9wYXRoLnltbCIpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjcmVhdGVkX2NvbXBvbmVudCA9IHBpcGVsaW5lc19yZWdpc3RyeV9jbGllbnQuY29tcG9uZW50cy5nZXQoCiAgICAgICAgICAgICAgICBsb2NhbF9jb21wb25lbnQubmFtZSwgdmVyc2lvbj1sb2NhbF9jb21wb25lbnQudmVyc2lvbgogICAgICAgICAgICApCiAgICAgICAgZXhjZXB0IFJlc291cmNlTm90Rm91bmRFcnJvcjoKICAgICAgICAgICAgY3JlYXRlZF9jb21wb25lbnQgPSBwaXBlbGluZXNfcmVnaXN0cnlfY2xpZW50LmNvbXBvbmVudHMuY3JlYXRlX29yX3VwZGF0ZShsb2NhbF9jb21wb25lbnQpCgogICAgICAgIEBwaXBlbGluZQogICAgICAgIGRlZiBzYW1wbGVfcGlwZWxpbmUoKToKICAgICAgICAgICAgY3JlYXRlZF9jb21wb25lbnQoKQoKICAgICAgICBwaXBlbGluZV9qb2IgPSBzYW1wbGVfcGlwZWxpbmUoKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCiAgICAgICAgYXNzZXJ0IHBpcGVsaW5lc19yZWdpc3RyeV9jbGllbnQuam9icy52YWxpZGF0ZShwaXBlbGluZV9qb2IpLnBhc3NlZAoKICAgICMgdGhpcyB0ZXN0IHdpbGwgYnJlYWsgaW4gcGxheWJhY2sgbW9kZSwgc28gaW5jbHVkZSBpdCBpbiBsaXZlIHRlc3Qgb25seQogICAgZGVmIHRlc3RfcGlwZWxpbmVfd2l0aF9sb2NhbF9jb21wb25lbnRfYW5kX3JlZ2lzdHJ5X21vZGVsX2FzX2lucHV0KHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgICMgbG9hZF9jb21wb25lbnQKICAgICAgICBzY29yZV9mdW5jID0gbG9hZF9jb21wb25lbnQoIi4vdGVzdHMvdGVzdF9jb25maWdzL3BpcGVsaW5lX2pvYnMvam9iX3dpdGhfcmVnaXN0cnlfbW9kZWxfYXNfaW5wdXQvc2NvcmUueW1sIikKCiAgICAgICAgcGlwZWxpbmVfc2NvcmVfbW9kZWwgPSBJbnB1dCgKICAgICAgICAgICAgdHlwZT0iY3VzdG9tX21vZGVsIiwgcGF0aD0iYXp1cmVtbDovL3JlZ2lzdHJpZXMvc2RrLXRlc3QvbW9kZWxzL2lyaXNfbW9kZWwvdmVyc2lvbnMvMSIKICAgICAgICApCgogICAgICAgIGFzc2VydF9waXBlbGluZV9qb2JfY2FuY2VsKGNsaWVudCwgc2NvcmVfZnVuYywgcGlwZWxpbmVfc2NvcmVfbW9kZWwsIHNlbGYudGVzdF9kYXRhKQoKICAgIGRlZiB0ZXN0X3BpcGVsaW5lX3dpdGhfbG9jYWxfY29tcG9uZW50X2FuZF9yZWdpc3RyeV9tb2RlbF9hc19pbnB1dF93aXRoX21vZGVsX2lucHV0KAogICAgICAgIHNlbGYsIGNsaWVudDogTUxDbGllbnQsIHBpcGVsaW5lc19yZWdpc3RyeV9jbGllbnQ6IE1MQ2xpZW50CiAgICApOgogICAgICAgICMgbG9hZF9jb21wb25lbnQKICAgICAgICBzY29yZV9mdW5jID0gbG9hZF9jb21wb25lbnQoIi4vdGVzdHMvdGVzdF9jb25maWdzL3BpcGVsaW5lX2pvYnMvam9iX3dpdGhfcmVnaXN0cnlfbW9kZWxfYXNfaW5wdXQvc2NvcmUueW1sIikKCiAgICAgICAgbW9kZWxfcGF0aCA9IFBhdGgoIi4vdGVzdHMvdGVzdF9jb25maWdzL21vZGVsL21vZGVsX2lyaXMueW1sIikKICAgICAgICBtb2RlbF9lbnRpdHkgPSBsb2FkX21vZGVsKG1vZGVsX3BhdGgpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwaXBlbGluZV9zY29yZV9tb2RlbCA9IHBpcGVsaW5lc19yZWdpc3RyeV9jbGllbnQubW9kZWxzLmdldCgKICAgICAgICAgICAgICAgIG5hbWU9bW9kZWxfZW50aXR5Lm5hbWUsIHZlcnNpb249bW9kZWxfZW50aXR5LnZlcnNpb24KICAgICAgICAgICAgKQogICAgICAgIGV4Y2VwdCBSZXNvdXJjZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgICAgIG1vZGVsX2VudGl0eSA9IHBpcGVsaW5lc19yZWdpc3RyeV9jbGllbnQubW9kZWxzLmNyZWF0ZV9vcl91cGRhdGUobW9kZWxfZW50aXR5KQogICAgICAgICAgICBwaXBlbGluZV9zY29yZV9tb2RlbCA9IHBpcGVsaW5lc19yZWdpc3RyeV9jbGllbnQubW9kZWxzLmdldCgKICAgICAgICAgICAgICAgIG5hbWU9bW9kZWxfZW50aXR5Lm5hbWUsIHZlcnNpb249bW9kZWxfZW50aXR5LnZlcnNpb24KICAgICAgICAgICAgKQoKICAgICAgICBhc3NlcnRfcGlwZWxpbmVfam9iX2NhbmNlbChjbGllbnQsIHNjb3JlX2Z1bmMsIHBpcGVsaW5lX3Njb3JlX21vZGVsLCBzZWxmLnRlc3RfZGF0YSkKCiAgICBkZWYgdGVzdF9waXBlbGluZV93aXRoX3JlZ2lzdHJ5X2NvbXBvbmVudF9hbmRfbW9kZWxfYXNfaW5wdXQoCiAgICAgICAgc2VsZiwgY2xpZW50OiBNTENsaWVudCwgcGlwZWxpbmVzX3JlZ2lzdHJ5X2NsaWVudDogTUxDbGllbnQKICAgICk6CiAgICAgICAgIyBsb2FkX2NvbXBvbmVudAogICAgICAgIHNjb3JlX2NvbXBvbmVudF9uYW1lLCBjb21wb25lbnRfdmVyc2lvbiA9ICJzY29yZV9jb21wb25lbnQiLCAiMiIKICAgICAgICBzY29yZV9mdW5jID0gcGlwZWxpbmVzX3JlZ2lzdHJ5X2NsaWVudC5jb21wb25lbnRzLmdldChuYW1lPXNjb3JlX2NvbXBvbmVudF9uYW1lLCB2ZXJzaW9uPWNvbXBvbmVudF92ZXJzaW9uKQoKICAgICAgICBwaXBlbGluZV9zY29yZV9tb2RlbCA9IElucHV0KAogICAgICAgICAgICB0eXBlPSJtbGZsb3dfbW9kZWwiLCBwYXRoPSJhenVyZW1sOi8vcmVnaXN0cmllcy9zZGstdGVzdC9tb2RlbHMvaXJpc19tb2RlbC92ZXJzaW9ucy8xIgogICAgICAgICkKCiAgICAgICAgYXNzZXJ0X3BpcGVsaW5lX2pvYl9jYW5jZWwoY2xpZW50LCBzY29yZV9mdW5jLCBwaXBlbGluZV9zY29yZV9tb2RlbCwgc2VsZi50ZXN0X2RhdGEpCg==",
      "StatusCode": 201,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Content-MD5": "w4/WwgQjAnQ92uQlPcU6MQ==",
        "Date": "Mon, 24 Apr 2023 03:22:27 GMT",
        "ETag": "\u00220x8DB44732179F6C6\u0022",
        "Last-Modified": "Mon, 24 Apr 2023 03:22:27 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-content-crc64": "5gxaAnUt0/8=",
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://samcw32zcnpjldw.blob.core.windows.net/azureml-blobstore-72e8eff8-148b-4582-a07d-efc79559f19f/LocalUpload/00000000000000000000000000000000/e2etests/test_controlflow_pipeline.py",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "44555",
        "Content-MD5": "M\u002BAluAj0SxPdZWYt7IbNyA==",
        "Content-Type": "application/octet-stream",
        "If-None-Match": "*",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)",
        "x-ms-blob-type": "BlockBlob",
        "x-ms-date": "Mon, 24 Apr 2023 03:22:25 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": "ZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCgppbXBvcnQgcHl0ZXN0CmZyb20gZGV2dG9vbHNfdGVzdHV0aWxzIGltcG9ydCBBenVyZVJlY29yZGVkVGVzdENhc2UsIGlzX2xpdmUKZnJvbSB0ZXN0X3V0aWxpdGllcy51dGlscyBpbXBvcnQgX1BZVEVTVF9USU1FT1VUX01FVEhPRCwgYXNzZXJ0X2pvYl9jYW5jZWwsIG9taXRfd2l0aF93aWxkY2FyZAoKZnJvbSBhenVyZS5haS5tbCBpbXBvcnQgSW5wdXQsIE1MQ2xpZW50LCBPdXRwdXQsIGxvYWRfY29tcG9uZW50CmZyb20gYXp1cmUuYWkubWwuZHNsIGltcG9ydCBwaXBlbGluZQpmcm9tIGF6dXJlLmFpLm1sLmRzbC5fY29uZGl0aW9uIGltcG9ydCBjb25kaXRpb24KZnJvbSBhenVyZS5haS5tbC5kc2wuX2RvX3doaWxlIGltcG9ydCBkb193aGlsZQpmcm9tIGF6dXJlLmFpLm1sLmRzbC5fZ3JvdXBfZGVjb3JhdG9yIGltcG9ydCBncm91cApmcm9tIGF6dXJlLmFpLm1sLmRzbC5fcGFyYWxsZWxfZm9yIGltcG9ydCBwYXJhbGxlbF9mb3IKCmZyb20gLi5fdXRpbCBpbXBvcnQgX0RTTF9USU1FT1VUX1NFQ09ORCwgaW5jbHVkZV9wcml2YXRlX3ByZXZpZXdfbm9kZXNfaW5fcGlwZWxpbmUKCnRlc3RfaW5wdXQgPSBJbnB1dCgKICAgIHR5cGU9InVyaV9maWxlIiwKICAgIHBhdGg9Imh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IiwKKQoKb21pdF9maWVsZHMgPSBbCiAgICAibmFtZSIsCiAgICAicHJvcGVydGllcy5kaXNwbGF5X25hbWUiLAogICAgInByb3BlcnRpZXMuam9icy4qLmNvbXBvbmVudElkIiwKICAgICJwcm9wZXJ0aWVzLnNldHRpbmdzIiwKXQoKCkBweXRlc3QubWFyay51c2VmaXh0dXJlcygKICAgICJlbmFibGVfcHJpdmF0ZV9wcmV2aWV3X3NjaGVtYV9mZWF0dXJlcyIsCiAgICAiZW5hYmxlX2Vudmlyb25tZW50X2lkX2FybV9leHBhbnNpb24iLAogICAgImVuYWJsZV9waXBlbGluZV9wcml2YXRlX3ByZXZpZXdfZmVhdHVyZXMiLAogICAgIm1vY2tfY29kZV9oYXNoIiwKICAgICJtb2NrX2Fzc2V0X25hbWUiLAogICAgIm1vY2tfY29tcG9uZW50X2hhc2giLAogICAgIm1vY2tfc2V0X2hlYWRlcnNfd2l0aF91c2VyX2FtbF90b2tlbiIsCiAgICAicmVjb3JkZWRfdGVzdCIsCiAgICAidXNlX3B5dGhvbl9hbWxpZ25vcmVfZHVyaW5nX3VwbG9hZCIsCikKQHB5dGVzdC5tYXJrLnRpbWVvdXQodGltZW91dD1fRFNMX1RJTUVPVVRfU0VDT05ELCBtZXRob2Q9X1BZVEVTVF9USU1FT1VUX01FVEhPRCkKQHB5dGVzdC5tYXJrLmUyZXRlc3QKQHB5dGVzdC5tYXJrLnBpcGVsaW5lX3Rlc3QKY2xhc3MgVGVzdENvbnRyb2xGbG93UGlwZWxpbmUoQXp1cmVSZWNvcmRlZFRlc3RDYXNlKToKICAgIHBhc3MKCgpAcHl0ZXN0Lm1hcmsudXNlZml4dHVyZXMoIm1vY2tfYW5vbl9jb21wb25lbnRfdmVyc2lvbiIpCmNsYXNzIFRlc3RJZkVsc2UoVGVzdENvbnRyb2xGbG93UGlwZWxpbmUpOgogICAgZGVmIHRlc3RfZHNsX2NvbmRpdGlvbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICAjIHVwZGF0ZSBqb2JzIGZpZWxkIHRvIGluY2x1ZGUgcHJpdmF0ZSBwcmV2aWV3IG5vZGVzCgogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9ub19wYXRocyA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICBzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnRfbm9fcGF0aHMueW1sIgogICAgICAgICkKICAgICAgICBiYXNpY19jb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudCgKICAgICAgICAgICAgc291cmNlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2NvbXBvbmVudF93aXRoX2NvbmRpdGlvbmFsX291dHB1dC9zcGVjLnlhbWwiCiAgICAgICAgKQoKICAgICAgICBAcGlwZWxpbmUoCiAgICAgICAgICAgIG5hbWU9InRlc3RfbWxkZXNpZ25lcl9jb21wb25lbnRfd2l0aF9jb25kaXRpb25hbF9vdXRwdXQiLAogICAgICAgICAgICBjb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgKQogICAgICAgIGRlZiBjb25kaXRpb25fcGlwZWxpbmUoKToKICAgICAgICAgICAgcmVzdWx0ID0gYmFzaWNfY29tcG9uZW50KCkKCiAgICAgICAgICAgIG5vZGUxID0gaGVsbG9fd29ybGRfY29tcG9uZW50X25vX3BhdGhzKGNvbXBvbmVudF9pbl9udW1iZXI9MSkKICAgICAgICAgICAgbm9kZTIgPSBoZWxsb193b3JsZF9jb21wb25lbnRfbm9fcGF0aHMoY29tcG9uZW50X2luX251bWJlcj0yKQogICAgICAgICAgICBjb25kaXRpb24oY29uZGl0aW9uPXJlc3VsdC5vdXRwdXRzLm91dHB1dCwgZmFsc2VfYmxvY2s9bm9kZTEsIHRydWVfYmxvY2s9bm9kZTIpCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNvbmRpdGlvbl9waXBlbGluZSgpCgogICAgICAgICMgaW5jbHVkZSBwcml2YXRlIHByZXZpZXcgbm9kZXMKICAgICAgICB3aXRoIGluY2x1ZGVfcHJpdmF0ZV9wcmV2aWV3X25vZGVzX2luX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHBpcGVsaW5lX2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQoKICAgICAgICBkc2xfcGlwZWxpbmVfam9iX2RpY3QgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKSwgKm9taXRfZmllbGRzKQogICAgICAgIGFzc2VydCBkc2xfcGlwZWxpbmVfam9iX2RpY3RbInByb3BlcnRpZXMiXVsiam9icyJdID09IHsKICAgICAgICAgICAgImNvbmRpdGlvbm5vZGUiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJEU0wiLAogICAgICAgICAgICAgICAgImNvbmRpdGlvbiI6ICIke3twYXJlbnQuam9icy5yZXN1bHQub3V0cHV0cy5vdXRwdXR9fSIsCiAgICAgICAgICAgICAgICAiZmFsc2VfYmxvY2siOiAiJHt7cGFyZW50LmpvYnMubm9kZTF9fSIsCiAgICAgICAgICAgICAgICAidHJ1ZV9ibG9jayI6ICIke3twYXJlbnQuam9icy5ub2RlMn19IiwKICAgICAgICAgICAgICAgICJ0eXBlIjogImlmX2Vsc2UiLAogICAgICAgICAgICB9LAogICAgICAgICAgICAibm9kZTEiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJSRU1PVEUuV09SS1NQQUNFLkNPTVBPTkVOVCIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogeyJjb21wb25lbnRfaW5fbnVtYmVyIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjEifX0sCiAgICAgICAgICAgICAgICAibmFtZSI6ICJub2RlMSIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm5vZGUyIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiUkVNT1RFLldPUktTUEFDRS5DT01QT05FTlQiLAogICAgICAgICAgICAgICAgImlucHV0cyI6IHsiY29tcG9uZW50X2luX251bWJlciI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIyIn19LAogICAgICAgICAgICAgICAgIm5hbWUiOiAibm9kZTIiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJyZXN1bHQiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJSRU1PVEUuV09SS1NQQUNFLkNPTVBPTkVOVCIsCiAgICAgICAgICAgICAgICAibmFtZSI6ICJyZXN1bHQiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgfQoKICAgIGRlZiB0ZXN0X2RzbF9jb25kaXRpb25fcGlwZWxpbmVfd2l0aF9wcmltaXRpdmVfaW5wdXQoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X25vX3BhdGhzID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgIHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudF9ub19wYXRocy55bWwiCiAgICAgICAgKQoKICAgICAgICBAcGlwZWxpbmUoCiAgICAgICAgICAgIG5hbWU9InRlc3RfbWxkZXNpZ25lcl9jb21wb25lbnRfd2l0aF9jb25kaXRpb25hbF9vdXRwdXQiLAogICAgICAgICAgICBjb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgKQogICAgICAgIGRlZiBjb25kaXRpb25fcGlwZWxpbmUoKToKICAgICAgICAgICAgbm9kZTEgPSBoZWxsb193b3JsZF9jb21wb25lbnRfbm9fcGF0aHMoY29tcG9uZW50X2luX251bWJlcj0xKQogICAgICAgICAgICBub2RlMiA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudF9ub19wYXRocyhjb21wb25lbnRfaW5fbnVtYmVyPTIpCiAgICAgICAgICAgIGNvbmRpdGlvbihjb25kaXRpb249VHJ1ZSwgZmFsc2VfYmxvY2s9bm9kZTEsIHRydWVfYmxvY2s9bm9kZTIpCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNvbmRpdGlvbl9waXBlbGluZSgpCiAgICAgICAgd2l0aCBpbmNsdWRlX3ByaXZhdGVfcHJldmlld19ub2Rlc19pbl9waXBlbGluZSgpOgogICAgICAgICAgICByZXN0X2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQoKICAgICAgICBkc2xfcGlwZWxpbmVfam9iX2RpY3QgPSBvbWl0X3dpdGhfd2lsZGNhcmQocmVzdF9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpLCAqb21pdF9maWVsZHMpCiAgICAgICAgYXNzZXJ0IGRzbF9waXBlbGluZV9qb2JfZGljdFsicHJvcGVydGllcyJdWyJqb2JzIl0gPT0gewogICAgICAgICAgICAiY29uZGl0aW9ubm9kZSI6IHsKICAgICAgICAgICAgICAgICJfc291cmNlIjogIkRTTCIsCiAgICAgICAgICAgICAgICAiY29uZGl0aW9uIjogVHJ1ZSwKICAgICAgICAgICAgICAgICJmYWxzZV9ibG9jayI6ICIke3twYXJlbnQuam9icy5ub2RlMX19IiwKICAgICAgICAgICAgICAgICJ0cnVlX2Jsb2NrIjogIiR7e3BhcmVudC5qb2JzLm5vZGUyfX0iLAogICAgICAgICAgICAgICAgInR5cGUiOiAiaWZfZWxzZSIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJub2RlMSI6IHsKICAgICAgICAgICAgICAgICJfc291cmNlIjogIlJFTU9URS5XT1JLU1BBQ0UuQ09NUE9ORU5UIiwKICAgICAgICAgICAgICAgICJpbnB1dHMiOiB7ImNvbXBvbmVudF9pbl9udW1iZXIiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMSJ9fSwKICAgICAgICAgICAgICAgICJuYW1lIjogIm5vZGUxIiwKICAgICAgICAgICAgICAgICJ0eXBlIjogImNvbW1hbmQiLAogICAgICAgICAgICB9LAogICAgICAgICAgICAibm9kZTIiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJSRU1PVEUuV09SS1NQQUNFLkNPTVBPTkVOVCIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogeyJjb21wb25lbnRfaW5fbnVtYmVyIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjIifX0sCiAgICAgICAgICAgICAgICAibmFtZSI6ICJub2RlMiIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgfSwKICAgICAgICB9CgogICAgZGVmIHRlc3RfZHNsX2NvbmRpdGlvbl9waXBlbGluZV93aXRoX29uZV9icmFuY2goc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X25vX3BhdGhzID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgIHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudF9ub19wYXRocy55bWwiCiAgICAgICAgKQoKICAgICAgICBAcGlwZWxpbmUoCiAgICAgICAgICAgIGNvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICApCiAgICAgICAgZGVmIGNvbmRpdGlvbl9waXBlbGluZSgpOgogICAgICAgICAgICBub2RlMSA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudF9ub19wYXRocyhjb21wb25lbnRfaW5fbnVtYmVyPTEpCiAgICAgICAgICAgIGNvbmRpdGlvbihjb25kaXRpb249VHJ1ZSwgZmFsc2VfYmxvY2s9bm9kZTEpCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNvbmRpdGlvbl9waXBlbGluZSgpCiAgICAgICAgd2l0aCBpbmNsdWRlX3ByaXZhdGVfcHJldmlld19ub2Rlc19pbl9waXBlbGluZSgpOgogICAgICAgICAgICByZXN0X2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQoKICAgICAgICBkc2xfcGlwZWxpbmVfam9iX2RpY3QgPSBvbWl0X3dpdGhfd2lsZGNhcmQocmVzdF9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpLCAqb21pdF9maWVsZHMpCiAgICAgICAgYXNzZXJ0IGRzbF9waXBlbGluZV9qb2JfZGljdFsicHJvcGVydGllcyJdWyJqb2JzIl0gPT0gewogICAgICAgICAgICAiY29uZGl0aW9ubm9kZSI6IHsKICAgICAgICAgICAgICAgICJfc291cmNlIjogIkRTTCIsCiAgICAgICAgICAgICAgICAiY29uZGl0aW9uIjogVHJ1ZSwKICAgICAgICAgICAgICAgICJmYWxzZV9ibG9jayI6ICIke3twYXJlbnQuam9icy5ub2RlMX19IiwKICAgICAgICAgICAgICAgICJ0eXBlIjogImlmX2Vsc2UiLAogICAgICAgICAgICB9LAogICAgICAgICAgICAibm9kZTEiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJSRU1PVEUuV09SS1NQQUNFLkNPTVBPTkVOVCIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogeyJjb21wb25lbnRfaW5fbnVtYmVyIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjEifX0sCiAgICAgICAgICAgICAgICAibmFtZSI6ICJub2RlMSIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgfSwKICAgICAgICB9CgogICAgZGVmIHRlc3RfcmVnaXN0ZXJlZF9jb21wb25lbnRfaXNfY29udHJvbChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBwcmltaXRpdmVfY29tcG9uZW50X3dpdGhfbm9ybWFsX2lucHV0X291dHB1dF92MiA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICBzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvZG9fd2hpbGVfdGVzdC9wcmltaXRpdmVfY29tcG9uZW50X3dpdGhfbm9ybWFsX2lucHV0X291dHB1dF92Mi55YW1sIgogICAgICAgICkKICAgICAgICBwcmltaXRpdmVfY29tcG9uZW50X3dpdGhfbm9ybWFsX2lucHV0X291dHB1dF92Mi5vdXRwdXRzWyJib29sX3BhcmFtX291dHB1dCJdLmVhcmx5X2F2YWlsYWJsZSA9IFRydWUKICAgICAgICByZWdpc3RlcmVkX2NvbXBvbmVudCA9IGNsaWVudC5jb21wb25lbnRzLmNyZWF0ZV9vcl91cGRhdGUocHJpbWl0aXZlX2NvbXBvbmVudF93aXRoX25vcm1hbF9pbnB1dF9vdXRwdXRfdjIpCiAgICAgICAgcmVzdF9kaWN0ID0gcmVnaXN0ZXJlZF9jb21wb25lbnQuX3RvX2RpY3QoKQogICAgICAgICMgQXNzZXJ0IGlzX2NvbnRyb2wgd2l0aCBjb3JyZWN0IGJvb2wgdHlwZQogICAgICAgIGV4cGVjdGVkX2RpY3QgPSB7CiAgICAgICAgICAgICJvdXRwdXRfZGF0YSI6IHsidHlwZSI6ICJ1cmlfZm9sZGVyIn0sCiAgICAgICAgICAgICJib29sX3BhcmFtX291dHB1dCI6IHsidHlwZSI6ICJib29sZWFuIiwgImlzX2NvbnRyb2wiOiBUcnVlLCAiZWFybHlfYXZhaWxhYmxlIjogVHJ1ZX0sCiAgICAgICAgICAgICJpbnRfcGFyYW1fb3V0cHV0IjogeyJ0eXBlIjogImludGVnZXIiLCAiaXNfY29udHJvbCI6IFRydWV9LAogICAgICAgICAgICAiZmxvYXRfcGFyYW1fb3V0cHV0IjogeyJ0eXBlIjogIm51bWJlciIsICJpc19jb250cm9sIjogVHJ1ZX0sCiAgICAgICAgICAgICJzdHJfcGFyYW1fb3V0cHV0IjogeyJ0eXBlIjogInN0cmluZyIsICJpc19jb250cm9sIjogVHJ1ZX0sCiAgICAgICAgfQogICAgICAgIGFzc2VydCByZXN0X2RpY3RbIm91dHB1dHMiXSA9PSBleHBlY3RlZF9kaWN0CgogICAgICAgICMgQXNzZXJ0IG9uIHBpcGVsaW5lIGNvbXBvbmVudAogICAgICAgIEBncm91cAogICAgICAgIGNsYXNzIENvbnRyb2xPdXRwdXRHcm91cDoKICAgICAgICAgICAgb3V0cHV0X2RhdGE6IE91dHB1dCh0eXBlPSJ1cmlfZm9sZGVyIikKICAgICAgICAgICAgZmxvYXRfcGFyYW1fb3V0cHV0OiBPdXRwdXQodHlwZT0ibnVtYmVyIiwgaXNfY29udHJvbD1UcnVlKQogICAgICAgICAgICBpbnRfcGFyYW1fb3V0cHV0OiBPdXRwdXQodHlwZT0iaW50ZWdlciIsIGlzX2NvbnRyb2w9VHJ1ZSkKICAgICAgICAgICAgYm9vbF9wYXJhbV9vdXRwdXQ6IE91dHB1dCh0eXBlPSJib29sZWFuIiwgaXNfY29udHJvbD1UcnVlKQogICAgICAgICAgICBzdHJfcGFyYW1fb3V0cHV0OiBPdXRwdXQodHlwZT0ic3RyaW5nIiwgaXNfY29udHJvbD1UcnVlKQoKICAgICAgICBAcGlwZWxpbmUoKQogICAgICAgIGRlZiB0ZXN0X3BpcGVsaW5lX2NvbXBvbmVudF9jb250cm9sX291dHB1dCgpIC0\u002BIENvbnRyb2xPdXRwdXRHcm91cDoKICAgICAgICAgICAgbm9kZSA9IHByaW1pdGl2ZV9jb21wb25lbnRfd2l0aF9ub3JtYWxfaW5wdXRfb3V0cHV0X3YyKAogICAgICAgICAgICAgICAgaW5wdXRfZGF0YT10ZXN0X2lucHV0LCBwYXJhbWJvb2w9VHJ1ZSwgcGFyYW1pbnQ9MiwgcGFyYW1mbG9hdD0yLjIsIHBhcmFtc3RyPSJ0ZXN0IgogICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiBub2RlLm91dHB1dHMKCiAgICAgICAgcmVnaXN0ZXJlZF9waXBlbGluZV9jb21wb25lbnQgPSBjbGllbnQuY29tcG9uZW50cy5jcmVhdGVfb3JfdXBkYXRlKHRlc3RfcGlwZWxpbmVfY29tcG9uZW50X2NvbnRyb2xfb3V0cHV0KQogICAgICAgIHJlc3RfZGljdCA9IHJlZ2lzdGVyZWRfcGlwZWxpbmVfY29tcG9uZW50Ll90b19kaWN0KCkKICAgICAgICBhc3NlcnQgcmVzdF9kaWN0WyJvdXRwdXRzIl0gPT0gZXhwZWN0ZWRfZGljdAoKICAgIGRlZiB0ZXN0X2RvX3doaWxlX2NvbWJpbmVkX2lmX2Vsc2Uoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgZG9fd2hpbGVfYm9keV9jb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudCgKICAgICAgICAgICAgc291cmNlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2RvX3doaWxlX3Rlc3QvZG9fd2hpbGVfYm9keV9jb21wb25lbnQueWFtbCIKICAgICAgICApCiAgICAgICAgcHJpbWl0aXZlX2NvbXBvbmVudF93aXRoX25vcm1hbF9pbnB1dF9vdXRwdXRfdjIgPSBsb2FkX2NvbXBvbmVudCgKICAgICAgICAgICAgc291cmNlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2RvX3doaWxlX3Rlc3QvcHJpbWl0aXZlX2NvbXBvbmVudF93aXRoX25vcm1hbF9pbnB1dF9vdXRwdXRfdjIueWFtbCIKICAgICAgICApCgogICAgICAgIEBwaXBlbGluZShkZWZhdWx0X2NvbXB1dGVfdGFyZ2V0PSJjcHUtY2x1c3RlciIsIGNvbnRpbnVlX29uX3N0ZXBfZmFpbHVyZT1UcnVlKQogICAgICAgIGRlZiB0ZXN0X3BpcGVsaW5lKGlucHV0X2RhdGEsIGludF9wYXJhbSwgYm9vbF9wYXJhbSwgZmxvYXRfcGFyYW0sIHN0cl9wYXJhbSk6CiAgICAgICAgICAgIGRvX3doaWxlX2JvZHlfZnVuYyA9IGRvX3doaWxlX2JvZHlfY29tcG9uZW50KAogICAgICAgICAgICAgICAgaW5wdXRfMT1pbnB1dF9kYXRhLAogICAgICAgICAgICAgICAgaW5wdXRfMj1pbnB1dF9kYXRhLAogICAgICAgICAgICAgICAgaW50X3BhcmFtPWludF9wYXJhbSwKICAgICAgICAgICAgICAgIGJvb2xfcGFyYW09Ym9vbF9wYXJhbSwKICAgICAgICAgICAgICAgIGZsb2F0X3BhcmFtPWZsb2F0X3BhcmFtLAogICAgICAgICAgICAgICAgc3RyX3BhcmFtPXN0cl9wYXJhbSwKICAgICAgICAgICAgKQoKICAgICAgICAgICAgZG9fd2hpbGUoCiAgICAgICAgICAgICAgICBib2R5PWRvX3doaWxlX2JvZHlfZnVuYywKICAgICAgICAgICAgICAgIGNvbmRpdGlvbj1kb193aGlsZV9ib2R5X2Z1bmMub3V0cHV0cy5jb25kaXRpb24sCiAgICAgICAgICAgICAgICBtYXBwaW5nPXsKICAgICAgICAgICAgICAgICAgICBkb193aGlsZV9ib2R5X2Z1bmMub3V0cHV0cy5vdXRwdXRfMTogZG9fd2hpbGVfYm9keV9mdW5jLmlucHV0cy5pbnB1dF8xLAogICAgICAgICAgICAgICAgICAgIGRvX3doaWxlX2JvZHlfZnVuYy5vdXRwdXRzLm91dHB1dF8yOiBkb193aGlsZV9ib2R5X2Z1bmMuaW5wdXRzLmlucHV0XzIsCiAgICAgICAgICAgICAgICAgICAgZG9fd2hpbGVfYm9keV9mdW5jLm91dHB1dHMuaW50X3BhcmFtX291dHB1dDogZG9fd2hpbGVfYm9keV9mdW5jLmlucHV0cy5pbnRfcGFyYW0sCiAgICAgICAgICAgICAgICAgICAgZG9fd2hpbGVfYm9keV9mdW5jLm91dHB1dHMuYm9vbF9wYXJhbV9vdXRwdXQ6IGRvX3doaWxlX2JvZHlfZnVuYy5pbnB1dHMuYm9vbF9wYXJhbSwKICAgICAgICAgICAgICAgICAgICBkb193aGlsZV9ib2R5X2Z1bmMub3V0cHV0cy5mbG9hdF9wYXJhbV9vdXRwdXQ6IGRvX3doaWxlX2JvZHlfZnVuYy5pbnB1dHMuZmxvYXRfcGFyYW0sCiAgICAgICAgICAgICAgICAgICAgZG9fd2hpbGVfYm9keV9mdW5jLm91dHB1dHMuc3RyX3BhcmFtX291dHB1dDogZG9fd2hpbGVfYm9keV9mdW5jLmlucHV0cy5zdHJfcGFyYW0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWF4X2l0ZXJhdGlvbl9jb3VudD0zLAogICAgICAgICAgICApCgogICAgICAgICAgICBwcmltaXRpdmVfb3V0cHV0X2NvbXBvbmVudF90cnVlID0gcHJpbWl0aXZlX2NvbXBvbmVudF93aXRoX25vcm1hbF9pbnB1dF9vdXRwdXRfdjIoCiAgICAgICAgICAgICAgICBpbnB1dF9kYXRhPWRvX3doaWxlX2JvZHlfZnVuYy5vdXRwdXRzLm91dHB1dF8xLAogICAgICAgICAgICAgICAgcGFyYW1ib29sPWRvX3doaWxlX2JvZHlfZnVuYy5vdXRwdXRzLmJvb2xfcGFyYW1fb3V0cHV0LAogICAgICAgICAgICAgICAgcGFyYW1pbnQ9ZG9fd2hpbGVfYm9keV9mdW5jLm91dHB1dHMuaW50X3BhcmFtX291dHB1dCwKICAgICAgICAgICAgICAgIHBhcmFtZmxvYXQ9ZG9fd2hpbGVfYm9keV9mdW5jLm91dHB1dHMuZmxvYXRfcGFyYW1fb3V0cHV0LAogICAgICAgICAgICAgICAgcGFyYW1zdHI9ZG9fd2hpbGVfYm9keV9mdW5jLm91dHB1dHMuc3RyX3BhcmFtX291dHB1dCwKICAgICAgICAgICAgKQoKICAgICAgICAgICAgY29uZGl0aW9uKGNvbmRpdGlvbj1kb193aGlsZV9ib2R5X2Z1bmMub3V0cHV0cy5jb25kaXRpb24sIHRydWVfYmxvY2s9cHJpbWl0aXZlX291dHB1dF9jb21wb25lbnRfdHJ1ZSkKCiAgICAgICAgcGlwZWxpbmVfam9iID0gdGVzdF9waXBlbGluZSgKICAgICAgICAgICAgaW5wdXRfZGF0YT10ZXN0X2lucHV0LCBpbnRfcGFyYW09NCwgYm9vbF9wYXJhbT1UcnVlLCBmbG9hdF9wYXJhbT0yMi4wLCBzdHJfcGFyYW09InN0cmluZ19wYXJhbV9ub19zcGFjZSIKICAgICAgICApCgogICAgICAgIHdpdGggaW5jbHVkZV9wcml2YXRlX3ByZXZpZXdfbm9kZXNfaW5fcGlwZWxpbmUoKToKICAgICAgICAgICAgcmVzdF9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZV9qb2IsIGNsaWVudCkKCiAgICAgICAgZHNsX3BpcGVsaW5lX2pvYl9kaWN0ID0gb21pdF93aXRoX3dpbGRjYXJkKHJlc3Rfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKSwgKm9taXRfZmllbGRzKQogICAgICAgIGFzc2VydCBkc2xfcGlwZWxpbmVfam9iX2RpY3RbInByb3BlcnRpZXMiXVsiam9icyJdID09IHsKICAgICAgICAgICAgImNvbmRpdGlvbm5vZGUiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJEU0wiLAogICAgICAgICAgICAgICAgImNvbmRpdGlvbiI6ICIke3twYXJlbnQuam9icy5kb193aGlsZV9ib2R5X2Z1bmMub3V0cHV0cy5jb25kaXRpb259fSIsCiAgICAgICAgICAgICAgICAidHJ1ZV9ibG9jayI6ICIke3twYXJlbnQuam9icy5wcmltaXRpdmVfb3V0cHV0X2NvbXBvbmVudF90cnVlfX0iLAogICAgICAgICAgICAgICAgInR5cGUiOiAiaWZfZWxzZSIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJkb193aGlsZV9ib2R5X2Z1bmMiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJSRU1PVEUuV09SS1NQQUNFLkNPTVBPTkVOVCIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJib29sX3BhcmFtIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuYm9vbF9wYXJhbX19In0sCiAgICAgICAgICAgICAgICAgICAgImZsb2F0X3BhcmFtIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuZmxvYXRfcGFyYW19fSJ9LAogICAgICAgICAgICAgICAgICAgICJpbnB1dF8xIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuaW5wdXRfZGF0YX19In0sCiAgICAgICAgICAgICAgICAgICAgImlucHV0XzIiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5pbnB1dF9kYXRhfX0ifSwKICAgICAgICAgICAgICAgICAgICAiaW50X3BhcmFtIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuaW50X3BhcmFtfX0ifSwKICAgICAgICAgICAgICAgICAgICAic3RyX3BhcmFtIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuc3RyX3BhcmFtfX0ifSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibmFtZSI6ICJkb193aGlsZV9ib2R5X2Z1bmMiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJkb3doaWxlIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiRFNMIiwKICAgICAgICAgICAgICAgICJib2R5IjogIiR7e3BhcmVudC5qb2JzLmRvX3doaWxlX2JvZHlfZnVuY319IiwKICAgICAgICAgICAgICAgICJjb25kaXRpb24iOiAiY29uZGl0aW9uIiwKICAgICAgICAgICAgICAgICJsaW1pdHMiOiB7Im1heF9pdGVyYXRpb25fY291bnQiOiAzfSwKICAgICAgICAgICAgICAgICJtYXBwaW5nIjogewogICAgICAgICAgICAgICAgICAgICJib29sX3BhcmFtX291dHB1dCI6IFsiYm9vbF9wYXJhbSJdLAogICAgICAgICAgICAgICAgICAgICJmbG9hdF9wYXJhbV9vdXRwdXQiOiBbImZsb2F0X3BhcmFtIl0sCiAgICAgICAgICAgICAgICAgICAgImludF9wYXJhbV9vdXRwdXQiOiBbImludF9wYXJhbSJdLAogICAgICAgICAgICAgICAgICAgICJvdXRwdXRfMSI6IFsiaW5wdXRfMSJdLAogICAgICAgICAgICAgICAgICAgICJvdXRwdXRfMiI6IFsiaW5wdXRfMiJdLAogICAgICAgICAgICAgICAgICAgICJzdHJfcGFyYW1fb3V0cHV0IjogWyJzdHJfcGFyYW0iXSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidHlwZSI6ICJkb193aGlsZSIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJwcmltaXRpdmVfb3V0cHV0X2NvbXBvbmVudF90cnVlIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiUkVNT1RFLldPUktTUEFDRS5DT01QT05FTlQiLAogICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAiaW5wdXRfZGF0YSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmpvYnMuZG9fd2hpbGVfYm9keV9mdW5jLm91dHB1dHMub3V0cHV0XzF9fSIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAicGFyYW1ib29sIjogewogICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuam9icy5kb193aGlsZV9ib2R5X2Z1bmMub3V0cHV0cy5ib29sX3BhcmFtX291dHB1dH19IiwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJwYXJhbWZsb2F0IjogewogICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuam9icy5kb193aGlsZV9ib2R5X2Z1bmMub3V0cHV0cy5mbG9hdF9wYXJhbV9vdXRwdXR9fSIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAicGFyYW1pbnQiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5qb2JzLmRvX3doaWxlX2JvZHlfZnVuYy5vdXRwdXRzLmludF9wYXJhbV9vdXRwdXR9fSIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAicGFyYW1zdHIiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5qb2JzLmRvX3doaWxlX2JvZHlfZnVuYy5vdXRwdXRzLnN0cl9wYXJhbV9vdXRwdXR9fSIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibmFtZSI6ICJwcmltaXRpdmVfb3V0cHV0X2NvbXBvbmVudF90cnVlIiwKICAgICAgICAgICAgICAgICJ0eXBlIjogImNvbW1hbmQiLAogICAgICAgICAgICB9LAogICAgICAgIH0KCiAgICBkZWYgdGVzdF9pZl9lbHNlX211bHRpcGxlX2Jsb2NrcyhzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfbm9fcGF0aHMgPSBsb2FkX2NvbXBvbmVudCgKICAgICAgICAgICAgc291cmNlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50X25vX3BhdGhzLnltbCIKICAgICAgICApCiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50ID0gbG9hZF9jb21wb25lbnQoc291cmNlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50LnltbCIpCiAgICAgICAgYmFzaWNfY29tcG9uZW50ID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgIHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9jb21wb25lbnRfd2l0aF9jb25kaXRpb25hbF9vdXRwdXQvc3BlYy55YW1sIgogICAgICAgICkKCiAgICAgICAgQHBpcGVsaW5lKAogICAgICAgICAgICBjb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgKQogICAgICAgIGRlZiBjb25kaXRpb25fcGlwZWxpbmUoKToKICAgICAgICAgICAgcmVzdWx0ID0gYmFzaWNfY29tcG9uZW50KCkKCiAgICAgICAgICAgIG5vZGUxID0gaGVsbG9fd29ybGRfY29tcG9uZW50X25vX3BhdGhzKGNvbXBvbmVudF9pbl9udW1iZXI9MSkKCiAgICAgICAgICAgIG5vZGUyID0gaGVsbG9fd29ybGRfY29tcG9uZW50X25vX3BhdGhzKGNvbXBvbmVudF9pbl9udW1iZXI9MikKICAgICAgICAgICAgbm9kZTMgPSBoZWxsb193b3JsZF9jb21wb25lbnQoY29tcG9uZW50X2luX251bWJlcj0zLCBjb21wb25lbnRfaW5fcGF0aD10ZXN0X2lucHV0KQogICAgICAgICAgICBub2RlNCA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudChjb21wb25lbnRfaW5fbnVtYmVyPTQsIGNvbXBvbmVudF9pbl9wYXRoPXRlc3RfaW5wdXQpCiAgICAgICAgICAgIGNvbmRpdGlvbihjb25kaXRpb249cmVzdWx0Lm91dHB1dHMub3V0cHV0LCBmYWxzZV9ibG9jaz1bbm9kZTEsIG5vZGUzXSwgdHJ1ZV9ibG9jaz1bbm9kZTIsIG5vZGU0XSkKCiAgICAgICAgcGlwZWxpbmVfam9iID0gY29uZGl0aW9uX3BpcGVsaW5lKCkKICAgICAgICB3aXRoIGluY2x1ZGVfcHJpdmF0ZV9wcmV2aWV3X25vZGVzX2luX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHBpcGVsaW5lX2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQoKICAgICAgICBkc2xfcGlwZWxpbmVfam9iX2RpY3QgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKSwgKm9taXRfZmllbGRzKQogICAgICAgIGFzc2VydCBkc2xfcGlwZWxpbmVfam9iX2RpY3RbInByb3BlcnRpZXMiXVsiam9icyJdWyJjb25kaXRpb25ub2RlIl0gPT0gewogICAgICAgICAgICAiX3NvdXJjZSI6ICJEU0wiLAogICAgICAgICAgICAiY29uZGl0aW9uIjogIiR7e3BhcmVudC5qb2JzLnJlc3VsdC5vdXRwdXRzLm91dHB1dH19IiwKICAgICAgICAgICAgImZhbHNlX2Jsb2NrIjogWyIke3twYXJlbnQuam9icy5ub2RlMX19IiwgIiR7e3BhcmVudC5qb2JzLm5vZGUzfX0iXSwKICAgICAgICAgICAgInRydWVfYmxvY2siOiBbIiR7e3BhcmVudC5qb2JzLm5vZGUyfX0iLCAiJHt7cGFyZW50LmpvYnMubm9kZTR9fSJdLAogICAgICAgICAgICAidHlwZSI6ICJpZl9lbHNlIiwKICAgICAgICB9CgogICAgQHB5dGVzdC5tYXJrLnNraXBpZihjb25kaXRpb249bm90IGlzX2xpdmUoKSwgcmVhc29uPSJUT0RPKDIxNzczNTMpOiBjaGVjayB3aHkgcmVjb3JkZWQgdGVzdHMgZmFpbHVyZS4iKQogICAgZGVmIHRlc3RfaWZfZWxzZV9tdWx0aXBsZV9ibG9ja3Nfc3ViZ3JhcGgoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X25vX3BhdGhzID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgIHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudF9ub19wYXRocy55bWwiCiAgICAgICAgKQogICAgICAgIGJhc2ljX2NvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICBzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvY29tcG9uZW50X3dpdGhfY29uZGl0aW9uYWxfb3V0cHV0L3NwZWMueWFtbCIKICAgICAgICApCgogICAgICAgIEBwaXBlbGluZSgpCiAgICAgICAgZGVmIHN1YmdyYXBoKCk6CiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9ub19wYXRocyhjb21wb25lbnRfaW5fbnVtYmVyPTIpCgogICAgICAgIEBwaXBlbGluZSgKICAgICAgICAgICAgY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICkKICAgICAgICBkZWYgY29uZGl0aW9uX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHJlc3VsdCA9IGJhc2ljX2NvbXBvbmVudCgpCgogICAgICAgICAgICBub2RlMSA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudF9ub19wYXRocyhjb21wb25lbnRfaW5fbnVtYmVyPTEpCgogICAgICAgICAgICBub2RlMiA9IHN1YmdyYXBoKCkKCiAgICAgICAgICAgIGNvbmRpdGlvbihjb25kaXRpb249cmVzdWx0Lm91dHB1dHMub3V0cHV0LCB0cnVlX2Jsb2NrPVtub2RlMSwgbm9kZTJdKQoKICAgICAgICBwaXBlbGluZV9qb2IgPSBjb25kaXRpb25fcGlwZWxpbmUoKQogICAgICAgIHdpdGggaW5jbHVkZV9wcml2YXRlX3ByZXZpZXdfbm9kZXNfaW5fcGlwZWxpbmUoKToKICAgICAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCgogICAgICAgIGRzbF9waXBlbGluZV9qb2JfZGljdCA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpLCAqb21pdF9maWVsZHMpCiAgICAgICAgYXNzZXJ0IGRzbF9waXBlbGluZV9qb2JfZGljdFsicHJvcGVydGllcyJdWyJqb2JzIl1bImNvbmRpdGlvbm5vZGUiXSA9PSB7CiAgICAgICAgICAgICJfc291cmNlIjogIkRTTCIsCiAgICAgICAgICAgICJjb25kaXRpb24iOiAiJHt7cGFyZW50LmpvYnMucmVzdWx0Lm91dHB1dHMub3V0cHV0fX0iLAogICAgICAgICAgICAidHJ1ZV9ibG9jayI6IFsiJHt7cGFyZW50LmpvYnMubm9kZTF9fSIsICIke3twYXJlbnQuam9icy5ub2RlMn19Il0sCiAgICAgICAgICAgICJ0eXBlIjogImlmX2Vsc2UiLAogICAgICAgIH0KCgpAcHl0ZXN0Lm1hcmsudXNlZml4dHVyZXMoIm1vY2tfYW5vbl9jb21wb25lbnRfdmVyc2lvbiIpCmNsYXNzIFRlc3REb1doaWxlUGlwZWxpbmUoVGVzdENvbnRyb2xGbG93UGlwZWxpbmUpOgogICAgQHByb3BlcnR5CiAgICBkZWYgX2Jhc2ljX2NvbXBvbmVudF9mdW5jKHNlbGYpOgogICAgICAgIHJldHVybiBsb2FkX2NvbXBvbmVudCgiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvZHNsX3BpcGVsaW5lL2RvX3doaWxlL2Jhc2ljX2NvbXBvbmVudC9jb21wb25lbnQueW1sIikKCiAgICBAcHl0ZXN0Lm1hcmsudXNlZml4dHVyZXMoIm1vY2tfYW5vbl9jb21wb25lbnRfdmVyc2lvbiIpCiAgICBkZWYgdGVzdF9kb193aGlsZV9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBAcGlwZWxpbmUKICAgICAgICBkZWYgZG9fd2hpbGVfYm9keV9waXBlbGluZV9jb21wb25lbnQoCiAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI6IElucHV0KHR5cGU9ImludGVnZXIiLCBvcHRpb25hbD1UcnVlKSwKICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg6IElucHV0KHR5cGU9InVyaV9mb2xkZXIiKSwKICAgICAgICApOgogICAgICAgICAgICAjIENhbGwgY29tcG9uZW50IG9iaiBhcyBmdW5jdGlvbjogYXBwbHkgZ2l2ZW4gaW5wdXRzICYgcGFyYW1ldGVycyB0byBjcmVhdGUgYSBub2RlIGluIHBpcGVsaW5lCiAgICAgICAgICAgIGJhc2ljX2NvbXBvbmVudCA9IHNlbGYuX2Jhc2ljX2NvbXBvbmVudF9mdW5jKAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcj1jb21wb25lbnRfaW5fbnVtYmVyLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2luX3BhdGgsCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIGJhc2ljX2NvbXBvbmVudC5vdXRwdXRzCgogICAgICAgIEBwaXBlbGluZQogICAgICAgIGRlZiBwaXBlbGluZV93aXRoX2RvX3doaWxlKAogICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyOiBJbnB1dCh0eXBlPSJpbnRlZ2VyIiksCiAgICAgICAgICAgIGNvbXBvbmVudF9pbl9wYXRoOiBJbnB1dCh0eXBlPSJ1cmlfZm9sZGVyIiksCiAgICAgICAgKToKICAgICAgICAgICAgIyBEbyB3aGlsZSBub2RlIHdpdGggcGlwZWxpbmUgY29tcG9uZW50CiAgICAgICAgICAgIGRvX3doaWxlX2JvZHlfcGlwZWxpbmUgPSBkb193aGlsZV9ib2R5X3BpcGVsaW5lX2NvbXBvbmVudCgKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9Y29tcG9uZW50X2luX251bWJlciwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbl9wYXRoLAogICAgICAgICAgICApCiAgICAgICAgICAgIGRvX3doaWxlX3dpdGhfcGlwZWxpbmUgPSBkb193aGlsZSggICMgbm9xYTogRjg0MQogICAgICAgICAgICAgICAgYm9keT1kb193aGlsZV9ib2R5X3BpcGVsaW5lLAogICAgICAgICAgICAgICAgY29uZGl0aW9uPWRvX3doaWxlX2JvZHlfcGlwZWxpbmUub3V0cHV0cy5pc19udW1iZXJfbGFyZ2VyX3RoYW5femVybywKICAgICAgICAgICAgICAgIG1hcHBpbmc9ewogICAgICAgICAgICAgICAgICAgIGRvX3doaWxlX2JvZHlfcGlwZWxpbmUub3V0cHV0cy5vdXRwdXRfaW5fcGF0aDogZG9fd2hpbGVfYm9keV9waXBlbGluZS5pbnB1dHMuY29tcG9uZW50X2luX3BhdGgsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWF4X2l0ZXJhdGlvbl9jb3VudD01LAogICAgICAgICAgICApCgogICAgICAgICAgICBjb21tYW5kX2NvbXBvbmVudCA9IHNlbGYuX2Jhc2ljX2NvbXBvbmVudF9mdW5jKAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcj1jb21wb25lbnRfaW5fbnVtYmVyLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2luX3BhdGgsCiAgICAgICAgICAgICkKICAgICAgICAgICAgZG9fd2hpbGVfd2l0aF9jb21tYW5kX2NvbXBvbmVudCA9IGRvX3doaWxlKCAgIyBub3FhOiBGODQxCiAgICAgICAgICAgICAgICBib2R5PWNvbW1hbmRfY29tcG9uZW50LAogICAgICAgICAgICAgICAgY29uZGl0aW9uPWNvbW1hbmRfY29tcG9uZW50Lm91dHB1dHMuaXNfbnVtYmVyX2xhcmdlcl90aGFuX3plcm8sCiAgICAgICAgICAgICAgICBtYXBwaW5nPXsKICAgICAgICAgICAgICAgICAgICAib3V0cHV0X2luX251bWJlciI6IGNvbW1hbmRfY29tcG9uZW50LmlucHV0cy5jb21wb25lbnRfaW5fbnVtYmVyLAogICAgICAgICAgICAgICAgICAgIGNvbW1hbmRfY29tcG9uZW50Lm91dHB1dHMub3V0cHV0X2luX3BhdGg6IGNvbW1hbmRfY29tcG9uZW50LmlucHV0cy5jb21wb25lbnRfaW5fcGF0aCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBtYXhfaXRlcmF0aW9uX2NvdW50PTUsCiAgICAgICAgICAgICkKCiAgICAgICAgICAgICMgVXNlIHRoZSBvdXRwdXRzIG9mIGRvX3doaWxlIG5vZGUKICAgICAgICAgICAgYmFzaWNfY29tcG9uZW50ID0gZG9fd2hpbGVfYm9keV9waXBlbGluZV9jb21wb25lbnQoCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyPU5vbmUsCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fcGF0aD1jb21tYW5kX2NvbXBvbmVudC5vdXRwdXRzLm91dHB1dF9pbl9wYXRoLAogICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiB7Im91dHB1dF9pbl9wYXRoIjogYmFzaWNfY29tcG9uZW50Lm91dHB1dHMub3V0cHV0X2luX3BhdGh9CgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBpcGVsaW5lX3dpdGhfZG9fd2hpbGUoCiAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9MiwKICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9SW5wdXQodHlwZT0idXJpX2ZvbGRlciIsIHBhdGg9c3RyKFBhdGgoX19maWxlX18pLnBhcmVudCkpLAogICAgICAgICkKICAgICAgICAjIHNldCBwaXBlbGluZSBsZXZlbCBjb21wdXRlCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCgogICAgZGVmIHRlc3RfZG9fd2hpbGVfcGlwZWxpbmVfd2l0aF9wcmltaXRpdmVfaW5wdXRzKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIEBwaXBlbGluZQogICAgICAgIGRlZiBkb193aGlsZV9ib2R5X3BpcGVsaW5lX2NvbXBvbmVudCgKICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcjogSW5wdXQodHlwZT0iaW50ZWdlciIpLAogICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyXzE6IElucHV0KHR5cGU9ImludGVnZXIiKSwKICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg6IElucHV0KHR5cGU9InVyaV9mb2xkZXIiKSwKICAgICAgICApOgogICAgICAgICAgICAiIiJFMkUgZHVtbXkgdHJhaW4tc2NvcmUtZXZhbCBwaXBlbGluZSB3aXRoIGNvbXBvbmVudHMgZGVmaW5lZCB2aWEgeWFtbC4iIiIKICAgICAgICAgICAgIyBDYWxsIGNvbXBvbmVudCBvYmogYXMgZnVuY3Rpb246IGFwcGx5IGdpdmVuIGlucHV0cyAmIHBhcmFtZXRlcnMgdG8gY3JlYXRlIGEgbm9kZSBpbiBwaXBlbGluZQogICAgICAgICAgICB0cmFpbl93aXRoX3NhbXBsZV9kYXRhID0gc2VsZi5fYmFzaWNfY29tcG9uZW50X2Z1bmMoCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyPWNvbXBvbmVudF9pbl9udW1iZXIsCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyXzE9Y29tcG9uZW50X2luX251bWJlcl8xLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2luX3BhdGgsCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIHRyYWluX3dpdGhfc2FtcGxlX2RhdGEub3V0cHV0cwoKICAgICAgICBAcGlwZWxpbmUKICAgICAgICBkZWYgcGlwZWxpbmVfd2l0aF9kb193aGlsZSgKICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcjogSW5wdXQodHlwZT0iaW50ZWdlciIpLAogICAgICAgICAgICBjb21wb25lbnRfaW5fcGF0aDogSW5wdXQodHlwZT0idXJpX2ZvbGRlciIpLAogICAgICAgICk6CiAgICAgICAgICAgICMgRG8gd2hpbGUgbm9kZSB3aXRoIHBpcGVsaW5lIGNvbXBvbmVudAogICAgICAgICAgICBkb193aGlsZV9ib2R5X3BpcGVsaW5lID0gZG9fd2hpbGVfYm9keV9waXBlbGluZV9jb21wb25lbnQoCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyPWNvbXBvbmVudF9pbl9udW1iZXIsCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyXzE9Y29tcG9uZW50X2luX251bWJlciwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbl9wYXRoLAogICAgICAgICAgICApCiAgICAgICAgICAgIGRvX3doaWxlX3dpdGhfcGlwZWxpbmUgPSBkb193aGlsZSggICMgbm9xYTogRjg0MQogICAgICAgICAgICAgICAgYm9keT1kb193aGlsZV9ib2R5X3BpcGVsaW5lLAogICAgICAgICAgICAgICAgY29uZGl0aW9uPWRvX3doaWxlX2JvZHlfcGlwZWxpbmUub3V0cHV0cy5pc19udW1iZXJfbGFyZ2VyX3RoYW5femVybywKICAgICAgICAgICAgICAgIG1hcHBpbmc9ewogICAgICAgICAgICAgICAgICAgIGRvX3doaWxlX2JvZHlfcGlwZWxpbmUub3V0cHV0cy5vdXRwdXRfaW5fbnVtYmVyOiBbCiAgICAgICAgICAgICAgICAgICAgICAgIGRvX3doaWxlX2JvZHlfcGlwZWxpbmUuaW5wdXRzLmNvbXBvbmVudF9pbl9udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIGRvX3doaWxlX2JvZHlfcGlwZWxpbmUuaW5wdXRzLmNvbXBvbmVudF9pbl9udW1iZXJfMSwKICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICJvdXRwdXRfaW5fcGF0aCI6IGRvX3doaWxlX2JvZHlfcGlwZWxpbmUuaW5wdXRzLmNvbXBvbmVudF9pbl9wYXRoLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG1heF9pdGVyYXRpb25fY291bnQ9NSwKICAgICAgICAgICAgKQoKICAgICAgICAgICAgY29tbWFuZF9jb21wb25lbnQgPSBzZWxmLl9iYXNpY19jb21wb25lbnRfZnVuYygKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9Y29tcG9uZW50X2luX251bWJlciwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXJfMT1jb21wb25lbnRfaW5fbnVtYmVyLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2luX3BhdGgsCiAgICAgICAgICAgICkKICAgICAgICAgICAgZG9fd2hpbGVfd2l0aF9jb21tYW5kX2NvbXBvbmVudCA9IGRvX3doaWxlKCAgIyBub3FhOiBGODQxCiAgICAgICAgICAgICAgICBib2R5PWNvbW1hbmRfY29tcG9uZW50LAogICAgICAgICAgICAgICAgY29uZGl0aW9uPWNvbW1hbmRfY29tcG9uZW50Lm91dHB1dHMuaXNfbnVtYmVyX2xhcmdlcl90aGFuX3plcm8sCiAgICAgICAgICAgICAgICBtYXBwaW5nPXsKICAgICAgICAgICAgICAgICAgICAib3V0cHV0X2luX251bWJlciI6IFsKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZF9jb21wb25lbnQuaW5wdXRzLmNvbXBvbmVudF9pbl9udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRfY29tcG9uZW50LmlucHV0cy5jb21wb25lbnRfaW5fbnVtYmVyXzEsCiAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICAib3V0cHV0X2luX3BhdGgiOiBjb21tYW5kX2NvbXBvbmVudC5pbnB1dHMuY29tcG9uZW50X2luX3BhdGgsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWF4X2l0ZXJhdGlvbl9jb3VudD01LAogICAgICAgICAgICApCgogICAgICAgICAgICAjIFVzZSB0aGUgb3V0cHV0cyBvZiBkb193aGlsZSBub2RlCiAgICAgICAgICAgIGJhc2ljX2NvbXBvbmVudCA9IGRvX3doaWxlX2JvZHlfcGlwZWxpbmVfY29tcG9uZW50KAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcj1kb193aGlsZV9ib2R5X3BpcGVsaW5lLm91dHB1dHMub3V0cHV0X2luX251bWJlciwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXJfMT1jb21tYW5kX2NvbXBvbmVudC5vdXRwdXRzLm91dHB1dF9pbl9udW1iZXIsCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fcGF0aD1kb193aGlsZV9ib2R5X3BpcGVsaW5lLm91dHB1dHMub3V0cHV0X2luX3BhdGgsCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIHsib3V0cHV0X2luX3BhdGgiOiBiYXNpY19jb21wb25lbnQub3V0cHV0cy5vdXRwdXRfaW5fcGF0aH0KCiAgICAgICAgcGlwZWxpbmVfam9iID0gcGlwZWxpbmVfd2l0aF9kb193aGlsZSgKICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcj0yLAogICAgICAgICAgICBjb21wb25lbnRfaW5fcGF0aD1JbnB1dCh0eXBlPSJ1cmlfZm9sZGVyIiwgcGF0aD1zdHIoUGF0aChfX2ZpbGVfXykucGFyZW50KSksCiAgICAgICAgKQogICAgICAgICMgc2V0IHBpcGVsaW5lIGxldmVsIGNvbXB1dGUKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImNwdS1jbHVzdGVyIgoKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZV9qb2IsIGNsaWVudCkKCgpAcHl0ZXN0Lm1hcmsuc2tpcGlmKAogICAgY29uZGl0aW9uPWlzX2xpdmUoKSwKICAgICMgVE9ETzogcmVvcGVuIGxpdmUgdGVzdCB3aGVuIHBhcmFsbGVsX2ZvciBkZXBsb3llZCB0byBjYW5hcnkKICAgIHJlYXNvbj0icGFyYWxsZWxfZm9yIGlzIG5vdCBhdmFpbGFibGUgaW4gY2FuYXJ5LiIsCikKY2xhc3MgVGVzdFBhcmFsbGVsRm9yUGlwZWxpbmUoVGVzdENvbnRyb2xGbG93UGlwZWxpbmUpOgogICAgZGVmIHRlc3Rfc2ltcGxlX2RzbF9wYXJhbGxlbF9mb3JfcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50ID0gbG9hZF9jb21wb25lbnQoc291cmNlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50LnltbCIpCgogICAgICAgIEBwaXBlbGluZQogICAgICAgIGRlZiBwYXJhbGxlbF9mb3JfcGlwZWxpbmUoKToKICAgICAgICAgICAgcGFyYWxsZWxfYm9keSA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD10ZXN0X2lucHV0KQogICAgICAgICAgICBwYXJhbGxlbF9ub2RlID0gcGFyYWxsZWxfZm9yKAogICAgICAgICAgICAgICAgYm9keT1wYXJhbGxlbF9ib2R5LAogICAgICAgICAgICAgICAgaXRlbXM9WwogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDF9LAogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDJ9LAogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgKQogICAgICAgICAgICBhZnRlcl9ub2RlID0gaGVsbG9fd29ybGRfY29tcG9uZW50KAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9cGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwKICAgICAgICAgICAgKQogICAgICAgICAgICBhZnRlcl9ub2RlLmNvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBhcmFsbGVsX2Zvcl9waXBlbGluZSgpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKCiAgICAgICAgd2l0aCBpbmNsdWRlX3ByaXZhdGVfcHJldmlld19ub2Rlc19pbl9waXBlbGluZSgpOgogICAgICAgICAgICBwaXBlbGluZV9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZV9qb2IsIGNsaWVudCkKCiAgICAgICAgZHNsX3BpcGVsaW5lX2pvYl9kaWN0ID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCksICpvbWl0X2ZpZWxkcykKICAgICAgICBhc3NlcnQgZHNsX3BpcGVsaW5lX2pvYl9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXSA9PSB7CiAgICAgICAgICAgICJhZnRlcl9ub2RlIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiUkVNT1RFLldPUktTUEFDRS5DT01QT05FTlQiLAogICAgICAgICAgICAgICAgImNvbXB1dGVJZCI6ICJjcHUtY2x1c3RlciIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmpvYnMucGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH19IiwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm5hbWUiOiAiYWZ0ZXJfbm9kZSIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInBhcmFsbGVsX2JvZHkiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJSRU1PVEUuV09SS1NQQUNFLkNPTVBPTkVOVCIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogInVyaV9maWxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgInVyaSI6ICJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJuYW1lIjogInBhcmFsbGVsX2JvZHkiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJwYXJhbGxlbF9ub2RlIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiRFNMIiwKICAgICAgICAgICAgICAgICJib2R5IjogIiR7e3BhcmVudC5qb2JzLnBhcmFsbGVsX2JvZHl9fSIsCiAgICAgICAgICAgICAgICAiaXRlbXMiOiAnW3siY29tcG9uZW50X2luX251bWJlciI6IDF9LCAnICd7ImNvbXBvbmVudF9pbl9udW1iZXIiOiAyfV0nLAogICAgICAgICAgICAgICAgInR5cGUiOiAicGFyYWxsZWxfZm9yIiwKICAgICAgICAgICAgfSwKICAgICAgICB9CgogICAgZGVmIHRlc3RfZHNsX3BhcmFsbGVsX2Zvcl9waXBlbGluZV91bnByb3ZpZGVkX2lucHV0KHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudF9hbHQxLnltbCIpCgogICAgICAgIEBwaXBlbGluZQogICAgICAgIGRlZiBwYXJhbGxlbF9mb3JfcGlwZWxpbmUoKToKICAgICAgICAgICAgcGFyYWxsZWxfYm9keSA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD10ZXN0X2lucHV0KQogICAgICAgICAgICBwYXJhbGxlbF9ub2RlID0gcGFyYWxsZWxfZm9yKAogICAgICAgICAgICAgICAgYm9keT1wYXJhbGxlbF9ib2R5LAogICAgICAgICAgICAgICAgaXRlbXM9WwogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDF9LAogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDJ9LAogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgKQogICAgICAgICAgICBhZnRlcl9ub2RlID0gaGVsbG9fd29ybGRfY29tcG9uZW50KAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9cGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwgY29tcG9uZW50X2luX251bWJlcj0xCiAgICAgICAgICAgICkKICAgICAgICAgICAgYWZ0ZXJfbm9kZS5jb21wdXRlID0gImNwdS1jbHVzdGVyIgoKICAgICAgICBwaXBlbGluZV9qb2IgPSBwYXJhbGxlbF9mb3JfcGlwZWxpbmUoKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCgogICAgICAgIHdpdGggaW5jbHVkZV9wcml2YXRlX3ByZXZpZXdfbm9kZXNfaW5fcGlwZWxpbmUoKToKICAgICAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCiAgICAgICAgZHNsX3BpcGVsaW5lX2pvYl9kaWN0ID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCksICpvbWl0X2ZpZWxkcykKICAgICAgICBhc3NlcnQgZHNsX3BpcGVsaW5lX2pvYl9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXSA9PSB7CiAgICAgICAgICAgICJhZnRlcl9ub2RlIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiUkVNT1RFLldPUktTUEFDRS5DT01QT05FTlQiLAogICAgICAgICAgICAgICAgImNvbXB1dGVJZCI6ICJjcHUtY2x1c3RlciIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fbnVtYmVyIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjEifSwKICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX3BhdGgiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5qb2JzLnBhcmFsbGVsX25vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9fSIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibmFtZSI6ICJhZnRlcl9ub2RlIiwKICAgICAgICAgICAgICAgICJ0eXBlIjogImNvbW1hbmQiLAogICAgICAgICAgICB9LAogICAgICAgICAgICAicGFyYWxsZWxfYm9keSI6IHsKICAgICAgICAgICAgICAgICJfc291cmNlIjogIlJFTU9URS5XT1JLU1BBQ0UuQ09NUE9ORU5UIiwKICAgICAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9pbl9wYXRoIjogewogICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAidXJpX2ZpbGUiLAogICAgICAgICAgICAgICAgICAgICAgICAidXJpIjogImh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IiwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm5hbWUiOiAicGFyYWxsZWxfYm9keSIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInBhcmFsbGVsX25vZGUiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJEU0wiLAogICAgICAgICAgICAgICAgImJvZHkiOiAiJHt7cGFyZW50LmpvYnMucGFyYWxsZWxfYm9keX19IiwKICAgICAgICAgICAgICAgICJpdGVtcyI6ICdbeyJjb21wb25lbnRfaW5fbnVtYmVyIjogMX0sICcgJ3siY29tcG9uZW50X2luX251bWJlciI6IDJ9XScsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJwYXJhbGxlbF9mb3IiLAogICAgICAgICAgICB9LAogICAgICAgIH0KCiAgICBkZWYgdGVzdF9wYXJhbGxlbF9mb3JfcGlwZWxpbmVfd2l0aF9zdWJncmFwaChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnQueW1sIikKCiAgICAgICAgQHBpcGVsaW5lCiAgICAgICAgZGVmIHN1Yl9ncmFwaChjb21wb25lbnRfaW5fbnVtYmVyOiBpbnQgPSAxMCk6CiAgICAgICAgICAgIG5vZGUgPSBoZWxsb193b3JsZF9jb21wb25lbnQoY29tcG9uZW50X2luX3BhdGg9dGVzdF9pbnB1dCwgY29tcG9uZW50X2luX251bWJlcj1jb21wb25lbnRfaW5fbnVtYmVyKQogICAgICAgICAgICByZXR1cm4geyJjb21wb25lbnRfb3V0X3BhdGgiOiBub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRofQoKICAgICAgICBAcGlwZWxpbmUKICAgICAgICBkZWYgcGFyYWxsZWxfZm9yX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHBhcmFsbGVsX2JvZHkgPSBzdWJfZ3JhcGgoKQogICAgICAgICAgICBwYXJhbGxlbF9ub2RlID0gcGFyYWxsZWxfZm9yKAogICAgICAgICAgICAgICAgYm9keT1wYXJhbGxlbF9ib2R5LAogICAgICAgICAgICAgICAgaXRlbXM9WwogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDF9LAogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDJ9LAogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgKQogICAgICAgICAgICBhZnRlcl9ub2RlID0gaGVsbG9fd29ybGRfY29tcG9uZW50KAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9cGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwKICAgICAgICAgICAgKQogICAgICAgICAgICBhZnRlcl9ub2RlLmNvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBhcmFsbGVsX2Zvcl9waXBlbGluZSgpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKCiAgICAgICAgd2l0aCBpbmNsdWRlX3ByaXZhdGVfcHJldmlld19ub2Rlc19pbl9waXBlbGluZSgpOgogICAgICAgICAgICBwaXBlbGluZV9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZV9qb2IsIGNsaWVudCkKCiAgICAgICAgZHNsX3BpcGVsaW5lX2pvYl9kaWN0ID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCksICpvbWl0X2ZpZWxkcykKICAgICAgICBhc3NlcnQgZHNsX3BpcGVsaW5lX2pvYl9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXSA9PSB7CiAgICAgICAgICAgICJhZnRlcl9ub2RlIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiUkVNT1RFLldPUktTUEFDRS5DT01QT05FTlQiLAogICAgICAgICAgICAgICAgImNvbXB1dGVJZCI6ICJjcHUtY2x1c3RlciIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmpvYnMucGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH19IiwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm5hbWUiOiAiYWZ0ZXJfbm9kZSIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInBhcmFsbGVsX2JvZHkiOiB7Il9zb3VyY2UiOiAiUkVNT1RFLldPUktTUEFDRS5DT01QT05FTlQiLCAibmFtZSI6ICJwYXJhbGxlbF9ib2R5IiwgInR5cGUiOiAicGlwZWxpbmUifSwKICAgICAgICAgICAgInBhcmFsbGVsX25vZGUiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJEU0wiLAogICAgICAgICAgICAgICAgImJvZHkiOiAiJHt7cGFyZW50LmpvYnMucGFyYWxsZWxfYm9keX19IiwKICAgICAgICAgICAgICAgICJpdGVtcyI6ICdbeyJjb21wb25lbnRfaW5fbnVtYmVyIjogMX0sICcgJ3siY29tcG9uZW50X2luX251bWJlciI6IDJ9XScsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJwYXJhbGxlbF9mb3IiLAogICAgICAgICAgICB9LAogICAgICAgIH0KCiAgICBkZWYgdGVzdF9wYXJhbGxlbF9mb3JfcGlwZWxpbmVfc3ViZ3JhcGhfdW5wcm92aWRlZF9pbnB1dChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnQueW1sIikKCiAgICAgICAgQHBpcGVsaW5lCiAgICAgICAgZGVmIHN1Yl9ncmFwaChjb21wb25lbnRfaW5fbnVtYmVyOiBpbnQpOgogICAgICAgICAgICBub2RlID0gaGVsbG9fd29ybGRfY29tcG9uZW50KGNvbXBvbmVudF9pbl9wYXRoPXRlc3RfaW5wdXQsIGNvbXBvbmVudF9pbl9udW1iZXI9Y29tcG9uZW50X2luX251bWJlcikKICAgICAgICAgICAgcmV0dXJuIHsiY29tcG9uZW50X291dF9wYXRoIjogbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH0KCiAgICAgICAgQHBpcGVsaW5lCiAgICAgICAgZGVmIHBhcmFsbGVsX2Zvcl9waXBlbGluZSgpOgogICAgICAgICAgICBwYXJhbGxlbF9ib2R5ID0gc3ViX2dyYXBoKCkKICAgICAgICAgICAgcGFyYWxsZWxfbm9kZSA9IHBhcmFsbGVsX2ZvcigKICAgICAgICAgICAgICAgIGJvZHk9cGFyYWxsZWxfYm9keSwKICAgICAgICAgICAgICAgIGl0ZW1zPVsKICAgICAgICAgICAgICAgICAgICB7ImNvbXBvbmVudF9pbl9udW1iZXIiOiAxfSwKICAgICAgICAgICAgICAgICAgICB7ImNvbXBvbmVudF9pbl9udW1iZXIiOiAyfSwKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICkKICAgICAgICAgICAgYWZ0ZXJfbm9kZSA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudCgKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9wYXRoPXBhcmFsbGVsX25vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgsCiAgICAgICAgICAgICkKICAgICAgICAgICAgYWZ0ZXJfbm9kZS5jb21wdXRlID0gImNwdS1jbHVzdGVyIgoKICAgICAgICBwaXBlbGluZV9qb2IgPSBwYXJhbGxlbF9mb3JfcGlwZWxpbmUoKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCgogICAgICAgIHdpdGggaW5jbHVkZV9wcml2YXRlX3ByZXZpZXdfbm9kZXNfaW5fcGlwZWxpbmUoKToKICAgICAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCgogICAgICAgIGRzbF9waXBlbGluZV9qb2JfZGljdCA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpLCAqb21pdF9maWVsZHMpCiAgICAgICAgYXNzZXJ0IGRzbF9waXBlbGluZV9qb2JfZGljdFsicHJvcGVydGllcyJdWyJqb2JzIl0gPT0gewogICAgICAgICAgICAiYWZ0ZXJfbm9kZSI6IHsKICAgICAgICAgICAgICAgICJfc291cmNlIjogIlJFTU9URS5XT1JLU1BBQ0UuQ09NUE9ORU5UIiwKICAgICAgICAgICAgICAgICJjb21wdXRlSWQiOiAiY3B1LWNsdXN0ZXIiLAogICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX3BhdGgiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5qb2JzLnBhcmFsbGVsX25vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9fSIsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJuYW1lIjogImFmdGVyX25vZGUiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJwYXJhbGxlbF9ib2R5IjogeyJfc291cmNlIjogIlJFTU9URS5XT1JLU1BBQ0UuQ09NUE9ORU5UIiwgIm5hbWUiOiAicGFyYWxsZWxfYm9keSIsICJ0eXBlIjogInBpcGVsaW5lIn0sCiAgICAgICAgICAgICJwYXJhbGxlbF9ub2RlIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiRFNMIiwKICAgICAgICAgICAgICAgICJib2R5IjogIiR7e3BhcmVudC5qb2JzLnBhcmFsbGVsX2JvZHl9fSIsCiAgICAgICAgICAgICAgICAiaXRlbXMiOiAnW3siY29tcG9uZW50X2luX251bWJlciI6IDF9LCAnICd7ImNvbXBvbmVudF9pbl9udW1iZXIiOiAyfV0nLAogICAgICAgICAgICAgICAgInR5cGUiOiAicGFyYWxsZWxfZm9yIiwKICAgICAgICAgICAgfSwKICAgICAgICB9CgogICAgZGVmIHRlc3RfcGFyYWxsZWxfZm9yX3BpcGVsaW5lX3dpdGhfcG9ydF9vdXRwdXRzKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICBzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnQueW1sIiwKICAgICAgICAgICAgcGFyYW1zX292ZXJyaWRlPVsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAib3V0cHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHsidHlwZSI6ICJ1cmlfZm9sZGVyIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfb3V0X2ZpbGUiOiB7InR5cGUiOiAidXJpX2ZpbGUifSwKICAgICAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfdGFibGUiOiB7InR5cGUiOiAibWx0YWJsZSJ9LAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICApCgogICAgICAgIEBwaXBlbGluZQogICAgICAgIGRlZiBwYXJhbGxlbF9mb3JfcGlwZWxpbmUoKToKICAgICAgICAgICAgcGFyYWxsZWxfYm9keSA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD10ZXN0X2lucHV0KQogICAgICAgICAgICBwYXJhbGxlbF9ub2RlID0gcGFyYWxsZWxfZm9yKAogICAgICAgICAgICAgICAgYm9keT1wYXJhbGxlbF9ib2R5LAogICAgICAgICAgICAgICAgaXRlbXM9WwogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDN9LAogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDR9LAogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHBhcmFsbGVsX25vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgsCiAgICAgICAgICAgICAgICAiY29tcG9uZW50X291dF9maWxlIjogcGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfZmlsZSwKICAgICAgICAgICAgICAgICJjb21wb25lbnRfb3V0X3RhYmxlIjogcGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfdGFibGUsCiAgICAgICAgICAgIH0KCiAgICAgICAgcGlwZWxpbmVfam9iID0gcGFyYWxsZWxfZm9yX3BpcGVsaW5lKCkKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImNwdS1jbHVzdGVyIgoKICAgICAgICB3aXRoIGluY2x1ZGVfcHJpdmF0ZV9wcmV2aWV3X25vZGVzX2luX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHBpcGVsaW5lX2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQoKICAgICAgICBkc2xfcGlwZWxpbmVfam9iX2RpY3QgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKSwgKm9taXRfZmllbGRzKQogICAgICAgIGFzc2VydCBkc2xfcGlwZWxpbmVfam9iX2RpY3RbInByb3BlcnRpZXMiXVsiam9icyJdID09IHsKICAgICAgICAgICAgInBhcmFsbGVsX2JvZHkiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJSRU1PVEUuV09SS1NQQUNFLkNPTVBPTkVOVCIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogInVyaV9maWxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgInVyaSI6ICJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJuYW1lIjogInBhcmFsbGVsX2JvZHkiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJwYXJhbGxlbF9ub2RlIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiRFNMIiwKICAgICAgICAgICAgICAgICJib2R5IjogIiR7e3BhcmVudC5qb2JzLnBhcmFsbGVsX2JvZHl9fSIsCiAgICAgICAgICAgICAgICAiaXRlbXMiOiAnW3siY29tcG9uZW50X2luX251bWJlciI6IDN9LCAnICd7ImNvbXBvbmVudF9pbl9udW1iZXIiOiA0fV0nLAogICAgICAgICAgICAgICAgInR5cGUiOiAicGFyYWxsZWxfZm9yIiwKICAgICAgICAgICAgICAgICJvdXRwdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfb3V0X2ZpbGUiOiB7InR5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy5jb21wb25lbnRfb3V0X2ZpbGV9fSJ9LAogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfb3V0X3BhdGgiOiB7InR5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9fSJ9LAogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfb3V0X3RhYmxlIjogeyJ0eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50Lm91dHB1dHMuY29tcG9uZW50X291dF90YWJsZX19In0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgIH0KICAgICAgICBhc3NlcnQgZHNsX3BpcGVsaW5lX2pvYl9kaWN0WyJwcm9wZXJ0aWVzIl1bIm91dHB1dHMiXSA9PSB7CiAgICAgICAgICAgICJjb21wb25lbnRfb3V0X2ZpbGUiOiB7ImpvYl9vdXRwdXRfdHlwZSI6ICJtbHRhYmxlIiwgIm1vZGUiOiAiUmVhZFdyaXRlTW91bnQifSwKICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHsiam9iX291dHB1dF90eXBlIjogIm1sdGFibGUiLCAibW9kZSI6ICJSZWFkV3JpdGVNb3VudCJ9LAogICAgICAgICAgICAiY29tcG9uZW50X291dF90YWJsZSI6IHsiam9iX291dHB1dF90eXBlIjogIm1sdGFibGUiLCAibW9kZSI6ICJSZWFkV3JpdGVNb3VudCJ9LAogICAgICAgIH0KCiAgICAgICAgIyBwYXJhbGxlbCBmb3IgcGlwZWxpbmUgY29tcG9uZW50IGlzIGNvcnJlY3RseSBnZW5lcmF0ZWQKICAgICAgICBAcGlwZWxpbmUKICAgICAgICBkZWYgcGFyZW50X3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHBhcmFsbGVsX2Zvcl9waXBlbGluZSgpCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBhcmVudF9waXBlbGluZSgpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKCiAgICAgICAgcmVzdF9waXBlbGluZV9jb21wb25lbnQgPSBwaXBlbGluZV9qb2Iuam9ic1sicGFyYWxsZWxfZm9yX3BpcGVsaW5lIl0uY29tcG9uZW50Ll90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKQogICAgICAgIGFzc2VydCByZXN0X3BpcGVsaW5lX2NvbXBvbmVudFsicHJvcGVydGllcyJdWyJjb21wb25lbnRfc3BlYyJdWyJvdXRwdXRzIl0gPT0gewogICAgICAgICAgICAiY29tcG9uZW50X291dF9maWxlIjogeyJ0eXBlIjogIm1sdGFibGUifSwKICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHsidHlwZSI6ICJtbHRhYmxlIn0sCiAgICAgICAgICAgICJjb21wb25lbnRfb3V0X3RhYmxlIjogeyJ0eXBlIjogIm1sdGFibGUifSwKICAgICAgICB9CiAgICAgICAgYXNzZXJ0IHJlc3RfcGlwZWxpbmVfY29tcG9uZW50WyJwcm9wZXJ0aWVzIl1bImNvbXBvbmVudF9zcGVjIl1bImpvYnMiXVsicGFyYWxsZWxfbm9kZSJdID09IHsKICAgICAgICAgICAgImJvZHkiOiAiJHt7cGFyZW50LmpvYnMucGFyYWxsZWxfYm9keX19IiwKICAgICAgICAgICAgIml0ZW1zIjogJ1t7ImNvbXBvbmVudF9pbl9udW1iZXIiOiAzfSwgeyJjb21wb25lbnRfaW5fbnVtYmVyIjogNH1dJywKICAgICAgICAgICAgIm91dHB1dHMiOiB7CiAgICAgICAgICAgICAgICAiY29tcG9uZW50X291dF9maWxlIjogeyJ0eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50Lm91dHB1dHMuY29tcG9uZW50X291dF9maWxlfX0ifSwKICAgICAgICAgICAgICAgICJjb21wb25lbnRfb3V0X3BhdGgiOiB7InR5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9fSJ9LAogICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfdGFibGUiOiB7InR5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy5jb21wb25lbnRfb3V0X3RhYmxlfX0ifSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInR5cGUiOiAicGFyYWxsZWxfZm9yIiwKICAgICAgICAgICAgIl9zb3VyY2UiOiAiRFNMIiwKICAgICAgICB9CgogICAgICAgIHdpdGggaW5jbHVkZV9wcml2YXRlX3ByZXZpZXdfbm9kZXNfaW5fcGlwZWxpbmUoKToKICAgICAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCgogICAgZGVmIHRlc3RfcGFyYWxsZWxfZm9yX3BpcGVsaW5lX3dpdGhfcHJpbWl0aXZlX291dHB1dHMoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50ID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgIHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiLAogICAgICAgICAgICBwYXJhbXNfb3ZlcnJpZGU9WwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJvdXRwdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X291dF9wYXRoIjogeyJ0eXBlIjogInVyaV9mb2xkZXIifSwKICAgICAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfbnVtYmVyIjogeyJ0eXBlIjogIm51bWJlciJ9LAogICAgICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X291dF9ib29sZWFuIjogeyJ0eXBlIjogImJvb2xlYW4iLCAiaXNfY29udHJvbCI6IFRydWV9LAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICApCgogICAgICAgIEBwaXBlbGluZQogICAgICAgIGRlZiBwYXJhbGxlbF9mb3JfcGlwZWxpbmUoKToKICAgICAgICAgICAgcGFyYWxsZWxfYm9keSA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD10ZXN0X2lucHV0KQogICAgICAgICAgICBwYXJhbGxlbF9ub2RlID0gcGFyYWxsZWxfZm9yKAogICAgICAgICAgICAgICAgYm9keT1wYXJhbGxlbF9ib2R5LAogICAgICAgICAgICAgICAgaXRlbXM9WwogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDF9LAogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDJ9LAogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHBhcmFsbGVsX25vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgsCiAgICAgICAgICAgICAgICAiY29tcG9uZW50X291dF9udW1iZXIiOiBwYXJhbGxlbF9ub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9udW1iZXIsCiAgICAgICAgICAgICAgICAiY29tcG9uZW50X291dF9ib29sZWFuIjogcGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfYm9vbGVhbiwKICAgICAgICAgICAgfQoKICAgICAgICBAcGlwZWxpbmUKICAgICAgICBkZWYgcGFyZW50X3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHBhcmFsbGVsX2Zvcl9waXBlbGluZSgpCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBhcmVudF9waXBlbGluZSgpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKCiAgICAgICAgcmVzdF9waXBlbGluZV9jb21wb25lbnQgPSBwaXBlbGluZV9qb2Iuam9ic1sicGFyYWxsZWxfZm9yX3BpcGVsaW5lIl0uY29tcG9uZW50Ll90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKQogICAgICAgIGFzc2VydCByZXN0X3BpcGVsaW5lX2NvbXBvbmVudFsicHJvcGVydGllcyJdWyJjb21wb25lbnRfc3BlYyJdWyJvdXRwdXRzIl0gPT0gewogICAgICAgICAgICAiY29tcG9uZW50X291dF9ib29sZWFuIjogeyJpc19jb250cm9sIjogVHJ1ZSwgInR5cGUiOiAic3RyaW5nIn0sCiAgICAgICAgICAgICJjb21wb25lbnRfb3V0X251bWJlciI6IHsidHlwZSI6ICJzdHJpbmcifSwKICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHsidHlwZSI6ICJtbHRhYmxlIn0sCiAgICAgICAgfQoKICAgICAgICBhc3NlcnQgcmVzdF9waXBlbGluZV9jb21wb25lbnRbInByb3BlcnRpZXMiXVsiY29tcG9uZW50X3NwZWMiXVsiam9icyJdWyJwYXJhbGxlbF9ub2RlIl0gPT0gewogICAgICAgICAgICAiYm9keSI6ICIke3twYXJlbnQuam9icy5wYXJhbGxlbF9ib2R5fX0iLAogICAgICAgICAgICAiaXRlbXMiOiAnW3siY29tcG9uZW50X2luX251bWJlciI6IDF9LCB7ImNvbXBvbmVudF9pbl9udW1iZXIiOiAyfV0nLAogICAgICAgICAgICAib3V0cHV0cyI6IHsKICAgICAgICAgICAgICAgICJjb21wb25lbnRfb3V0X2Jvb2xlYW4iOiB7InR5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy5jb21wb25lbnRfb3V0X2Jvb2xlYW59fSJ9LAogICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfbnVtYmVyIjogeyJ0eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50Lm91dHB1dHMuY29tcG9uZW50X291dF9udW1iZXJ9fSJ9LAogICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHsidHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH19In0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJ0eXBlIjogInBhcmFsbGVsX2ZvciIsCiAgICAgICAgICAgICJfc291cmNlIjogIkRTTCIsCiAgICAgICAgfQoKICAgICAgICAjIHBhcmFsbGVsIGZvciBwaXBlbGluZSBjb21wb25lbnQgaXMgY29ycmVjdGx5IGdlbmVyYXRlZAogICAgICAgIHdpdGggaW5jbHVkZV9wcml2YXRlX3ByZXZpZXdfbm9kZXNfaW5fcGlwZWxpbmUoKToKICAgICAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCgogICAgZGVmIHRlc3RfcGFyYWxsZWxfZm9yX3BpcGVsaW5lX3dpdGhfZW1wdHlfaW5wdXRzKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICBzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnRfbm9faW5wdXRzLnltbCIsCiAgICAgICAgKQoKICAgICAgICBAcGlwZWxpbmUKICAgICAgICBkZWYgcGFyYWxsZWxfZm9yX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHBhcmFsbGVsX2JvZHkgPSBoZWxsb193b3JsZF9jb21wb25lbnQoKQogICAgICAgICAgICBmb3JlYWNoX2NvbmZpZyA9IHt9CiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDEwKToKICAgICAgICAgICAgICAgIGZvcmVhY2hfY29uZmlnW2Yic2lsb197aX0iXSA9IHt9CiAgICAgICAgICAgIHBhcmFsbGVsX25vZGUgPSBwYXJhbGxlbF9mb3IoYm9keT1wYXJhbGxlbF9ib2R5LCBpdGVtcz1mb3JlYWNoX2NvbmZpZykKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJjb21wb25lbnRfb3V0X3BhdGgiOiBwYXJhbGxlbF9ub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLAogICAgICAgICAgICB9CgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBhcmFsbGVsX2Zvcl9waXBlbGluZSgpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKCiAgICAgICAgd2l0aCBpbmNsdWRlX3ByaXZhdGVfcHJldmlld19ub2Rlc19pbl9waXBlbGluZSgpOgogICAgICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZV9qb2IsIGNsaWVudCkKCiAgICAgICAgZHNsX3BpcGVsaW5lX2pvYl9kaWN0ID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCksICpvbWl0X2ZpZWxkcykKICAgICAgICBhc3NlcnQgZHNsX3BpcGVsaW5lX2pvYl9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXSA9PSB7CiAgICAgICAgICAgICJwYXJhbGxlbF9ib2R5IjogeyJfc291cmNlIjogIllBTUwuQ09NUE9ORU5UIiwgIm5hbWUiOiAicGFyYWxsZWxfYm9keSIsICJ0eXBlIjogImNvbW1hbmQifSwKICAgICAgICAgICAgInBhcmFsbGVsX25vZGUiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJEU0wiLAogICAgICAgICAgICAgICAgImJvZHkiOiAiJHt7cGFyZW50LmpvYnMucGFyYWxsZWxfYm9keX19IiwKICAgICAgICAgICAgICAgICJpdGVtcyI6ICd7InNpbG9fMCI6IHt9LCAic2lsb18xIjoge30sICJzaWxvXzIiOiB7fSwgJwogICAgICAgICAgICAgICAgJyJzaWxvXzMiOiB7fSwgInNpbG9fNCI6IHt9LCAic2lsb181Ijoge30sICcKICAgICAgICAgICAgICAgICcic2lsb182Ijoge30sICJzaWxvXzciOiB7fSwgInNpbG9fOCI6IHt9LCAnCiAgICAgICAgICAgICAgICAnInNpbG9fOSI6IHt9fScsCiAgICAgICAgICAgICAgICAib3V0cHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X291dF9wYXRoIjogeyJ0eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50Lm91dHB1dHMuY29tcG9uZW50X291dF9wYXRofX0ifQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ0eXBlIjogInBhcmFsbGVsX2ZvciIsCiAgICAgICAgICAgIH0sCiAgICAgICAgfQoKICAgIGRlZiB0ZXN0X3BhcmFsbGVsX2Zvcl9waXBlbGluZV93aXRoX2Fzc2V0X2l0ZW1zKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiKQoKICAgICAgICBAcGlwZWxpbmUKICAgICAgICBkZWYgcGFyYWxsZWxfZm9yX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHBhcmFsbGVsX2JvZHkgPSBoZWxsb193b3JsZF9jb21wb25lbnQoKQogICAgICAgICAgICBwYXJhbGxlbF9ub2RlID0gcGFyYWxsZWxfZm9yKAogICAgICAgICAgICAgICAgYm9keT1wYXJhbGxlbF9ib2R5LAogICAgICAgICAgICAgICAgaXRlbXM9WwogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDEsICJjb21wb25lbnRfaW5fcGF0aCI6IHRlc3RfaW5wdXR9LAogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDIsICJjb21wb25lbnRfaW5fcGF0aCI6IHRlc3RfaW5wdXR9LAogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgKQogICAgICAgICAgICBhZnRlcl9ub2RlID0gaGVsbG9fd29ybGRfY29tcG9uZW50KAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9cGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwKICAgICAgICAgICAgKQoKICAgICAgICBwaXBlbGluZV9qb2IgPSBwYXJhbGxlbF9mb3JfcGlwZWxpbmUoKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCgogICAgICAgIHdpdGggaW5jbHVkZV9wcml2YXRlX3ByZXZpZXdfbm9kZXNfaW5fcGlwZWxpbmUoKToKICAgICAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCgogICAgICAgIGRzbF9waXBlbGluZV9qb2JfZGljdCA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpLCAqb21pdF9maWVsZHMpCiAgICAgICAgYXNzZXJ0IGRzbF9waXBlbGluZV9qb2JfZGljdFsicHJvcGVydGllcyJdWyJqb2JzIl1bInBhcmFsbGVsX25vZGUiXSA9PSB7CiAgICAgICAgICAgICJib2R5IjogIiR7e3BhcmVudC5qb2JzLnBhcmFsbGVsX2JvZHl9fSIsCiAgICAgICAgICAgICJpdGVtcyI6ICdbeyJjb21wb25lbnRfaW5fcGF0aCI6IHsidXJpIjogJwogICAgICAgICAgICAnImh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IiwgJwogICAgICAgICAgICAnImpvYl9pbnB1dF90eXBlIjogInVyaV9maWxlIn0sICcKICAgICAgICAgICAgJyJjb21wb25lbnRfaW5fbnVtYmVyIjogMX0sIHsiY29tcG9uZW50X2luX3BhdGgiOiAnCiAgICAgICAgICAgICd7InVyaSI6ICcKICAgICAgICAgICAgJyJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIsICcKICAgICAgICAgICAgJyJqb2JfaW5wdXRfdHlwZSI6ICJ1cmlfZmlsZSJ9LCAnCiAgICAgICAgICAgICciY29tcG9uZW50X2luX251bWJlciI6IDJ9XScsCiAgICAgICAgICAgICJ0eXBlIjogInBhcmFsbGVsX2ZvciIsCiAgICAgICAgICAgICJfc291cmNlIjogIkRTTCIsCiAgICAgICAgfQo=",
      "StatusCode": 201,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Content-MD5": "M\u002BAluAj0SxPdZWYt7IbNyA==",
        "Date": "Mon, 24 Apr 2023 03:22:27 GMT",
        "ETag": "\u00220x8DB44732187D770\u0022",
        "Last-Modified": "Mon, 24 Apr 2023 03:22:27 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-content-crc64": "IyW1\u002BmdBJcM=",
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://samcw32zcnpjldw.blob.core.windows.net/azureml-blobstore-72e8eff8-148b-4582-a07d-efc79559f19f/LocalUpload/00000000000000000000000000000000/e2etests/test_dsl_pipeline_samples.py",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "19601",
        "Content-MD5": "ePxWxi0sjiP7ZwTSwCeNbQ==",
        "Content-Type": "application/octet-stream",
        "If-None-Match": "*",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)",
        "x-ms-blob-type": "BlockBlob",
        "x-ms-date": "Mon, 24 Apr 2023 03:22:25 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": "IiIiClRoaXMgZmlsZSBjb3ZlcnMgYWxsIHNhbXBsZSBwaXBlbGluZSBpbiBodHRwczovL2dpdGh1Yi5jb20vQXp1cmUvYXp1cmVtbC1wcmV2aWV3cy90cmVlL21haW4vcHJldmlld3MvcGlwZWxpbmVzL3NhbXBsZXMKaW4gZHNsLnBpcGVsaW5lLgpUaGUgc2FtcGxlcyBhcmUgY29waWVkIHRvIHRlc3RfY29uZmlncy9kc2xfcGlwZWxpbmVfc2FtcGxlcwoiIiIKaW1wb3J0IGpzb24KaW1wb3J0IHN5cwpmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKCmltcG9ydCBweWRhc2gKaW1wb3J0IHB5dGVzdApmcm9tIGRldnRvb2xzX3Rlc3R1dGlscyBpbXBvcnQgQXp1cmVSZWNvcmRlZFRlc3RDYXNlLCBpc19saXZlCmZyb20gdGVzdF91dGlsaXRpZXMudXRpbHMgaW1wb3J0IF9QWVRFU1RfVElNRU9VVF9NRVRIT0QsIGFzc2VydF9qb2JfY2FuY2VsCgpmcm9tIGF6dXJlLmFpLm1sIGltcG9ydCBNTENsaWVudCwgbG9hZF9qb2IKZnJvbSBhenVyZS5haS5tbC5lbnRpdGllcyBpbXBvcnQgQ29tcG9uZW50IGFzIENvbXBvbmVudEVudGl0eQpmcm9tIGF6dXJlLmFpLm1sLmVudGl0aWVzIGltcG9ydCBQaXBlbGluZUpvYgpmcm9tIGF6dXJlLmFpLm1sLm9wZXJhdGlvbnMuX3J1bl9oaXN0b3J5X2NvbnN0YW50cyBpbXBvcnQgSm9iU3RhdHVzCgpmcm9tIC4uX3V0aWwgaW1wb3J0IF9EU0xfVElNRU9VVF9TRUNPTkQKCnRlc3RzX3Jvb3RfZGlyID0gUGF0aChfX2ZpbGVfXykucGFyZW50LnBhcmVudC5wYXJlbnQKc3lzLnBhdGguaW5zZXJ0KDAsIHN0cih0ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MiKSkKc2FtcGxlc19kaXIgPSB0ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvZHNsX3BpcGVsaW5lLyIKCgpkZWYgYXNzZXJ0X2pvYl9jb21wbGV0ZWQocGlwZWxpbmUsIGNsaWVudDogTUxDbGllbnQpOgogICAgam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSkKICAgIGNsaWVudC5qb2JzLnN0cmVhbShqb2IubmFtZSkKICAgIGFzc2VydCBjbGllbnQuam9icy5nZXQoam9iLm5hbWUpLnN0YXR1cyA9PSBKb2JTdGF0dXMuQ09NUExFVEVECgoKZGVmIGFzc2VydF9kc2xfY3VyYXRlZChwaXBlbGluZTogUGlwZWxpbmVKb2IsIGpvYl95YW1sLCBvbWl0X2ZpZWxkcyk6CiAgICBkc2xfcGlwZWxpbmVfam9iX2RpY3QgPSBwaXBlbGluZS5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCkKICAgIHBpcGVsaW5lX2pvYl9kaWN0ID0gbG9hZF9qb2Ioc291cmNlPWpvYl95YW1sKS5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCkKCiAgICBkc2xfcGlwZWxpbmVfam9iX2RpY3QgPSBweWRhc2gub21pdChkc2xfcGlwZWxpbmVfam9iX2RpY3QsIG9taXRfZmllbGRzKQogICAgcGlwZWxpbmVfam9iX2RpY3QgPSBweWRhc2gub21pdChwaXBlbGluZV9qb2JfZGljdCwgb21pdF9maWVsZHMpCiAgICBwcmludChqc29uLmR1bXBzKGRzbF9waXBlbGluZV9qb2JfZGljdCwgaW5kZW50PTIpKQogICAgcHJpbnQoanNvbi5kdW1wcyhwaXBlbGluZV9qb2JfZGljdCwgaW5kZW50PTIpKQogICAgYXNzZXJ0IGRzbF9waXBlbGluZV9qb2JfZGljdCA9PSBwaXBlbGluZV9qb2JfZGljdAoKCkBweXRlc3QubWFyay51c2VmaXh0dXJlcygKICAgICJlbmFibGVfZW52aXJvbm1lbnRfaWRfYXJtX2V4cGFuc2lvbiIsCiAgICAiZW5hYmxlX3BpcGVsaW5lX3ByaXZhdGVfcHJldmlld19mZWF0dXJlcyIsCiAgICAibW9ja19jb2RlX2hhc2giLAogICAgIm1vY2tfY29tcG9uZW50X2hhc2giLAogICAgIm1vY2tfc2V0X2hlYWRlcnNfd2l0aF91c2VyX2FtbF90b2tlbiIsCiAgICAicmVjb3JkZWRfdGVzdCIsCiAgICAibW9ja19hc3NldF9uYW1lIiwKICAgICJtb2NrX2Fub25fY29tcG9uZW50X3ZlcnNpb24iLAopCkBweXRlc3QubWFyay50aW1lb3V0KHRpbWVvdXQ9X0RTTF9USU1FT1VUX1NFQ09ORCwgbWV0aG9kPV9QWVRFU1RfVElNRU9VVF9NRVRIT0QpCkBweXRlc3QubWFyay5lMmV0ZXN0CkBweXRlc3QubWFyay5waXBlbGluZV90ZXN0CmNsYXNzIFRlc3REU0xQaXBlbGluZVNhbXBsZXMoQXp1cmVSZWNvcmRlZFRlc3RDYXNlKToKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9lMmVfbG9jYWxfY29tcG9uZW50cyhzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5lMmVfbG9jYWxfY29tcG9uZW50cy5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgZTJlX2xvY2FsX2NvbXBvbmVudHMsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IGUyZV9sb2NhbF9jb21wb25lbnRzKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9lMmVfcmVnaXN0ZXJlZF9jb21wb25lbnRzKAogICAgICAgIHNlbGYsCiAgICAgICAgY2xpZW50OiBNTENsaWVudCwKICAgICAgICBwaXBlbGluZV9zYW1wbGVzX2UyZV9yZWdpc3RlcmVkX3RyYWluX2NvbXBvbmVudHM6IENvbXBvbmVudEVudGl0eSwKICAgICAgICBwaXBlbGluZV9zYW1wbGVzX2UyZV9yZWdpc3RlcmVkX3Njb3JlX2NvbXBvbmVudHM6IENvbXBvbmVudEVudGl0eSwKICAgICAgICBwaXBlbGluZV9zYW1wbGVzX2UyZV9yZWdpc3RlcmVkX2V2YWxfY29tcG9uZW50czogQ29tcG9uZW50RW50aXR5LAogICAgKSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5lMmVfcmVnaXN0ZXJlZF9jb21wb25lbnRzLnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIGdlbmVyYXRlX2RzbF9waXBlbGluZSBhcyBlMmVfcmVnaXN0ZXJlZF9jb21wb25lbnRzLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBlMmVfcmVnaXN0ZXJlZF9jb21wb25lbnRzKAogICAgICAgICAgICBjbGllbnQ9Y2xpZW50LAogICAgICAgICAgICBwaXBlbGluZV9zYW1wbGVzX2UyZV9yZWdpc3RlcmVkX3RyYWluX2NvbXBvbmVudHM9cGlwZWxpbmVfc2FtcGxlc19lMmVfcmVnaXN0ZXJlZF90cmFpbl9jb21wb25lbnRzLAogICAgICAgICAgICBwaXBlbGluZV9zYW1wbGVzX2UyZV9yZWdpc3RlcmVkX3Njb3JlX2NvbXBvbmVudHM9cGlwZWxpbmVfc2FtcGxlc19lMmVfcmVnaXN0ZXJlZF9zY29yZV9jb21wb25lbnRzLAogICAgICAgICAgICBwaXBlbGluZV9zYW1wbGVzX2UyZV9yZWdpc3RlcmVkX2V2YWxfY29tcG9uZW50cz1waXBlbGluZV9zYW1wbGVzX2UyZV9yZWdpc3RlcmVkX2V2YWxfY29tcG9uZW50cywKICAgICAgICApCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKICAgICAgICAjIG1vdmUgdW5pdCB0ZXN0IGhlcmUgZHVlIHRvIHBlcm1pc3Npb24gcHJvYmxlbQogICAgICAgIGpvYl95YW1sID0gc3RyKHNhbXBsZXNfZGlyIC8gImUyZV9yZWdpc3RlcmVkX2NvbXBvbmVudHMvcGlwZWxpbmUueW1sIikKICAgICAgICBvbWl0X2ZpZWxkcyA9IFsKICAgICAgICAgICAgInByb3BlcnRpZXMuZXhwZXJpbWVudF9uYW1lIiwKICAgICAgICAgICAgIm5hbWUiLAogICAgICAgICAgICAicHJvcGVydGllcy5qb2JzLnRyYWluX2pvYi5jb21wb25lbnRJZCIsCiAgICAgICAgICAgICJwcm9wZXJ0aWVzLmpvYnMuc2NvcmVfam9iLmNvbXBvbmVudElkIiwKICAgICAgICAgICAgInByb3BlcnRpZXMuam9icy5ldmFsdWF0ZV9qb2IuY29tcG9uZW50SWQiLAogICAgICAgICAgICAicHJvcGVydGllcy5qb2JzLnRyYWluX2pvYi5yZXNvdXJjZXMiLCAgIyBqb2IgeWFtbCB3b24ndCBoYXZlIHJlc291cmNlcyBidXQgd2Ugd2lsbCBwYXNzIHRoZW0KICAgICAgICAgICAgInByb3BlcnRpZXMuam9icy5zY29yZV9qb2IucmVzb3VyY2VzIiwKICAgICAgICAgICAgInByb3BlcnRpZXMuam9icy5ldmFsdWF0ZV9qb2IucmVzb3VyY2VzIiwKICAgICAgICAgICAgInByb3BlcnRpZXMuaW5wdXRzLnBpcGVsaW5lX2pvYl90cmFpbmluZ19pbnB1dC51cmkiLAogICAgICAgICAgICAicHJvcGVydGllcy5pbnB1dHMucGlwZWxpbmVfam9iX3Rlc3RfaW5wdXQudXJpIiwKICAgICAgICAgICAgInByb3BlcnRpZXMucHJvcGVydGllcyIsCiAgICAgICAgICAgICJwcm9wZXJ0aWVzLmNvbXB1dGVfaWQiLAogICAgICAgICAgICAicHJvcGVydGllcy5zZXR0aW5ncyIsCiAgICAgICAgXQogICAgICAgIGFzc2VydF9kc2xfY3VyYXRlZChwaXBlbGluZSwgam9iX3lhbWwsIG9taXRfZmllbGRzKQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9iYXNpY19jb21wb25lbnQoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuYmFzaWNfY29tcG9uZW50LnBpcGVsaW5lIGltcG9ydCBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgYmFzaWNfY29tcG9uZW50CgogICAgICAgIHBpcGVsaW5lID0gYmFzaWNfY29tcG9uZW50KCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9jb21wb25lbnRfd2l0aF9pbnB1dF9vdXRwdXQoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuY29tcG9uZW50X3dpdGhfaW5wdXRfb3V0cHV0LnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIGdlbmVyYXRlX2RzbF9waXBlbGluZSBhcyBjb21wb25lbnRfd2l0aF9pbnB1dF9vdXRwdXQsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IGNvbXBvbmVudF93aXRoX2lucHV0X291dHB1dCgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfYmFzaWNfcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuYmFzaWNfcGlwZWxpbmUucGlwZWxpbmUgaW1wb3J0IGdlbmVyYXRlX2RzbF9waXBlbGluZSBhcyBiYXNpY19waXBlbGluZQoKICAgICAgICBwaXBlbGluZSA9IGJhc2ljX3BpcGVsaW5lKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9waXBlbGluZV93aXRoX2RhdGEoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUucGlwbGluZV93aXRoX2RhdGEucGlwZWxpbmUgaW1wb3J0IGdlbmVyYXRlX2RzbF9waXBlbGluZSBhcyBwaXBsaW5lX3dpdGhfZGF0YQoKICAgICAgICBwaXBlbGluZSA9IHBpcGxpbmVfd2l0aF9kYXRhKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9sb2NhbF9kYXRhX2lucHV0KHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLmxvY2FsX2RhdGFfaW5wdXQucGlwZWxpbmUgaW1wb3J0IGdlbmVyYXRlX2RzbF9waXBlbGluZSBhcyBsb2NhbF9kYXRhX2lucHV0CgogICAgICAgIHBpcGVsaW5lID0gbG9jYWxfZGF0YV9pbnB1dCgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfZGF0YXN0b3JlX2RhdGFwYXRoX3VyaV9mb2xkZXIoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuZGF0YXN0b3JlX2RhdGFwYXRoX3VyaV9mb2xkZXIucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIGRhdGFzdG9yZV9kYXRhcGF0aF91cmlfZm9sZGVyLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBkYXRhc3RvcmVfZGF0YXBhdGhfdXJpX2ZvbGRlcigpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfZGF0YXN0b3JlX2RhdGFwYXRoX3VyaV9maWxlKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLmRhdGFzdG9yZV9kYXRhcGF0aF91cmlfZmlsZS5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgZGF0YXN0b3JlX2RhdGFwYXRoX3VyaV9maWxlLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBkYXRhc3RvcmVfZGF0YXBhdGhfdXJpX2ZpbGUoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X2RhdGFzZXRfaW5wdXQoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuZGF0YXNldF9pbnB1dC5waXBlbGluZSBpbXBvcnQgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIGRhdGFzZXRfaW5wdXQKCiAgICAgICAgcGlwZWxpbmUgPSBkYXRhc2V0X2lucHV0KGNsaWVudCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF93ZWJfdXJsX2lucHV0KHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLndlYl91cmxfaW5wdXQucGlwZWxpbmUgaW1wb3J0IGdlbmVyYXRlX2RzbF9waXBlbGluZSBhcyB3ZWJfdXJsX2lucHV0CgogICAgICAgIHBpcGVsaW5lID0gd2ViX3VybF9pbnB1dCgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfZW52X3B1YmxpY19kb2NrZXJfaW1hZ2Uoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuZW52X3B1YmxpY19kb2NrZXJfaW1hZ2UucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIGVudl9wdWJsaWNfZG9ja2VyX2ltYWdlLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBlbnZfcHVibGljX2RvY2tlcl9pbWFnZSgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfZW52X3JlZ2lzdGVyZWQoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuZW52X3JlZ2lzdGVyZWQucGlwZWxpbmUgaW1wb3J0IGdlbmVyYXRlX2RzbF9waXBlbGluZSBhcyBlbnZfcmVnaXN0ZXJlZAoKICAgICAgICBwaXBlbGluZSA9IGVudl9yZWdpc3RlcmVkKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9lbnZfY29uZGFfZmlsZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5lbnZfY29uZGFfZmlsZS5waXBlbGluZSBpbXBvcnQgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIGVudl9jb25kYV9maWxlCgogICAgICAgIHBpcGVsaW5lID0gZW52X2NvbmRhX2ZpbGUoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X3RmX2hlbGxvX3dvcmxkKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLnRmX2hlbGxvX3dvcmxkLnBpcGVsaW5lIGltcG9ydCBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgdGZfaGVsbG9fd29ybGQKCiAgICAgICAgcGlwZWxpbmUgPSB0Zl9oZWxsb193b3JsZCgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfbXBpX2hlbGxvX3dvcmxkKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLm1waV9oZWxsb193b3JsZC5waXBlbGluZSBpbXBvcnQgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIG1waV9oZWxsb193b3JsZAoKICAgICAgICBwaXBlbGluZSA9IG1waV9oZWxsb193b3JsZCgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfcHl0b3JjaF9oZWxsb193b3JsZChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5weXRvcmNoX2hlbGxvX3dvcmxkLnBpcGVsaW5lIGltcG9ydCBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgcHl0b3JjaF9oZWxsb193b3JsZAoKICAgICAgICBwaXBlbGluZSA9IHB5dG9yY2hfaGVsbG9fd29ybGQoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X255Y190YXhpX2RhdGFfcmVncmVzc2lvbihzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5ueWNfdGF4aV9kYXRhX3JlZ3Jlc3Npb24ucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIG55Y190YXhpX2RhdGFfcmVncmVzc2lvbiwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gbnljX3RheGlfZGF0YV9yZWdyZXNzaW9uKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF90Zl9tbmlzdChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS50Zl9tbmlzdC5waXBlbGluZSBpbXBvcnQgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIHRmX21uaXN0CgogICAgICAgIHBpcGVsaW5lID0gdGZfbW5pc3QoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X2UyZV9pbmxpbmVfY29tcG9uZW50cyhzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5lMmVfaW5saW5lX2NvbXBvbmVudHMucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIGUyZV9pbmxpbmVfY29tcG9uZW50cywKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gZTJlX2lubGluZV9jb21wb25lbnRzKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay51c2VmaXh0dXJlcygibW9ja19hc3NldF9uYW1lIikKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9jb21tYW5kX2pvYl9pbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5jb21tYW5kX2pvYl9pbl9waXBlbGluZS5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgY29tbWFuZF9qb2JfaW5fcGlwZWxpbmUsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IGNvbW1hbmRfam9iX2luX3BpcGVsaW5lKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9tdWx0aV9wYXJhbGxlbF9jb21wb25lbnRzX3dpdGhfZmlsZV9pbnB1dF9waXBlbGluZV9vdXRwdXQoCiAgICAgICAgc2VsZiwKICAgICAgICBjbGllbnQ6IE1MQ2xpZW50LAogICAgKSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5wYXJhbGxlbF9jb21wb25lbnRfd2l0aF9maWxlX2lucHV0LnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIGdlbmVyYXRlX2RzbF9waXBlbGluZSBhcyBwaXBlbGluZV93aXRoX3BhcmFsbGVsX2NvbXBvbmVudHMsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX3dpdGhfcGFyYWxsZWxfY29tcG9uZW50cygpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfcGFyYWxsZWxfY29tcG9uZW50c193aXRoX3RhYnVsYXJfaW5wdXRfcGlwZWxpbmVfb3V0cHV0KHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLnBhcmFsbGVsX2NvbXBvbmVudF93aXRoX3RhYnVsYXJfaW5wdXQucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIHBpcGVsaW5lX3dpdGhfcGFyYWxsZWxfY29tcG9uZW50cywKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmVfd2l0aF9wYXJhbGxlbF9jb21wb25lbnRzKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9wYXJhbGxlbF9jb21wb25lbnRzKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLnBhcmFsbGVsX2NvbXBvbmVudC5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgcGlwZWxpbmVfd2l0aF9wYXJhbGxlbF9jb21wb25lbnRzLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV93aXRoX3BhcmFsbGVsX2NvbXBvbmVudHMoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X2F1dG9tbF9qb2JfaW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuYXV0b21sX2pvYl9pbl9waXBlbGluZS5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgYXV0b21sX2pvYl9pbl9waXBlbGluZSwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gYXV0b21sX2pvYl9pbl9waXBlbGluZSgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfcGlwZWxpbmVfd2l0aF9waXBlbGluZV9jb21wb25lbnQoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUucGlwZWxpbmVfd2l0aF9waXBlbGluZV9jb21wb25lbnQucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIHBpcGVsaW5lX3dpdGhfcGlwZWxpbmVfY29tcG9uZW50LAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV93aXRoX3BpcGVsaW5lX2NvbXBvbmVudCgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfcGlwZWxpbmVfd2l0aF9kYXRhX2FzX2lucHV0c19mb3JfcGlwZWxpbmVfY29tcG9uZW50KHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLnBpcGVsaW5lX3dpdGhfcGlwZWxpbmVfY29tcG9uZW50LnBpcGVsaW5lX3dpdGhfZGF0YV9hc19pbnB1dCBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgcGlwZWxpbmVfd2l0aF9waXBlbGluZV9jb21wb25lbnQsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX3dpdGhfcGlwZWxpbmVfY29tcG9uZW50KGNsaWVudCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9zcGFya19qb2JfaW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuc3Bhcmtfam9iX2luX3BpcGVsaW5lLnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIGdlbmVyYXRlX2RzbF9waXBlbGluZV9mcm9tX3lhbWwgYXMgc3Bhcmtfam9iX2luX3BpcGVsaW5lLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBzcGFya19qb2JfaW5fcGlwZWxpbmUoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X3NwYXJrX2pvYl93aXRoX2J1aWxkZXJfaW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuc3Bhcmtfam9iX2luX3BpcGVsaW5lLnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIGdlbmVyYXRlX2RzbF9waXBlbGluZV9mcm9tX2J1aWxkZXIgYXMgc3Bhcmtfam9iX2luX3BpcGVsaW5lLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBzcGFya19qb2JfaW5fcGlwZWxpbmUoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X3NwYXJrX2pvYl93aXRoX211bHRpcGxlX25vZGVfaW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuc3Bhcmtfam9iX2luX3BpcGVsaW5lLmttZWFuc19zYW1wbGUucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lX2Zyb21feWFtbCBhcyBzcGFya19qb2JfaW5fcGlwZWxpbmUsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHNwYXJrX2pvYl9pbl9waXBlbGluZSgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3Rfc3Bhcmtfam9iX3dpdGhfYnVpbGRlcl9pbl9waXBlbGluZV93aXRob3V0X2VudHJ5KAogICAgICAgIHNlbGYsCiAgICAgICAgY2xpZW50OiBNTENsaWVudCwKICAgICkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuc3Bhcmtfam9iX2luX3BpcGVsaW5lLmludmFsaWRfcGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lX2Zyb21fYnVpbGRlcl93aXRob3V0X2VudHJ5IGFzIHNwYXJrX2pvYl9pbl9waXBlbGluZSwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gc3Bhcmtfam9iX2luX3BpcGVsaW5lKCkKICAgICAgICB3aXRoIHB5dGVzdC5yYWlzZXMoRXhjZXB0aW9uKSBhcyBleDoKICAgICAgICAgICAgY3JlYXRlZF9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lKQoKICAgICAgICBhc3NlcnQgKAogICAgICAgICAgICAne1xuICAicmVzdWx0IjogIkZhaWxlZCIsXG4gICJlcnJvcnMiOiBbXG4gICAge1xuICAgICAgIm1lc3NhZ2UiOiAiTWlzc2luZyBkYXRhIGZvciByZXF1aXJlZCBmaWVsZC4iLCcKICAgICAgICAgICAgJ1xuICAgICAgInBhdGgiOiAiam9icy5hZGRfZ3JlZXRpbmdfY29sdW1uLmNvbXBvbmVudC5lbnRyeSIsXG4gICAgICAidmFsdWUiOiBudWxsXG4gICAgfVxuICBdXG59JwogICAgICAgICAgICA9PSBzdHIoZXgudmFsdWUpCiAgICAgICAgKQoKICAgICAgICB2YWxpZGF0aW9uX3Jlc3VsdCA9IGNsaWVudC5qb2JzLnZhbGlkYXRlKHBpcGVsaW5lKQogICAgICAgIGFzc2VydCB2YWxpZGF0aW9uX3Jlc3VsdC5wYXNzZWQgaXMgRmFsc2UKICAgICAgICBhc3NlcnQgdmFsaWRhdGlvbl9yZXN1bHQuZXJyb3JfbWVzc2FnZXMgPT0gewogICAgICAgICAgICAiam9icy5hZGRfZ3JlZXRpbmdfY29sdW1uLmNvbXBvbmVudC5lbnRyeSI6ICJNaXNzaW5nIGRhdGEgZm9yIHJlcXVpcmVkIGZpZWxkLiIsCiAgICAgICAgfQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9zcGFya19qb2Jfd2l0aF9idWlsZGVyX2luX3BpcGVsaW5lX3dpdGhfZHluYW1pY19hbGxvY2F0aW9uX2Rpc2FibGVkKAogICAgICAgIHNlbGYsCiAgICAgICAgY2xpZW50OiBNTENsaWVudCwKICAgICkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuc3Bhcmtfam9iX2luX3BpcGVsaW5lLmludmFsaWRfcGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lX2Zyb21fYnVpbGRlcl93aXRoX2R5bmFtaWNfYWxsb2NhdGlvbl9kaXNhYmxlZCBhcyBzcGFya19qb2JfaW5fcGlwZWxpbmUsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHNwYXJrX2pvYl9pbl9waXBlbGluZSgpCiAgICAgICAgd2l0aCBweXRlc3QucmFpc2VzKEV4Y2VwdGlvbikgYXMgZXg6CiAgICAgICAgICAgIGNyZWF0ZWRfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSkKCiAgICAgICAgYXNzZXJ0ICgKICAgICAgICAgICAgJ3tcbiAgInJlc3VsdCI6ICJGYWlsZWQiLFxuICAiZXJyb3JzIjogW1xuICAgIHtcbiAgICAgICJtZXNzYWdlIjogIlNob3VsZCBub3Qgc3BlY2lmeSBtaW4gb3IgbWF4ICcKICAgICAgICAgICAgJ2V4ZWN1dG9ycyB3aGVuIGR5bmFtaWMgYWxsb2NhdGlvbiBpcyBkaXNhYmxlZC4iLFxuJyBpbiBzdHIoZXgudmFsdWUpCiAgICAgICAgKQoKICAgICAgICB2YWxpZGF0aW9uX3Jlc3VsdCA9IGNsaWVudC5qb2JzLnZhbGlkYXRlKHBpcGVsaW5lKQogICAgICAgIGFzc2VydCB2YWxpZGF0aW9uX3Jlc3VsdC5wYXNzZWQgaXMgRmFsc2UKICAgICAgICBhc3NlcnQgdmFsaWRhdGlvbl9yZXN1bHQuZXJyb3JfbWVzc2FnZXMgPT0gewogICAgICAgICAgICAiam9icy5hZGRfZ3JlZXRpbmdfY29sdW1uIjogIlNob3VsZCBub3Qgc3BlY2lmeSBtaW4gb3IgbWF4IGV4ZWN1dG9ycyB3aGVuIGR5bmFtaWMgYWxsb2NhdGlvbiBpcyBkaXNhYmxlZC4iLAogICAgICAgIH0KCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfZGF0YV90cmFuc2Zlcl9jb3B5XzJ1cmlmb2xkZXJfam9iX2luX3BpcGVsaW5lKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLmRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lLmNvcHlfZGF0YS5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmVfZnJvbV95YW1sIGFzIGRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBkYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZSgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCwgc2tpcF9jYW5jZWw9VHJ1ZSkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfZGF0YV90cmFuc2Zlcl9jb3B5XzJ1cmlmb2xkZXJfam9iX3dpdGhfYnVpbGRlcl9pbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5kYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZS5jb3B5X2RhdGEucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lX2Zyb21fYnVpbGRlciBhcyBkYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZSwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X2RhdGFfdHJhbnNmZXJfY29weV9taXh0eXBlX2pvYl9pbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5kYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZS5jb3B5X2RhdGEucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lX2NvcHlfbWl4dHlwZV9mcm9tX3lhbWwgYXMgZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IGRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9kYXRhX3RyYW5zZmVyX2NvcHlfdXJpZmlsZV9qb2JfaW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUuY29weV9kYXRhLnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIGdlbmVyYXRlX2RzbF9waXBlbGluZV9jb3B5X3VyaWZpbGVfZnJvbV95YW1sIGFzIGRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBkYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZSgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfZGF0YV90cmFuc2Zlcl9jb3B5X3VyaWZvbGRlcl9qb2JfaW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUuY29weV9kYXRhLnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIGdlbmVyYXRlX2RzbF9waXBlbGluZV9jb3B5X3VyaWZvbGRlcl9mcm9tX3lhbWwgYXMgZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IGRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9kYXRhX3RyYW5zZmVyX2ltcG9ydF9maWxlc3lzdGVtX2pvYl9pbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5kYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZS5pbXBvcnRfZmlsZV9zeXN0ZW0ucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lX2Zyb21fYnVpbGRlciBhcyBkYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZSwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X2RhdGFfdHJhbnNmZXJfaW1wb3J0X3NxbF9kYXRhYmFzZV9qb2JfaW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUuaW1wb3J0X2RhdGFiYXNlLnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIGdlbmVyYXRlX2RzbF9waXBlbGluZV9mcm9tX2J1aWxkZXJfc3FsIGFzIGRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBkYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZSgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfZGF0YV90cmFuc2Zlcl9pbXBvcnRfc25vd2ZsYWtlX2RhdGFiYXNlX2pvYl9pbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5kYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZS5pbXBvcnRfZGF0YWJhc2UucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lX2Zyb21fYnVpbGRlciBhcyBkYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZSwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X2RhdGFfdHJhbnNmZXJfZXhwb3J0X3NxbF9kYXRhYmFzZV9qb2JfaW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUuZXhwb3J0X2RhdGFiYXNlLnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIGdlbmVyYXRlX2RzbF9waXBlbGluZV9mcm9tX2J1aWxkZXIgYXMgZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IGRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9kYXRhX3RyYW5zZmVyX211bHRpX2pvYl9pbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5kYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZS5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IGRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQo=",
      "StatusCode": 201,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Content-MD5": "ePxWxi0sjiP7ZwTSwCeNbQ==",
        "Date": "Mon, 24 Apr 2023 03:22:27 GMT",
        "ETag": "\u00220x8DB4473218DF111\u0022",
        "Last-Modified": "Mon, 24 Apr 2023 03:22:27 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-content-crc64": "ZdjLM36mwI4=",
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://samcw32zcnpjldw.blob.core.windows.net/azureml-blobstore-72e8eff8-148b-4582-a07d-efc79559f19f/LocalUpload/00000000000000000000000000000000/e2etests/test_automl_dsl_pipeline.py",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "34209",
        "Content-MD5": "7KSIc2nEWBWtt/xkdXjRWw==",
        "Content-Type": "application/octet-stream",
        "If-None-Match": "*",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)",
        "x-ms-blob-type": "BlockBlob",
        "x-ms-date": "Mon, 24 Apr 2023 03:22:25 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": "ZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCgppbXBvcnQgcHlkYXNoCmltcG9ydCBweXRlc3QKZnJvbSBkZXZ0b29sc190ZXN0dXRpbHMgaW1wb3J0IEF6dXJlUmVjb3JkZWRUZXN0Q2FzZQpmcm9tIHRlc3RfdXRpbGl0aWVzLnV0aWxzIGltcG9ydCBjYW5jZWxfam9iCgpmcm9tIGF6dXJlLmFpLm1sIGltcG9ydCBJbnB1dCwgTUxDbGllbnQsIGF1dG9tbCwgZHNsLCBPdXRwdXQKZnJvbSBhenVyZS5haS5tbC5hdXRvbWwgaW1wb3J0ICgKICAgIGNsYXNzaWZpY2F0aW9uLAogICAgZm9yZWNhc3RpbmcsCiAgICByZWdyZXNzaW9uLAogICAgdGV4dF9jbGFzc2lmaWNhdGlvbiwKICAgIHRleHRfY2xhc3NpZmljYXRpb25fbXVsdGlsYWJlbCwKICAgIHRleHRfbmVyLAopCmZyb20gYXp1cmUuYWkubWwuY29uc3RhbnRzLl9jb21tb24gaW1wb3J0IEFzc2V0VHlwZXMKZnJvbSBhenVyZS5haS5tbC5lbnRpdGllcyBpbXBvcnQgUGlwZWxpbmVKb2IKZnJvbSBhenVyZS5haS5tbC5lbnRpdGllcy5fam9iLmF1dG9tbCBpbXBvcnQgU2VhcmNoU3BhY2UKZnJvbSBhenVyZS5haS5tbC5lbnRpdGllcy5fam9iLmF1dG9tbC5ubHAgaW1wb3J0IE5scEZlYXR1cml6YXRpb25TZXR0aW5ncwpmcm9tIGF6dXJlLmFpLm1sLmVudGl0aWVzLl9qb2IuYXV0b21sLnRhYnVsYXIgaW1wb3J0IFRhYnVsYXJGZWF0dXJpemF0aW9uU2V0dGluZ3MKZnJvbSBhenVyZS5haS5tbC5lbnRpdGllcy5fam9iLmF1dG9tbC50YWJ1bGFyLmZvcmVjYXN0aW5nX3NldHRpbmdzIGltcG9ydCBGb3JlY2FzdGluZ1NldHRpbmdzCmZyb20gYXp1cmUuYWkubWwuc3dlZXAgaW1wb3J0IEJhbmRpdFBvbGljeSwgQ2hvaWNlLCBVbmlmb3JtCgp0ZXN0c19yb290X2RpciA9IFBhdGgoX19maWxlX18pLnBhcmVudC5wYXJlbnQucGFyZW50CgojIGRlY2xhcmUgdmFyaWFibGVzIGZvciBjb21wdXRlLCBzbyB0aGF0IHdlIGNhbiBlYXNpbHkgY2hhbmdlIHRoZW0gbGF0ZXIKQ1BVX0NMVVNURVIgPSAiY3B1LWNsdXN0ZXIiCkdQVV9DTFVTVEVSID0gImdwdS1jbHVzdGVyIgoKCkBweXRlc3QubWFyay51c2VmaXh0dXJlcygKICAgICJlbmFibGVfZW52aXJvbm1lbnRfaWRfYXJtX2V4cGFuc2lvbiIsCiAgICAiZW5hYmxlX3BpcGVsaW5lX3ByaXZhdGVfcHJldmlld19mZWF0dXJlcyIsCiAgICAibW9ja19jb2RlX2hhc2giLAogICAgIm1vY2tfY29tcG9uZW50X2hhc2giLAogICAgIm1vY2tfc2V0X2hlYWRlcnNfd2l0aF91c2VyX2FtbF90b2tlbiIsCiAgICAicmVjb3JkZWRfdGVzdCIsCikKQHB5dGVzdC5tYXJrLmF1dG9tbGUyZXRlc3QKQHB5dGVzdC5tYXJrLnBpcGVsaW5lX3Rlc3QKY2xhc3MgVGVzdEF1dG9tbERTTFBpcGVsaW5lKEF6dXJlUmVjb3JkZWRUZXN0Q2FzZSk6CiAgICBkZWYgdGVzdF9hdXRvbWxfY2xhc3NpZmljYXRpb25faW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgQGRzbC5waXBlbGluZShuYW1lPSJ0cmFpbl9hdXRvbWxfY2xhc3NpZmljYXRpb25faW5fcGlwZWxpbmUiKQogICAgICAgIGRlZiB0cmFpbl9hdXRvbWxfY2xhc3NpZmljYXRpb25faW5fcGlwZWxpbmUoCiAgICAgICAgICAgIGNsYXNzX3RyYWluX2RhdGEsCiAgICAgICAgICAgIGNsYXNzX3ZhbGlkX2RhdGEsCiAgICAgICAgKToKICAgICAgICAgICAgY2xhc3NpZmljYXRpb25fbm9kZSA9IGNsYXNzaWZpY2F0aW9uKAogICAgICAgICAgICAgICAgdHJhaW5pbmdfZGF0YT1jbGFzc190cmFpbl9kYXRhLAogICAgICAgICAgICAgICAgdmFsaWRhdGlvbl9kYXRhPWNsYXNzX3ZhbGlkX2RhdGEsCiAgICAgICAgICAgICAgICB0ZXN0X2RhdGE9Y2xhc3NfdmFsaWRfZGF0YSwKICAgICAgICAgICAgICAgIHRhcmdldF9jb2x1bW5fbmFtZT0ieSIsCiAgICAgICAgICAgICAgICBwcmltYXJ5X21ldHJpYz0iYWNjdXJhY3kiLAogICAgICAgICAgICAgICAgZmVhdHVyaXphdGlvbj1UYWJ1bGFyRmVhdHVyaXphdGlvblNldHRpbmdzKG1vZGU9IkF1dG8iKSwKICAgICAgICAgICAgKQogICAgICAgICAgICBjbGFzc2lmaWNhdGlvbl9ub2RlLnNldF9saW1pdHMobWF4X3RyaWFscz0xKQogICAgICAgICAgICBjbGFzc2lmaWNhdGlvbl9ub2RlLnNldF90cmFpbmluZyhlbmFibGVfc3RhY2tfZW5zZW1ibGU9RmFsc2UsIGVuYWJsZV92b3RlX2Vuc2VtYmxlPUZhbHNlKQoKICAgICAgICBjbGFzc190cmFpbiA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL2JhbmtfbWFya2V0aW5nL3RyYWluIiwKICAgICAgICApCiAgICAgICAgY2xhc3NfdmFsaWQgPSBJbnB1dCgKICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgIHBhdGg9dGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2F1dG9tbF9qb2IvdGVzdF9kYXRhc2V0cy9iYW5rX21hcmtldGluZy92YWxpZCIsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZV9qb2I6IFBpcGVsaW5lSm9iID0gdHJhaW5fYXV0b21sX2NsYXNzaWZpY2F0aW9uX2luX3BpcGVsaW5lKGNsYXNzX3RyYWluLCBjbGFzc192YWxpZCkKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gQ1BVX0NMVVNURVIKCiAgICAgICAgZnJvbV9yZXN0X3BpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmVfam9iKQogICAgICAgIGNhbmNlbF9qb2IoY2xpZW50LCBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iKQoKICAgICAgICBhY3R1YWxfZGljdCA9IGZyb21fcmVzdF9waXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpCiAgICAgICAgZmllbGRzX3RvX29taXQgPSBbIm5hbWUiLCAiZGlzcGxheV9uYW1lIiwgImV4cGVyaW1lbnRfbmFtZSIsICJwcm9wZXJ0aWVzIl0KCiAgICAgICAgY2xhc3NpZmljYXRpb25fZGljdCA9IHB5ZGFzaC5vbWl0KGFjdHVhbF9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXVsiY2xhc3NpZmljYXRpb25fbm9kZSJdLCBmaWVsZHNfdG9fb21pdCkKICAgICAgICBhc3NlcnQgY2xhc3NpZmljYXRpb25fZGljdCA9PSB7CiAgICAgICAgICAgICJ0ZXN0X2RhdGEiOiAiJHt7cGFyZW50LmlucHV0cy5jbGFzc192YWxpZF9kYXRhfX0iLAogICAgICAgICAgICAidmFsaWRhdGlvbl9kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMuY2xhc3NfdmFsaWRfZGF0YX19IiwKICAgICAgICAgICAgInRyYWluaW5nX2RhdGEiOiAiJHt7cGFyZW50LmlucHV0cy5jbGFzc190cmFpbl9kYXRhfX0iLAogICAgICAgICAgICAidGFyZ2V0X2NvbHVtbl9uYW1lIjogInkiLAogICAgICAgICAgICAidGFncyI6IHt9LAogICAgICAgICAgICAidHlwZSI6ICJhdXRvbWwiLAogICAgICAgICAgICAib3V0cHV0cyI6IHt9LAogICAgICAgICAgICAibG9nX3ZlcmJvc2l0eSI6ICJpbmZvIiwKICAgICAgICAgICAgImxpbWl0cyI6IHsibWF4X3RyaWFscyI6IDF9LAogICAgICAgICAgICAiZmVhdHVyaXphdGlvbiI6IHsibW9kZSI6ICJhdXRvIn0sCiAgICAgICAgICAgICJ0cmFpbmluZyI6IHsiZW5hYmxlX3N0YWNrX2Vuc2VtYmxlIjogRmFsc2UsICJlbmFibGVfdm90ZV9lbnNlbWJsZSI6IEZhbHNlfSwKICAgICAgICAgICAgInRhc2siOiAiY2xhc3NpZmljYXRpb24iLAogICAgICAgICAgICAicHJpbWFyeV9tZXRyaWMiOiAiYWNjdXJhY3kiLAogICAgICAgIH0KCiAgICBkZWYgdGVzdF9yZWdpc3Rlcl9vdXRwdXRfZm9yX2F1dG9tbF9jbGFzc2lmaWNhdGlvbihzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBAZHNsLnBpcGVsaW5lKG5hbWU9InRyYWluX2F1dG9tbF9jbGFzc2lmaWNhdGlvbl9pbl9waXBlbGluZSIpCiAgICAgICAgZGVmIHRyYWluX2F1dG9tbF9jbGFzc2lmaWNhdGlvbl9pbl9waXBlbGluZSgKICAgICAgICAgICAgY2xhc3NfdHJhaW5fZGF0YSwKICAgICAgICAgICAgY2xhc3NfdmFsaWRfZGF0YSwKICAgICAgICApOgogICAgICAgICAgICBjbGFzc2lmaWNhdGlvbl9ub2RlID0gY2xhc3NpZmljYXRpb24oCiAgICAgICAgICAgICAgICB0cmFpbmluZ19kYXRhPWNsYXNzX3RyYWluX2RhdGEsCiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uX2RhdGE9Y2xhc3NfdmFsaWRfZGF0YSwKICAgICAgICAgICAgICAgIHRlc3RfZGF0YT1jbGFzc192YWxpZF9kYXRhLAogICAgICAgICAgICAgICAgdGFyZ2V0X2NvbHVtbl9uYW1lPSJ5IiwKICAgICAgICAgICAgICAgIHByaW1hcnlfbWV0cmljPSJhY2N1cmFjeSIsCiAgICAgICAgICAgICAgICBmZWF0dXJpemF0aW9uPVRhYnVsYXJGZWF0dXJpemF0aW9uU2V0dGluZ3MobW9kZT0iQXV0byIpLAogICAgICAgICAgICAgICAgb3V0cHV0cz17ImJlc3RfbW9kZWwiOiBPdXRwdXQodHlwZT0ibWxmbG93X21vZGVsIil9LAogICAgICAgICAgICApCiAgICAgICAgICAgIGNsYXNzaWZpY2F0aW9uX25vZGUuc2V0X2xpbWl0cyhtYXhfdHJpYWxzPTEpCiAgICAgICAgICAgIGNsYXNzaWZpY2F0aW9uX25vZGUuc2V0X3RyYWluaW5nKGVuYWJsZV9zdGFja19lbnNlbWJsZT1GYWxzZSwgZW5hYmxlX3ZvdGVfZW5zZW1ibGU9RmFsc2UpCiAgICAgICAgICAgIGNsYXNzaWZpY2F0aW9uX25vZGUub3V0cHV0c1siYmVzdF9tb2RlbCJdLm5hbWUgPSAiY2xhc3NpZmljYXRpb25fb3V0cHV0X25hbWUiCiAgICAgICAgICAgIGNsYXNzaWZpY2F0aW9uX25vZGUub3V0cHV0c1siYmVzdF9tb2RlbCJdLnZlcnNpb24gPSAiMSIKCiAgICAgICAgICAgIGNsYXNzaWZpY2F0aW9uX25vZGVfMiA9IGNsYXNzaWZpY2F0aW9uKCAgIyBiaW5kaW5nIHRvIHBpcGVsaW5lIG91dHB1dAogICAgICAgICAgICAgICAgdHJhaW5pbmdfZGF0YT1jbGFzc190cmFpbl9kYXRhLAogICAgICAgICAgICAgICAgdmFsaWRhdGlvbl9kYXRhPWNsYXNzX3ZhbGlkX2RhdGEsCiAgICAgICAgICAgICAgICB0ZXN0X2RhdGE9Y2xhc3NfdmFsaWRfZGF0YSwKICAgICAgICAgICAgICAgIHRhcmdldF9jb2x1bW5fbmFtZT0ieSIsCiAgICAgICAgICAgICAgICBwcmltYXJ5X21ldHJpYz0iYWNjdXJhY3kiLAogICAgICAgICAgICAgICAgZmVhdHVyaXphdGlvbj1UYWJ1bGFyRmVhdHVyaXphdGlvblNldHRpbmdzKG1vZGU9IkF1dG8iKSwKICAgICAgICAgICAgICAgIG91dHB1dHM9eyJiZXN0X21vZGVsIjogT3V0cHV0KHR5cGU9Im1sZmxvd19tb2RlbCIpfSwKICAgICAgICAgICAgKQogICAgICAgICAgICBjbGFzc2lmaWNhdGlvbl9ub2RlXzIuc2V0X2xpbWl0cyhtYXhfdHJpYWxzPTEpCiAgICAgICAgICAgIGNsYXNzaWZpY2F0aW9uX25vZGVfMi5zZXRfdHJhaW5pbmcoZW5hYmxlX3N0YWNrX2Vuc2VtYmxlPUZhbHNlLCBlbmFibGVfdm90ZV9lbnNlbWJsZT1GYWxzZSkKICAgICAgICAgICAgY2xhc3NpZmljYXRpb25fbm9kZV8yLm91dHB1dHNbImJlc3RfbW9kZWwiXS5uYW1lID0gImNsYXNzaWZpY2F0aW9uX291dHB1dF9uYW1lIgogICAgICAgICAgICBjbGFzc2lmaWNhdGlvbl9ub2RlXzIub3V0cHV0c1siYmVzdF9tb2RlbCJdLnZlcnNpb24gPSAiMiIKCiAgICAgICAgICAgIHJldHVybiB7ImNsYXNzaWZpY2F0aW9uXzJfb3V0cHV0IjogY2xhc3NpZmljYXRpb25fbm9kZV8yLm91dHB1dHMuYmVzdF9tb2RlbH0KCiAgICAgICAgY2xhc3NfdHJhaW4gPSBJbnB1dCgKICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgIHBhdGg9dGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2F1dG9tbF9qb2IvdGVzdF9kYXRhc2V0cy9iYW5rX21hcmtldGluZy90cmFpbiIsCiAgICAgICAgKQogICAgICAgIGNsYXNzX3ZhbGlkID0gSW5wdXQoCiAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5NTFRBQkxFLAogICAgICAgICAgICBwYXRoPXRlc3RzX3Jvb3RfZGlyIC8gInRlc3RfY29uZmlncy9hdXRvbWxfam9iL3Rlc3RfZGF0YXNldHMvYmFua19tYXJrZXRpbmcvdmFsaWQiLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmVfam9iOiBQaXBlbGluZUpvYiA9IHRyYWluX2F1dG9tbF9jbGFzc2lmaWNhdGlvbl9pbl9waXBlbGluZShjbGFzc190cmFpbiwgY2xhc3NfdmFsaWQpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9IENQVV9DTFVTVEVSCgogICAgICAgIGZyb21fcmVzdF9waXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lX2pvYikKICAgICAgICBjYW5jZWxfam9iKGNsaWVudCwgZnJvbV9yZXN0X3BpcGVsaW5lX2pvYikKCiAgICAgICAgYWN0dWFsX2RpY3QgPSBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKQogICAgICAgIGZpZWxkc190b19vbWl0ID0gWyJuYW1lIiwgImRpc3BsYXlfbmFtZSIsICJleHBlcmltZW50X25hbWUiLCAicHJvcGVydGllcyJdCgogICAgICAgIGNsYXNzaWZpY2F0aW9uX2RpY3QgPSBweWRhc2gub21pdChhY3R1YWxfZGljdFsicHJvcGVydGllcyJdWyJqb2JzIl1bImNsYXNzaWZpY2F0aW9uX25vZGUiXSwgZmllbGRzX3RvX29taXQpCiAgICAgICAgYXNzZXJ0IGNsYXNzaWZpY2F0aW9uX2RpY3QgPT0gewogICAgICAgICAgICAidGVzdF9kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMuY2xhc3NfdmFsaWRfZGF0YX19IiwKICAgICAgICAgICAgInZhbGlkYXRpb25fZGF0YSI6ICIke3twYXJlbnQuaW5wdXRzLmNsYXNzX3ZhbGlkX2RhdGF9fSIsCiAgICAgICAgICAgICJ0cmFpbmluZ19kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMuY2xhc3NfdHJhaW5fZGF0YX19IiwKICAgICAgICAgICAgInRhcmdldF9jb2x1bW5fbmFtZSI6ICJ5IiwKICAgICAgICAgICAgInRhZ3MiOiB7fSwKICAgICAgICAgICAgInR5cGUiOiAiYXV0b21sIiwKICAgICAgICAgICAgIm91dHB1dHMiOiB7CiAgICAgICAgICAgICAgICAiYmVzdF9tb2RlbCI6IHsiam9iX291dHB1dF90eXBlIjogIm1sZmxvd19tb2RlbCIsICJuYW1lIjogImNsYXNzaWZpY2F0aW9uX291dHB1dF9uYW1lIiwgInZlcnNpb24iOiAiMSJ9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJsb2dfdmVyYm9zaXR5IjogImluZm8iLAogICAgICAgICAgICAibGltaXRzIjogeyJtYXhfdHJpYWxzIjogMX0sCiAgICAgICAgICAgICJmZWF0dXJpemF0aW9uIjogeyJtb2RlIjogImF1dG8ifSwKICAgICAgICAgICAgInRyYWluaW5nIjogeyJlbmFibGVfc3RhY2tfZW5zZW1ibGUiOiBGYWxzZSwgImVuYWJsZV92b3RlX2Vuc2VtYmxlIjogRmFsc2V9LAogICAgICAgICAgICAidGFzayI6ICJjbGFzc2lmaWNhdGlvbiIsCiAgICAgICAgICAgICJwcmltYXJ5X21ldHJpYyI6ICJhY2N1cmFjeSIsCiAgICAgICAgfQoKICAgICAgICBjbGFzc2lmaWNhdGlvbl9kaWN0ID0gcHlkYXNoLm9taXQoCiAgICAgICAgICAgIGFjdHVhbF9kaWN0WyJwcm9wZXJ0aWVzIl1bIm91dHB1dHMiXVsiY2xhc3NpZmljYXRpb25fMl9vdXRwdXQiXSwgZmllbGRzX3RvX29taXQKICAgICAgICApCiAgICAgICAgYXNzZXJ0IGNsYXNzaWZpY2F0aW9uX2RpY3QgPT0gewogICAgICAgICAgICAiYXNzZXRfbmFtZSI6ICJjbGFzc2lmaWNhdGlvbl9vdXRwdXRfbmFtZSIsCiAgICAgICAgICAgICJhc3NldF92ZXJzaW9uIjogIjIiLAogICAgICAgICAgICAiam9iX291dHB1dF90eXBlIjogIm1sZmxvd19tb2RlbCIsCiAgICAgICAgICAgICJtb2RlIjogIlJlYWRXcml0ZU1vdW50IiwKICAgICAgICB9CgogICAgZGVmIHRlc3RfYXV0b21sX3JlZ3Jlc3Npb25faW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgQGRzbC5waXBlbGluZShuYW1lPSJ0cmFpbl9hdXRvbWxfcmVncmVzc2lvbl9pbl9waXBlbGluZSIpCiAgICAgICAgZGVmIHRyYWluX2F1dG9tbF9yZWdyZXNzaW9uX2luX3BpcGVsaW5lKHJlZ3Jlc3Npb25fdHJhaW5fZGF0YSk6CiAgICAgICAgICAgIHJlZ3Jlc3Npb25fbm9kZSA9IHJlZ3Jlc3Npb24oCiAgICAgICAgICAgICAgICBwcmltYXJ5X21ldHJpYz0icjJfc2NvcmUiLAogICAgICAgICAgICAgICAgdGFyZ2V0X2NvbHVtbl9uYW1lPSJFUlAiLAogICAgICAgICAgICAgICAgdHJhaW5pbmdfZGF0YT1yZWdyZXNzaW9uX3RyYWluX2RhdGEsCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmVncmVzc2lvbl9ub2RlLnNldF9saW1pdHMobWF4X3RyaWFscz0xKQogICAgICAgICAgICByZWdyZXNzaW9uX25vZGUuc2V0X3RyYWluaW5nKGVuYWJsZV9zdGFja19lbnNlbWJsZT1GYWxzZSwgZW5hYmxlX3ZvdGVfZW5zZW1ibGU9RmFsc2UpCiAgICAgICAgICAgIHJlZ3Jlc3Npb25fbm9kZS5zZXRfZmVhdHVyaXphdGlvbihtb2RlPSJhdXRvIikKCiAgICAgICAgcmVncmVzc2lvbl90cmFpbiA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL21hY2hpbmVfZGF0YS90cmFpbiIsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZV9qb2I6IFBpcGVsaW5lSm9iID0gdHJhaW5fYXV0b21sX3JlZ3Jlc3Npb25faW5fcGlwZWxpbmUocmVncmVzc2lvbl90cmFpbikKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gQ1BVX0NMVVNURVIKCiAgICAgICAgZnJvbV9yZXN0X3BpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmVfam9iKQogICAgICAgIGNhbmNlbF9qb2IoY2xpZW50LCBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iKQoKICAgICAgICBhY3R1YWxfZGljdCA9IGZyb21fcmVzdF9waXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpCiAgICAgICAgZmllbGRzX3RvX29taXQgPSBbIm5hbWUiLCAiZGlzcGxheV9uYW1lIiwgImV4cGVyaW1lbnRfbmFtZSIsICJwcm9wZXJ0aWVzIl0KCiAgICAgICAgcmVncmVzc2lvbl9kaWN0ID0gcHlkYXNoLm9taXQoYWN0dWFsX2RpY3RbInByb3BlcnRpZXMiXVsiam9icyJdWyJyZWdyZXNzaW9uX25vZGUiXSwgZmllbGRzX3RvX29taXQpCiAgICAgICAgYXNzZXJ0IHJlZ3Jlc3Npb25fZGljdCA9PSB7CiAgICAgICAgICAgICJ0cmFpbmluZ19kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMucmVncmVzc2lvbl90cmFpbl9kYXRhfX0iLAogICAgICAgICAgICAidGFyZ2V0X2NvbHVtbl9uYW1lIjogIkVSUCIsCiAgICAgICAgICAgICJ0YWdzIjoge30sCiAgICAgICAgICAgICJ0eXBlIjogImF1dG9tbCIsCiAgICAgICAgICAgICJvdXRwdXRzIjoge30sCiAgICAgICAgICAgICJsb2dfdmVyYm9zaXR5IjogImluZm8iLAogICAgICAgICAgICAibGltaXRzIjogeyJtYXhfdHJpYWxzIjogMX0sCiAgICAgICAgICAgICJmZWF0dXJpemF0aW9uIjogeyJtb2RlIjogImF1dG8ifSwKICAgICAgICAgICAgInRyYWluaW5nIjogeyJlbmFibGVfc3RhY2tfZW5zZW1ibGUiOiBGYWxzZSwgImVuYWJsZV92b3RlX2Vuc2VtYmxlIjogRmFsc2V9LAogICAgICAgICAgICAidGFzayI6ICJyZWdyZXNzaW9uIiwKICAgICAgICAgICAgInByaW1hcnlfbWV0cmljIjogInIyX3Njb3JlIiwKICAgICAgICB9CgogICAgZGVmIHRlc3RfYXV0b21sX2ZvcmVjYXN0aW5nX2luX3BpcGVsaW5lKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIEBkc2wucGlwZWxpbmUobmFtZT0idHJhaW5fd2l0aF9hdXRvbWxfaW5fcGlwZWxpbmUiKQogICAgICAgIGRlZiB0cmFpbl9hdXRvbWxfZm9yZWNhc3RpbmdfaW5fcGlwZWxpbmUoCiAgICAgICAgICAgIGZvcmVjYXN0aW5nX3RyYWluX2RhdGEsCiAgICAgICAgKToKICAgICAgICAgICAgZm9yZWNhc3Rpbmdfc2V0dGluZ3MgPSBGb3JlY2FzdGluZ1NldHRpbmdzKHRpbWVfY29sdW1uX25hbWU9IkRBVEUiLCBmb3JlY2FzdF9ob3Jpem9uPTEyLCBmcmVxdWVuY3k9Ik1TIikKCiAgICAgICAgICAgIGZvcmVjYXN0aW5nX25vZGUgPSBmb3JlY2FzdGluZygKICAgICAgICAgICAgICAgIHByaW1hcnlfbWV0cmljPSJub3JtYWxpemVkX3Jvb3RfbWVhbl9zcXVhcmVkX2Vycm9yIiwKICAgICAgICAgICAgICAgIHRhcmdldF9jb2x1bW5fbmFtZT0iQmVlclByb2R1Y3Rpb24iLAogICAgICAgICAgICAgICAgdHJhaW5pbmdfZGF0YT1mb3JlY2FzdGluZ190cmFpbl9kYXRhLAogICAgICAgICAgICAgICAgbl9jcm9zc192YWxpZGF0aW9ucz0yLAogICAgICAgICAgICAgICAgZm9yZWNhc3Rpbmdfc2V0dGluZ3M9Zm9yZWNhc3Rpbmdfc2V0dGluZ3MsCiAgICAgICAgICAgICkKICAgICAgICAgICAgZm9yZWNhc3Rpbmdfbm9kZS5zZXRfbGltaXRzKG1heF90cmlhbHM9MSkKICAgICAgICAgICAgZm9yZWNhc3Rpbmdfbm9kZS5zZXRfdHJhaW5pbmcoZW5hYmxlX3N0YWNrX2Vuc2VtYmxlPUZhbHNlLCBlbmFibGVfdm90ZV9lbnNlbWJsZT1GYWxzZSkKICAgICAgICAgICAgZm9yZWNhc3Rpbmdfbm9kZS5zZXRfZmVhdHVyaXphdGlvbihtb2RlPSJhdXRvIikKCiAgICAgICAgZm9yZWNhc3RpbmdfdHJhaW4gPSBJbnB1dCgKICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgIHBhdGg9dGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2F1dG9tbF9qb2IvdGVzdF9kYXRhc2V0cy9iZWVyX2ZvcmVjYXN0aW5nL3RyYWluIiwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lX2pvYjogUGlwZWxpbmVKb2IgPSB0cmFpbl9hdXRvbWxfZm9yZWNhc3RpbmdfaW5fcGlwZWxpbmUoZm9yZWNhc3RpbmdfdHJhaW5fZGF0YT1mb3JlY2FzdGluZ190cmFpbikKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gQ1BVX0NMVVNURVIKCiAgICAgICAgZnJvbV9yZXN0X3BpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmVfam9iKQogICAgICAgIGNhbmNlbF9qb2IoY2xpZW50LCBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iKQoKICAgICAgICBhY3R1YWxfZGljdCA9IGZyb21fcmVzdF9waXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpCiAgICAgICAgZmllbGRzX3RvX29taXQgPSBbIm5hbWUiLCAiZGlzcGxheV9uYW1lIiwgImV4cGVyaW1lbnRfbmFtZSIsICJwcm9wZXJ0aWVzIl0KCiAgICAgICAgZm9yZWNhc3RpbmdfZGljdCA9IHB5ZGFzaC5vbWl0KGFjdHVhbF9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXVsiZm9yZWNhc3Rpbmdfbm9kZSJdLCBmaWVsZHNfdG9fb21pdCkKICAgICAgICBhc3NlcnQgZm9yZWNhc3RpbmdfZGljdCA9PSB7CiAgICAgICAgICAgICJ0cmFpbmluZ19kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMuZm9yZWNhc3RpbmdfdHJhaW5fZGF0YX19IiwKICAgICAgICAgICAgIm5fY3Jvc3NfdmFsaWRhdGlvbnMiOiAyLAogICAgICAgICAgICAidGFyZ2V0X2NvbHVtbl9uYW1lIjogIkJlZXJQcm9kdWN0aW9uIiwKICAgICAgICAgICAgInRhZ3MiOiB7fSwKICAgICAgICAgICAgInR5cGUiOiAiYXV0b21sIiwKICAgICAgICAgICAgIm91dHB1dHMiOiB7fSwKICAgICAgICAgICAgImxvZ192ZXJib3NpdHkiOiAiaW5mbyIsCiAgICAgICAgICAgICJsaW1pdHMiOiB7Im1heF90cmlhbHMiOiAxfSwKICAgICAgICAgICAgImZlYXR1cml6YXRpb24iOiB7Im1vZGUiOiAiYXV0byJ9LAogICAgICAgICAgICAidHJhaW5pbmciOiB7ImVuYWJsZV9zdGFja19lbnNlbWJsZSI6IEZhbHNlLCAiZW5hYmxlX3ZvdGVfZW5zZW1ibGUiOiBGYWxzZX0sCiAgICAgICAgICAgICJ0YXNrIjogImZvcmVjYXN0aW5nIiwKICAgICAgICAgICAgImZvcmVjYXN0aW5nIjogeyJmb3JlY2FzdF9ob3Jpem9uIjogMTIsICJ0aW1lX2NvbHVtbl9uYW1lIjogIkRBVEUiLCAiZnJlcXVlbmN5IjogIk1TIn0sCiAgICAgICAgICAgICJwcmltYXJ5X21ldHJpYyI6ICJub3JtYWxpemVkX3Jvb3RfbWVhbl9zcXVhcmVkX2Vycm9yIiwKICAgICAgICB9CgogICAgZGVmIHRlc3RfYXV0b21sX3RleHRfY2xhc3NpZmljYXRpb25faW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgQGRzbC5waXBlbGluZShuYW1lPSJ0cmFpbl9hdXRvbWxfdGV4dF9jbGFzc19pbl9waXBlbGluZSIpCiAgICAgICAgZGVmIHRyYWluX2F1dG9tbF90ZXh0X2NsYXNzX2luX3BpcGVsaW5lKAogICAgICAgICAgICB0ZXh0X2NsYXNzaWZpY2F0aW9uX3RyYWluLAogICAgICAgICAgICB0ZXh0X2NsYXNzaWZpY2F0aW9uX3ZhbGlkLAogICAgICAgICk6CiAgICAgICAgICAgIHRleHRfY2xhc3NpZmljYXRpb25fbm9kZSA9IHRleHRfY2xhc3NpZmljYXRpb24oCiAgICAgICAgICAgICAgICB0cmFpbmluZ19kYXRhPXRleHRfY2xhc3NpZmljYXRpb25fdHJhaW4sCiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uX2RhdGE9dGV4dF9jbGFzc2lmaWNhdGlvbl92YWxpZCwKICAgICAgICAgICAgICAgIHRhcmdldF9jb2x1bW5fbmFtZT0ieSIsCiAgICAgICAgICAgICAgICBwcmltYXJ5X21ldHJpYz0iYWNjdXJhY3kiLAogICAgICAgICAgICAgICAgZmVhdHVyaXphdGlvbj1ObHBGZWF0dXJpemF0aW9uU2V0dGluZ3MoZGF0YXNldF9sYW5ndWFnZT0iZW5nIiksCiAgICAgICAgICAgICkKICAgICAgICAgICAgdGV4dF9jbGFzc2lmaWNhdGlvbl9ub2RlLnNldF9saW1pdHMobWF4X2NvbmN1cnJlbnRfdHJpYWxzPTEpCgogICAgICAgIHRleHRfY2xhc3NpZmljYXRpb25fdHJhaW4gPSBJbnB1dCgKICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgIHBhdGg9dGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2F1dG9tbF9qb2IvdGVzdF9kYXRhc2V0cy9uZXdzZ3JvdXAvdHJhaW4iLAogICAgICAgICkKICAgICAgICB0ZXh0X2NsYXNzaWZpY2F0aW9uX3ZhbGlkID0gSW5wdXQoCiAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5NTFRBQkxFLAogICAgICAgICAgICBwYXRoPXRlc3RzX3Jvb3RfZGlyIC8gInRlc3RfY29uZmlncy9hdXRvbWxfam9iL3Rlc3RfZGF0YXNldHMvbmV3c2dyb3VwL3ZhbGlkIiwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lX2pvYjogUGlwZWxpbmVKb2IgPSB0cmFpbl9hdXRvbWxfdGV4dF9jbGFzc19pbl9waXBlbGluZSgKICAgICAgICAgICAgdGV4dF9jbGFzc2lmaWNhdGlvbl90cmFpbiwgdGV4dF9jbGFzc2lmaWNhdGlvbl92YWxpZAogICAgICAgICkKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gR1BVX0NMVVNURVIKICAgICAgICBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZV9qb2IpCiAgICAgICAgY2FuY2VsX2pvYihjbGllbnQsIGZyb21fcmVzdF9waXBlbGluZV9qb2IpCgogICAgICAgIGFjdHVhbF9kaWN0ID0gZnJvbV9yZXN0X3BpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCkKICAgICAgICBmaWVsZHNfdG9fb21pdCA9IFsibmFtZSIsICJkaXNwbGF5X25hbWUiLCAiZXhwZXJpbWVudF9uYW1lIiwgInByb3BlcnRpZXMiXQoKICAgICAgICBqb2JfZGljdCA9IHB5ZGFzaC5vbWl0KGFjdHVhbF9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXVsidGV4dF9jbGFzc2lmaWNhdGlvbl9ub2RlIl0sIGZpZWxkc190b19vbWl0KQogICAgICAgIGFzc2VydCBqb2JfZGljdCA9PSB7CiAgICAgICAgICAgICJ0cmFpbmluZ19kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMudGV4dF9jbGFzc2lmaWNhdGlvbl90cmFpbn19IiwKICAgICAgICAgICAgInZhbGlkYXRpb25fZGF0YSI6ICIke3twYXJlbnQuaW5wdXRzLnRleHRfY2xhc3NpZmljYXRpb25fdmFsaWR9fSIsCiAgICAgICAgICAgICJ0YXJnZXRfY29sdW1uX25hbWUiOiAieSIsCiAgICAgICAgICAgICJ0YWdzIjoge30sCiAgICAgICAgICAgICJ0eXBlIjogImF1dG9tbCIsCiAgICAgICAgICAgICJvdXRwdXRzIjoge30sCiAgICAgICAgICAgICJsaW1pdHMiOiB7Im1heF90cmlhbHMiOiAxLCAibWF4X25vZGVzIjogMSwgIm1heF9jb25jdXJyZW50X3RyaWFscyI6IDF9LAogICAgICAgICAgICAiZmVhdHVyaXphdGlvbiI6IHsiZGF0YXNldF9sYW5ndWFnZSI6ICJlbmcifSwKICAgICAgICAgICAgInRhc2siOiAidGV4dF9jbGFzc2lmaWNhdGlvbiIsCiAgICAgICAgICAgICJwcmltYXJ5X21ldHJpYyI6ICJhY2N1cmFjeSIsCiAgICAgICAgfQoKICAgIGRlZiB0ZXN0X2F1dG9tbF90ZXh0X2NsYXNzaWZpY2F0aW9uX211bHRpbGFiZWxfaW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgQGRzbC5waXBlbGluZShuYW1lPSJ0cmFpbl9hdXRvbWxfdGV4dF9jbGFzc19tdWx0aWxhYmVsX2luX3BpcGVsaW5lIikKICAgICAgICBkZWYgdHJhaW5fYXV0b21sX3RleHRfY2xhc3NfbXVsdGlsYWJlbF9pbl9waXBlbGluZSgKICAgICAgICAgICAgdGV4dF9jbGFzc2lmaWNhdGlvbl9tdWx0aWxhYmVsX3RyYWluLAogICAgICAgICAgICB0ZXh0X2NsYXNzaWZpY2F0aW9uX211bHRpbGFiZWxfdmFsaWQsCiAgICAgICAgKToKICAgICAgICAgICAgdGV4dF9jbGFzc2lmaWNhdGlvbl9tdWx0aWxhYmVsX25vZGUgPSB0ZXh0X2NsYXNzaWZpY2F0aW9uX211bHRpbGFiZWwoCiAgICAgICAgICAgICAgICB0cmFpbmluZ19kYXRhPXRleHRfY2xhc3NpZmljYXRpb25fbXVsdGlsYWJlbF90cmFpbiwKICAgICAgICAgICAgICAgIHZhbGlkYXRpb25fZGF0YT10ZXh0X2NsYXNzaWZpY2F0aW9uX211bHRpbGFiZWxfdmFsaWQsCiAgICAgICAgICAgICAgICB0YXJnZXRfY29sdW1uX25hbWU9InRlcm1zIiwKICAgICAgICAgICAgICAgIHByaW1hcnlfbWV0cmljPSJhY2N1cmFjeSIsCiAgICAgICAgICAgICkKICAgICAgICAgICAgdGV4dF9jbGFzc2lmaWNhdGlvbl9tdWx0aWxhYmVsX25vZGUuc2V0X2xpbWl0cyhtYXhfY29uY3VycmVudF90cmlhbHM9MSkKCiAgICAgICAgdGV4dF9jbGFzc2lmaWNhdGlvbl9tdWx0aWxhYmVsX3RyYWluID0gSW5wdXQoCiAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5NTFRBQkxFLAogICAgICAgICAgICBwYXRoPXRlc3RzX3Jvb3RfZGlyIC8gInRlc3RfY29uZmlncy9hdXRvbWxfam9iL3Rlc3RfZGF0YXNldHMvcGFwZXJfY2F0ZWdvcml6YXRpb24vdHJhaW4iLAogICAgICAgICkKCiAgICAgICAgdGV4dF9jbGFzc2lmaWNhdGlvbl9tdWx0aWxhYmVsX3ZhbGlkID0gSW5wdXQoCiAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5NTFRBQkxFLAogICAgICAgICAgICBwYXRoPXRlc3RzX3Jvb3RfZGlyIC8gInRlc3RfY29uZmlncy9hdXRvbWxfam9iL3Rlc3RfZGF0YXNldHMvcGFwZXJfY2F0ZWdvcml6YXRpb24vdmFsaWQiLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmVfam9iOiBQaXBlbGluZUpvYiA9IHRyYWluX2F1dG9tbF90ZXh0X2NsYXNzX211bHRpbGFiZWxfaW5fcGlwZWxpbmUoCiAgICAgICAgICAgIHRleHRfY2xhc3NpZmljYXRpb25fbXVsdGlsYWJlbF90cmFpbiwgdGV4dF9jbGFzc2lmaWNhdGlvbl9tdWx0aWxhYmVsX3ZhbGlkCiAgICAgICAgKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSBHUFVfQ0xVU1RFUgogICAgICAgIGZyb21fcmVzdF9waXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lX2pvYikKICAgICAgICBjYW5jZWxfam9iKGNsaWVudCwgZnJvbV9yZXN0X3BpcGVsaW5lX2pvYikKCiAgICAgICAgYWN0dWFsX2RpY3QgPSBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKQogICAgICAgIGZpZWxkc190b19vbWl0ID0gWyJuYW1lIiwgImRpc3BsYXlfbmFtZSIsICJleHBlcmltZW50X25hbWUiLCAicHJvcGVydGllcyJdCgogICAgICAgIGpvYl9kaWN0ID0gcHlkYXNoLm9taXQoYWN0dWFsX2RpY3RbInByb3BlcnRpZXMiXVsiam9icyJdWyJ0ZXh0X2NsYXNzaWZpY2F0aW9uX211bHRpbGFiZWxfbm9kZSJdLCBmaWVsZHNfdG9fb21pdCkKICAgICAgICBhc3NlcnQgam9iX2RpY3QgPT0gewogICAgICAgICAgICAidHJhaW5pbmdfZGF0YSI6ICIke3twYXJlbnQuaW5wdXRzLnRleHRfY2xhc3NpZmljYXRpb25fbXVsdGlsYWJlbF90cmFpbn19IiwKICAgICAgICAgICAgInZhbGlkYXRpb25fZGF0YSI6ICIke3twYXJlbnQuaW5wdXRzLnRleHRfY2xhc3NpZmljYXRpb25fbXVsdGlsYWJlbF92YWxpZH19IiwKICAgICAgICAgICAgInRhcmdldF9jb2x1bW5fbmFtZSI6ICJ0ZXJtcyIsCiAgICAgICAgICAgICJ0YWdzIjoge30sCiAgICAgICAgICAgICJ0eXBlIjogImF1dG9tbCIsCiAgICAgICAgICAgICJvdXRwdXRzIjoge30sCiAgICAgICAgICAgICJsaW1pdHMiOiB7Im1heF90cmlhbHMiOiAxLCAibWF4X25vZGVzIjogMSwgIm1heF9jb25jdXJyZW50X3RyaWFscyI6IDF9LAogICAgICAgICAgICAidGFzayI6ICJ0ZXh0X2NsYXNzaWZpY2F0aW9uX211bHRpbGFiZWwiLAogICAgICAgICAgICAicHJpbWFyeV9tZXRyaWMiOiAiYWNjdXJhY3kiLAogICAgICAgIH0KCiAgICBkZWYgdGVzdF9hdXRvbWxfdGV4dF9uZXJfaW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgQGRzbC5waXBlbGluZShuYW1lPSJ0cmFpbl9hdXRvbWxfdGV4dF9uZXJfaW5fcGlwZWxpbmUiKQogICAgICAgIGRlZiB0cmFpbl9hdXRvbWxfdGV4dF9uZXJfaW5fcGlwZWxpbmUoCiAgICAgICAgICAgIHRleHRfbmVyX3RyYWluLAogICAgICAgICAgICB0ZXh0X25lcl92YWxpZCwKICAgICAgICApOgogICAgICAgICAgICB0ZXh0X25lcl9ub2RlID0gdGV4dF9uZXIoCiAgICAgICAgICAgICAgICB0cmFpbmluZ19kYXRhPXRleHRfbmVyX3RyYWluLAogICAgICAgICAgICAgICAgdmFsaWRhdGlvbl9kYXRhPXRleHRfbmVyX3ZhbGlkLAogICAgICAgICAgICAgICAgdGFyZ2V0X2NvbHVtbl9uYW1lPSJsYWJlbCIsCiAgICAgICAgICAgICAgICBwcmltYXJ5X21ldHJpYz0iYWNjdXJhY3kiLAogICAgICAgICAgICApCiAgICAgICAgICAgIHRleHRfbmVyX25vZGUuc2V0X2xpbWl0cyhtYXhfY29uY3VycmVudF90cmlhbHM9MSkKCiAgICAgICAgdGV4dF9uZXJfdHJhaW4gPSBJbnB1dCgKICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgIHBhdGg9dGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2F1dG9tbF9qb2IvdGVzdF9kYXRhc2V0cy9jb25sbDIwMDMvdHJhaW4iLAogICAgICAgICkKICAgICAgICB0ZXh0X25lcl92YWxpZCA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL2NvbmxsMjAwMy92YWxpZCIsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZV9qb2I6IFBpcGVsaW5lSm9iID0gdHJhaW5fYXV0b21sX3RleHRfbmVyX2luX3BpcGVsaW5lKHRleHRfbmVyX3RyYWluLCB0ZXh0X25lcl92YWxpZCkKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gR1BVX0NMVVNURVIKICAgICAgICBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZV9qb2IpCiAgICAgICAgY2FuY2VsX2pvYihjbGllbnQsIGZyb21fcmVzdF9waXBlbGluZV9qb2IpCgogICAgICAgIGFjdHVhbF9kaWN0ID0gZnJvbV9yZXN0X3BpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCkKICAgICAgICBmaWVsZHNfdG9fb21pdCA9IFsibmFtZSIsICJkaXNwbGF5X25hbWUiLCAiZXhwZXJpbWVudF9uYW1lIiwgInByb3BlcnRpZXMiXQoKICAgICAgICBqb2JfZGljdCA9IHB5ZGFzaC5vbWl0KGFjdHVhbF9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXVsidGV4dF9uZXJfbm9kZSJdLCBmaWVsZHNfdG9fb21pdCkKICAgICAgICBhc3NlcnQgam9iX2RpY3QgPT0gewogICAgICAgICAgICAidHJhaW5pbmdfZGF0YSI6ICIke3twYXJlbnQuaW5wdXRzLnRleHRfbmVyX3RyYWlufX0iLAogICAgICAgICAgICAidmFsaWRhdGlvbl9kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMudGV4dF9uZXJfdmFsaWR9fSIsCiAgICAgICAgICAgICJ0YXJnZXRfY29sdW1uX25hbWUiOiAibGFiZWwiLAogICAgICAgICAgICAidGFncyI6IHt9LAogICAgICAgICAgICAidHlwZSI6ICJhdXRvbWwiLAogICAgICAgICAgICAib3V0cHV0cyI6IHt9LAogICAgICAgICAgICAibGltaXRzIjogeyJtYXhfdHJpYWxzIjogMSwgIm1heF9ub2RlcyI6IDEsICJtYXhfY29uY3VycmVudF90cmlhbHMiOiAxfSwKICAgICAgICAgICAgInRhc2siOiAidGV4dF9uZXIiLAogICAgICAgICAgICAicHJpbWFyeV9tZXRyaWMiOiAiYWNjdXJhY3kiLAogICAgICAgIH0KCiAgICBkZWYgdGVzdF9hdXRvbWxfdmlzaW9uX211bHRpY2xhc3Nfbm9kZV9pbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBAZHNsLnBpcGVsaW5lKG5hbWU9InRyYWluX211bHRpY2xhc3Nfd2l0aF9hdXRvbWxfaW5fcGlwZWxpbmUiKQogICAgICAgIGRlZiB0cmFpbl9tdWx0aWNsYXNzX3dpdGhfYXV0b21sX2luX3BpcGVsaW5lKAogICAgICAgICAgICBpbWFnZV9tdWx0aWNsYXNzX3RyYWluX2RhdGEsCiAgICAgICAgICAgIGltYWdlX211bHRpY2xhc3NfdmFsaWRfZGF0YSwKICAgICAgICApOgogICAgICAgICAgICBpbWFnZV9tdWx0aWNsYXNzX25vZGUgPSBhdXRvbWwuaW1hZ2VfY2xhc3NpZmljYXRpb24oCiAgICAgICAgICAgICAgICB0cmFpbmluZ19kYXRhPWltYWdlX211bHRpY2xhc3NfdHJhaW5fZGF0YSwKICAgICAgICAgICAgICAgIHZhbGlkYXRpb25fZGF0YT1pbWFnZV9tdWx0aWNsYXNzX3ZhbGlkX2RhdGEsCiAgICAgICAgICAgICAgICB0YXJnZXRfY29sdW1uX25hbWU9ImxhYmVsIiwKICAgICAgICAgICAgICAgIHByaW1hcnlfbWV0cmljPSJBY2N1cmFjeSIsCiAgICAgICAgICAgICkKICAgICAgICAgICAgaW1hZ2VfbXVsdGljbGFzc19ub2RlLnNldF9saW1pdHMoCiAgICAgICAgICAgICAgICB0aW1lb3V0X21pbnV0ZXM9NjAsCiAgICAgICAgICAgICkKICAgICAgICAgICAgaW1hZ2VfbXVsdGljbGFzc19ub2RlLmV4dGVuZF9zZWFyY2hfc3BhY2UoCiAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgU2VhcmNoU3BhY2UoCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsX25hbWU9Q2hvaWNlKFsidml0czE2cjIyNCJdKSwKICAgICAgICAgICAgICAgICAgICAgICAgbGVhcm5pbmdfcmF0ZT1Vbmlmb3JtKDAuMDAxLCAwLjAxKSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIFNlYXJjaFNwYWNlKAogICAgICAgICAgICAgICAgICAgICAgICBtb2RlbF9uYW1lPUNob2ljZShbInNlcmVzbmV4dCJdKSwKICAgICAgICAgICAgICAgICAgICAgICAgbGVhcm5pbmdfcmF0ZT1Vbmlmb3JtKDAuMDAxLCAwLjAxKSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICApCiAgICAgICAgICAgIGltYWdlX211bHRpY2xhc3Nfbm9kZS5zZXRfc3dlZXAoCiAgICAgICAgICAgICAgICBzYW1wbGluZ19hbGdvcml0aG09IlJhbmRvbSIsCiAgICAgICAgICAgICAgICBlYXJseV90ZXJtaW5hdGlvbj1CYW5kaXRQb2xpY3koZXZhbHVhdGlvbl9pbnRlcnZhbD0yLCBzbGFja19mYWN0b3I9MC4yLCBkZWxheV9ldmFsdWF0aW9uPTYpLAogICAgICAgICAgICApCiAgICAgICAgICAgIGltYWdlX211bHRpY2xhc3Nfbm9kZS5zZXRfbGltaXRzKAogICAgICAgICAgICAgICAgbWF4X3RyaWFscz0xLAogICAgICAgICAgICAgICAgbWF4X2NvbmN1cnJlbnRfdHJpYWxzPTEsCiAgICAgICAgICAgICkKCiAgICAgICAgbXVsdGljbGFzc190cmFpbiA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL2ltYWdlX2NsYXNzaWZpY2F0aW9uL3RyYWluIiwKICAgICAgICApCiAgICAgICAgbXVsdGljbGFzc192YWxpZCA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL2ltYWdlX2NsYXNzaWZpY2F0aW9uL3ZhbGlkIiwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lX2pvYjogUGlwZWxpbmVKb2IgPSB0cmFpbl9tdWx0aWNsYXNzX3dpdGhfYXV0b21sX2luX3BpcGVsaW5lKG11bHRpY2xhc3NfdHJhaW4sIG11bHRpY2xhc3NfdmFsaWQpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9IEdQVV9DTFVTVEVSCgogICAgICAgIGZyb21fcmVzdF9waXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lX2pvYikKICAgICAgICBjYW5jZWxfam9iKGNsaWVudCwgZnJvbV9yZXN0X3BpcGVsaW5lX2pvYikKCiAgICAgICAgYWN0dWFsX2RpY3QgPSBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKQogICAgICAgIGZpZWxkc190b19vbWl0ID0gWyJuYW1lIiwgImRpc3BsYXlfbmFtZSIsICJleHBlcmltZW50X25hbWUiLCAicHJvcGVydGllcyJdCgogICAgICAgIGltYWdlX211bHRpY2xhc3NfZGljdCA9IHB5ZGFzaC5vbWl0KGFjdHVhbF9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXVsiaW1hZ2VfbXVsdGljbGFzc19ub2RlIl0sIGZpZWxkc190b19vbWl0KQogICAgICAgIGFzc2VydCBpbWFnZV9tdWx0aWNsYXNzX2RpY3QgPT0gewogICAgICAgICAgICAibGltaXRzIjogeyJtYXhfY29uY3VycmVudF90cmlhbHMiOiAxLCAibWF4X3RyaWFscyI6IDEsICJ0aW1lb3V0X21pbnV0ZXMiOiA2MH0sCiAgICAgICAgICAgICJsb2dfdmVyYm9zaXR5IjogImluZm8iLAogICAgICAgICAgICAib3V0cHV0cyI6IHt9LAogICAgICAgICAgICAicHJpbWFyeV9tZXRyaWMiOiAiYWNjdXJhY3kiLAogICAgICAgICAgICAidGFncyI6IHt9LAogICAgICAgICAgICAidGFyZ2V0X2NvbHVtbl9uYW1lIjogImxhYmVsIiwKICAgICAgICAgICAgInRhc2siOiAiaW1hZ2VfY2xhc3NpZmljYXRpb24iLAogICAgICAgICAgICAidHJhaW5pbmdfZGF0YSI6ICIke3twYXJlbnQuaW5wdXRzLmltYWdlX211bHRpY2xhc3NfdHJhaW5fZGF0YX19IiwKICAgICAgICAgICAgInR5cGUiOiAiYXV0b21sIiwKICAgICAgICAgICAgInZhbGlkYXRpb25fZGF0YSI6ICIke3twYXJlbnQuaW5wdXRzLmltYWdlX211bHRpY2xhc3NfdmFsaWRfZGF0YX19IiwKICAgICAgICAgICAgInN3ZWVwIjogewogICAgICAgICAgICAgICAgInNhbXBsaW5nX2FsZ29yaXRobSI6ICJyYW5kb20iLAogICAgICAgICAgICAgICAgImVhcmx5X3Rlcm1pbmF0aW9uIjogewogICAgICAgICAgICAgICAgICAgICJldmFsdWF0aW9uX2ludGVydmFsIjogMiwKICAgICAgICAgICAgICAgICAgICAiZGVsYXlfZXZhbHVhdGlvbiI6IDYsCiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiYmFuZGl0IiwKICAgICAgICAgICAgICAgICAgICAic2xhY2tfZmFjdG9yIjogMC4yLAogICAgICAgICAgICAgICAgICAgICJzbGFja19hbW91bnQiOiAwLjAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICAic2VhcmNoX3NwYWNlIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJsZWFybmluZ19yYXRlIjogInVuaWZvcm0oMC4wMDEsMC4wMSkiLAogICAgICAgICAgICAgICAgICAgICJtb2RlbF9uYW1lIjogImNob2ljZSgndml0czE2cjIyNCcpIiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgImxlYXJuaW5nX3JhdGUiOiAidW5pZm9ybSgwLjAwMSwwLjAxKSIsCiAgICAgICAgICAgICAgICAgICAgIm1vZGVsX25hbWUiOiAiY2hvaWNlKCdzZXJlc25leHQnKSIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICBdLAogICAgICAgIH0KCiAgICBkZWYgdGVzdF9hdXRvbWxfdmlzaW9uX211bHRpbGFiZWxfbm9kZV9pbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBAZHNsLnBpcGVsaW5lKG5hbWU9InRyYWluX211bHRpbGFiZWxfd2l0aF9hdXRvbWxfaW5fcGlwZWxpbmUiKQogICAgICAgIGRlZiB0cmFpbl9tdWx0aWxhYmVsX3dpdGhfYXV0b21sX2luX3BpcGVsaW5lKAogICAgICAgICAgICBpbWFnZV9tdWx0aWxhYmVsX3RyYWluX2RhdGEsCiAgICAgICAgICAgIGltYWdlX211bHRpbGFiZWxfdmFsaWRfZGF0YSwKICAgICAgICApOgogICAgICAgICAgICBpbWFnZV9tdWx0aWxhYmVsX25vZGUgPSBhdXRvbWwuaW1hZ2VfY2xhc3NpZmljYXRpb25fbXVsdGlsYWJlbCgKICAgICAgICAgICAgICAgIHRyYWluaW5nX2RhdGE9aW1hZ2VfbXVsdGlsYWJlbF90cmFpbl9kYXRhLAogICAgICAgICAgICAgICAgdmFsaWRhdGlvbl9kYXRhPWltYWdlX211bHRpbGFiZWxfdmFsaWRfZGF0YSwKICAgICAgICAgICAgICAgIHRhcmdldF9jb2x1bW5fbmFtZT0ibGFiZWwiLAogICAgICAgICAgICAgICAgcHJpbWFyeV9tZXRyaWM9ImlvdSIsCiAgICAgICAgICAgICkKICAgICAgICAgICAgaW1hZ2VfbXVsdGlsYWJlbF9ub2RlLnNldF9saW1pdHMoCiAgICAgICAgICAgICAgICB0aW1lb3V0X21pbnV0ZXM9NjAsCiAgICAgICAgICAgICkKICAgICAgICAgICAgaW1hZ2VfbXVsdGlsYWJlbF9ub2RlLmV4dGVuZF9zZWFyY2hfc3BhY2UoCiAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgU2VhcmNoU3BhY2UoCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsX25hbWU9Q2hvaWNlKFsidml0YjE2cjIyNCJdKSwKICAgICAgICAgICAgICAgICAgICAgICAgbGVhcm5pbmdfcmF0ZT1Vbmlmb3JtKDAuMDAxLCAwLjAxKSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIFNlYXJjaFNwYWNlKAogICAgICAgICAgICAgICAgICAgICAgICBtb2RlbF9uYW1lPUNob2ljZShbInNlcmVzbmV4dCJdKSwKICAgICAgICAgICAgICAgICAgICAgICAgbGVhcm5pbmdfcmF0ZT1Vbmlmb3JtKDAuMDAxLCAwLjAxKSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICApCiAgICAgICAgICAgIGltYWdlX211bHRpbGFiZWxfbm9kZS5zZXRfc3dlZXAoCiAgICAgICAgICAgICAgICBzYW1wbGluZ19hbGdvcml0aG09IlJhbmRvbSIsCiAgICAgICAgICAgICAgICBlYXJseV90ZXJtaW5hdGlvbj1CYW5kaXRQb2xpY3koZXZhbHVhdGlvbl9pbnRlcnZhbD0yLCBzbGFja19mYWN0b3I9MC4yLCBkZWxheV9ldmFsdWF0aW9uPTYpLAogICAgICAgICAgICApCiAgICAgICAgICAgIGltYWdlX211bHRpbGFiZWxfbm9kZS5zZXRfbGltaXRzKAogICAgICAgICAgICAgICAgbWF4X3RyaWFscz0xLAogICAgICAgICAgICAgICAgbWF4X2NvbmN1cnJlbnRfdHJpYWxzPTEsCiAgICAgICAgICAgICkKCiAgICAgICAgbXVsdGlsYWJlbF90cmFpbiA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL2ltYWdlX2NsYXNzaWZpY2F0aW9uX211bHRpbGFiZWwvdHJhaW4iLAogICAgICAgICkKICAgICAgICBtdWx0aWxhYmVsX3ZhbGlkID0gSW5wdXQoCiAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5NTFRBQkxFLAogICAgICAgICAgICBwYXRoPXRlc3RzX3Jvb3RfZGlyIC8gInRlc3RfY29uZmlncy9hdXRvbWxfam9iL3Rlc3RfZGF0YXNldHMvaW1hZ2VfY2xhc3NpZmljYXRpb25fbXVsdGlsYWJlbC92YWxpZCIsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZV9qb2I6IFBpcGVsaW5lSm9iID0gdHJhaW5fbXVsdGlsYWJlbF93aXRoX2F1dG9tbF9pbl9waXBlbGluZShtdWx0aWxhYmVsX3RyYWluLCBtdWx0aWxhYmVsX3ZhbGlkKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSBHUFVfQ0xVU1RFUgoKICAgICAgICBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZV9qb2IpCiAgICAgICAgY2FuY2VsX2pvYihjbGllbnQsIGZyb21fcmVzdF9waXBlbGluZV9qb2IpCgogICAgICAgIGFjdHVhbF9kaWN0ID0gZnJvbV9yZXN0X3BpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCkKICAgICAgICBmaWVsZHNfdG9fb21pdCA9IFsibmFtZSIsICJkaXNwbGF5X25hbWUiLCAiZXhwZXJpbWVudF9uYW1lIiwgInByb3BlcnRpZXMiXQoKICAgICAgICBpbWFnZV9tdWx0aWxhYmVsX2RpY3QgPSBweWRhc2gub21pdChhY3R1YWxfZGljdFsicHJvcGVydGllcyJdWyJqb2JzIl1bImltYWdlX211bHRpbGFiZWxfbm9kZSJdLCBmaWVsZHNfdG9fb21pdCkKICAgICAgICBhc3NlcnQgaW1hZ2VfbXVsdGlsYWJlbF9kaWN0ID09IHsKICAgICAgICAgICAgImxpbWl0cyI6IHsibWF4X2NvbmN1cnJlbnRfdHJpYWxzIjogMSwgIm1heF90cmlhbHMiOiAxLCAidGltZW91dF9taW51dGVzIjogNjB9LAogICAgICAgICAgICAibG9nX3ZlcmJvc2l0eSI6ICJpbmZvIiwKICAgICAgICAgICAgIm91dHB1dHMiOiB7fSwKICAgICAgICAgICAgInByaW1hcnlfbWV0cmljIjogImlvdSIsCiAgICAgICAgICAgICJ0YWdzIjoge30sCiAgICAgICAgICAgICJ0YXJnZXRfY29sdW1uX25hbWUiOiAibGFiZWwiLAogICAgICAgICAgICAidGFzayI6ICJpbWFnZV9jbGFzc2lmaWNhdGlvbl9tdWx0aWxhYmVsIiwKICAgICAgICAgICAgInRyYWluaW5nX2RhdGEiOiAiJHt7cGFyZW50LmlucHV0cy5pbWFnZV9tdWx0aWxhYmVsX3RyYWluX2RhdGF9fSIsCiAgICAgICAgICAgICJ0eXBlIjogImF1dG9tbCIsCiAgICAgICAgICAgICJ2YWxpZGF0aW9uX2RhdGEiOiAiJHt7cGFyZW50LmlucHV0cy5pbWFnZV9tdWx0aWxhYmVsX3ZhbGlkX2RhdGF9fSIsCiAgICAgICAgICAgICJzd2VlcCI6IHsKICAgICAgICAgICAgICAgICJzYW1wbGluZ19hbGdvcml0aG0iOiAicmFuZG9tIiwKICAgICAgICAgICAgICAgICJlYXJseV90ZXJtaW5hdGlvbiI6IHsKICAgICAgICAgICAgICAgICAgICAiZXZhbHVhdGlvbl9pbnRlcnZhbCI6IDIsCiAgICAgICAgICAgICAgICAgICAgImRlbGF5X2V2YWx1YXRpb24iOiA2LAogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImJhbmRpdCIsCiAgICAgICAgICAgICAgICAgICAgInNsYWNrX2ZhY3RvciI6IDAuMiwKICAgICAgICAgICAgICAgICAgICAic2xhY2tfYW1vdW50IjogMC4wLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInNlYXJjaF9zcGFjZSI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibW9kZWxfbmFtZSI6ICJjaG9pY2UoJ3ZpdGIxNnIyMjQnKSIsCiAgICAgICAgICAgICAgICAgICAgImxlYXJuaW5nX3JhdGUiOiAidW5pZm9ybSgwLjAwMSwwLjAxKSIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtb2RlbF9uYW1lIjogImNob2ljZSgnc2VyZXNuZXh0JykiLAogICAgICAgICAgICAgICAgICAgICJsZWFybmluZ19yYXRlIjogInVuaWZvcm0oMC4wMDEsMC4wMSkiLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgXSwKICAgICAgICB9CgogICAgZGVmIHRlc3RfYXV0b21sX3Zpc2lvbl9vZF9ub2RlX2luX3BpcGVsaW5lKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIEBkc2wucGlwZWxpbmUobmFtZT0idHJhaW5fb2Rfd2l0aF9hdXRvbWxfaW5fcGlwZWxpbmUiKQogICAgICAgIGRlZiB0cmFpbl9vZF93aXRoX2F1dG9tbF9pbl9waXBlbGluZSgKICAgICAgICAgICAgaW1hZ2Vfb2JqZWN0X2RldGVjdGlvbl90cmFpbl9kYXRhLAogICAgICAgICAgICBpbWFnZV9vYmplY3RfZGV0ZWN0aW9uX3ZhbGlkX2RhdGEsCiAgICAgICAgKToKICAgICAgICAgICAgaW1hZ2Vfb2JqZWN0X2RldGVjdGlvbl9ub2RlID0gYXV0b21sLmltYWdlX29iamVjdF9kZXRlY3Rpb24oCiAgICAgICAgICAgICAgICB0cmFpbmluZ19kYXRhPWltYWdlX29iamVjdF9kZXRlY3Rpb25fdHJhaW5fZGF0YSwKICAgICAgICAgICAgICAgIHZhbGlkYXRpb25fZGF0YT1pbWFnZV9vYmplY3RfZGV0ZWN0aW9uX3ZhbGlkX2RhdGEsCiAgICAgICAgICAgICAgICB0YXJnZXRfY29sdW1uX25hbWU9ImxhYmVsIiwKICAgICAgICAgICAgICAgIHByaW1hcnlfbWV0cmljPSJNZWFuQXZlcmFnZVByZWNpc2lvbiIsCiAgICAgICAgICAgICkKCiAgICAgICAgICAgIGltYWdlX29iamVjdF9kZXRlY3Rpb25fbm9kZS5leHRlbmRfc2VhcmNoX3NwYWNlKAogICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgIFNlYXJjaFNwYWNlKAogICAgICAgICAgICAgICAgICAgICAgICBtb2RlbF9uYW1lPUNob2ljZShbInlvbG92NSJdKSwKICAgICAgICAgICAgICAgICAgICAgICAgbGVhcm5pbmdfcmF0ZT1Vbmlmb3JtKDAuMDAwMSwgMC4wMSksCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsX3NpemU9Q2hvaWNlKFsic21hbGwiLCAibWVkaXVtIl0pLCAgIyBtb2RlbC1zcGVjaWZpYwogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgU2VhcmNoU3BhY2UoCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsX25hbWU9Q2hvaWNlKFsiZmFzdGVycmNubl9yZXNuZXQ1MF9mcG4iXSksCiAgICAgICAgICAgICAgICAgICAgICAgIGxlYXJuaW5nX3JhdGU9VW5pZm9ybSgwLjAwMDEsIDAuMDAxKSwKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW1pemVyPUNob2ljZShbInNnZCIsICJhZGFtIiwgImFkYW13Il0pLAogICAgICAgICAgICAgICAgICAgICAgICBtaW5fc2l6ZT1DaG9pY2UoWzYwMCwgODAwXSksICAjIG1vZGVsLXNwZWNpZmljCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgKQogICAgICAgICAgICBpbWFnZV9vYmplY3RfZGV0ZWN0aW9uX25vZGUuc2V0X3RyYWluaW5nX3BhcmFtZXRlcnMobm1zX2lvdV90aHJlc2hvbGQ9MC43KQogICAgICAgICAgICBpbWFnZV9vYmplY3RfZGV0ZWN0aW9uX25vZGUuc2V0X2xpbWl0cygKICAgICAgICAgICAgICAgIHRpbWVvdXRfbWludXRlcz02MCwKICAgICAgICAgICAgKQogICAgICAgICAgICBpbWFnZV9vYmplY3RfZGV0ZWN0aW9uX25vZGUuc2V0X3N3ZWVwKAogICAgICAgICAgICAgICAgc2FtcGxpbmdfYWxnb3JpdGhtPSJSYW5kb20iLAogICAgICAgICAgICAgICAgZWFybHlfdGVybWluYXRpb249QmFuZGl0UG9saWN5KGV2YWx1YXRpb25faW50ZXJ2YWw9Miwgc2xhY2tfZmFjdG9yPTAuMiwgZGVsYXlfZXZhbHVhdGlvbj02KSwKICAgICAgICAgICAgKQogICAgICAgICAgICBpbWFnZV9vYmplY3RfZGV0ZWN0aW9uX25vZGUuc2V0X2xpbWl0cygKICAgICAgICAgICAgICAgIG1heF90cmlhbHM9MSwKICAgICAgICAgICAgICAgIG1heF9jb25jdXJyZW50X3RyaWFscz0xLAogICAgICAgICAgICApCgogICAgICAgIG9iamVjdF9kZXRlY3Rpb25fdHJhaW4gPSBJbnB1dCgKICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgIHBhdGg9dGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2F1dG9tbF9qb2IvdGVzdF9kYXRhc2V0cy9pbWFnZV9vYmplY3RfZGV0ZWN0aW9uL3RyYWluIiwKICAgICAgICApCiAgICAgICAgb2JqZWN0X2RldGVjdGlvbl92YWxpZCA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL2ltYWdlX29iamVjdF9kZXRlY3Rpb24vdmFsaWQiLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmVfam9iOiBQaXBlbGluZUpvYiA9IHRyYWluX29kX3dpdGhfYXV0b21sX2luX3BpcGVsaW5lKG9iamVjdF9kZXRlY3Rpb25fdHJhaW4sIG9iamVjdF9kZXRlY3Rpb25fdmFsaWQpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9IEdQVV9DTFVTVEVSCgogICAgICAgIGZyb21fcmVzdF9waXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lX2pvYikKICAgICAgICBjYW5jZWxfam9iKGNsaWVudCwgZnJvbV9yZXN0X3BpcGVsaW5lX2pvYikKCiAgICAgICAgYWN0dWFsX2RpY3QgPSBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKQogICAgICAgIGZpZWxkc190b19vbWl0ID0gWyJuYW1lIiwgImRpc3BsYXlfbmFtZSIsICJleHBlcmltZW50X25hbWUiLCAicHJvcGVydGllcyJdCgogICAgICAgIGltYWdlX29iamVjdF9kZXRlY3Rpb25fZGljdCA9IHB5ZGFzaC5vbWl0KAogICAgICAgICAgICBhY3R1YWxfZGljdFsicHJvcGVydGllcyJdWyJqb2JzIl1bImltYWdlX29iamVjdF9kZXRlY3Rpb25fbm9kZSJdLCBmaWVsZHNfdG9fb21pdAogICAgICAgICkKICAgICAgICBhc3NlcnQgaW1hZ2Vfb2JqZWN0X2RldGVjdGlvbl9kaWN0ID09IHsKICAgICAgICAgICAgImxpbWl0cyI6IHsibWF4X2NvbmN1cnJlbnRfdHJpYWxzIjogMSwgIm1heF90cmlhbHMiOiAxLCAidGltZW91dF9taW51dGVzIjogNjB9LAogICAgICAgICAgICAibG9nX3ZlcmJvc2l0eSI6ICJpbmZvIiwKICAgICAgICAgICAgIm91dHB1dHMiOiB7fSwKICAgICAgICAgICAgInByaW1hcnlfbWV0cmljIjogIm1lYW5fYXZlcmFnZV9wcmVjaXNpb24iLAogICAgICAgICAgICAidGFncyI6IHt9LAogICAgICAgICAgICAidGFyZ2V0X2NvbHVtbl9uYW1lIjogImxhYmVsIiwKICAgICAgICAgICAgInRhc2siOiAiaW1hZ2Vfb2JqZWN0X2RldGVjdGlvbiIsCiAgICAgICAgICAgICJ0cmFpbmluZ19kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMuaW1hZ2Vfb2JqZWN0X2RldGVjdGlvbl90cmFpbl9kYXRhfX0iLAogICAgICAgICAgICAidHlwZSI6ICJhdXRvbWwiLAogICAgICAgICAgICAidmFsaWRhdGlvbl9kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMuaW1hZ2Vfb2JqZWN0X2RldGVjdGlvbl92YWxpZF9kYXRhfX0iLAogICAgICAgICAgICAidHJhaW5pbmdfcGFyYW1ldGVycyI6IHsibm1zX2lvdV90aHJlc2hvbGQiOiAwLjd9LAogICAgICAgICAgICAic3dlZXAiOiB7CiAgICAgICAgICAgICAgICAic2FtcGxpbmdfYWxnb3JpdGhtIjogInJhbmRvbSIsCiAgICAgICAgICAgICAgICAiZWFybHlfdGVybWluYXRpb24iOiB7CiAgICAgICAgICAgICAgICAgICAgImV2YWx1YXRpb25faW50ZXJ2YWwiOiAyLAogICAgICAgICAgICAgICAgICAgICJkZWxheV9ldmFsdWF0aW9uIjogNiwKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJiYW5kaXQiLAogICAgICAgICAgICAgICAgICAgICJzbGFja19mYWN0b3IiOiAwLjIsCiAgICAgICAgICAgICAgICAgICAgInNsYWNrX2Ftb3VudCI6IDAuMCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJzZWFyY2hfc3BhY2UiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgImxlYXJuaW5nX3JhdGUiOiAidW5pZm9ybSgwLjAwMDEsMC4wMSkiLAogICAgICAgICAgICAgICAgICAgICJtb2RlbF9uYW1lIjogImNob2ljZSgneW9sb3Y1JykiLAogICAgICAgICAgICAgICAgICAgICJtb2RlbF9zaXplIjogImNob2ljZSgnc21hbGwnLCdtZWRpdW0nKSIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJsZWFybmluZ19yYXRlIjogInVuaWZvcm0oMC4wMDAxLDAuMDAxKSIsCiAgICAgICAgICAgICAgICAgICAgIm1pbl9zaXplIjogImNob2ljZSg2MDAsODAwKSIsCiAgICAgICAgICAgICAgICAgICAgIm1vZGVsX25hbWUiOiAiY2hvaWNlKCdmYXN0ZXJyY25uX3Jlc25ldDUwX2ZwbicpIiwKICAgICAgICAgICAgICAgICAgICAib3B0aW1pemVyIjogImNob2ljZSgnc2dkJywnYWRhbScsJ2FkYW13JykiLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgXSwKICAgICAgICB9CgogICAgZGVmIHRlc3RfYXV0b21sX3Zpc2lvbl9zZWdtZW50YXRpb25fbm9kZV9pbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBAZHNsLnBpcGVsaW5lKG5hbWU9InRyYWluX3dpdGhfYXV0b21sX2luX3BpcGVsaW5lIikKICAgICAgICBkZWYgdHJhaW5fc2VnbWVudGF0aW9uX3dpdGhfYXV0b21sX2luX3BpcGVsaW5lKAogICAgICAgICAgICBpbWFnZV9pbnN0YW5jZV9zZWdtZW50YXRpb25fdHJhaW5fZGF0YSwKICAgICAgICAgICAgaW1hZ2VfaW5zdGFuY2Vfc2VnbWVudGF0aW9uX3ZhbGlkX2RhdGEsCiAgICAgICAgKToKICAgICAgICAgICAgaW1hZ2VfaW5zdGFuY2Vfc2VnbWVudGF0aW9uX25vZGUgPSBhdXRvbWwuaW1hZ2VfaW5zdGFuY2Vfc2VnbWVudGF0aW9uKAogICAgICAgICAgICAgICAgcHJpbWFyeV9tZXRyaWM9Ik1lYW5BdmVyYWdlUHJlY2lzaW9uIiwKICAgICAgICAgICAgICAgIHRhcmdldF9jb2x1bW5fbmFtZT0ibGFiZWwiLAogICAgICAgICAgICAgICAgdHJhaW5pbmdfZGF0YT1pbWFnZV9pbnN0YW5jZV9zZWdtZW50YXRpb25fdHJhaW5fZGF0YSwKICAgICAgICAgICAgICAgIHZhbGlkYXRpb25fZGF0YT1pbWFnZV9pbnN0YW5jZV9zZWdtZW50YXRpb25fdmFsaWRfZGF0YSwKICAgICAgICAgICAgKQogICAgICAgICAgICBpbWFnZV9pbnN0YW5jZV9zZWdtZW50YXRpb25fbm9kZS5zZXRfbGltaXRzKAogICAgICAgICAgICAgICAgdGltZW91dF9taW51dGVzPTYwLAogICAgICAgICAgICApCiAgICAgICAgICAgIGltYWdlX2luc3RhbmNlX3NlZ21lbnRhdGlvbl9ub2RlLnNldF90cmFpbmluZ19wYXJhbWV0ZXJzKG5tc19pb3VfdGhyZXNob2xkPTAuNykKICAgICAgICAgICAgaW1hZ2VfaW5zdGFuY2Vfc2VnbWVudGF0aW9uX25vZGUuZXh0ZW5kX3NlYXJjaF9zcGFjZSgKICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICBTZWFyY2hTcGFjZSgKICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWxfbmFtZT1DaG9pY2UoWyJtYXNrcmNubl9yZXNuZXQ1MF9mcG4iXSksCiAgICAgICAgICAgICAgICAgICAgICAgIGxlYXJuaW5nX3JhdGU9VW5pZm9ybSgwLjAwMDEsIDAuMDAxKSwKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW1pemVyPUNob2ljZShbInNnZCIsICJhZGFtIiwgImFkYW13Il0pLAogICAgICAgICAgICAgICAgICAgICAgICBtaW5fc2l6ZT1DaG9pY2UoWzYwMCwgODAwXSksCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgKQoKICAgICAgICAgICAgaW1hZ2VfaW5zdGFuY2Vfc2VnbWVudGF0aW9uX25vZGUuc2V0X3N3ZWVwKAogICAgICAgICAgICAgICAgc2FtcGxpbmdfYWxnb3JpdGhtPSJSYW5kb20iLAogICAgICAgICAgICAgICAgZWFybHlfdGVybWluYXRpb249QmFuZGl0UG9saWN5KGV2YWx1YXRpb25faW50ZXJ2YWw9Miwgc2xhY2tfZmFjdG9yPTAuMiwgZGVsYXlfZXZhbHVhdGlvbj02KSwKICAgICAgICAgICAgKQogICAgICAgICAgICBpbWFnZV9pbnN0YW5jZV9zZWdtZW50YXRpb25fbm9kZS5zZXRfbGltaXRzKAogICAgICAgICAgICAgICAgbWF4X3RyaWFscz0xMCwKICAgICAgICAgICAgICAgIG1heF9jb25jdXJyZW50X3RyaWFscz0yLAogICAgICAgICAgICApCgogICAgICAgIGluc3RhbmNlX3NlZ21lbnRhdGlvbl90cmFpbiA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL2ltYWdlX2luc3RhbmNlX3NlZ21lbnRhdGlvbi90cmFpbiIsCiAgICAgICAgKQogICAgICAgIGluc3RhbmNlX3NlZ21lbnRhdGlvbl92YWxpZCA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL2ltYWdlX2luc3RhbmNlX3NlZ21lbnRhdGlvbi92YWxpZCIsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZV9qb2I6IFBpcGVsaW5lSm9iID0gdHJhaW5fc2VnbWVudGF0aW9uX3dpdGhfYXV0b21sX2luX3BpcGVsaW5lKAogICAgICAgICAgICBpbnN0YW5jZV9zZWdtZW50YXRpb25fdHJhaW4sIGluc3RhbmNlX3NlZ21lbnRhdGlvbl92YWxpZAogICAgICAgICkKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gR1BVX0NMVVNURVIKCiAgICAgICAgZnJvbV9yZXN0X3BpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmVfam9iKQogICAgICAgIGNhbmNlbF9qb2IoY2xpZW50LCBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iKQoKICAgICAgICBhY3R1YWxfZGljdCA9IGZyb21fcmVzdF9waXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpCiAgICAgICAgZmllbGRzX3RvX29taXQgPSBbIm5hbWUiLCAiZGlzcGxheV9uYW1lIiwgImV4cGVyaW1lbnRfbmFtZSIsICJwcm9wZXJ0aWVzIl0KCiAgICAgICAgaW1hZ2VfaW5zdGFuY2Vfc2VnbWVudGF0aW9uX2RpY3QgPSBweWRhc2gub21pdCgKICAgICAgICAgICAgYWN0dWFsX2RpY3RbInByb3BlcnRpZXMiXVsiam9icyJdWyJpbWFnZV9pbnN0YW5jZV9zZWdtZW50YXRpb25fbm9kZSJdLCBmaWVsZHNfdG9fb21pdAogICAgICAgICkKICAgICAgICBhc3NlcnQgaW1hZ2VfaW5zdGFuY2Vfc2VnbWVudGF0aW9uX2RpY3QgPT0gewogICAgICAgICAgICAibGltaXRzIjogeyJtYXhfY29uY3VycmVudF90cmlhbHMiOiAyLCAibWF4X3RyaWFscyI6IDEwLCAidGltZW91dF9taW51dGVzIjogNjB9LAogICAgICAgICAgICAibG9nX3ZlcmJvc2l0eSI6ICJpbmZvIiwKICAgICAgICAgICAgIm91dHB1dHMiOiB7fSwKICAgICAgICAgICAgInByaW1hcnlfbWV0cmljIjogIm1lYW5fYXZlcmFnZV9wcmVjaXNpb24iLAogICAgICAgICAgICAidGFncyI6IHt9LAogICAgICAgICAgICAidGFyZ2V0X2NvbHVtbl9uYW1lIjogImxhYmVsIiwKICAgICAgICAgICAgInRhc2siOiAiaW1hZ2VfaW5zdGFuY2Vfc2VnbWVudGF0aW9uIiwKICAgICAgICAgICAgInRyYWluaW5nX2RhdGEiOiAiJHt7cGFyZW50LmlucHV0cy5pbWFnZV9pbnN0YW5jZV9zZWdtZW50YXRpb25fdHJhaW5fZGF0YX19IiwKICAgICAgICAgICAgInR5cGUiOiAiYXV0b21sIiwKICAgICAgICAgICAgInZhbGlkYXRpb25fZGF0YSI6ICIke3twYXJlbnQuaW5wdXRzLmltYWdlX2luc3RhbmNlX3NlZ21lbnRhdGlvbl92YWxpZF9kYXRhfX0iLAogICAgICAgICAgICAidHJhaW5pbmdfcGFyYW1ldGVycyI6IHsibm1zX2lvdV90aHJlc2hvbGQiOiAwLjd9LAogICAgICAgICAgICAic3dlZXAiOiB7CiAgICAgICAgICAgICAgICAic2FtcGxpbmdfYWxnb3JpdGhtIjogInJhbmRvbSIsCiAgICAgICAgICAgICAgICAiZWFybHlfdGVybWluYXRpb24iOiB7CiAgICAgICAgICAgICAgICAgICAgImV2YWx1YXRpb25faW50ZXJ2YWwiOiAyLAogICAgICAgICAgICAgICAgICAgICJkZWxheV9ldmFsdWF0aW9uIjogNiwKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJiYW5kaXQiLAogICAgICAgICAgICAgICAgICAgICJzbGFja19mYWN0b3IiOiAwLjIsCiAgICAgICAgICAgICAgICAgICAgInNsYWNrX2Ftb3VudCI6IDAuMCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJzZWFyY2hfc3BhY2UiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgImxlYXJuaW5nX3JhdGUiOiAidW5pZm9ybSgwLjAwMDEsMC4wMDEpIiwKICAgICAgICAgICAgICAgICAgICAibW9kZWxfbmFtZSI6ICJjaG9pY2UoJ21hc2tyY25uX3Jlc25ldDUwX2ZwbicpIiwKICAgICAgICAgICAgICAgICAgICAib3B0aW1pemVyIjogImNob2ljZSgnc2dkJywnYWRhbScsJ2FkYW13JykiLAogICAgICAgICAgICAgICAgICAgICJtaW5fc2l6ZSI6ICJjaG9pY2UoNjAwLDgwMCkiLAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgIH0K",
      "StatusCode": 201,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Content-MD5": "7KSIc2nEWBWtt/xkdXjRWw==",
        "Date": "Mon, 24 Apr 2023 03:22:27 GMT",
        "ETag": "\u00220x8DB447321954307\u0022",
        "Last-Modified": "Mon, 24 Apr 2023 03:22:27 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-content-crc64": "cwNop4tXhvc=",
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://samcw32zcnpjldw.blob.core.windows.net/azureml-blobstore-72e8eff8-148b-4582-a07d-efc79559f19f/LocalUpload/00000000000000000000000000000000/e2etests/test_dsl_fl.py",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "10442",
        "Content-MD5": "Bf2zKM/VFLU1K2yMYkGmbw==",
        "Content-Type": "application/octet-stream",
        "If-None-Match": "*",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)",
        "x-ms-blob-type": "BlockBlob",
        "x-ms-date": "Mon, 24 Apr 2023 03:22:25 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": "aW1wb3J0IHB5dGVzdApmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKZnJvbSBkZXZ0b29sc190ZXN0dXRpbHMgaW1wb3J0IEF6dXJlUmVjb3JkZWRUZXN0Q2FzZSwgaXNfbGl2ZQpmcm9tIGF6dXJlLmNvcmUuZXhjZXB0aW9ucyBpbXBvcnQgUmVzb3VyY2VOb3RGb3VuZEVycm9yCmZyb20gLi5fdXRpbCBpbXBvcnQgX0RTTF9USU1FT1VUX1NFQ09ORApmcm9tIHRlc3RfdXRpbGl0aWVzLnV0aWxzIGltcG9ydCBfUFlURVNUX1RJTUVPVVRfTUVUSE9ECmZyb20gYXp1cmUuYWkubWwgaW1wb3J0IElucHV0LCBsb2FkX2NvbXBvbmVudApmcm9tIHR5cGluZyBpbXBvcnQgQ2FsbGFibGUKZnJvbSBhenVyZS5haS5tbC5kc2wuX2ZsX3NjYXR0ZXJfZ2F0aGVyX25vZGUgaW1wb3J0IGZsX3NjYXR0ZXJfZ2F0aGVyCmZyb20gYXp1cmUuYWkubWwuZW50aXRpZXMuX2Fzc2V0cy5mZWRlcmF0ZWRfbGVhcm5pbmdfc2lsbyBpbXBvcnQgRmVkZXJhdGVkTGVhcm5pbmdTaWxvCmZyb20gYXp1cmUuYWkubWwuY29uc3RhbnRzIGltcG9ydCBBc3NldFR5cGVzCmZyb20gYXp1cmUuYWkubWwuZW50aXRpZXMuX2NyZWRlbnRpYWxzIGltcG9ydCAoCiAgICBJZGVudGl0eUNvbmZpZ3VyYXRpb24sCiAgICBJZGVudGl0eUNvbmZpZ3VyYXRpb25UeXBlLAogICAgTWFuYWdlZElkZW50aXR5Q29uZmlndXJhdGlvbiwKKQpmcm9tIGF6dXJlLmFpLm1sLmRzbCBpbXBvcnQgcGlwZWxpbmUKaW1wb3J0IG9zCmZyb20gYXp1cmUuYWkubWwgaW1wb3J0ICgKICAgIE1MQ2xpZW50LAopCgoKIyBSRVNPVVJDRSBOT1RFUyAtIEFzIGFuIGUyZSB0ZXN0IGZpbGUsIHRoaXMgZmlsZSBtYWtlcyBhbmQgcmVmZXJlbmNlcyByZWFsIEFNTCByZXNvdXJjZXMuCiMgQWxsIHJlc291cmNlcyByZWZlcmVuY2VzIGJ5IHRoaXMgZmlsZSBhcmUgY29udGFpbmVkIHdpdGhpbiB0aGUgZm9sbG93aW5nOgojIHN1YnNjcmlwdGlvbjogZGF0YSBzY2llbmNlIFZNIFRlYW0gKERTVk0pCiMgcmVzb3VyY2UgZ3JvdXA6IGZsLWUyZS10ZXN0aW5nLXJnCiMgd29ya3NwYWNlOiBmbC1lMmUtdGVzdGluZy13cwojIElmIHlvdSdyZSBydW5uaW5nIHRoaXMgdGVzdCBsb2NhbGx5IGluIGxpdmUgbW9kZSwgbWFrZSBzdXJlIHlvdSd2ZSBzZXQgdGhlIGFib3ZlIHZhbHVlcyBpbgojIHlvdXIgLmVudiBmaWxlLgojIHJlc291cmNlcyBvZiBub3RlOgojIC0gbXVsdGlwbGUgc3RvcmFnZSBjb250YWluZXJzCiMgLSBtdWx0aXBsZSBjb21wdXRlcyB3aXRoIHZhcnlpbmcgbWFuYWdlZCBpZGVudGl0aWVzIHRvIGFsbG93IGFjY2VzcyB0byBkaWZmZXJlbnQgc3RvcmFnZSBjb250YWluZXJzCkBweXRlc3QubWFyay50aW1lb3V0KHRpbWVvdXQ9X0RTTF9USU1FT1VUX1NFQ09ORCwgbWV0aG9kPV9QWVRFU1RfVElNRU9VVF9NRVRIT0QpCkBweXRlc3QubWFyay5lMmV0ZXN0CkBweXRlc3QubWFyay5jb3JlX3Nka190ZXN0CmNsYXNzIFRlc3REU0xQaXBlbGluZShBenVyZVJlY29yZGVkVGVzdENhc2UpOgogICAgIyBERVYgTk9URTogVGhpcyB0ZXN0IGV4cGVjdHMgYSBsb3Qgb2YgcmVzb3VyY2VzIHRvIGFscmVhZHkgZXhpc3QgaW4gQU1MLiBUaGUgaW5pdGlhbCBpbXBsZW1lbnRhdGlvbgogICAgIyBvZiB0aGlzIHRlc3QgaW1wbGVtZW50ZWQgYWxsIG9mIHRoZXNlIHRoaWducyB1bmRlciB0aGUgJ2ZsLWUyZS10ZXN0aW5nLXJnJyByZXNvdXJjZSBncm91cCBhbmQKICAgICMgdGhlICdmbC1lMmUtdGVzdGluZy13cycgd29ya3NwYWNlIGluc2lkZSB0aGF0IFJHLgogICAgIyBUaGUgbmVlZGVkIHJlc291cmNlcyBhcmU6CiAgICAjIC0gSW4gdGhlIHdvcmtzcGFjZSdzIHN0b3JhZ2UgYWNjb3VudCwgMyBjb250YWluZXJzIG5hbWVkICdzaWxvLWNvbnRhaW5lcjEnLCAnc2lsby1jb250YWluZXIyMycsCiAgICAjICAgICAgIGFuZCAnYWdnLWNvbnRhaW5lcicuIEVhY2ggY29udGFpbmVyIG5lZWRzIHRvIGhhdmUgYXNzaWduZWQgdGhlIGJsb2Igb3duZXIgcGVybWlzc2lvbgogICAgIyAgICAgICB0byB0aGUgJ3Rlc3QtbXNpLWlkJyBtYW5hZ2VkIGlkZW50aXR5CiAgICAjIC0gNCBjb21wdXRlIGNsdXN0ZXJzIGluIHRoZSB3b3Jrc3BhY2UgbmFtZWQgc2lsb0NvbXB1dGUxLzIvMyBhbmQgYWdnQ29tcHV0ZS4gRWFjaCBvZiB3aGljaAogICAgIyAgICAgICBoYXMgYmVlbiBhc3NpZ25lZCB0aGUgJ3Rlc3QtbXNpLWlkJyBJRAogICAgIyAtIDQgZGF0YXN0b3JlcyBjb25uZWN0ZWQgdG8gdGhlIGFmb3JlbWVudGlvbmVkIHN0b3JhZ2UgY29udGFpbmVycyBuYW1lZCBzaWxvX2RhdGFzdG9yZTEvMi8zIGFuZAogICAgIyAgICAgICBhZ2dfZGF0YXN0b3JlLgogICAgQHB5dGVzdC5tYXJrLnNraXBpZigKICAgICAgICBjb25kaXRpb249bm90IGlzX2xpdmUoKSwKICAgICAgICByZWFzb249KAogICAgICAgICAgICAiVE9ETyAoMjIzNTAzNCkgVGhlIGNyaXRpY2FsIGNhbGwgdG8gYGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGVgIHNlZW1zIHRvIG1ha2UgZGlmZmVyZW50IgogICAgICAgICAgICArICJBUEkgY2FsbHMgaW4gcGxheWJhY2sgbW9kZSBjb21wYXJlZCB0byByZWNvcmRpbmcgbW9kZSIKICAgICAgICApLAogICAgKQogICAgZGVmIHRlc3RfZmxfcGlwZWxpbmUoCiAgICAgICAgc2VsZiwKICAgICAgICBjbGllbnQ6IE1MQ2xpZW50LAogICAgICAgIGZlZGVyYXRlZF9sZWFybmluZ19jb21wb25lbnRzX2ZvbGRlcjogUGF0aCwKICAgICAgICBmZWRlcmF0ZWRfbGVhcm5pbmdfbG9jYWxfZGF0YV9mb2xkZXI6IFBhdGgsCiAgICApIC0\u002BIE5vbmU6CiAgICAgICAgaWQgPSBJZGVudGl0eUNvbmZpZ3VyYXRpb24oCiAgICAgICAgICAgIHR5cGU9SWRlbnRpdHlDb25maWd1cmF0aW9uVHlwZS5NQU5BR0VELAogICAgICAgICAgICB1c2VyX2Fzc2lnbmVkX2lkZW50aXRpZXM9W01hbmFnZWRJZGVudGl0eUNvbmZpZ3VyYXRpb24oY2xpZW50X2lkPSIzYWRmZjc0Mi0wMTQyLTQ1YTYtODE0Mi0zZDk0Zjk0NGNhZmIiKV0sCiAgICAgICAgKQoKICAgICAgICAjIFRvIHN1cHBvcnQgZHNsIHBpcGVsaW5lIGt3YXJncwogICAgICAgIG9zLmVudmlyb25bIkFaVVJFX01MX0NMSV9QUklWQVRFX0ZFQVRVUkVTX0VOQUJMRUQiXSA9ICJUcnVlIgogICAgICAgIGNvbXB1dGVfbmFtZXMgPSBbCiAgICAgICAgICAgICJzaWxvQ29tcHV0ZTEiLAogICAgICAgICAgICAic2lsb0NvbXB1dGUyIiwKICAgICAgICAgICAgInNpbG9Db21wdXRlMyIsCiAgICAgICAgICAgICJhZ2dDb21wdXRlIiwKICAgICAgICBdCiAgICAgICAgY29tcHV0ZXMgPSBbXQogICAgICAgIGZvciBuYW1lIGluIGNvbXB1dGVfbmFtZXM6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGV4dGFudF9jb21wdXRlID0gY2xpZW50LmNvbXB1dGUuZ2V0KG5hbWUpCiAgICAgICAgICAgICAgICBwcmludChmIkZvdW5kIGV4aXN0aW5nIGNvbXB1dGUgJ3tuYW1lfScsIHVzaW5nIHRoYXQgaW5zdGVhZCBvZiBjcmVhdGluZyBpdC4iKQogICAgICAgICAgICAgICAgY29tcHV0ZXMuYXBwZW5kKGV4dGFudF9jb21wdXRlKQogICAgICAgICAgICBleGNlcHQgUmVzb3VyY2VOb3RGb3VuZEVycm9yIGFzIGU6CiAgICAgICAgICAgICAgICByYWlzZSAoZSkKCiAgICAgICAgZGF0YXN0b3JlX25hbWVzID0gWwogICAgICAgICAgICAic2lsb19kYXRhc3RvcmUxIiwKICAgICAgICAgICAgInNpbG9fZGF0YXN0b3JlMiIsCiAgICAgICAgICAgICJzaWxvX2RhdGFzdG9yZTMiLAogICAgICAgICAgICAiYWdnX2RhdGFzdG9yZSIsCiAgICAgICAgXQoKICAgICAgICBkYXRhc3RvcmVzID0gW10KICAgICAgICBmb3IgZGF0YXN0b3JlX25hbWUgaW4gZGF0YXN0b3JlX25hbWVzOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBleHRhbnRfZHMgPSBjbGllbnQuZGF0YXN0b3Jlcy5nZXQoZGF0YXN0b3JlX25hbWUpCiAgICAgICAgICAgICAgICBwcmludChmIkZvdW5kIGV4aXN0aW5nIGRhdGFzdG9yZSAne2RhdGFzdG9yZV9uYW1lfScsIHVzaW5nIHRoYXQgaW5zdGVhZCBvZiBjcmVhdGluZyBpdC4iKQogICAgICAgICAgICAgICAgZGF0YXN0b3Jlcy5hcHBlbmQoZXh0YW50X2RzKQogICAgICAgICAgICBleGNlcHQgUmVzb3VyY2VOb3RGb3VuZEVycm9yIGFzIGU6CiAgICAgICAgICAgICAgICByYWlzZSAoZSkKCiAgICAgICAgIyBMb2FkIGNvbXBvbmVudHMgZnJvbSBsb2NhbCBjb25maWdzCiAgICAgICAgcHJlcHJvY2Vzc2luZ19jb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudCgKICAgICAgICAgICAgc291cmNlPW9zLnBhdGguam9pbihmZWRlcmF0ZWRfbGVhcm5pbmdfY29tcG9uZW50c19mb2xkZXIsICJwcmVwcm9jZXNzaW5nIiwgInNwZWMueWFtbCIpCiAgICAgICAgKQoKICAgICAgICB0cmFpbmluZ19jb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudCgKICAgICAgICAgICAgc291cmNlPW9zLnBhdGguam9pbihmZWRlcmF0ZWRfbGVhcm5pbmdfY29tcG9uZW50c19mb2xkZXIsICJ0cmFpbmluZyIsICJzcGVjLnlhbWwiKQogICAgICAgICkKCiAgICAgICAgYWdncmVnYXRlX2NvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICBzb3VyY2U9b3MucGF0aC5qb2luKGZlZGVyYXRlZF9sZWFybmluZ19jb21wb25lbnRzX2ZvbGRlciwgImFnZ3JlZ2F0ZSIsICJzcGVjLnlhbWwiKQogICAgICAgICkKCiAgICAgICAgIyBVc2UgYSBuZXN0ZWQgcGlwZWxpbmUgZm9yIHRoZSBzaWxvIHN0ZXAKICAgICAgICBAcGlwZWxpbmUKICAgICAgICBkZWYgc2lsb19zdGVwX2Z1bmMoCiAgICAgICAgICAgIHJhd190cmFpbl9kYXRhOiBJbnB1dCwKICAgICAgICAgICAgcmF3X3Rlc3RfZGF0YTogSW5wdXQsCiAgICAgICAgICAgIGNoZWNrcG9pbnQ6IElucHV0KG9wdGlvbmFsPVRydWUpLAogICAgICAgICAgICBscjogZmxvYXQgPSAwLjAxLAogICAgICAgICAgICBiYXRjaF9zaXplOiBpbnQgPSA2NCwKICAgICAgICAgICAgaXRlcmF0aW9uX251bTogaW50ID0gMCwKICAgICAgICAgICAgZXBvY2hzOiBpbnQgPSAzLAogICAgICAgICk6CiAgICAgICAgICAgICMgUHJlcHJvY2VzcyBkYXRhCiAgICAgICAgICAgIHNpbG9fcHJlX3Byb2Nlc3Npbmdfc3RlcCA9IHByZXByb2Nlc3NpbmdfY29tcG9uZW50KAogICAgICAgICAgICAgICAgcmF3X3RyYWluaW5nX2RhdGE9cmF3X3RyYWluX2RhdGEsCiAgICAgICAgICAgICAgICByYXdfdGVzdGluZ19kYXRhPXJhd190ZXN0X2RhdGEsCiAgICAgICAgICAgICAgICAjIHJhd19ldmFsdWF0aW9uX2RhdGE9cmF3X2V2YWxfZGF0YSwKICAgICAgICAgICAgICAgICMgaGVyZSB3ZSdyZSB1c2luZyB0aGUgbmFtZSBvZiB0aGUgc2lsbyBjb21wdXRlIGFzIGEgbWV0cmljcyBwcmVmaXgKICAgICAgICAgICAgICAgIG1ldHJpY3NfcHJlZml4PSIiLAogICAgICAgICAgICApCgogICAgICAgICAgICAjIFJ1biB0cmFpbmluZwogICAgICAgICAgICBzaWxvX3RyYWluaW5nX3N0ZXAgPSB0cmFpbmluZ19jb21wb25lbnQoCiAgICAgICAgICAgICAgICB0cmFpbl9kYXRhPXNpbG9fcHJlX3Byb2Nlc3Npbmdfc3RlcC5vdXRwdXRzLnByb2Nlc3NlZF90cmFpbl9kYXRhLAogICAgICAgICAgICAgICAgdGVzdF9kYXRhPXNpbG9fcHJlX3Byb2Nlc3Npbmdfc3RlcC5vdXRwdXRzLnByb2Nlc3NlZF90ZXN0X2RhdGEsCiAgICAgICAgICAgICAgICBjaGVja3BvaW50PWNoZWNrcG9pbnQsCiAgICAgICAgICAgICAgICBscj1sciwKICAgICAgICAgICAgICAgIGVwb2Nocz1lcG9jaHMsCiAgICAgICAgICAgICAgICBiYXRjaF9zaXplPWJhdGNoX3NpemUsCiAgICAgICAgICAgICAgICBtZXRyaWNzX3ByZWZpeD0iIiwKICAgICAgICAgICAgICAgIGl0ZXJhdGlvbl9udW09aXRlcmF0aW9uX251bSwKICAgICAgICAgICAgKQogICAgICAgICAgICAjIHJldHVybiB0cmFpbmluZyByZXN1bHRzCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAibW9kZWwiOiBzaWxvX3RyYWluaW5nX3N0ZXAub3V0cHV0cy5tb2RlbCwKICAgICAgICAgICAgfQoKICAgICAgICAjIFVzZSBhIGNvbXBvbmVudCBkaXJlY3RseSBmb3IgdGhlIGFnZyBzdGVwCiAgICAgICAgYWdncmVnYXRpb25fc3RlcCA9IGFnZ3JlZ2F0ZV9jb21wb25lbnQKCiAgICAgICAgc2lsb19jb25maWdzID0gWwogICAgICAgICAgICBGZWRlcmF0ZWRMZWFybmluZ1NpbG8oCiAgICAgICAgICAgICAgICBjb21wdXRlPWNvbXB1dGVzWzBdLm5hbWUsCiAgICAgICAgICAgICAgICBkYXRhc3RvcmU9ZGF0YXN0b3Jlc1swXS5uYW1lLAogICAgICAgICAgICAgICAgaW5wdXRzPXsKICAgICAgICAgICAgICAgICAgICAicmF3X3RyYWluX2RhdGEiOiBJbnB1dCgKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLlVSSV9GSUxFLAogICAgICAgICAgICAgICAgICAgICAgICBtb2RlPSJkaXJlY3QiLAogICAgICAgICAgICAgICAgICAgICAgICBwYXRoPW9zLnBhdGguam9pbihmZWRlcmF0ZWRfbGVhcm5pbmdfbG9jYWxfZGF0YV9mb2xkZXIsICJzaWxvMV9pbnB1dDEudHh0IiksCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzdG9yZT1kYXRhc3RvcmVzWzBdLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAicmF3X3Rlc3RfZGF0YSI6IElucHV0KAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuVVJJX0ZJTEUsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU9ImRpcmVjdCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg9b3MucGF0aC5qb2luKGZlZGVyYXRlZF9sZWFybmluZ19sb2NhbF9kYXRhX2ZvbGRlciwgInNpbG8xX2lucHV0Mi50eHQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXN0b3JlPWRhdGFzdG9yZXNbMF0ubmFtZSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgRmVkZXJhdGVkTGVhcm5pbmdTaWxvKAogICAgICAgICAgICAgICAgY29tcHV0ZT1jb21wdXRlc1sxXS5uYW1lLAogICAgICAgICAgICAgICAgZGF0YXN0b3JlPWRhdGFzdG9yZXNbMV0ubmFtZSwKICAgICAgICAgICAgICAgIGlucHV0cz17CiAgICAgICAgICAgICAgICAgICAgInJhd190cmFpbl9kYXRhIjogSW5wdXQoCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5VUklfRklMRSwKICAgICAgICAgICAgICAgICAgICAgICAgbW9kZT0ibW91bnQiLAogICAgICAgICAgICAgICAgICAgICAgICBwYXRoPW9zLnBhdGguam9pbihmZWRlcmF0ZWRfbGVhcm5pbmdfbG9jYWxfZGF0YV9mb2xkZXIsICJzaWxvMl9pbnB1dDEudHh0IiksCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzdG9yZT1kYXRhc3RvcmVzWzFdLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAicmF3X3Rlc3RfZGF0YSI6IElucHV0KAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuVVJJX0ZJTEUsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU9ImRpcmVjdCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg9b3MucGF0aC5qb2luKGZlZGVyYXRlZF9sZWFybmluZ19sb2NhbF9kYXRhX2ZvbGRlciwgInNpbG8yX2lucHV0Mi50eHQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXN0b3JlPWRhdGFzdG9yZXNbMV0ubmFtZSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgRmVkZXJhdGVkTGVhcm5pbmdTaWxvKAogICAgICAgICAgICAgICAgY29tcHV0ZT1jb21wdXRlc1syXS5uYW1lLAogICAgICAgICAgICAgICAgZGF0YXN0b3JlPWRhdGFzdG9yZXNbMl0ubmFtZSwKICAgICAgICAgICAgICAgIGlucHV0cz17CiAgICAgICAgICAgICAgICAgICAgInJhd190cmFpbl9kYXRhIjogSW5wdXQoCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5VUklfRklMRSwKICAgICAgICAgICAgICAgICAgICAgICAgbW9kZT0ibW91bnQiLAogICAgICAgICAgICAgICAgICAgICAgICBwYXRoPW9zLnBhdGguam9pbihmZWRlcmF0ZWRfbGVhcm5pbmdfbG9jYWxfZGF0YV9mb2xkZXIsICJzaWxvM19pbnB1dDEudHh0IiksCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzdG9yZT1kYXRhc3RvcmVzWzJdLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAicmF3X3Rlc3RfZGF0YSI6IElucHV0KAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuVVJJX0ZJTEUsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU9Im1vdW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aD1vcy5wYXRoLmpvaW4oZmVkZXJhdGVkX2xlYXJuaW5nX2xvY2FsX2RhdGFfZm9sZGVyLCAic2lsbzNfaW5wdXQyLnR4dCIpLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhc3RvcmU9ZGF0YXN0b3Jlc1syXS5uYW1lLAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApLAogICAgICAgIF0KCiAgICAgICAgc2lsb190b19hZ2dyZWdhdGlvbl9hcmd1bWVudF9tYXAgPSB7Im1vZGVsIjogInNpbG9faW5wdXRzIn0KICAgICAgICBhZ2dyZWdhdGlvbl90b19zaWxvX2FyZ3VtZW50X21hcCA9IHsiYWdncmVnYXRlZF9vdXRwdXQiOiAiY2hlY2twb2ludCJ9CgogICAgICAgICMgT3RoZXIgYXJncwogICAgICAgIGl0ZXJhdGlvbnMgPSAzCiAgICAgICAgc2lsb19rd2FyZ3MgPSB7fQogICAgICAgIGFnZ19rd2FyZ3MgPSB7fQogICAgICAgIGFnZ3JlZ2F0aW9uX2NvbXB1dGUgPSBjb21wdXRlc1szXS5uYW1lCiAgICAgICAgYWdncmVnYXRpb25fZGF0YXN0b3JlID0gZGF0YXN0b3Jlc1szXS5uYW1lCgogICAgICAgICMgRGVmaW5lIHRoZSBmbCBwaXBlbGluZQogICAgICAgIGZsX25vZGUgPSBmbF9zY2F0dGVyX2dhdGhlcigKICAgICAgICAgICAgc2lsb19jb25maWdzPXNpbG9fY29uZmlncywKICAgICAgICAgICAgc2lsb19jb21wb25lbnQ9c2lsb19zdGVwX2Z1bmMsCiAgICAgICAgICAgIGFnZ3JlZ2F0aW9uX2NvbXBvbmVudD1hZ2dyZWdhdGlvbl9zdGVwLAogICAgICAgICAgICBhZ2dyZWdhdGlvbl9jb21wdXRlPWFnZ3JlZ2F0aW9uX2NvbXB1dGUsCiAgICAgICAgICAgIGFnZ3JlZ2F0aW9uX2RhdGFzdG9yZT1hZ2dyZWdhdGlvbl9kYXRhc3RvcmUsCiAgICAgICAgICAgIHNoYXJlZF9zaWxvX2t3YXJncz1zaWxvX2t3YXJncywKICAgICAgICAgICAgYWdncmVnYXRpb25fa3dhcmdzPWFnZ19rd2FyZ3MsCiAgICAgICAgICAgIHNpbG9fdG9fYWdncmVnYXRpb25fYXJndW1lbnRfbWFwPXNpbG9fdG9fYWdncmVnYXRpb25fYXJndW1lbnRfbWFwLAogICAgICAgICAgICBhZ2dyZWdhdGlvbl90b19zaWxvX2FyZ3VtZW50X21hcD1hZ2dyZWdhdGlvbl90b19zaWxvX2FyZ3VtZW50X21hcCwKICAgICAgICAgICAgbWF4X2l0ZXJhdGlvbnM9aXRlcmF0aW9ucywKICAgICAgICApCgogICAgICAgICMgY3JlYXRlIGFuZCBzdWJtaXQgdGhlIHBpcGVsaW5lIGpvYgogICAgICAgIHN1Ym1pdHRlZF9waXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKAogICAgICAgICAgICBmbF9ub2RlLnNjYXR0ZXJfZ2F0aGVyX2dyYXBoLCBleHBlcmltZW50X25hbWU9ImV4YW1wbGVfZmxfcGlwZWxpbmUiCiAgICAgICAgKQogICAgICAgIHByaW50KCJTdWJtaXR0ZWQgcGlwZWxpbmUgam9iOiB7fSIuZm9ybWF0KHN1Ym1pdHRlZF9waXBlbGluZV9qb2IuaWQpKQogICAgICAgIHN1YmdyYXBoID0gc3VibWl0dGVkX3BpcGVsaW5lX2pvYi5jb21wb25lbnQuam9icwoKICAgICAgICAjIFVuZm9ydHVuYXRlbHkgZXhlY3V0ZWQgcGlwZWxpbmVzIGRvbid0IHJldHVybiBpbnRlcmlvciB2YWx1ZXMgb2Ygc3ViLXBpcGVsaW5lcywKICAgICAgICAjIHNvIHdlIGNhbid0IGluc3BlY3QgaW50ZXJuYWwgZGF0YXN0b3JlcyBvciBjb21wdXRlcyBpbiBzaWxvIHN0ZXBzCiAgICAgICAgYXNzZXJ0ICJzY2F0dGVyX2dhdGhlcl9ib2R5IiBpbiBzdWJncmFwaAogICAgICAgIHNjYXR0ZXJfZ2F0aGVyX2JvZHkgPSBzdWJncmFwaFsic2NhdHRlcl9nYXRoZXJfYm9keSJdCiAgICAgICAgYXNzZXJ0IHNjYXR0ZXJfZ2F0aGVyX2JvZHkudHlwZSA9PSAicGlwZWxpbmUiCiAgICAgICAgYXNzZXJ0IGFsbChzaWxvX2lucHV0IGluIHNjYXR0ZXJfZ2F0aGVyX2JvZHkuaW5wdXRzIGZvciBzaWxvX2lucHV0IGluIHNpbG9fa3dhcmdzKQogICAgICAgIGFzc2VydCBhbGwoc2lsb19pbnB1dCBpbiBzY2F0dGVyX2dhdGhlcl9ib2R5LmlucHV0cyBmb3Igc2lsb19pbnB1dCBpbiBhZ2dyZWdhdGlvbl90b19zaWxvX2FyZ3VtZW50X21hcC52YWx1ZXMoKSkKICAgICAgICBhc3NlcnQgYWxsKGFnZ19vdXRwdXQgaW4gc2NhdHRlcl9nYXRoZXJfYm9keS5vdXRwdXRzIGZvciBhZ2dfb3V0cHV0IGluIGFnZ3JlZ2F0aW9uX3RvX3NpbG9fYXJndW1lbnRfbWFwKQo=",
      "StatusCode": 201,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Content-MD5": "Bf2zKM/VFLU1K2yMYkGmbw==",
        "Date": "Mon, 24 Apr 2023 03:22:27 GMT",
        "ETag": "\u00220x8DB447321A19D4E\u0022",
        "Last-Modified": "Mon, 24 Apr 2023 03:22:27 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-content-crc64": "nvRzTOL/DNw=",
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://samcw32zcnpjldw.blob.core.windows.net/azureml-blobstore-72e8eff8-148b-4582-a07d-efc79559f19f/LocalUpload/00000000000000000000000000000000/e2etests/test_dsl_pipeline_with_specific_nodes.py",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "12855",
        "Content-MD5": "1Eejn94qxLQlrgO40sYwwA==",
        "Content-Type": "application/octet-stream",
        "If-None-Match": "*",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)",
        "x-ms-blob-type": "BlockBlob",
        "x-ms-date": "Mon, 24 Apr 2023 03:22:25 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": "aW1wb3J0IG11bHRpcHJvY2Vzc2luZwppbXBvcnQgdXVpZApmcm9tIGZ1bmN0b29scyBpbXBvcnQgcGFydGlhbApmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKZnJvbSB0eXBpbmcgaW1wb3J0IENhbGxhYmxlLCBVbmlvbgoKaW1wb3J0IHB5dGVzdApmcm9tIGRldnRvb2xzX3Rlc3R1dGlscyBpbXBvcnQgQXp1cmVSZWNvcmRlZFRlc3RDYXNlCmZyb20gbW9jayBpbXBvcnQgbW9jawpmcm9tIHB5dGVzdF9tb2NrIGltcG9ydCBNb2NrRml4dHVyZQoKZnJvbSBhenVyZS5haS5tbC5vcGVyYXRpb25zLl9vcGVyYXRpb25fb3JjaGVzdHJhdG9yIGltcG9ydCBPcGVyYXRpb25PcmNoZXN0cmF0b3IKZnJvbSB0ZXN0X3V0aWxpdGllcy51dGlscyBpbXBvcnQgKAogICAgX1BZVEVTVF9USU1FT1VUX01FVEhPRCwKICAgIGFzc2VydF9qb2JfY2FuY2VsLAogICAgc3VibWl0X2FuZF9jYW5jZWxfbmV3X2RzbF9waXBlbGluZSwKICAgIG9taXRfd2l0aF93aWxkY2FyZCwKKQoKZnJvbSBhenVyZS5haS5tbCBpbXBvcnQgKAogICAgSW5wdXQsCiAgICBNTENsaWVudCwKICAgIGRzbCwKICAgIGxvYWRfY29tcG9uZW50LAopCmZyb20gYXp1cmUuYWkubWwuY29uc3RhbnRzLl9jb21tb24gaW1wb3J0IEFzc2V0VHlwZXMKZnJvbSBhenVyZS5haS5tbC5lbnRpdGllcyBpbXBvcnQgQ29tbWFuZENvbXBvbmVudCwgQ29tbWFuZCwgQ2hvaWNlLCBTd2VlcCwgQ29tcG9uZW50LCBFbnZpcm9ubWVudCwgUGlwZWxpbmVDb21wb25lbnQKZnJvbSBhenVyZS5haS5tbC5lbnRpdGllcyBpbXBvcnQgUGlwZWxpbmVKb2IKCmZyb20gLi5fdXRpbCBpbXBvcnQgX0RTTF9USU1FT1VUX1NFQ09ORAoKdGVzdHNfcm9vdF9kaXIgPSBQYXRoKF9fZmlsZV9fKS5wYXJlbnQucGFyZW50LnBhcmVudApjb21wb25lbnRzX2RpciA9IHRlc3RzX3Jvb3RfZGlyIC8gInRlc3RfY29uZmlncy9jb21wb25lbnRzLyIKam9iX2lucHV0ID0gSW5wdXQoCiAgICB0eXBlPUFzc2V0VHlwZXMuVVJJX0ZJTEUsCiAgICBwYXRoPSJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIsCikKZXhwZXJpbWVudF9uYW1lID0gImRzbF9waXBlbGluZV9lMmUiCmNvbW1vbl9vbWl0X2ZpZWxkcyA9IFsKICAgICJwcm9wZXJ0aWVzIiwKICAgICJkaXNwbGF5X25hbWUiLAogICAgImV4cGVyaW1lbnRfbmFtZSIsCiAgICAiam9icy4qLmNvbXBvbmVudElkIiwKICAgICJpbnB1dHMuKi51cmkiLAogICAgImpvYnMuKi5fc291cmNlIiwKICAgICJqb2JzLioucHJvcGVydGllcyIsCiAgICAic2V0dGluZ3MuX3NvdXJjZSIsCiAgICAic291cmNlX2pvYl9pZCIsCiAgICAic2VydmljZXMiLApdCgoKZGVmIF9nZXRfY29tcG9uZW50X2luX2ZpcnN0X2NoaWxkKF93aXRoX2pvYnM6IFVuaW9uW1BpcGVsaW5lSm9iLCBQaXBlbGluZUNvbXBvbmVudF0sIGNsaWVudDogTUxDbGllbnQpIC0\u002BIENvbXBvbmVudDoKICAgIGlmIG5vdCBfd2l0aF9qb2JzLmpvYnM6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiTm8gam9icyBmb3VuZCBpbiB0aGUgcGlwZWxpbmUiKQogICAgX3Jlc3VsdCA9IG5leHQoaXRlcihfd2l0aF9qb2JzLmpvYnMudmFsdWVzKCkpKS5jb21wb25lbnQuc3BsaXQoIjoiKQogICAgaWYgbGVuKF9yZXN1bHQpID09IDI6CiAgICAgICAgX25hbWUsIF92ZXJzaW9uID0gX3Jlc3VsdAogICAgZWxpZiBsZW4oX3Jlc3VsdCkgPT0gMzoKICAgICAgICBfLCBfbmFtZSwgX3ZlcnNpb24gPSBfcmVzdWx0CiAgICBlbHNlOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoIkludmFsaWQgY29tcG9uZW50IGFybSBzdHJpbmc6IHt9Ii5mb3JtYXQoX3Jlc3VsdCkpCiAgICByZXR1cm4gY2xpZW50LmNvbXBvbmVudHMuZ2V0KF9uYW1lLCBfdmVyc2lvbikKCgpAcHl0ZXN0Lm1hcmsudXNlZml4dHVyZXMoCiAgICAiZW5hYmxlX2Vudmlyb25tZW50X2lkX2FybV9leHBhbnNpb24iLAogICAgImVuYWJsZV9waXBlbGluZV9wcml2YXRlX3ByZXZpZXdfZmVhdHVyZXMiLAogICAgIm1vY2tfY29kZV9oYXNoIiwKICAgICJtb2NrX2NvbXBvbmVudF9oYXNoIiwKICAgICJtb2NrX3NldF9oZWFkZXJzX3dpdGhfdXNlcl9hbWxfdG9rZW4iLAogICAgInJlY29yZGVkX3Rlc3QiLAopCkBweXRlc3QubWFyay50aW1lb3V0KHRpbWVvdXQ9X0RTTF9USU1FT1VUX1NFQ09ORCwgbWV0aG9kPV9QWVRFU1RfVElNRU9VVF9NRVRIT0QpCkBweXRlc3QubWFyay5lMmV0ZXN0CkBweXRlc3QubWFyay5waXBlbGluZV90ZXN0CmNsYXNzIFRlc3REU0xQaXBlbGluZVdpdGhTcGVjaWZpY05vZGVzKEF6dXJlUmVjb3JkZWRUZXN0Q2FzZSk6CiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgX2dlbmVyYXRlX211bHRpX2xheWVyX3BpcGVsaW5lX2Z1bmMoKToKICAgICAgICBwYXRoID0gIi4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnQueW1sIgoKICAgICAgICBAZHNsLnBpcGVsaW5lCiAgICAgICAgZGVmIHBpcGVsaW5lX2xlYWYoY29tcG9uZW50X2luX3BhdGg6IElucHV0KToKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMxID0gbG9hZF9jb21wb25lbnQoc291cmNlPXBhdGgpCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMShjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5fcGF0aCwgY29tcG9uZW50X2luX251bWJlcj0xKQoKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMyID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgICAgICBzb3VyY2U9cGF0aCwKICAgICAgICAgICAgICAgIHBhcmFtc19vdmVycmlkZT1bCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJhbm90aGVyX2NvbXBvbmVudF9uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZlcnNpb24iOiAiYW5vdGhlcl9jb21wb25lbnRfdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgKQogICAgICAgICAgICBjb21wb25lbnRfZnVuYzIoY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2luX3BhdGgsIGNvbXBvbmVudF9pbl9udW1iZXI9MSkKCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMyA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICAgICAgc291cmNlPXBhdGgsIHBhcmFtc19vdmVycmlkZT1beyJlbnZpcm9ubWVudCI6ICJhenVyZW1sOkF6dXJlTUwtc2tsZWFybi0xLjAtdWJ1bnR1MjAuMDQtcHkzOC1jcHU6MzIifV0KICAgICAgICAgICAgKQogICAgICAgICAgICBjb21wb25lbnRfZnVuYzMoY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2luX3BhdGgsIGNvbXBvbmVudF9pbl9udW1iZXI9MSkKCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jNCA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1wYXRoKQogICAgICAgICAgICBjb21wb25lbnRfZnVuYzQuY29tbWFuZCArPSAiICYgZWNobyB1cGRhdGVkMSIKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmM0KGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbl9wYXRoLCBjb21wb25lbnRfaW5fbnVtYmVyPTEpCgogICAgICAgIEBkc2wucGlwZWxpbmUKICAgICAgICBkZWYgcGlwZWxpbmVfbWlkKGpvYl9pbl9wYXRoOiBJbnB1dCk6CiAgICAgICAgICAgIHBpcGVsaW5lX2xlYWYoam9iX2luX3BhdGgpCiAgICAgICAgICAgIHBpcGVsaW5lX2xlYWYoam9iX2luX3BhdGgpCgogICAgICAgIEBkc2wucGlwZWxpbmUKICAgICAgICBkZWYgcGlwZWxpbmVfcm9vdChqb2JfaW5fcGF0aDogSW5wdXQpOgogICAgICAgICAgICBwaXBlbGluZV9taWQoam9iX2luX3BhdGgpCiAgICAgICAgICAgIHBpcGVsaW5lX21pZChqb2JfaW5fcGF0aCkKCiAgICAgICAgcmV0dXJuIHBpcGVsaW5lX3Jvb3QKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgX2dlbmVyYXRlX3BpcGVsaW5lX2Z1bmNfZm9yX2NvbmN1cnJlbnRfY29tcG9uZW50X3JlZ2lzdHJhdGlvbl90ZXN0KHNoYXJlZF9pbnB1dCk6CiAgICAgICAgcGF0aCA9ICIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50LnltbCIKICAgICAgICBjb25kYV9maWxlX3BhdGggPSAiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvZW52aXJvbm1lbnQvZW52aXJvbm1lbnRfZmlsZXMvZW52aXJvbm1lbnQueW1sIgoKICAgICAgICBlbnZpcm9ubWVudCA9IEVudmlyb25tZW50KAogICAgICAgICAgICBuYW1lPSJ0ZXN0LWVudmlyb25tZW50IiwKICAgICAgICAgICAgY29uZGFfZmlsZT1jb25kYV9maWxlX3BhdGgsCiAgICAgICAgICAgIGltYWdlPSJtY3IubWljcm9zb2Z0LmNvbS9henVyZW1sL29wZW5tcGk0LjEuMC11YnVudHUyMC4wNCIsCiAgICAgICAgICAgIHZlcnNpb249IjIiLCAgIyBUT0RPOiBhbm9ueW1vdXMgZW52aXJvbm1lbnQgaGFzIHBvdGVudGlhbCB2ZXJzaW9uIGNvbmZsaWN0PwogICAgICAgICAgICBkZXNjcmlwdGlvbj0iVGhpcyBpcyBhbiBhbm9ueW1vdXMgZW52aXJvbm1lbnQiLAogICAgICAgICkKCiAgICAgICAgQGRzbC5waXBlbGluZQogICAgICAgIGRlZiBwaXBlbGluZV9sZWFmKCk6CiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMWEgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9cGF0aCkKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMxYS5lbnZpcm9ubWVudCA9IGVudmlyb25tZW50CiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMWEuY29tbWFuZCArPSAiICYgZWNobyB1cGRhdGVkMSIKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMxYShjb21wb25lbnRfaW5fcGF0aD1zaGFyZWRfaW5wdXQsIGNvbXBvbmVudF9pbl9udW1iZXI9MSkKCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMWIgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9cGF0aCkKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMxYi5lbnZpcm9ubWVudCA9IGVudmlyb25tZW50CiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMWIuY29tbWFuZCArPSAiICYgZWNobyB1cGRhdGVkMSIKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMxYihjb21wb25lbnRfaW5fcGF0aD1zaGFyZWRfaW5wdXQsIGNvbXBvbmVudF9pbl9udW1iZXI9MSkKCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMiA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1wYXRoKQogICAgICAgICAgICBjb21wb25lbnRfZnVuYzIuY29tbWFuZCArPSAiICYgZWNobyB1cGRhdGVkMiIKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMyLmVudmlyb25tZW50ID0gZW52aXJvbm1lbnQKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMyKGNvbXBvbmVudF9pbl9wYXRoPXNoYXJlZF9pbnB1dCwgY29tcG9uZW50X2luX251bWJlcj0xKQoKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMzID0gbG9hZF9jb21wb25lbnQoc291cmNlPXBhdGgpCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMy5jb21tYW5kICs9ICIgJiBlY2hvIHVwZGF0ZWQzIgogICAgICAgICAgICBjb21wb25lbnRfZnVuYzMuZW52aXJvbm1lbnQgPSBlbnZpcm9ubWVudAogICAgICAgICAgICBjb21wb25lbnRfZnVuYzMoY29tcG9uZW50X2luX3BhdGg9c2hhcmVkX2lucHV0LCBjb21wb25lbnRfaW5fbnVtYmVyPTEpCgogICAgICAgICMgVE9ETzogdGVzdCB3aXRoIG11bHRpcGxlIHBpcGVsaW5lcyBhZnRlciBzZXJ2ZXItc2lkZSByZXR1cm4gam9icyBmb3IgcGlwZWxpbmUgY29tcG9uZW50CiAgICAgICAgIyBAZHNsLnBpcGVsaW5lCiAgICAgICAgIyBkZWYgcGlwZWxpbmVfbWlkKCk6CiAgICAgICAgIyAgICAgcGlwZWxpbmVfbGVhZigpCiAgICAgICAgIyAgICAgcGlwZWxpbmVfbGVhZigpCiAgICAgICAgIwogICAgICAgICMgQGRzbC5waXBlbGluZQogICAgICAgICMgZGVmIHBpcGVsaW5lX3Jvb3QoKToKICAgICAgICAjICAgICBwaXBlbGluZV9taWQoKQogICAgICAgICMgICAgIHBpcGVsaW5lX21pZCgpCgogICAgICAgIHJldHVybiBwaXBlbGluZV9sZWFmCgogICAgZGVmIHRlc3RfZHNsX3BpcGVsaW5lX3N3ZWVwX25vZGUoc2VsZiwgY2xpZW50OiBNTENsaWVudCwgcmFuZHN0cjogQ2FsbGFibGVbW3N0cl0sIHN0cl0pIC0\u002BIE5vbmU6CiAgICAgICAgeWFtbF9maWxlID0gIi4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnQueW1sIgoKICAgICAgICBAZHNsLnBpcGVsaW5lCiAgICAgICAgZGVmIHRyYWluX3dpdGhfc3dlZXBfaW5fcGlwZWxpbmUocmF3X2RhdGEsIHByaW1hcnlfbWV0cmljOiBzdHIgPSAiQVVDIiwgbWF4X3RvdGFsX3RyaWFsczogaW50ID0gMTApOgogICAgICAgICAgICBjb21wb25lbnRfdG9fc3dlZXA6IENvbW1hbmRDb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9eWFtbF9maWxlKQogICAgICAgICAgICAjIHRvIGNoZWNrIHRoZSBsb2dpYyB0byBzZXQgZGVmYXVsdCBkaXNwbGF5IG5hbWUgZm9yIGNvbXBvbmVudHMKICAgICAgICAgICAgY29tcG9uZW50X3RvX3N3ZWVwLmRpc3BsYXlfbmFtZSA9IE5vbmUKCiAgICAgICAgICAgIGNtZF9ub2RlMTogQ29tbWFuZCA9IGNvbXBvbmVudF90b19zd2VlcCgKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9Q2hvaWNlKFsyLCAzLCA0LCA1XSksIGNvbXBvbmVudF9pbl9wYXRoPXJhd19kYXRhCiAgICAgICAgICAgICkKCiAgICAgICAgICAgIHN3ZWVwX2pvYjE6IFN3ZWVwID0gY21kX25vZGUxLnN3ZWVwKAogICAgICAgICAgICAgICAgcHJpbWFyeV9tZXRyaWM9IkFVQyIsICAjIHByaW1hcnlfbWV0cmljLAogICAgICAgICAgICAgICAgZ29hbD0ibWF4aW1pemUiLAogICAgICAgICAgICAgICAgc2FtcGxpbmdfYWxnb3JpdGhtPSJyYW5kb20iLAogICAgICAgICAgICApCiAgICAgICAgICAgIHN3ZWVwX2pvYjEuY29tcHV0ZSA9ICJncHUtY2x1c3RlciIKICAgICAgICAgICAgc3dlZXBfam9iMS5zZXRfbGltaXRzKG1heF90b3RhbF90cmlhbHM9MTApICAjIG1heF90b3RhbF90cmlhbHMKCiAgICAgICAgICAgIGNtZF9ub2RlMjogQ29tbWFuZCA9IGNvbXBvbmVudF90b19zd2VlcCgKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9Q2hvaWNlKFsyLCAzLCA0LCA1XSksIGNvbXBvbmVudF9pbl9wYXRoPXJhd19kYXRhCiAgICAgICAgICAgICkKICAgICAgICAgICAgc3dlZXBfam9iMjogU3dlZXAgPSBjbWRfbm9kZTIuc3dlZXAoCiAgICAgICAgICAgICAgICBwcmltYXJ5X21ldHJpYz0iQVVDIiwKICAgICAgICAgICAgICAgIGdvYWw9Im1pbmltaXplIiwKICAgICAgICAgICAgICAgIHNhbXBsaW5nX2FsZ29yaXRobT0icmFuZG9tIiwKICAgICAgICAgICAgICAgIG1heF90b3RhbF90cmlhbHM9MTAsCiAgICAgICAgICAgICkKICAgICAgICAgICAgc3dlZXBfam9iMi5jb21wdXRlID0gImdwdS1jbHVzdGVyIgoKICAgICAgICAgICAgc3dlZXBfam9iMzogU3dlZXAgPSBjb21wb25lbnRfdG9fc3dlZXAoCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyPUNob2ljZShbMiwgMywgNCwgNV0pLCBjb21wb25lbnRfaW5fcGF0aD1yYXdfZGF0YQogICAgICAgICAgICApLnN3ZWVwKAogICAgICAgICAgICAgICAgcHJpbWFyeV9tZXRyaWM9ImFjY3VyYWN5IiwKICAgICAgICAgICAgICAgIGdvYWw9Im1heGltaXplIiwKICAgICAgICAgICAgICAgIHNhbXBsaW5nX2FsZ29yaXRobT0icmFuZG9tIiwKICAgICAgICAgICAgICAgIG1heF90b3RhbF90cmlhbHM9MTAsCiAgICAgICAgICAgICkKCiAgICAgICAgICAgIGNvbXBvbmVudF90b19saW5rID0gbG9hZF9jb21wb25lbnQoc291cmNlPXlhbWxfZmlsZSwgcGFyYW1zX292ZXJyaWRlPVt7Im5hbWUiOiAibm9kZV90b19saW5rIn1dKQogICAgICAgICAgICBsaW5rX25vZGUgPSBjb21wb25lbnRfdG9fbGluaygKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9MiwgY29tcG9uZW50X2luX3BhdGg9c3dlZXBfam9iMS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aAogICAgICAgICAgICApCgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInBpcGVsaW5lX2pvYl9iZXN0X21vZGVsMSI6IHN3ZWVwX2pvYjEub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgsCiAgICAgICAgICAgICAgICAicGlwZWxpbmVfam9iX2Jlc3RfbW9kZWwyIjogc3dlZXBfam9iMi5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwKICAgICAgICAgICAgICAgICJwaXBlbGluZV9qb2JfYmVzdF9tb2RlbDMiOiBzd2VlcF9qb2IzLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLAogICAgICAgICAgICAgICAgInBpcGVsaW5lX21vZGVsX3Rlc3RfcmVzdWx0IjogbGlua19ub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLAogICAgICAgICAgICB9CgogICAgICAgIHBpcGVsaW5lOiBQaXBlbGluZUpvYiA9IHRyYWluX3dpdGhfc3dlZXBfaW5fcGlwZWxpbmUoCiAgICAgICAgICAgIHJhd19kYXRhPWpvYl9pbnB1dCwgbWF4X3RvdGFsX3RyaWFscz0xMDAsIHByaW1hcnlfbWV0cmljPSJhY2N1cmFjeSIKICAgICAgICApCiAgICAgICAgcGlwZWxpbmUuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImNwdS1jbHVzdGVyIgogICAgICAgIGNyZWF0ZWRfcGlwZWxpbmUgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQogICAgICAgIG5hbWUsIHZlcnNpb24gPSBjcmVhdGVkX3BpcGVsaW5lLmpvYnNbInN3ZWVwX2pvYjEiXS50cmlhbC5zcGxpdCgiOiIpCiAgICAgICAgY3JlYXRlZF9jb21wb25lbnQgPSBjbGllbnQuY29tcG9uZW50cy5nZXQobmFtZSwgdmVyc2lvbikKICAgICAgICAjIGtlZXAgb3JpZ2luYWwgY29tcG9uZW50IGRpc3BsYXkgbmFtZSB0byBndWFyYW50ZWUgcmV1c2UKICAgICAgICBhc3NlcnQgY3JlYXRlZF9jb21wb25lbnQuZGlzcGxheV9uYW1lIGlzIE5vbmUKCiAgICBkZWYgdGVzdF9kc2xfcGlwZWxpbmVfY29tcG9uZW50X2NhY2hlX2luX3Jlc29sdmVyKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgaW5wdXRfZGF0YV9wYXRoID0gIi4vdGVzdHMvdGVzdF9jb25maWdzL2RhdGEvIgogICAgICAgIHBpcGVsaW5lX3Jvb3QgPSBzZWxmLl9nZW5lcmF0ZV9tdWx0aV9sYXllcl9waXBlbGluZV9mdW5jKCkKCiAgICAgICAgX3N1Ym1pdF9hbmRfY2FuY2VsID0gcGFydGlhbCgKICAgICAgICAgICAgc3VibWl0X2FuZF9jYW5jZWxfbmV3X2RzbF9waXBlbGluZSwgY2xpZW50PWNsaWVudCwgam9iX2luX3BhdGg9SW5wdXQocGF0aD1pbnB1dF9kYXRhX3BhdGgpCiAgICAgICAgKQoKICAgICAgICBkZWYgX21vY2tfZ2V0X2NvbXBvbmVudF9hcm1faWQoX2NvbXBvbmVudDogQ29tcG9uZW50KSAtPiBzdHI6CiAgICAgICAgICAgICMgdGhlIGxvZ2ljIGhhcyBubyBkaWZmIGNvbXBhcmluZyB0byBvcmlnaW5hbCBmdW5jdGlvbiBvdGhlciB0aGFuIGFsd2F5cyB1c2luZyBzaG93X3Byb2dyZXNzPUZhbHNlCiAgICAgICAgICAgICMganVzdCB0byBtb2NrIHRoZSBmdW5jdGlvbiBhbmQgY2hlY2sgY2FsbCBpbmZvcm1hdGlvbgogICAgICAgICAgICBpZiBub3QgX2NvbXBvbmVudC5pZDoKICAgICAgICAgICAgICAgIF9jb21wb25lbnQuX2lkID0gY2xpZW50LmNvbXBvbmVudHMuY3JlYXRlX29yX3VwZGF0ZSgKICAgICAgICAgICAgICAgICAgICBfY29tcG9uZW50LCBpc19hbm9ueW1vdXM9VHJ1ZSwgc2hvd19wcm9ncmVzcz1GYWxzZQogICAgICAgICAgICAgICAgKS5pZAogICAgICAgICAgICByZXR1cm4gX2NvbXBvbmVudC5pZAoKICAgICAgICB3aXRoIG1vY2sucGF0Y2gub2JqZWN0KAogICAgICAgICAgICBPcGVyYXRpb25PcmNoZXN0cmF0b3IsICJfZ2V0X2NvbXBvbmVudF9hcm1faWQiLCBzaWRlX2VmZmVjdD1fbW9ja19nZXRfY29tcG9uZW50X2FybV9pZAogICAgICAgICkgYXMgbW9ja19yZXNvbHZlOgogICAgICAgICAgICBfc3VibWl0X2FuZF9jYW5jZWwocGlwZWxpbmVfcm9vdCkKICAgICAgICAgICAgIyBwaXBlbGluZV9sZWFmLCBwaXBlbGluZV9taWQgYW5kIDMgY29tbWFuZCBjb21wb25lbnRzIHdpbGwgYmUgcmVzb2x2ZWQKICAgICAgICAgICAgYXNzZXJ0IG1vY2tfcmVzb2x2ZS5jYWxsX2NvdW50ID09IDUKCiAgICAgICAgd2l0aCBtb2NrLnBhdGNoLm9iamVjdCgKICAgICAgICAgICAgT3BlcmF0aW9uT3JjaGVzdHJhdG9yLCAiX2dldF9jb21wb25lbnRfYXJtX2lkIiwgc2lkZV9lZmZlY3Q9X21vY2tfZ2V0X2NvbXBvbmVudF9hcm1faWQKICAgICAgICApIGFzIG1vY2tfcmVzb2x2ZToKICAgICAgICAgICAgX3N1Ym1pdF9hbmRfY2FuY2VsKHBpcGVsaW5lX3Jvb3QpCiAgICAgICAgICAgICMgbm8gbW9yZSByZXF1ZXN0cyB0byByZXNvbHZlIGNvbXBvbmVudHMgYXMgbG9jYWwgY2FjaGUgaXMgaGl0CiAgICAgICAgICAgIGFzc2VydCBtb2NrX3Jlc29sdmUuY2FsbF9jb3VudCA9PSAwCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBpcGVsaW5lX3Jvb3Qoam9iX2luX3BhdGg9SW5wdXQocGF0aD1pbnB1dF9kYXRhX3BhdGgpKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCiAgICAgICAgbGVhZl9zdWJncmFwaCA9IHBpcGVsaW5lX2pvYi5qb2JzWyJwaXBlbGluZV9taWQiXS5jb21wb25lbnQuam9ic1sicGlwZWxpbmVfbGVhZiJdLmNvbXBvbmVudAogICAgICAgIGxlYWZfc3ViZ3JhcGguam9ic1siYW5vdGhlcl9jb21wb25lbnRfbmFtZSJdLmNvbXBvbmVudC5jb21tYW5kICs9ICIgJiBlY2hvIHVwZGF0ZWQyIgogICAgICAgIHdpdGggbW9jay5wYXRjaC5vYmplY3QoCiAgICAgICAgICAgIE9wZXJhdGlvbk9yY2hlc3RyYXRvciwgIl9nZXRfY29tcG9uZW50X2FybV9pZCIsIHNpZGVfZWZmZWN0PV9tb2NrX2dldF9jb21wb25lbnRfYXJtX2lkCiAgICAgICAgKSBhcyBtb2NrX3Jlc29sdmU6CiAgICAgICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQogICAgICAgICAgICAjIHVwZGF0ZWQgY29tbWFuZCBjb21wb25lbnQgYW5kIGl0cyBwYXJlbnRzIChwaXBlbGluZV9sZWFmIGFuZCBwaXBlbGluZV9taWQpIHdpbGwgYmUgcmVzb2x2ZWQKICAgICAgICAgICAgYXNzZXJ0IG1vY2tfcmVzb2x2ZS5jYWxsX2NvdW50ID09IDMKCiAgICBkZWYgdGVzdF9kc2xfcGlwZWxpbmVfY29uY3VycmVudF9jb21wb25lbnRfcmVnaXN0cmF0aW9uKHNlbGYsIGNsaWVudDogTUxDbGllbnQsIG1vY2tlcjogTW9ja0ZpeHR1cmUpIC0\u002BIE5vbmU6CiAgICAgICAgIyBkaXNhYmxlIG9uLWRpc2sgY2FjaGUgdG8gdGVzdCBjb25jdXJyZW50IGNvbXBvbmVudCByZWdpc3RyYXRpb24KICAgICAgICBtb2NrZXIucGF0Y2goImF6dXJlLmFpLm1sLl91dGlscy51dGlscy5pc19vbl9kaXNrX2NhY2hlX2VuYWJsZWQiLCByZXR1cm5fdmFsdWU9RmFsc2UpCgogICAgICAgIGlucHV0X2RhdGFfcGF0aCA9ICIuL3Rlc3RzL3Rlc3RfY29uZmlncy9kYXRhLyIKICAgICAgICBwaXBlbGluZV9yb290ID0gc2VsZi5fZ2VuZXJhdGVfcGlwZWxpbmVfZnVuY19mb3JfY29uY3VycmVudF9jb21wb25lbnRfcmVnaXN0cmF0aW9uX3Rlc3QoCiAgICAgICAgICAgIHNoYXJlZF9pbnB1dD1JbnB1dChwYXRoPWlucHV0X2RhdGFfcGF0aCkKICAgICAgICApCgogICAgICAgIF9zdWJtaXRfYW5kX2NhbmNlbCA9IHBhcnRpYWwoCiAgICAgICAgICAgIHN1Ym1pdF9hbmRfY2FuY2VsX25ld19kc2xfcGlwZWxpbmUsCiAgICAgICAgICAgIGNsaWVudD1jbGllbnQsCiAgICAgICAgKQoKICAgICAgICB0cmVhdG1lbnRfcGlwZWxpbmVfam9iID0gX3N1Ym1pdF9hbmRfY2FuY2VsKHBpcGVsaW5lX3Jvb3QpCgogICAgICAgIHdpdGggbW9jay5wYXRjaCgiYXp1cmUuYWkubWwuX3V0aWxzLnV0aWxzLmlzX2NvbmN1cnJlbnRfY29tcG9uZW50X3JlZ2lzdHJhdGlvbl9lbmFibGVkIiwgcmV0dXJuX3ZhbHVlPUZhbHNlKToKICAgICAgICAgICAgYmFzZV9waXBlbGluZV9qb2IgPSBfc3VibWl0X2FuZF9jYW5jZWwocGlwZWxpbmVfcm9vdCkKCiAgICAgICAgIyBTZXJ2ZXItc2lkZSBkb2VzIG5vdCBndWFyYW50ZWUgdGhlIHNhbWUgYW5vbnltb3VzIHBpcGVsaW5lIGNvbXBvbmVudCBzaGFyZSB0aGUgc2FtZSB2ZXJzaW9uCiAgICAgICAgIyBTbyBvbWl0IG5hbWUgYW5kIHZlcnNpb24gYW5kIGRvIGNvbXBhcmlzb24gbGF5ZXIgYnkgbGF5ZXIKICAgICAgICBvbWl0X2ZpZWxkcyA9IFsiaWQiLCAibmFtZSIsICJ2ZXJzaW9uIiwgImNyZWF0aW9uX2NvbnRleHQiLCAic2VydmljZXMiLCAiam9icy4qLmNvbXBvbmVudCJdCgogICAgICAgIGJhc2UsIHRyZWF0ID0gYmFzZV9waXBlbGluZV9qb2IsIHRyZWF0bWVudF9waXBlbGluZV9qb2IKICAgICAgICAjIFRPRE86IHRlc3Qgd2l0aCBtdWx0aXBsZSBwaXBlbGluZXMgYWZ0ZXIgc2VydmVyLXNpZGUgcmV0dXJuIGpvYnMgZm9yIHBpcGVsaW5lIGNvbXBvbmVudAogICAgICAgIGZvciBfIGluIHJhbmdlKDAsIDApOgogICAgICAgICAgICBhc3NlcnQgb21pdF93aXRoX3dpbGRjYXJkKGJhc2UuX3RvX2RpY3QoKSwgKm9taXRfZmllbGRzKSA9PSBvbWl0X3dpdGhfd2lsZGNhcmQoCiAgICAgICAgICAgICAgICB0cmVhdC5fdG9fZGljdCgpLCAqb21pdF9maWVsZHMKICAgICAgICAgICAgKQogICAgICAgICAgICBiYXNlID0gX2dldF9jb21wb25lbnRfaW5fZmlyc3RfY2hpbGQoYmFzZSwgY2xpZW50KQogICAgICAgICAgICB0cmVhdCA9IF9nZXRfY29tcG9uZW50X2luX2ZpcnN0X2NoaWxkKHRyZWF0LCBjbGllbnQpCgogICAgICAgICMgVGhlIGxhc3QgbGF5ZXIgY29udGFpbnMgdGhlIGNvbW1hbmQgY29tcG9uZW50cwogICAgICAgIG9taXRfZmllbGRzLnBvcCgpCiAgICAgICAgYXNzZXJ0IG9taXRfd2l0aF93aWxkY2FyZChiYXNlLl90b19kaWN0KCksICpvbWl0X2ZpZWxkcykgPT0gb21pdF93aXRoX3dpbGRjYXJkKHRyZWF0Ll90b19kaWN0KCksICpvbWl0X2ZpZWxkcykK",
      "StatusCode": 201,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Content-MD5": "1Eejn94qxLQlrgO40sYwwA==",
        "Date": "Mon, 24 Apr 2023 03:22:27 GMT",
        "ETag": "\u00220x8DB447321B45F41\u0022",
        "Last-Modified": "Mon, 24 Apr 2023 03:22:28 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-content-crc64": "JlZ2Rw/sEnA=",
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://samcw32zcnpjldw.blob.core.windows.net/azureml-blobstore-72e8eff8-148b-4582-a07d-efc79559f19f/LocalUpload/00000000000000000000000000000000/e2etests/test_dsl_pipeline.py",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "156103",
        "Content-MD5": "I4y4Qh7esHSfKFgWjfBTwA==",
        "Content-Type": "application/octet-stream",
        "If-None-Match": "*",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)",
        "x-ms-blob-type": "BlockBlob",
        "x-ms-date": "Mon, 24 Apr 2023 03:22:25 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": "aW1wb3J0IGxvZ2dpbmcKZnJvbSBpbyBpbXBvcnQgU3RyaW5nSU8KZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmZyb20gdHlwaW5nIGltcG9ydCBDYWxsYWJsZQpmcm9tIHVuaXR0ZXN0Lm1vY2sgaW1wb3J0IHBhdGNoCgppbXBvcnQgcHlkYXNoCmltcG9ydCBweXRlc3QKZnJvbSBhenVyZS5haS5tbCBpbXBvcnQgKAogICAgQW1sVG9rZW5Db25maWd1cmF0aW9uLAogICAgSW5wdXQsCiAgICBNYW5hZ2VkSWRlbnRpdHlDb25maWd1cmF0aW9uLAogICAgTUxDbGllbnQsCiAgICBNcGlEaXN0cmlidXRpb24sCiAgICBPdXRwdXQsCiAgICBQeVRvcmNoRGlzdHJpYnV0aW9uLAogICAgVGVuc29yRmxvd0Rpc3RyaWJ1dGlvbiwKICAgIFVzZXJJZGVudGl0eUNvbmZpZ3VyYXRpb24sCiAgICBjb21tYW5kLAogICAgZHNsLAogICAgbG9hZF9jb21wb25lbnQsCikKZnJvbSBhenVyZS5haS5tbC5fdXRpbHMuX2FybV9pZF91dGlscyBpbXBvcnQgaXNfQVJNX2lkX2Zvcl9yZXNvdXJjZSwgaXNfc2luZ3VsYXJpdHlfaWRfZm9yX3Jlc291cmNlCmZyb20gYXp1cmUuYWkubWwuY29uc3RhbnRzLl9jb21tb24gaW1wb3J0ICgKICAgIEFOT05ZTU9VU19DT01QT05FTlRfTkFNRSwKICAgIEFzc2V0VHlwZXMsCiAgICBJbnB1dE91dHB1dE1vZGVzLAogICAgU0lOR1VMQVJJVFlfSURfRk9STUFULAopCmZyb20gYXp1cmUuYWkubWwuY29uc3RhbnRzLl9qb2IucGlwZWxpbmUgaW1wb3J0IFBpcGVsaW5lQ29uc3RhbnRzCmZyb20gYXp1cmUuYWkubWwuZHNsLl9ncm91cF9kZWNvcmF0b3IgaW1wb3J0IGdyb3VwCmZyb20gYXp1cmUuYWkubWwuZHNsLl9sb2FkX2ltcG9ydCBpbXBvcnQgdG9fY29tcG9uZW50CmZyb20gYXp1cmUuYWkubWwuZW50aXRpZXMgaW1wb3J0IENvbW1hbmRDb21wb25lbnQsIENvbW1hbmRKb2IKZnJvbSBhenVyZS5haS5tbC5lbnRpdGllcyBpbXBvcnQgQ29tcG9uZW50CmZyb20gYXp1cmUuYWkubWwuZW50aXRpZXMgaW1wb3J0IENvbXBvbmVudCBhcyBDb21wb25lbnRFbnRpdHkKZnJvbSBhenVyZS5haS5tbC5lbnRpdGllcyBpbXBvcnQgRGF0YSwgSm9iUmVzb3VyY2VDb25maWd1cmF0aW9uLCBQaXBlbGluZUpvYiwgUXVldWVTZXR0aW5ncwpmcm9tIGF6dXJlLmFpLm1sLmV4Y2VwdGlvbnMgaW1wb3J0IFVuZXhwZWN0ZWRLZXl3b3JkRXJyb3IsIFZhbGlkYXRpb25FeGNlcHRpb24KZnJvbSBhenVyZS5haS5tbC5wYXJhbGxlbCBpbXBvcnQgUGFyYWxsZWxKb2IsIFJ1bkZ1bmN0aW9uLCBwYXJhbGxlbF9ydW5fZnVuY3Rpb24KZnJvbSBkZXZ0b29sc190ZXN0dXRpbHMgaW1wb3J0IEF6dXJlUmVjb3JkZWRUZXN0Q2FzZSwgaXNfbGl2ZQpmcm9tIHBpcGVsaW5lX2pvYi5lMmV0ZXN0cy50ZXN0X3BpcGVsaW5lX2pvYiBpbXBvcnQgYXNzZXJ0X2pvYl9pbnB1dF9vdXRwdXRfdHlwZXMKZnJvbSB0ZXN0X3V0aWxpdGllcy51dGlscyBpbXBvcnQgX1BZVEVTVF9USU1FT1VUX01FVEhPRCwgYXNzZXJ0X2pvYl9jYW5jZWwsIG9taXRfd2l0aF93aWxkY2FyZCwgc2xlZXBfaWZfbGl2ZQoKZnJvbSAuLl91dGlsIGltcG9ydCBfRFNMX1RJTUVPVVRfU0VDT05ECgp0ZXN0c19yb290X2RpciA9IFBhdGgoX19maWxlX18pLnBhcmVudC5wYXJlbnQucGFyZW50CmNvbXBvbmVudHNfZGlyID0gdGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2NvbXBvbmVudHMvIgpqb2JfaW5wdXQgPSBJbnB1dCgKICAgIHR5cGU9QXNzZXRUeXBlcy5VUklfRklMRSwKICAgIHBhdGg9Imh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IiwKKQpleHBlcmltZW50X25hbWUgPSAiZHNsX3BpcGVsaW5lX2UyZSIKY29tbW9uX29taXRfZmllbGRzID0gWwogICAgInByb3BlcnRpZXMiLAogICAgImRpc3BsYXlfbmFtZSIsCiAgICAiZXhwZXJpbWVudF9uYW1lIiwKICAgICJqb2JzLiouY29tcG9uZW50SWQiLAogICAgImlucHV0cy4qLnVyaSIsCiAgICAiam9icy4qLl9zb3VyY2UiLAogICAgImpvYnMuKi5wcm9wZXJ0aWVzIiwKICAgICJzZXR0aW5ncy5fc291cmNlIiwKICAgICJzb3VyY2Vfam9iX2lkIiwKICAgICJzZXJ2aWNlcyIsCl0KCgpkZWYgY2hlY2tfbmFtZV9hbmRfdmVyc2lvbihvdXRwdXQsIG91dHB1dF9uYW1lLCBvdXRwdXRfdmVyc2lvbik6CiAgICBhc3NlcnQgb3V0cHV0Lm5hbWUgPT0gb3V0cHV0X25hbWUKICAgIGFzc2VydCBvdXRwdXQudmVyc2lvbiA9PSBvdXRwdXRfdmVyc2lvbgoKCmRlZiBidWlsZF9waXBlbGluZV93aXRoX3BhcmFsbGVsX3J1bl9mdW5jdGlvbihkYXRhLCBsaXRlcmFsX2lucHV0PU5vbmUpOgogICAgIyBjb21tYW5kIGpvYiB3aXRoIGRpY3QgZGlzdHJpYnV0aW9uCiAgICBlbnZpcm9ubWVudCA9ICJBenVyZU1MLXNrbGVhcm4tMS4wLXVidW50dTIwLjA0LXB5MzgtY3B1OjMzIgogICAgaW5wdXRzID0gewogICAgICAgICJqb2JfZGF0YV9wYXRoIjogSW5wdXQoCiAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5NTFRBQkxFLAogICAgICAgICAgICBwYXRoPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9kYXRhc2V0L21uaXN0LWRhdGEiLAogICAgICAgICAgICBtb2RlPUlucHV0T3V0cHV0TW9kZXMuRVZBTF9NT1VOVCwKICAgICAgICApLAogICAgICAgICJqb2JfZGF0YV9wYXRoX29wdGlvbmFsIjogSW5wdXQoCiAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5NTFRBQkxFLAogICAgICAgICAgICBtb2RlPUlucHV0T3V0cHV0TW9kZXMuRVZBTF9NT1VOVCwKICAgICAgICAgICAgb3B0aW9uYWw9VHJ1ZSwKICAgICAgICApLAogICAgfQogICAgaW5wdXRfZGF0YSA9ICIke3tpbnB1dHMuam9iX2RhdGFfcGF0aH19IgogICAgb3V0cHV0cyA9IHsiam9iX291dHB1dF9wYXRoIjogT3V0cHV0KHR5cGU9QXNzZXRUeXBlcy5VUklfRk9MREVSLCBtb2RlPSJyd19tb3VudCIpfQogICAgZXhwZWN0ZWRfcmVzb3VyY2VzID0geyJpbnN0YW5jZV9jb3VudCI6IDJ9CgogICAgdGFzayA9IFJ1bkZ1bmN0aW9uKAogICAgICAgIGNvZGU9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2RzbF9waXBlbGluZS9wYXJhbGxlbF9jb21wb25lbnRfd2l0aF9maWxlX2lucHV0L3NyYy8iLAogICAgICAgIGVudHJ5X3NjcmlwdD0ic2NvcmUucHkiLAogICAgICAgIHByb2dyYW1fYXJndW1lbnRzPSItLWpvYl9vdXRwdXRfcGF0aCAke3tvdXRwdXRzLmpvYl9vdXRwdXRfcGF0aH19IiwKICAgICAgICBlbnZpcm9ubWVudD1lbnZpcm9ubWVudCwKICAgICkKICAgIGxvZ2dpbmdfbGV2ZWwgPSAiREVCVUciCiAgICBtYXhfY29uY3VycmVuY3lfcGVyX2luc3RhbmNlID0gMQogICAgZXJyb3JfdGhyZXNob2xkID0gMQogICAgbWluaV9iYXRjaF9lcnJvcl90aHJlc2hvbGQgPSAxCiAgICBtaW5pX2JhdGNoX3NpemUgPSAiNSIKCiAgICAjIFBhcmFsbGVsIGZyb20gcGFyYWxsZWxfcnVuX2Z1bmN0aW9uKCkKICAgIHBhcmFsbGVsX2Z1bmN0aW9uID0gcGFyYWxsZWxfcnVuX2Z1bmN0aW9uKAogICAgICAgIGRpc3BsYXlfbmFtZT0ibXktZXZhbHVhdGUtam9iIiwKICAgICAgICBpbnB1dHM9aW5wdXRzLAogICAgICAgIG91dHB1dHM9b3V0cHV0cywKICAgICAgICBtaW5pX2JhdGNoX3NpemU9bWluaV9iYXRjaF9zaXplLAogICAgICAgIHRhc2s9dGFzaywKICAgICAgICBsb2dnaW5nX2xldmVsPWxvZ2dpbmdfbGV2ZWwsCiAgICAgICAgbWF4X2NvbmN1cnJlbmN5X3Blcl9pbnN0YW5jZT1tYXhfY29uY3VycmVuY3lfcGVyX2luc3RhbmNlLAogICAgICAgIGVycm9yX3RocmVzaG9sZD1lcnJvcl90aHJlc2hvbGQsCiAgICAgICAgbWluaV9iYXRjaF9lcnJvcl90aHJlc2hvbGQ9bWluaV9iYXRjaF9lcnJvcl90aHJlc2hvbGQsCiAgICAgICAgcmVzb3VyY2VzPWV4cGVjdGVkX3Jlc291cmNlcywKICAgICAgICBpbnB1dF9kYXRhPWlucHV0X2RhdGEsCiAgICApCiAgICBpZiBsaXRlcmFsX2lucHV0IGlzIE5vbmU6CgogICAgICAgIEBkc2wucGlwZWxpbmUoZXhwZXJpbWVudF9uYW1lPSJ0ZXN0X3BpcGVsaW5lX3dpdGhfcGFyYWxsZWxfZnVuY3Rpb24iLCBkZWZhdWx0X2NvbXB1dGU9ImNwdS1jbHVzdGVyIikKICAgICAgICBkZWYgcGFyYWxsZWxfaW5fcGlwZWxpbmUoam9iX2RhdGFfcGF0aCk6CiAgICAgICAgICAgIG5vZGUxID0gcGFyYWxsZWxfZnVuY3Rpb24oam9iX2RhdGFfcGF0aD1qb2JfZGF0YV9wYXRoKQogICAgICAgICAgICAjIFRPRE8gMjEwNDI0Nzogbm9kZTEudGFzayB3aWxsIGJlIGtlcHQgYXMgYSBsb2NhbCBwYXRoIHdoZW4gc3VibWl0dGluZyB0aGUgcGlwZWxpbmUgam9iLgogICAgICAgICAgICBub2RlMS50YXNrID0gTm9uZQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInBpcGVsaW5lX291dHB1dCI6IG5vZGUxLm91dHB1dHMuam9iX291dHB1dF9wYXRoLAogICAgICAgICAgICB9CgogICAgICAgIHJldHVybiBwYXJhbGxlbF9pbl9waXBlbGluZShkYXRhKQogICAgZWxzZToKCiAgICAgICAgQGRzbC5waXBlbGluZShleHBlcmltZW50X25hbWU9InRlc3RfcGlwZWxpbmVfd2l0aF9wYXJhbGxlbF9mdW5jdGlvbiIsIGRlZmF1bHRfY29tcHV0ZT0iY3B1LWNsdXN0ZXIiKQogICAgICAgIGRlZiBwYXJhbGxlbF9pbl9waXBlbGluZShqb2JfZGF0YV9wYXRoLCBsaXRlcmFsX2lucHV0KToKICAgICAgICAgICAgbm9kZTEgPSBwYXJhbGxlbF9mdW5jdGlvbihqb2JfZGF0YV9wYXRoPWpvYl9kYXRhX3BhdGgpCiAgICAgICAgICAgICMgVE9ETyAyMTA0MjQ3OiBub2RlMS50YXNrIHdpbGwgYmUga2VwdCBhcyBhIGxvY2FsIHBhdGggd2hlbiBzdWJtaXR0aW5nIHRoZSBwaXBlbGluZSBqb2IuCiAgICAgICAgICAgIG5vZGUxLnRhc2sgPSBOb25lCiAgICAgICAgICAgIG5vZGUxLnJlc291cmNlcy5pbnN0YW5jZV9jb3VudCA9IGxpdGVyYWxfaW5wdXQKICAgICAgICAgICAgbm9kZTEubWF4X2NvbmN1cnJlbmN5X3Blcl9pbnN0YW5jZSA9IGxpdGVyYWxfaW5wdXQKICAgICAgICAgICAgbm9kZTEuZXJyb3JfdGhyZXNob2xkID0gbGl0ZXJhbF9pbnB1dAogICAgICAgICAgICBub2RlMS5taW5pX2JhdGNoX2Vycm9yX3RocmVzaG9sZCA9IGxpdGVyYWxfaW5wdXQKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJwaXBlbGluZV9vdXRwdXQiOiBub2RlMS5vdXRwdXRzLmpvYl9vdXRwdXRfcGF0aCwKICAgICAgICAgICAgfQoKICAgICAgICByZXR1cm4gcGFyYWxsZWxfaW5fcGlwZWxpbmUoZGF0YSwgbGl0ZXJhbF9pbnB1dCkKCgpAcHl0ZXN0Lm1hcmsudXNlZml4dHVyZXMoCiAgICAiZW5hYmxlX2Vudmlyb25tZW50X2lkX2FybV9leHBhbnNpb24iLAogICAgImVuYWJsZV9waXBlbGluZV9wcml2YXRlX3ByZXZpZXdfZmVhdHVyZXMiLAogICAgImVuYWJsZV9wcml2YXRlX3ByZXZpZXdfc2NoZW1hX2ZlYXR1cmVzIiwKICAgICJtb2NrX2NvZGVfaGFzaCIsCiAgICAibW9ja19jb21wb25lbnRfaGFzaCIsCiAgICAibW9ja19zZXRfaGVhZGVyc193aXRoX3VzZXJfYW1sX3Rva2VuIiwKICAgICJyZWNvcmRlZF90ZXN0IiwKICAgICJtb2NrX2Fzc2V0X25hbWUiLAopCkBweXRlc3QubWFyay50aW1lb3V0KHRpbWVvdXQ9X0RTTF9USU1FT1VUX1NFQ09ORCwgbWV0aG9kPV9QWVRFU1RfVElNRU9VVF9NRVRIT0QpCkBweXRlc3QubWFyay5lMmV0ZXN0CkBweXRlc3QubWFyay5waXBlbGluZV90ZXN0CmNsYXNzIFRlc3REU0xQaXBlbGluZShBenVyZVJlY29yZGVkVGVzdENhc2UpOgogICAgZGVmIHRlc3RfY29tbWFuZF9jb21wb25lbnRfY3JlYXRlKHNlbGYsIGNsaWVudDogTUxDbGllbnQsIHJhbmRzdHI6IENhbGxhYmxlW1tzdHJdLCBzdHJdKSAtPiBOb25lOgogICAgICAgIGNvbXBvbmVudF95YW1sID0gY29tcG9uZW50c19kaXIgLyAiaGVsbG93b3JsZF9jb21wb25lbnQueW1sIgogICAgICAgIGNvbXBvbmVudF9mdW5jMSA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1jb21wb25lbnRfeWFtbCwgcGFyYW1zX292ZXJyaWRlPVt7Im5hbWUiOiByYW5kc3RyKCJjb21wb25lbnRfbmFtZSIpfV0pCiAgICAgICAgY29tcG9uZW50X2Z1bmMyID0gbG9hZF9jb21wb25lbnQoc291cmNlPWNvbXBvbmVudF95YW1sLCBwYXJhbXNfb3ZlcnJpZGU9W3sibmFtZSI6IHJhbmRzdHIoImNvbXBvbmVudF9uYW1lIil9XSkKCiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgbmFtZT1yYW5kc3RyKCJwaXBlbGluZV9uYW1lIiksCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJUaGUgaGVsbG8gd29ybGQgcGlwZWxpbmUgam9iIiwKICAgICAgICAgICAgdGFncz17Im93bmVyIjogInNka3RlYW0iLCAidGFnIjogInRhZ3ZhbHVlIn0sCiAgICAgICAgICAgIGNvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICAgICAgZXhwZXJpbWVudF9uYW1lPWV4cGVyaW1lbnRfbmFtZSwKICAgICAgICAgICAgY29udGludWVfb25fc3RlcF9mYWlsdXJlPVRydWUsCiAgICAgICAgKQogICAgICAgIGRlZiBwaXBlbGluZShqb2JfaW5fbnVtYmVyLCBqb2JfaW5fb3RoZXJfbnVtYmVyLCBqb2JfaW5fcGF0aCk6CiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMShjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQogICAgICAgICAgICBjb21wb25lbnRfZnVuYzIoY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fb3RoZXJfbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aCkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZSgxMCwgMTUsIGpvYl9pbnB1dCkKICAgICAgICBqb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lKQogICAgICAgICMgY2hlY2sgcmVxdWlyZWQgZmllbGRzIGluIGpvYiBkaWN0CiAgICAgICAgam9iX2RpY3QgPSBqb2IuX3RvX2RpY3QoKQogICAgICAgIGV4cGVjdGVkX2tleXMgPSBbInN0YXR1cyIsICJwcm9wZXJ0aWVzIiwgInRhZ3MiLCAiY3JlYXRpb25fY29udGV4dCJdCiAgICAgICAgZm9yIGsgaW4gZXhwZWN0ZWRfa2V5czoKICAgICAgICAgICAgYXNzZXJ0IGsgaW4gam9iX2RpY3Qua2V5cygpLCBmImZhaWxlZCB0byBnZXQge2t9IGluIHtqb2JfZGljdH0iCgogICAgICAgICMgb3JpZ2luYWwgam9iIGRpZCBub3QgY2hhbmdlCiAgICAgICAgYXNzZXJ0X2pvYl9pbnB1dF9vdXRwdXRfdHlwZXMoam9iKQogICAgICAgIGFzc2VydCBqb2Iuc2V0dGluZ3MuY29udGludWVfb25fc3RlcF9mYWlsdXJlIGlzIFRydWUKICAgICAgICBhc3NlcnQgam9iLmNvbXB1dGUgPT0gImNwdS1jbHVzdGVyIgoKICAgIGRlZiB0ZXN0X3BpcGVsaW5lX2pvYl9jcmVhdGVfd2l0aF9yZXNvbHZlX3JldXNlKHNlbGYsIGNsaWVudDogTUxDbGllbnQsIHJhbmRzdHI6IENhbGxhYmxlW1tzdHJdLCBzdHJdKSAtPiBOb25lOgogICAgICAgIGNvbXBvbmVudF95YW1sID0gY29tcG9uZW50c19kaXIgLyAiaGVsbG93b3JsZF9jb21wb25lbnQueW1sIgogICAgICAgIGNvbXBvbmVudF9mdW5jMTogQ29tbWFuZENvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1jb21wb25lbnRfeWFtbCkKICAgICAgICBjb21wb25lbnRfZnVuYzI6IENvbW1hbmRDb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Y29tcG9uZW50X3lhbWwpCiAgICAgICAgY29tcG9uZW50X2Z1bmMzOiBDb21tYW5kQ29tcG9uZW50ID0gY29tcG9uZW50X2Z1bmMxCgogICAgICAgIEBkc2wucGlwZWxpbmUoCiAgICAgICAgICAgIG5hbWU9cmFuZHN0cigicGlwZWxpbmVfbmFtZSIpLAogICAgICAgICAgICBkZXNjcmlwdGlvbj0iVGhlIGhlbGxvIHdvcmxkIHBpcGVsaW5lIGpvYiIsCiAgICAgICAgICAgIHRhZ3M9eyJvd25lciI6ICJzZGt0ZWFtIiwgInRhZyI6ICJ0YWd2YWx1ZSJ9LAogICAgICAgICAgICBjb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgICAgIGV4cGVyaW1lbnRfbmFtZT1leHBlcmltZW50X25hbWUsCiAgICAgICAgICAgIGNvbnRpbnVlX29uX3N0ZXBfZmFpbHVyZT1UcnVlLAogICAgICAgICkKICAgICAgICBkZWYgcGlwZWxpbmUoam9iX2luX251bWJlciwgam9iX2luX290aGVyX251bWJlciwgam9iX2luX3BhdGgpOgogICAgICAgICAgICBjb21wb25lbnRfZnVuYzEoY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aCkKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMzKGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX290aGVyX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9am9iX2luX3BhdGgpCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMShjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9vdGhlcl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQoKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMyKGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX290aGVyX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9am9iX2luX3BhdGgpCgogICAgICAgIGRzbF9waXBlbGluZSA9IHBpcGVsaW5lKDEwLCAxNSwgam9iX2lucHV0KQogICAgICAgIGNvbXBvbmVudF9pZF9zZXQgPSBzZXQobWFwKGxhbWJkYSB4OiBpZCh4LmNvbXBvbmVudCksIGRzbF9waXBlbGluZS5qb2JzLnZhbHVlcygpKSkKICAgICAgICBhc3NlcnQgbGVuKGNvbXBvbmVudF9pZF9zZXQpID09IDIKCiAgICAgICAgZm9yIGpvYl9pbnN0YW5jZSBpbiBkc2xfcGlwZWxpbmUuam9icy52YWx1ZXMoKToKICAgICAgICAgICAgYXNzZXJ0IGpvYl9pbnN0YW5jZS5jb21wb25lbnQuaWQgaXMgTm9uZSwgImNvbXBvbmVudCBpZCB3b24ndCBiZSByZXNvbHZlZCBiZWZvcmUgY3JlYXRlX29yX3VwZGF0ZSIKCiAgICAgICAgIyBUT0RPOiBuZWVkIGV4dHJhIG1vY2sgYmFzZWQgdGVzdHMgdG8gdmVyaWZ5IGlmIHRoZSBjb21wb25lbnQgaXMgcmVzb2x2ZWQgb25seSBvbmNlCiAgICAgICAgXyA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUoZHNsX3BpcGVsaW5lKQogICAgICAgIGZvciBqb2JfaW5zdGFuY2UgaW4gZHNsX3BpcGVsaW5lLmpvYnMudmFsdWVzKCk6CiAgICAgICAgICAgIGFzc2VydCAoCiAgICAgICAgICAgICAgICBpc2luc3RhbmNlKGpvYl9pbnN0YW5jZS5jb21wb25lbnQsIHN0cikgb3Igam9iX2luc3RhbmNlLmNvbXBvbmVudC5pZCBpcyBub3QgTm9uZQogICAgICAgICAgICApLCAiY29tcG9uZW50IGlkIHdpbGwgYmUgZmlsbGVkIGJhY2sgdG8gdGhlIGluc3RhbmNlIGR1cmluZyBjcmVhdGVfb3JfdXBkYXRlIgoKICAgIGRlZiB0ZXN0X2NvbW1hbmRfY29tcG9uZW50X2NyZWF0ZV93aXRoX291dHB1dChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50LCByYW5kc3RyOiBDYWxsYWJsZVtbc3RyXSwgc3RyXSkgLT4gTm9uZToKICAgICAgICBjb21wb25lbnRfeWFtbCA9IGNvbXBvbmVudHNfZGlyIC8gImhlbGxvd29ybGRfY29tcG9uZW50LnltbCIKICAgICAgICBjb21wb25lbnRfZnVuYzEgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Y29tcG9uZW50X3lhbWwsIHBhcmFtc19vdmVycmlkZT1beyJuYW1lIjogcmFuZHN0cigiY29tcG9uZW50X25hbWUiKX1dKQogICAgICAgIGNvbXBvbmVudF9mdW5jMiA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1jb21wb25lbnRfeWFtbCwgcGFyYW1zX292ZXJyaWRlPVt7Im5hbWUiOiByYW5kc3RyKCJjb21wb25lbnRfbmFtZSIpfV0pCgogICAgICAgIEBkc2wucGlwZWxpbmUoCiAgICAgICAgICAgIG5hbWU9cmFuZHN0cigicGlwZWxpbmVfbmFtZSIpLAogICAgICAgICAgICBkZXNjcmlwdGlvbj0iVGhlIGhlbGxvIHdvcmxkIHBpcGVsaW5lIGpvYiIsCiAgICAgICAgICAgIHRhZ3M9eyJvd25lciI6ICJzZGt0ZWFtIiwgInRhZyI6ICJ0YWd2YWx1ZSJ9LAogICAgICAgICAgICBjb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgKQogICAgICAgIGRlZiBwaXBlbGluZV93aXRoX291dHB1dChqb2JfaW5fbnVtYmVyLCBqb2JfaW5fb3RoZXJfbnVtYmVyLCBqb2JfaW5fcGF0aCk6CiAgICAgICAgICAgIG5vZGUxID0gY29tcG9uZW50X2Z1bmMxKGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9am9iX2luX3BhdGgpCgogICAgICAgICAgICBub2RlMiA9IGNvbXBvbmVudF9mdW5jMigKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX290aGVyX251bWJlciwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9wYXRoPW5vZGUxLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLAogICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiB7ImpvYl9vdXRfZGF0YSI6IG5vZGUyLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRofQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX3dpdGhfb3V0cHV0KDEwLCAxNSwgam9iX2lucHV0KQogICAgICAgIHBpcGVsaW5lLm91dHB1dHMuam9iX291dF9kYXRhID0gT3V0cHV0KGRhdGFzZXQ9RGF0YShuYW1lPSJkc2xfcGlwZWxpbmVfb3V0cHV0IiwgdmVyc2lvbj0iMSIpKQogICAgICAgIGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUsIGV4cGVyaW1lbnRfbmFtZT1leHBlcmltZW50X25hbWUpCgogICAgZGVmIHRlc3RfY29tbWFuZF9jb21wb25lbnRfY3JlYXRlX2Zyb21fcmVtb3RlKAogICAgICAgIHNlbGYsCiAgICAgICAgY2xpZW50OiBNTENsaWVudCwKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnQ6IENvbXBvbmVudEVudGl0eSwKICAgICAgICByYW5kc3RyOiBDYWxsYWJsZVtbc3RyXSwgc3RyXSwKICAgICkgLT4gTm9uZToKICAgICAgICBjb21wb25lbnRfZnVuYyA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICBjbGllbnQ9Y2xpZW50LAogICAgICAgICAgICBuYW1lPWhlbGxvX3dvcmxkX2NvbXBvbmVudC5uYW1lLAogICAgICAgICAgICB2ZXJzaW9uPWhlbGxvX3dvcmxkX2NvbXBvbmVudC52ZXJzaW9uLAogICAgICAgICkKCiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgbmFtZT1yYW5kc3RyKCJwaXBlbGluZV9uYW1lIiksCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJUaGUgaGVsbG8gd29ybGQgcGlwZWxpbmUgam9iIiwKICAgICAgICAgICAgdGFncz17Im93bmVyIjogInNka3RlYW0iLCAidGFnIjogInRhZ3ZhbHVlIn0sCiAgICAgICAgICAgIGNvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICApCiAgICAgICAgZGVmIHBpcGVsaW5lX3JlbW90ZV9jb21wb25lbnQoam9iX2luX251bWJlciwgam9iX2luX290aGVyX251bWJlciwgam9iX2luX3BhdGgpOgogICAgICAgICAgICBub2RlMSA9IGNvbXBvbmVudF9mdW5jKGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9am9iX2luX3BhdGgpCiAgICAgICAgICAgICMgdW4tY29uZmlndXJlZCBkYXRhIGJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZAogICAgICAgICAgICBub2RlMS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCA9IE91dHB1dChkYXRhc2V0PURhdGEobmFtZT0ibWxkZXNpZ25lcl9jb21wb25lbnRfb3V0cHV0IikpCgogICAgICAgICAgICBub2RlMiA9IGNvbXBvbmVudF9mdW5jKAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fb3RoZXJfbnVtYmVyLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9bm9kZTEub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgsCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIHsiam9iX291dF9kYXRhIjogbm9kZTIub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9CgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmVfcmVtb3RlX2NvbXBvbmVudCgxMCwgMTUsIGpvYl9pbnB1dCkKICAgICAgICBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lLCBleHBlcmltZW50X25hbWU9ZXhwZXJpbWVudF9uYW1lKQoKICAgIGRlZiB0ZXN0X2NvbXBvbmVudF9sb2FkX2Zyb21fcmVtb3RlKHNlbGYsIGNsaWVudDogTUxDbGllbnQsIGhlbGxvX3dvcmxkX2NvbXBvbmVudDogQ29tcG9uZW50RW50aXR5KSAtPiBOb25lOgogICAgICAgIGNvbXBvbmVudF9mdW5jID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgIGNsaWVudD1jbGllbnQsCiAgICAgICAgICAgIG5hbWU9aGVsbG9fd29ybGRfY29tcG9uZW50Lm5hbWUsCiAgICAgICAgICAgIHZlcnNpb249aGVsbG9fd29ybGRfY29tcG9uZW50LnZlcnNpb24sCiAgICAgICAgKQoKICAgICAgICBjb21wb25lbnRfbm9kZSA9IGNvbXBvbmVudF9mdW5jKGNvbXBvbmVudF9pbl9udW1iZXI9MTAsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbnB1dCkKCiAgICAgICAgY29tcG9uZW50X2pvYl9kaWN0ID0gY29tcG9uZW50X25vZGUuX3RvX3Jlc3Rfb2JqZWN0KCkKICAgICAgICBhc3NlcnQgaXNfQVJNX2lkX2Zvcl9yZXNvdXJjZShjb21wb25lbnRfam9iX2RpY3RbImNvbXBvbmVudElkIl0pCiAgICAgICAgb21pdF9maWVsZHMgPSBbImNvbXBvbmVudElkIiwgIl9zb3VyY2UiLCAicHJvcGVydGllcyJdCiAgICAgICAgY29tcG9uZW50X2pvYl9kaWN0ID0gcHlkYXNoLm9taXQoY29tcG9uZW50X2pvYl9kaWN0LCAqb21pdF9maWVsZHMpCiAgICAgICAgYXNzZXJ0IGNvbXBvbmVudF9qb2JfZGljdCA9PSB7CiAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX251bWJlciI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIxMCJ9LAogICAgICAgICAgICAgICAgImNvbXBvbmVudF9pbl9wYXRoIjogewogICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJ1cmlfZmlsZSIsCiAgICAgICAgICAgICAgICAgICAgInVyaSI6ICJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICAicmVzb3VyY2VzIjogeyJpbnN0YW5jZV9jb3VudCI6IDF9LAogICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICB9CgogICAgZGVmIHRlc3RfZGlzdHJpYnV0aW9uX2NvbXBvbmVudHMoc2VsZiwgY2xpZW50OiBNTENsaWVudCwgcmFuZHN0cjogQ2FsbGFibGVbW3N0cl0sIHN0cl0pIC0\u002BIE5vbmU6CiAgICAgICAgbXBpX2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9c3RyKGNvbXBvbmVudHNfZGlyIC8gImhlbGxvd29ybGRfY29tcG9uZW50X21waS55bWwiKSkKICAgICAgICBweXRvcmNoX2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9c3RyKGNvbXBvbmVudHNfZGlyIC8gImhlbGxvd29ybGRfY29tcG9uZW50X3B5dG9yY2gueW1sIikpCiAgICAgICAgdGVuc29yZmxvd19mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPXN0cihjb21wb25lbnRzX2RpciAvICJoZWxsb3dvcmxkX2NvbXBvbmVudF90ZW5zb3JmbG93LnltbCIpKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBuYW1lPXJhbmRzdHIoInBpcGVsaW5lX25hbWUiKSwKICAgICAgICAgICAgZGVzY3JpcHRpb249IlRoZSBoZWxsbyB3b3JsZCBwaXBlbGluZSBqb2IiLAogICAgICAgICAgICB0YWdzPXsib3duZXIiOiAic2RrdGVhbSIsICJ0YWciOiAidGFndmFsdWUifSwKICAgICAgICAgICAgY29tcHV0ZT0iZ3B1LWNsdXN0ZXIiLAogICAgICAgICAgICBleHBlcmltZW50X25hbWU9ZXhwZXJpbWVudF9uYW1lLAogICAgICAgICkKICAgICAgICBkZWYgcGlwZWxpbmVfZGlzdHJpYnV0aW9uX2NvbXBvbmVudHMoam9iX2luX251bWJlciwgam9iX2luX3BhdGgpOgogICAgICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfbXBpID0gbXBpX2Z1bmMoY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aCkKICAgICAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X21waS5kaXN0cmlidXRpb24gPSBNcGlEaXN0cmlidXRpb24oKQogICAgICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfbXBpLmRpc3RyaWJ1dGlvbi5wcm9jZXNzX2NvdW50X3Blcl9pbnN0YW5jZSA9IDIKCiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9weXRvcmNoID0gcHl0b3JjaF9mdW5jKAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aAogICAgICAgICAgICApCiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9weXRvcmNoLmRpc3RyaWJ1dGlvbiA9IFB5VG9yY2hEaXN0cmlidXRpb24oKQogICAgICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfcHl0b3JjaC5kaXN0cmlidXRpb24ucHJvY2Vzc19jb3VudF9wZXJfaW5zdGFuY2UgPSAyCgogICAgICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfdGVuc29yZmxvdyA9IHRlbnNvcmZsb3dfZnVuYygKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9am9iX2luX3BhdGgKICAgICAgICAgICAgKQogICAgICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfdGVuc29yZmxvdy5kaXN0cmlidXRpb24gPSBUZW5zb3JGbG93RGlzdHJpYnV0aW9uKCkKICAgICAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X3RlbnNvcmZsb3cuZGlzdHJpYnV0aW9uLndvcmtlcl9jb3VudCA9IDIKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV9kaXN0cmlidXRpb25fY29tcG9uZW50cygxMCwgam9iX2lucHV0KQogICAgICAgIGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUsIGV4cGVyaW1lbnRfbmFtZT1leHBlcmltZW50X25hbWUpCgogICAgZGVmIHRlc3RfY29tcG9uZW50X3dpdGhfYmluZGluZyhzZWxmLCBjbGllbnQ6IE1MQ2xpZW50LCByYW5kc3RyOiBDYWxsYWJsZVtbc3RyXSwgc3RyXSk6CiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X3lhbWwgPSBzdHIoY29tcG9uZW50c19kaXIgLyAiaGVsbG93b3JsZF9jb21wb25lbnQueW1sIikKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1oZWxsb193b3JsZF9jb21wb25lbnRfeWFtbCkKCiAgICAgICAgbWVyZ2Vfb3V0cHV0c19jb21wb25lbnRfeWFtbCA9IHN0cihjb21wb25lbnRzX2RpciAvICJtZXJnZV9vdXRwdXRzX2NvbXBvbmVudC55bWwiKQogICAgICAgIG1lcmdlX291dHB1dHNfY29tcG9uZW50X2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9bWVyZ2Vfb3V0cHV0c19jb21wb25lbnRfeWFtbCkKCiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgbmFtZT1yYW5kc3RyKCJwaXBlbGluZV9uYW1lIiksCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJUaGUgaGVsbG8gd29ybGQgcGlwZWxpbmUgam9iIiwKICAgICAgICAgICAgdGFncz17Im93bmVyIjogInNka3RlYW0iLCAidGFnIjogInRhZ3ZhbHVlIn0sCiAgICAgICAgICAgIGNvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICApCiAgICAgICAgZGVmIHBpcGVsaW5lX3dpdGhfYmluZGluZyhqb2JfaW5fbnVtYmVyLCBqb2JfaW5fb3RoZXJfbnVtYmVyLCBqb2JfaW5fcGF0aCk6CiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF8xID0gaGVsbG9fd29ybGRfY29tcG9uZW50X2Z1bmMoCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoCiAgICAgICAgICAgICkKICAgICAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50XzIgPSBoZWxsb193b3JsZF9jb21wb25lbnRfZnVuYygKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9am9iX2luX3BhdGgKICAgICAgICAgICAgKQoKICAgICAgICAgICAgIyBjb25maWd1cmUgY29tcG9uZW50IG92ZXJyaWRlcywgY3VyYXRlZCBTREsgbm90IHN1cHBvcnRlZCB5ZXQKICAgICAgICAgICAgIyBoZWxsb193b3JsZF9jb21wb25lbnRfMi5yZXNvdXJjZXMuaW5zdGFuY2VfY291bnQgPSAyCgogICAgICAgICAgICAjIGNvbmZpZ3VyZSBjb21wb25lbnQgb3V0cHV0cwogICAgICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfMS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aC5tb2RlID0gIlVwbG9hZCIKICAgICAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50XzIub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgubW9kZSA9ICJVcGxvYWQiCgogICAgICAgICAgICBtZXJnZV9jb21wb25lbnRfb3V0cHV0cyA9IG1lcmdlX291dHB1dHNfY29tcG9uZW50X2Z1bmMoCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9vdGhlcl9udW1iZXIsCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fcGF0aF8xPWhlbGxvX3dvcmxkX2NvbXBvbmVudF8xLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGhfMj1oZWxsb193b3JsZF9jb21wb25lbnRfMi5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgImpvYl9vdXRfZGF0YV8xIjogbWVyZ2VfY29tcG9uZW50X291dHB1dHMub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGhfMSwKICAgICAgICAgICAgICAgICJqb2Jfb3V0X2RhdGFfMiI6IG1lcmdlX2NvbXBvbmVudF9vdXRwdXRzLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoXzIsCiAgICAgICAgICAgIH0KCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV93aXRoX2JpbmRpbmcoMTAsIDE2LCBqb2JfaW5wdXQpCiAgICAgICAgY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZSgKICAgICAgICAgICAgcGlwZWxpbmUsCiAgICAgICAgICAgIGV4cGVyaW1lbnRfbmFtZT0iZHNsX3BpcGVsaW5lX2UyZSIsCiAgICAgICAgKQoKICAgIGRlZiB0ZXN0X2RhdGFfaW5wdXQoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBwYXJlbnRfZGlyID0gc3RyKHRlc3RzX3Jvb3RfZGlyIC8gInRlc3RfY29uZmlncy9kc2xfcGlwZWxpbmUvbnljX3RheGlfZGF0YV9yZWdyZXNzaW9uIikKCiAgICAgICAgZGVmIGdlbmVyYXRlX2RzbF9waXBlbGluZSgpOgogICAgICAgICAgICAjIDEuIExvYWQgY29tcG9uZW50IGZ1bmNzCiAgICAgICAgICAgIHByZXBfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1wYXJlbnRfZGlyICsgIi9wcmVwLnltbCIpCiAgICAgICAgICAgIHRyYW5zZm9ybV9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPXBhcmVudF9kaXIgKyAiL3RyYW5zZm9ybS55bWwiKQogICAgICAgICAgICB0cmFpbl9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPXBhcmVudF9kaXIgKyAiL3RyYWluLnltbCIpCiAgICAgICAgICAgIHByZWRpY3RfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1wYXJlbnRfZGlyICsgIi9wcmVkaWN0LnltbCIpCiAgICAgICAgICAgIHNjb3JlX2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9cGFyZW50X2RpciArICIvc2NvcmUueW1sIikKCiAgICAgICAgICAgICMgMi4gQ29uc3RydWN0IHBpcGVsaW5lCiAgICAgICAgICAgIEBkc2wucGlwZWxpbmUoY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLCBkZWZhdWx0X2RhdGFzdG9yZT0id29ya3NwYWNlYmxvYnN0b3JlIikKICAgICAgICAgICAgZGVmIHNhbXBsZV9waXBlbGluZShwaXBlbGluZV9qb2JfaW5wdXQpOgogICAgICAgICAgICAgICAgcHJlcF9qb2IgPSBwcmVwX2Z1bmMocmF3X2RhdGE9cGlwZWxpbmVfam9iX2lucHV0KQogICAgICAgICAgICAgICAgdHJhbnNmb3JtX2pvYiA9IHRyYW5zZm9ybV9mdW5jKGNsZWFuX2RhdGE9cHJlcF9qb2Iub3V0cHV0cy5wcmVwX2RhdGEpCiAgICAgICAgICAgICAgICB0cmFpbl9qb2IgPSB0cmFpbl9mdW5jKHRyYWluaW5nX2RhdGE9dHJhbnNmb3JtX2pvYi5vdXRwdXRzLnRyYW5zZm9ybWVkX2RhdGEpCiAgICAgICAgICAgICAgICBwcmVkaWN0X2pvYiA9IHByZWRpY3RfZnVuYygKICAgICAgICAgICAgICAgICAgICBtb2RlbF9pbnB1dD10cmFpbl9qb2Iub3V0cHV0cy5tb2RlbF9vdXRwdXQsCiAgICAgICAgICAgICAgICAgICAgdGVzdF9kYXRhPXRyYWluX2pvYi5vdXRwdXRzLnRlc3RfZGF0YSwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHNjb3JlX2pvYiA9IHNjb3JlX2Z1bmMoCiAgICAgICAgICAgICAgICAgICAgcHJlZGljdGlvbnM9cHJlZGljdF9qb2Iub3V0cHV0cy5wcmVkaWN0aW9ucywKICAgICAgICAgICAgICAgICAgICBtb2RlbD10cmFpbl9qb2Iub3V0cHV0cy5tb2RlbF9vdXRwdXQsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICJwaXBlbGluZV9qb2JfcHJlcHBlZF9kYXRhIjogcHJlcF9qb2Iub3V0cHV0cy5wcmVwX2RhdGEsCiAgICAgICAgICAgICAgICAgICAgInBpcGVsaW5lX2pvYl90cmFuc2Zvcm1lZF9kYXRhIjogdHJhbnNmb3JtX2pvYi5vdXRwdXRzLnRyYW5zZm9ybWVkX2RhdGEsCiAgICAgICAgICAgICAgICAgICAgInBpcGVsaW5lX2pvYl90cmFpbmVkX21vZGVsIjogdHJhaW5fam9iLm91dHB1dHMubW9kZWxfb3V0cHV0LAogICAgICAgICAgICAgICAgICAgICJwaXBlbGluZV9qb2JfdGVzdF9kYXRhIjogdHJhaW5fam9iLm91dHB1dHMudGVzdF9kYXRhLAogICAgICAgICAgICAgICAgICAgICJwaXBlbGluZV9qb2JfcHJlZGljdGlvbnMiOiBwcmVkaWN0X2pvYi5vdXRwdXRzLnByZWRpY3Rpb25zLAogICAgICAgICAgICAgICAgICAgICJwaXBlbGluZV9qb2Jfc2NvcmVfcmVwb3J0Ijogc2NvcmVfam9iLm91dHB1dHMuc2NvcmVfcmVwb3J0LAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgcGlwZWxpbmUgPSBzYW1wbGVfcGlwZWxpbmUoSW5wdXQodHlwZT1Bc3NldFR5cGVzLlVSSV9GT0xERVIsIHBhdGg9cGFyZW50X2RpciArICIvZGF0YS8iKSkKICAgICAgICAgICAgcGlwZWxpbmUub3V0cHV0cy5waXBlbGluZV9qb2JfcHJlcHBlZF9kYXRhLmRhdGEgPSAiL3ByZXBwZWRfZGF0YSIKICAgICAgICAgICAgcGlwZWxpbmUub3V0cHV0cy5waXBlbGluZV9qb2JfcHJlcHBlZF9kYXRhLm1vZGUgPSAicndfbW91bnQiCiAgICAgICAgICAgIHBpcGVsaW5lLm91dHB1dHMucGlwZWxpbmVfam9iX3RyYW5zZm9ybWVkX2RhdGEuZGF0YSA9ICIvdHJhbnNmb3JtZWRfZGF0YSIKICAgICAgICAgICAgcGlwZWxpbmUub3V0cHV0cy5waXBlbGluZV9qb2JfdHJhbnNmb3JtZWRfZGF0YS5tb2RlID0gInJ3X21vdW50IgogICAgICAgICAgICBwaXBlbGluZS5vdXRwdXRzLnBpcGVsaW5lX2pvYl90cmFpbmVkX21vZGVsLmRhdGEgPSAiL3RyYWluZWQtbW9kZWwiCiAgICAgICAgICAgIHBpcGVsaW5lLm91dHB1dHMucGlwZWxpbmVfam9iX3RyYWluZWRfbW9kZWwubW9kZSA9ICJyd19tb3VudCIKICAgICAgICAgICAgcGlwZWxpbmUub3V0cHV0cy5waXBlbGluZV9qb2JfdGVzdF9kYXRhLmRhdGEgPSAiL3Rlc3RfZGF0YSIKICAgICAgICAgICAgcGlwZWxpbmUub3V0cHV0cy5waXBlbGluZV9qb2JfdGVzdF9kYXRhLm1vZGUgPSAicndfbW91bnQiCiAgICAgICAgICAgIHBpcGVsaW5lLm91dHB1dHMucGlwZWxpbmVfam9iX3ByZWRpY3Rpb25zLmRhdGEgPSAiL3ByZWRpY3Rpb25zIgogICAgICAgICAgICBwaXBlbGluZS5vdXRwdXRzLnBpcGVsaW5lX2pvYl9wcmVkaWN0aW9ucy5tb2RlID0gInJ3X21vdW50IgogICAgICAgICAgICBwaXBlbGluZS5vdXRwdXRzLnBpcGVsaW5lX2pvYl9zY29yZV9yZXBvcnQuZGF0YSA9ICIvcmVwb3J0IgogICAgICAgICAgICBwaXBlbGluZS5vdXRwdXRzLnBpcGVsaW5lX2pvYl9zY29yZV9yZXBvcnQubW9kZSA9ICJyd19tb3VudCIKICAgICAgICAgICAgcmV0dXJuIHBpcGVsaW5lCgogICAgICAgICMgY3JlYXRlIHBpcGVsaW5lIGluc3RhbmNlCiAgICAgICAgcGlwZWxpbmUgPSBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUoKQogICAgICAgICMgc3VibWl0IGpvYiB0byB3b3Jrc3BhY2UKICAgICAgICBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKAogICAgICAgICAgICBwaXBlbGluZSwKICAgICAgICAgICAgZXhwZXJpbWVudF9uYW1lPSJueWNfdGF4aV9kYXRhX3JlZ3Jlc3Npb24iLAogICAgICAgICkKCiAgICBkZWYgdGVzdF9jb21tYW5kX2Z1bmN0aW9uKHNlbGYsIHJhbmRzdHI6IENhbGxhYmxlW1tzdHJdLCBzdHJdLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfeWFtbCA9IHN0cihjb21wb25lbnRzX2RpciAvICJoZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiKQogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPWhlbGxvX3dvcmxkX2NvbXBvbmVudF95YW1sKQogICAgICAgICMgdXBkYXRlIGNvbXBvbmVudCBkaXNwbGF5IG5hbWUgdG8gd29yayBhcm91bmQgc2FtZSBjb21wb25lbnQgcmVnaXN0ZXIgbXVsdGlwbGUgdGltZSBpc3N1ZQogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9mdW5jLmRpc3BsYXlfbmFtZSA9ICJ0ZXN0X2NvbW1hbmRfZnVuY3Rpb25fbm9kZSIKCiAgICAgICAgZW52aXJvbm1lbnQgPSAiQXp1cmVNTC1za2xlYXJuLTEuMC11YnVudHUyMC4wNC1weTM4LWNwdTozMyIKICAgICAgICBkaXN0cmlidXRpb24gPSB7InR5cGUiOiAiUHl0b3JjaCIsICJwcm9jZXNzX2NvdW50X3Blcl9pbnN0YW5jZSI6IDJ9CiAgICAgICAgcmVzb3VyY2VzID0geyJpbnN0YW5jZV9jb3VudCI6IDJ9CiAgICAgICAgZW52aXJvbm1lbnRfdmFyaWFibGVzID0geyJlbnZpcm9uIjogInZhbCJ9CiAgICAgICAgaW5wdXRzID0gewogICAgICAgICAgICAiY29tcG9uZW50X2luX3BhdGgiOiBJbnB1dCh0eXBlPSJ1cmlfZm9sZGVyIiwgcGF0aD0iaHR0cHM6Ly9teS1ibG9iL3BhdGgvdG8vZGF0YSIsIG1vZGU9InJvX21vdW50IiksCiAgICAgICAgICAgICJjb21wb25lbnRfaW5fbnVtYmVyIjogMC4wMSwKICAgICAgICB9CiAgICAgICAgb3V0cHV0cyA9IHsiY29tcG9uZW50X291dF9wYXRoIjogT3V0cHV0KHR5cGU9Im1sZmxvd19tb2RlbCIsIG1vZGU9InJ3X21vdW50Iil9CgogICAgICAgIEBkc2wucGlwZWxpbmUoCiAgICAgICAgICAgIG5hbWU9cmFuZHN0cigicGlwZWxpbmVfbmFtZSIpLAogICAgICAgICAgICBkZXNjcmlwdGlvbj0iVGhlIGhlbGxvIHdvcmxkIHBpcGVsaW5lIGpvYiIsCiAgICAgICAgICAgIHRhZ3M9eyJvd25lciI6ICJzZGt0ZWFtIiwgInRhZyI6ICJ0YWd2YWx1ZSJ9LAogICAgICAgICAgICBjb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgKQogICAgICAgIGRlZiBtaXhlZF9waXBlbGluZShqb2JfaW5fbnVtYmVyLCBqb2JfaW5fcGF0aCk6CiAgICAgICAgICAgIGNvbW1hbmRfam9iID0gQ29tbWFuZEpvYigKICAgICAgICAgICAgICAgIGRpc3BsYXlfbmFtZT0iY29tbWFuZC1qb2IiLAogICAgICAgICAgICAgICAgZW52aXJvbm1lbnQ9ZW52aXJvbm1lbnQsCiAgICAgICAgICAgICAgICBjb21tYW5kPSdlY2hvICJoZWxsbyB3b3JsZCInLAogICAgICAgICAgICAgICAgZGlzdHJpYnV0aW9uPWRpc3RyaWJ1dGlvbiwKICAgICAgICAgICAgICAgIHJlc291cmNlcz1yZXNvdXJjZXMsCiAgICAgICAgICAgICAgICBlbnZpcm9ubWVudF92YXJpYWJsZXM9ZW52aXJvbm1lbnRfdmFyaWFibGVzLAogICAgICAgICAgICAgICAgaW5wdXRzPWlucHV0cywKICAgICAgICAgICAgICAgIG91dHB1dHM9b3V0cHV0cywKICAgICAgICAgICAgKQogICAgICAgICAgICBjb21tYW5kX2pvYl9mdW5jID0gdG9fY29tcG9uZW50KGpvYj1jb21tYW5kX2pvYikKCiAgICAgICAgICAgICMgQ29tbWFuZCBmcm9tIGNvbW1hbmQoKSBmdW5jdGlvbgogICAgICAgICAgICBjb21tYW5kX2Z1bmN0aW9uID0gY29tbWFuZCgKICAgICAgICAgICAgICAgIGRpc3BsYXlfbmFtZT0iY29tbWFuZC1mdW5jdGlvbi1qb2IiLAogICAgICAgICAgICAgICAgZW52aXJvbm1lbnQ9ZW52aXJvbm1lbnQsCiAgICAgICAgICAgICAgICBjb21tYW5kPSdlY2hvICJoZWxsbyB3b3JsZCInLAogICAgICAgICAgICAgICAgZGlzdHJpYnV0aW9uPWRpc3RyaWJ1dGlvbiwKICAgICAgICAgICAgICAgIHJlc291cmNlcz1yZXNvdXJjZXMsCiAgICAgICAgICAgICAgICBlbnZpcm9ubWVudF92YXJpYWJsZXM9ZW52aXJvbm1lbnRfdmFyaWFibGVzLAogICAgICAgICAgICAgICAgaW5wdXRzPWlucHV0cywKICAgICAgICAgICAgICAgIG91dHB1dHM9b3V0cHV0cywKICAgICAgICAgICAgKQoKICAgICAgICAgICAgbm9kZTEgPSBoZWxsb193b3JsZF9jb21wb25lbnRfZnVuYyhjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQogICAgICAgICAgICBub2RlMiA9IGNvbW1hbmRfam9iX2Z1bmMoCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fcGF0aD1ub2RlMS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9MiwKICAgICAgICAgICAgKQogICAgICAgICAgICBub2RlMyA9IGNvbW1hbmRfZnVuY3Rpb24oCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fcGF0aD1ub2RlMi5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9MywKICAgICAgICAgICAgKQoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJwaXBlbGluZV9qb2Jfb3V0Ijogbm9kZTMub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgsCiAgICAgICAgICAgIH0KCiAgICAgICAgcGlwZWxpbmUgPSBtaXhlZF9waXBlbGluZSgxNiwgam9iX2lucHV0KQogICAgICAgICMgc3VibWl0IGpvYiB0byB3b3Jrc3BhY2UKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKAogICAgICAgICAgICBwaXBlbGluZSwKICAgICAgICAgICAgZXhwZXJpbWVudF9uYW1lPSJtaXhlZF9waXBlbGluZSIsCiAgICAgICAgKQogICAgICAgIGFjdHVhbF9qb2IgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLnByb3BlcnRpZXMuYXNfZGljdCgpLCAqY29tbW9uX29taXRfZmllbGRzKQogICAgICAgIGV4cGVjdGVkX2pvYiA9IHsKICAgICAgICAgICAgInRhZ3MiOiB7Im93bmVyIjogInNka3RlYW0iLCAidGFnIjogInRhZ3ZhbHVlIn0sCiAgICAgICAgICAgICJjb21wdXRlX2lkIjogImNwdS1jbHVzdGVyIiwKICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogIlRoZSBoZWxsbyB3b3JsZCBwaXBlbGluZSBqb2IiLAogICAgICAgICAgICAiaXNfYXJjaGl2ZWQiOiBGYWxzZSwKICAgICAgICAgICAgImpvYl90eXBlIjogIlBpcGVsaW5lIiwKICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICJqb2JfaW5fbnVtYmVyIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjE2In0sCiAgICAgICAgICAgICAgICAiam9iX2luX3BhdGgiOiB7CiAgICAgICAgICAgICAgICAgICAgIm1vZGUiOiAiUmVhZE9ubHlNb3VudCIsCiAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogInVyaV9maWxlIiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJqb2JzIjogewogICAgICAgICAgICAgICAgIm5vZGUxIjogewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImNvbW1hbmQiLAogICAgICAgICAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fbnVtYmVyIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuam9iX2luX251bWJlcn19IiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9pbl9wYXRoIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuam9iX2luX3BhdGh9fSJ9LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAibm9kZTEiLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJub2RlMiI6IHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgICAgICAgICAiZGlzdHJpYnV0aW9uIjogeyJkaXN0cmlidXRpb25fdHlwZSI6ICJQeVRvcmNoIiwgInByb2Nlc3NfY291bnRfcGVyX2luc3RhbmNlIjogMn0sCiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9pbl9udW1iZXIiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMiJ9LAogICAgICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX3BhdGgiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmpvYnMubm9kZTEub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJub2RlMiIsCiAgICAgICAgICAgICAgICAgICAgInJlc291cmNlcyI6IHsiaW5zdGFuY2VfY291bnQiOiAyfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibm9kZTMiOiB7CiAgICAgICAgICAgICAgICAgICAgImRpc3BsYXlfbmFtZSI6ICJjb21tYW5kLWZ1bmN0aW9uLWpvYiIsCiAgICAgICAgICAgICAgICAgICAgImRpc3RyaWJ1dGlvbiI6IHsiZGlzdHJpYnV0aW9uX3R5cGUiOiAiUHlUb3JjaCIsICJwcm9jZXNzX2NvdW50X3Blcl9pbnN0YW5jZSI6IDJ9LAogICAgICAgICAgICAgICAgICAgICJlbnZpcm9ubWVudF92YXJpYWJsZXMiOiB7ImVudmlyb24iOiAidmFsIn0sCiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9pbl9udW1iZXIiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX3BhdGgiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmpvYnMubm9kZTIub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJub2RlMyIsCiAgICAgICAgICAgICAgICAgICAgIm91dHB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfb3V0X3BhdGgiOiB7InR5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy5waXBlbGluZV9qb2Jfb3V0fX0ifQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgInJlc291cmNlcyI6IHsiaW5zdGFuY2VfY291bnQiOiAyfSwKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJvdXRwdXRzIjogewogICAgICAgICAgICAgICAgInBpcGVsaW5lX2pvYl9vdXQiOiB7CiAgICAgICAgICAgICAgICAgICAgIm1vZGUiOiAiUmVhZFdyaXRlTW91bnQiLAogICAgICAgICAgICAgICAgICAgICJqb2Jfb3V0cHV0X3R5cGUiOiAibWxmbG93X21vZGVsIiwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgInNldHRpbmdzIjoge30sCiAgICAgICAgfQogICAgICAgIGFzc2VydCBleHBlY3RlZF9qb2IgPT0gYWN0dWFsX2pvYgoKICAgIGRlZiB0ZXN0X2NvbW1hbmRfd2l0aF9vcHRpb25hbF9pbnB1dHMoc2VsZiwgcmFuZHN0cjogQ2FsbGFibGVbW3N0cl0sIHN0cl0sIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF95YW1sID0gc3RyKGNvbXBvbmVudHNfZGlyIC8gImhlbGxvd29ybGRfY29tcG9uZW50X3dpdGhfb3B0aW9uYWxfaW5wdXRzLnltbCIpCiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9aGVsbG9fd29ybGRfY29tcG9uZW50X3lhbWwpCiAgICAgICAgY29tbWFuZF9mdW5jID0gY29tbWFuZCgKICAgICAgICAgICAgbmFtZT1mInRlc3Rfb3B0aW9uYWxfaW5wdXRfY29tcG9uZW50XyIgKyByYW5kc3RyKCJjb21wb25lbnRfbmFtZSIpLAogICAgICAgICAgICBkaXNwbGF5X25hbWU9ImNvbW1hbmRfd2l0aF9vcHRpb25hbF9pbnB1dHMiLAogICAgICAgICAgICBlbnZpcm9ubWVudD0iQXp1cmVNTC1za2xlYXJuLTEuMC11YnVudHUyMC4wNC1weTM4LWNwdTozMyIsCiAgICAgICAgICAgIGNvbW1hbmQ9KAogICAgICAgICAgICAgICAgJ2VjaG8gImhlbGxvIHdvcmxkIiAnCiAgICAgICAgICAgICAgICAiJiBlY2hvICRbWyR7e2lucHV0cy5mbG9hdH19XV0gIgogICAgICAgICAgICAgICAgIiYgZWNobyAkW1ske3tpbnB1dHMuaW50ZWdlcn19XV0gIgogICAgICAgICAgICAgICAgIiYgZWNobyAkW1ske3tpbnB1dHMuc3RyaW5nfX1dXSAiCiAgICAgICAgICAgICAgICAiJiBlY2hvICRbWyR7e2lucHV0cy5ib29sZWFufX1dXSAiCiAgICAgICAgICAgICAgICAiJiBlY2hvICR7e2lucHV0cy51cmlfZm9sZGVyfX0gIgogICAgICAgICAgICAgICAgIiYgZWNobyAkW1ske3tpbnB1dHMub3B0aW9uYWxfMH19XV0gIgogICAgICAgICAgICAgICAgIiYgZWNobyAkW1ske3tpbnB1dHMub3B0aW9uYWxfMX19XV0iCiAgICAgICAgICAgICAgICAiJiBlY2hvICRbWyR7e2lucHV0cy5vcHRpb25hbF8yfX1dXSIKICAgICAgICAgICAgKSwKICAgICAgICAgICAgZGlzdHJpYnV0aW9uPXsidHlwZSI6ICJQeXRvcmNoIiwgInByb2Nlc3NfY291bnRfcGVyX2luc3RhbmNlIjogMn0sCiAgICAgICAgICAgIHJlc291cmNlcz17Imluc3RhbmNlX2NvdW50IjogMn0sCiAgICAgICAgICAgIGVudmlyb25tZW50X3ZhcmlhYmxlcz17ImVudmlyb24iOiAidmFsIn0sCiAgICAgICAgICAgIGlucHV0cz17CiAgICAgICAgICAgICAgICAiZmxvYXQiOiBJbnB1dCh0eXBlPSJudW1iZXIiLCBkZWZhdWx0PTEuMSwgbWluPTAsIG1heD01LCBvcHRpb25hbD1UcnVlKSwKICAgICAgICAgICAgICAgICJpbnRlZ2VyIjogSW5wdXQodHlwZT0iaW50ZWdlciIsIGRlZmF1bHQ9MiwgbWluPS0xLCBtYXg9NCwgb3B0aW9uYWw9VHJ1ZSksCiAgICAgICAgICAgICAgICAic3RyaW5nIjogSW5wdXQodHlwZT0ic3RyaW5nIiwgZGVmYXVsdD0iZGVmYXVsdF9zdHIiLCBvcHRpb25hbD1UcnVlKSwKICAgICAgICAgICAgICAgICJib29sZWFuIjogSW5wdXQodHlwZT0iYm9vbGVhbiIsIGRlZmF1bHQ9RmFsc2UsIG9wdGlvbmFsPVRydWUpLAogICAgICAgICAgICAgICAgInVyaV9mb2xkZXIiOiBJbnB1dCh0eXBlPSJ1cmlfZm9sZGVyIiksCiAgICAgICAgICAgICAgICAib3B0aW9uYWxfMCI6IElucHV0KHR5cGU9InVyaV9maWxlIiwgb3B0aW9uYWw9VHJ1ZSksCiAgICAgICAgICAgICAgICAib3B0aW9uYWxfMSI6IElucHV0KHR5cGU9Im51bWJlciIsIG9wdGlvbmFsPVRydWUpLAogICAgICAgICAgICAgICAgIm9wdGlvbmFsXzIiOiBJbnB1dCh0eXBlPSJudW1iZXIiLCBvcHRpb25hbD1UcnVlLCBkZWZhdWx0PTEuMiksCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG91dHB1dHM9eyJjb21wb25lbnRfb3V0X3BhdGgiOiBPdXRwdXQodHlwZT0idXJpX2ZvbGRlciIpfSwKICAgICAgICApCgogICAgICAgIGNvbXBvbmVudCA9IGNsaWVudC5jb21wb25lbnRzLmNyZWF0ZV9vcl91cGRhdGUoY29tbWFuZF9mdW5jLmNvbXBvbmVudCkKICAgICAgICBhc3NlcnQgY29tcG9uZW50IGFuZCBjb21wb25lbnQudmVyc2lvbiA9PSAiMSIKCiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgbmFtZT1mInRlc3Rfb3B0aW9uYWxfaW5wdXRfY29tcG9uZW50X3BpcGVsaW5lXyIgKyByYW5kc3RyKCJwaXBlbGluZV9uYW1lIiksCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJUaGUgY29tbWFuZCBub2RlIHdpdGggb3B0aW9uYWwgaW5wdXRzIiwKICAgICAgICAgICAgdGFncz17Im93bmVyIjogInNka3RlYW0iLCAidGFnIjogInRhZ3ZhbHVlIn0sCiAgICAgICAgICAgIGNvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICApCiAgICAgICAgZGVmIHNhbXBsZV9waXBlbGluZShqb2JfaW5fZmlsZSk6CiAgICAgICAgICAgIG5vZGUxID0gaGVsbG9fd29ybGRfY29tcG9uZW50X2Z1bmMoY29tcG9uZW50X2luX3BhdGg9am9iX2luX2ZpbGUpCiAgICAgICAgICAgIG5vZGUyID0gY29tbWFuZF9mdW5jKHVyaV9mb2xkZXI9bm9kZTEub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgpCgogICAgICAgICAgICByZXR1cm4geyJwaXBlbGluZV9vdXRwdXQiOiBub2RlMi5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH0KCiAgICAgICAgcGlwZWxpbmUgPSBzYW1wbGVfcGlwZWxpbmUoCiAgICAgICAgICAgIElucHV0KHR5cGU9InVyaV9maWxlIiwgcGF0aD0iaHR0cHM6Ly9kcHJlcGRhdGEuYmxvYi5jb3JlLndpbmRvd3MubmV0L2RlbW8vVGl0YW5pYy5jc3YiKQogICAgICAgICkKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lKQoKICAgICAgICBhY3R1YWxfam9iID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5wcm9wZXJ0aWVzLmFzX2RpY3QoKSwgKmNvbW1vbl9vbWl0X2ZpZWxkcykKICAgICAgICBleHBlY3RlZF9qb2IgPSB7CiAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJUaGUgY29tbWFuZCBub2RlIHdpdGggb3B0aW9uYWwgaW5wdXRzIiwKICAgICAgICAgICAgInRhZ3MiOiB7Im93bmVyIjogInNka3RlYW0iLCAidGFnIjogInRhZ3ZhbHVlIn0sCiAgICAgICAgICAgICJjb21wdXRlX2lkIjogImNwdS1jbHVzdGVyIiwKICAgICAgICAgICAgImlzX2FyY2hpdmVkIjogRmFsc2UsCiAgICAgICAgICAgICJqb2JfdHlwZSI6ICJQaXBlbGluZSIsCiAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAiam9iX2luX2ZpbGUiOiB7CiAgICAgICAgICAgICAgICAgICAgIm1vZGUiOiAiUmVhZE9ubHlNb3VudCIsCiAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogInVyaV9maWxlIiwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgImpvYnMiOiB7CiAgICAgICAgICAgICAgICAibm9kZTEiOiB7CiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9pbl9wYXRoIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuam9iX2luX2ZpbGV9fSJ9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJub2RlMSIsCiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm5vZGUyIjogewogICAgICAgICAgICAgICAgICAgICJkaXNwbGF5X25hbWUiOiAiY29tbWFuZF93aXRoX29wdGlvbmFsX2lucHV0cyIsCiAgICAgICAgICAgICAgICAgICAgImRpc3RyaWJ1dGlvbiI6IHsiZGlzdHJpYnV0aW9uX3R5cGUiOiAiUHlUb3JjaCIsICJwcm9jZXNzX2NvdW50X3Blcl9pbnN0YW5jZSI6IDJ9LAogICAgICAgICAgICAgICAgICAgICJlbnZpcm9ubWVudF92YXJpYWJsZXMiOiB7ImVudmlyb24iOiAidmFsIn0sCiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgInVyaV9mb2xkZXIiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmpvYnMubm9kZTEub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIm5vZGUyIiwKICAgICAgICAgICAgICAgICAgICAib3V0cHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHsidHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5vdXRwdXRzLnBpcGVsaW5lX291dHB1dH19In0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJyZXNvdXJjZXMiOiB7Imluc3RhbmNlX2NvdW50IjogMn0sCiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICAib3V0cHV0cyI6IHsicGlwZWxpbmVfb3V0cHV0IjogeyJtb2RlIjogIlJlYWRXcml0ZU1vdW50IiwgImpvYl9vdXRwdXRfdHlwZSI6ICJ1cmlfZm9sZGVyIn19LAogICAgICAgICAgICAic2V0dGluZ3MiOiB7fSwKICAgICAgICB9CiAgICAgICAgYXNzZXJ0IGV4cGVjdGVkX2pvYiA9PSBhY3R1YWxfam9iCgogICAgZGVmIHRlc3Rfc3Bhcmtfd2l0aF9vcHRpb25hbF9pbnB1dHMoc2VsZiwgcmFuZHN0cjogQ2FsbGFibGVbW3N0cl0sIHN0cl0sIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGNvbXBvbmVudF95YW1sID0gIi4vdGVzdHMvdGVzdF9jb25maWdzL2RzbF9waXBlbGluZS9zcGFya19qb2JfaW5fcGlwZWxpbmUvY29tcG9uZW50X3dpdGhfb3B0aW9uYWxfaW5wdXRzLnltbCIKICAgICAgICBzcGFya193aXRoX29wdGlvbmFsX2lucHV0c19jb21wb25lbnRfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1jb21wb25lbnRfeWFtbCkKCiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgbmFtZT1mInRlc3Rfb3B0aW9uYWxfaW5wdXRfY29tcG9uZW50X3BpcGVsaW5lXyIgKyByYW5kc3RyKCJwaXBlbGluZV9uYW1lIiksCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJUaGUgc3Bhcmsgbm9kZSB3aXRoIG9wdGlvbmFsIGlucHV0cyIsCiAgICAgICAgICAgIHRhZ3M9eyJvd25lciI6ICJzZGt0ZWFtIiwgInRhZyI6ICJ0YWd2YWx1ZSJ9LAogICAgICAgICkKICAgICAgICBkZWYgc2FtcGxlX3BpcGVsaW5lKGpvYl9pbl9maWxlLCBzYW1wbGVfcmF0ZSk6CiAgICAgICAgICAgIG5vZGUxID0gc3Bhcmtfd2l0aF9vcHRpb25hbF9pbnB1dHNfY29tcG9uZW50X2Z1bmMoaW5wdXQxPWpvYl9pbl9maWxlLCBzYW1wbGVfcmF0ZT1zYW1wbGVfcmF0ZSkKICAgICAgICAgICAgbm9kZTEucmVzb3VyY2VzID0geyJpbnN0YW5jZV90eXBlIjogInN0YW5kYXJkX2U0c192MyIsICJydW50aW1lX3ZlcnNpb24iOiAiMy4yLjAifQogICAgICAgICAgICByZXR1cm4geyJwaXBlbGluZV9vdXRwdXQiOiBub2RlMS5vdXRwdXRzLm91dHB1dDF9CgogICAgICAgIHBpcGVsaW5lID0gc2FtcGxlX3BpcGVsaW5lKAogICAgICAgICAgICBqb2JfaW5fZmlsZT1JbnB1dCgKICAgICAgICAgICAgICAgIHBhdGg9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2RzbF9waXBlbGluZS9zcGFya19qb2JfaW5fcGlwZWxpbmUvZGF0YXNldC9zaGFrZXNwZWFyZS50eHQiLAogICAgICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLlVSSV9GSUxFLAogICAgICAgICAgICAgICAgbW9kZT1JbnB1dE91dHB1dE1vZGVzLkRJUkVDVCwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgc2FtcGxlX3JhdGU9MC4wMSwKICAgICAgICApCiAgICAgICAgcGlwZWxpbmUub3V0cHV0cy5waXBlbGluZV9vdXRwdXQubW9kZSA9IElucHV0T3V0cHV0TW9kZXMuRElSRUNUCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSkKCiAgICAgICAgYWN0dWFsX2pvYiA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkucHJvcGVydGllcy5hc19kaWN0KCksICpjb21tb25fb21pdF9maWVsZHMpCiAgICAgICAgZXhwZWN0ZWRfam9iID0gewogICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiVGhlIHNwYXJrIG5vZGUgd2l0aCBvcHRpb25hbCBpbnB1dHMiLAogICAgICAgICAgICAidGFncyI6IHsib3duZXIiOiAic2RrdGVhbSIsICJ0YWciOiAidGFndmFsdWUifSwKICAgICAgICAgICAgImlzX2FyY2hpdmVkIjogRmFsc2UsCiAgICAgICAgICAgICJqb2JfdHlwZSI6ICJQaXBlbGluZSIsCiAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAiam9iX2luX2ZpbGUiOiB7ImpvYl9pbnB1dF90eXBlIjogInVyaV9maWxlIiwgIm1vZGUiOiAiRGlyZWN0In0sCiAgICAgICAgICAgICAgICAic2FtcGxlX3JhdGUiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMC4wMSJ9LAogICAgICAgICAgICB9LAogICAgICAgICAgICAiam9icyI6IHsKICAgICAgICAgICAgICAgICJub2RlMSI6IHsKICAgICAgICAgICAgICAgICAgICAiYXJncyI6ICItLWlucHV0MSAke3tpbnB1dHMuaW5wdXQxfX0gLS1vdXRwdXQyICIKICAgICAgICAgICAgICAgICAgICAiJHt7b3V0cHV0cy5vdXRwdXQxfX0gLS1teV9zYW1wbGVfcmF0ZSAiCiAgICAgICAgICAgICAgICAgICAgIiR7e2lucHV0cy5zYW1wbGVfcmF0ZX19ICRbWy0taW5wdXRfb3B0aW9uYWwgIgogICAgICAgICAgICAgICAgICAgICIke3tpbnB1dHMuaW5wdXRfb3B0aW9uYWx9fV1dIiwKICAgICAgICAgICAgICAgICAgICAiY29uZiI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgInNwYXJrLmRyaXZlci5jb3JlcyI6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICJzcGFyay5kcml2ZXIubWVtb3J5IjogIjJnIiwKICAgICAgICAgICAgICAgICAgICAgICAgInNwYXJrLmR5bmFtaWNBbGxvY2F0aW9uLmVuYWJsZWQiOiBUcnVlLAogICAgICAgICAgICAgICAgICAgICAgICAic3BhcmsuZHluYW1pY0FsbG9jYXRpb24ubWF4RXhlY3V0b3JzIjogNCwKICAgICAgICAgICAgICAgICAgICAgICAgInNwYXJrLmR5bmFtaWNBbGxvY2F0aW9uLm1pbkV4ZWN1dG9ycyI6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICJzcGFyay5leGVjdXRvci5jb3JlcyI6IDIsCiAgICAgICAgICAgICAgICAgICAgICAgICJzcGFyay5leGVjdXRvci5pbnN0YW5jZXMiOiAxLAogICAgICAgICAgICAgICAgICAgICAgICAic3BhcmsuZXhlY3V0b3IubWVtb3J5IjogIjJnIiwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJlbnRyeSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImZpbGUiOiAic2FtcGxld29yZF93aXRoX29wdGlvbmFsX2lucHV0LnB5IiwKICAgICAgICAgICAgICAgICAgICAgICAgInNwYXJrX2pvYl9lbnRyeV90eXBlIjogIlNwYXJrSm9iUHl0aG9uRW50cnkiLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgImlkZW50aXR5IjogeyJpZGVudGl0eV90eXBlIjogIlVzZXJJZGVudGl0eSJ9LAogICAgICAgICAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJpbnB1dDEiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5qb2JfaW5fZmlsZX19In0sCiAgICAgICAgICAgICAgICAgICAgICAgICJzYW1wbGVfcmF0ZSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLnNhbXBsZV9yYXRlfX0ifSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIm5vZGUxIiwKICAgICAgICAgICAgICAgICAgICAib3V0cHV0cyI6IHsib3V0cHV0MSI6IHsidHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5vdXRwdXRzLnBpcGVsaW5lX291dHB1dH19In19LAogICAgICAgICAgICAgICAgICAgICJyZXNvdXJjZXMiOiB7Imluc3RhbmNlX3R5cGUiOiAic3RhbmRhcmRfZTRzX3YzIiwgInJ1bnRpbWVfdmVyc2lvbiI6ICIzLjIuMCJ9LAogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogInNwYXJrIiwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm91dHB1dHMiOiB7InBpcGVsaW5lX291dHB1dCI6IHsibW9kZSI6ICJEaXJlY3QiLCAiam9iX291dHB1dF90eXBlIjogInVyaV9maWxlIn19LAogICAgICAgICAgICAic2V0dGluZ3MiOiB7fSwKICAgICAgICB9CiAgICAgICAgYXNzZXJ0IGV4cGVjdGVkX2pvYiA9PSBhY3R1YWxfam9iCgogICAgZGVmIHRlc3RfY29tbWFuZF9ieV9wYXNzKHNlbGYsIHJhbmRzdHI6IENhbGxhYmxlW1tzdHJdLCBzdHJdLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfeWFtbCA9IHN0cihjb21wb25lbnRzX2RpciAvICJoZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiKQogICAgICAgIGNvbXBvbmVudF9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPWhlbGxvX3dvcmxkX2NvbXBvbmVudF95YW1sKQogICAgICAgICMgdXBkYXRlIGNvbXBvbmVudCBkaXNwbGF5IG5hbWUgdG8gd29yayBhcm91bmQgc2FtZSBjb21wb25lbnQgcmVnaXN0ZXIgbXVsdGlwbGUgdGltZSBpc3N1ZQogICAgICAgIGNvbXBvbmVudF9mdW5jLmRpc3BsYXlfbmFtZSA9ICJ0ZXN0X2NvbW1hbmRfYnlfcGFzcyIKCiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgbmFtZT1yYW5kc3RyKCJwaXBlbGluZV9uYW1lIiksCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJUaGUgaGVsbG8gd29ybGQgcGlwZWxpbmUgam9iIiwKICAgICAgICAgICAgdGFncz17Im93bmVyIjogInNka3RlYW0iLCAidGFnIjogInRhZ3ZhbHVlIn0sCiAgICAgICAgICAgIGRlZmF1bHRfY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICAgICBleHBlcmltZW50X25hbWU9ZXhwZXJpbWVudF9uYW1lLAogICAgICAgICAgICBjb250aW51ZV9vbl9zdGVwX2ZhaWx1cmU9VHJ1ZSwKICAgICAgICApCiAgICAgICAgZGVmIHBpcGVsaW5lKGpvYl9pbl9udW1iZXIsIGpvYl9pbl9vdGhlcl9udW1iZXIsIGpvYl9pbl9wYXRoKToKICAgICAgICAgICAgIyBkeW5hbWljIGZpZWxkcyB3aWxsIHBhc3MgdGhyb3VnaCB0byBiYWNrZW5kCiAgICAgICAgICAgIG5vZGUxID0gY29tcG9uZW50X2Z1bmMoY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aCkKICAgICAgICAgICAgbm9kZTEubmV3X2ZpZWxkID0gInZhbCIKICAgICAgICAgICAgbm9kZTIgPSBjb21wb25lbnRfZnVuYyhjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9vdGhlcl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQogICAgICAgICAgICBub2RlMi5uZXdfZmllbGQgPSB7fQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lKDEwLCAyMCwgam9iX2lucHV0KQogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUoCiAgICAgICAgICAgIHBpcGVsaW5lLAogICAgICAgICAgICBleHBlcmltZW50X25hbWU9ImRzbF9leHAiLAogICAgICAgICkKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZm9yY2VfcmVydW4gPSBGYWxzZQogICAgICAgIGFjdHVhbF9qb2IgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLnByb3BlcnRpZXMuYXNfZGljdCgpLCAqY29tbW9uX29taXRfZmllbGRzKQogICAgICAgIGV4cGVjdGVkX2pvYiA9IHsKICAgICAgICAgICAgInRhZ3MiOiB7Im93bmVyIjogInNka3RlYW0iLCAidGFnIjogInRhZ3ZhbHVlIn0sCiAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJUaGUgaGVsbG8gd29ybGQgcGlwZWxpbmUgam9iIiwKICAgICAgICAgICAgImlzX2FyY2hpdmVkIjogRmFsc2UsCiAgICAgICAgICAgICJqb2JfdHlwZSI6ICJQaXBlbGluZSIsCiAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAiam9iX2luX251bWJlciI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIxMCJ9LAogICAgICAgICAgICAgICAgImpvYl9pbl9vdGhlcl9udW1iZXIiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMjAifSwKICAgICAgICAgICAgICAgICJqb2JfaW5fcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAibW9kZSI6ICJSZWFkT25seU1vdW50IiwKICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAidXJpX2ZpbGUiLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImpvYnMiOiB7CiAgICAgICAgICAgICAgICAibm9kZTEiOiB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9pbl9udW1iZXIiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5qb2JfaW5fbnVtYmVyfX0iLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX3BhdGgiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5qb2JfaW5fcGF0aH19In0sCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJub2RlMSIsCiAgICAgICAgICAgICAgICAgICAgIm5ld19maWVsZCI6ICJ2YWwiLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJub2RlMiI6IHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX251bWJlciI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmpvYl9pbl9vdGhlcl9udW1iZXJ9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmpvYl9pbl9wYXRofX0ifSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIm5vZGUyIiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJvdXRwdXRzIjoge30sCiAgICAgICAgICAgICJzZXR0aW5ncyI6IHsKICAgICAgICAgICAgICAgICJjb250aW51ZV9vbl9zdGVwX2ZhaWx1cmUiOiBUcnVlLAogICAgICAgICAgICAgICAgImZvcmNlX3JlcnVuIjogRmFsc2UsCiAgICAgICAgICAgICAgICAiZGVmYXVsdF9jb21wdXRlIjogImNwdS1jbHVzdGVyIiwKICAgICAgICAgICAgfSwKICAgICAgICB9CiAgICAgICAgYXNzZXJ0IGV4cGVjdGVkX2pvYiA9PSBhY3R1YWxfam9iCgogICAgZGVmIHRlc3RfcGlwZWxpbmVfcGFyYW1ldGVyX3dpdGhfZGVmYXVsdF92YWx1ZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGlucHV0X3R5cGVzX2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9c3RyKGNvbXBvbmVudHNfZGlyIC8gImlucHV0X3R5cGVzX2NvbXBvbmVudC55bWwiKSkKCiAgICAgICAgIyBDb25zdHJ1Y3QgcGlwZWxpbmUKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBkZWZhdWx0X2NvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICAgICAgZGVzY3JpcHRpb249IlRoaXMgaXMgdGhlIGJhc2ljIHBpcGVsaW5lIHdpdGggc2V2ZXJhbCBpbnB1dCB0eXBlcyIsCiAgICAgICAgKQogICAgICAgIGRlZiBpbnB1dF90eXBlc19waXBlbGluZSgKICAgICAgICAgICAgY29tcG9uZW50X2luX3N0cmluZz0iY29tcG9uZW50X2luX3N0cmluZyIsCiAgICAgICAgICAgIGNvbXBvbmVudF9pbl9yYW5nZWRfaW50ZWdlcj0xMCwKICAgICAgICAgICAgY29tcG9uZW50X2luX2VudW09IndvcmxkIiwKICAgICAgICAgICAgY29tcG9uZW50X2luX2Jvb2xlYW49VHJ1ZSwKICAgICAgICAgICAgY29tcG9uZW50X2luX3JhbmdlZF9udW1iZXI9OCwKICAgICAgICApOgogICAgICAgICAgICBpbnB1dF90eXBlc19mdW5jKAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3N0cmluZz1jb21wb25lbnRfaW5fc3RyaW5nLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3JhbmdlZF9pbnRlZ2VyPWNvbXBvbmVudF9pbl9yYW5nZWRfaW50ZWdlciwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9lbnVtPWNvbXBvbmVudF9pbl9lbnVtLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX2Jvb2xlYW49Y29tcG9uZW50X2luX2Jvb2xlYW4sCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fcmFuZ2VkX251bWJlcj1jb21wb25lbnRfaW5fcmFuZ2VkX251bWJlciwKICAgICAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IGlucHV0X3R5cGVzX3BpcGVsaW5lKCkgICMgdXNlIGRlZmF1bHQgcGlwZWxpbmUgcGFyYW1ldGVyCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSwgZXhwZXJpbWVudF9uYW1lPSJpbnB1dF90eXBlc19waXBlbGluZSIpCgogICAgICAgIGFzc2VydCBwaXBlbGluZV9qb2IuaW5wdXRzLmNvbXBvbmVudF9pbl9zdHJpbmcuX2RhdGEgPT0gImNvbXBvbmVudF9pbl9zdHJpbmciCiAgICAgICAgYXNzZXJ0IHBpcGVsaW5lX2pvYi5pbnB1dHMuY29tcG9uZW50X2luX3JhbmdlZF9pbnRlZ2VyLl9kYXRhID09ICIxMCIKICAgICAgICBhc3NlcnQgcGlwZWxpbmVfam9iLmlucHV0cy5jb21wb25lbnRfaW5fZW51bS5fZGF0YSA9PSAid29ybGQiCiAgICAgICAgYXNzZXJ0IHBpcGVsaW5lX2pvYi5pbnB1dHMuY29tcG9uZW50X2luX2Jvb2xlYW4uX2RhdGEgPT0gIlRydWUiCiAgICAgICAgYXNzZXJ0IHBpcGVsaW5lX2pvYi5pbnB1dHMuY29tcG9uZW50X2luX3JhbmdlZF9udW1iZXIuX2RhdGEgPT0gIjgiCgogICAgZGVmIHRlc3RfY29tcG9uZW50X3dpdGhfZGVmYXVsdF9vcHRpb25hbF9pbnB1dChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGRlZmF1bHRfb3B0aW9uYWxfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1zdHIoY29tcG9uZW50c19kaXIgLyAiZGVmYXVsdF9vcHRpb25hbF9jb21wb25lbnQueW1sIikpCgogICAgICAgICMgQ29uc3RydWN0IHBpcGVsaW5lCiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJUaGlzIGlzIHRoZSBiYXNpYyBwaXBlbGluZSB3aXRoIHNldmVyYWwgaW5wdXQgdHlwZXMiLAogICAgICAgICkKICAgICAgICBkZWYgZGVmYXVsdF9vcHRpb25hbF9waXBlbGluZSgpOgogICAgICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMoCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbT0iZGVmIiwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PUlucHV0KHR5cGU9InVyaV9maWxlIiwgcGF0aD0iaHR0cHM6Ly9kcHJlcGRhdGEuYmxvYi5jb3JlLndpbmRvd3MubmV0L2RlbW8vVGl0YW5pYy5jc3YiKSwKICAgICAgICAgICAgKQogICAgICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMoCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbT0iZGVmIiwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PUlucHV0KHR5cGU9InVyaV9maWxlIiwgcGF0aD0iaHR0cHM6Ly9kcHJlcGRhdGEuYmxvYi5jb3JlLndpbmRvd3MubmV0L2RlbW8vVGl0YW5pYy5jc3YiKSwKICAgICAgICAgICAgICAgIG9wdGlvbmFsX2lucHV0PU5vbmUsCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQ9Tm9uZSwKICAgICAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtPU5vbmUsCiAgICAgICAgICAgICAgICBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQ9Tm9uZSwKICAgICAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IGRlZmF1bHRfb3B0aW9uYWxfcGlwZWxpbmUoKSAgIyB1c2UgZGVmYXVsdCBwaXBlbGluZSBwYXJhbWV0ZXIKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lLCBleHBlcmltZW50X25hbWU9ImRlZmF1bHRfb3B0aW9uYWxfcGlwZWxpbmUiKQoKICAgICAgICAjIG9ubHkgdGhlIHR3byByZXF1aXJlZCBpbnB1dCBleGlzdHMKICAgICAgICBhc3NlcnQgbGVuKHBpcGVsaW5lX2pvYi5qb2JzWyJkZWZhdWx0X29wdGlvbmFsX2NvbXBvbmVudCJdLmlucHV0cykgPT0gMgogICAgICAgICMgVE9ETzogb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0IHNob3VsZCBhbHNvIGV4aXN0cwogICAgICAgIGFzc2VydCBsZW4ocGlwZWxpbmVfam9iLmpvYnNbImRlZmF1bHRfb3B0aW9uYWxfY29tcG9uZW50XzEiXS5pbnB1dHMpID09IDIKCiAgICBkZWYgdGVzdF9waXBlbGluZV93aXRoX25vbmVfcGFyYW1ldGVyX2hhc19kZWZhdWx0X29wdGlvbmFsX2ZhbHNlKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPXN0cihjb21wb25lbnRzX2RpciAvICJkZWZhdWx0X29wdGlvbmFsX2NvbXBvbmVudC55bWwiKSkKCiAgICAgICAgIyBOb25lIGlucHV0IGlzIGJpbmRpbmcgdG8gYSByZXF1aXJlZCBpbnB1dAogICAgICAgIEBkc2wucGlwZWxpbmUoCiAgICAgICAgICAgIGRlZmF1bHRfY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICkKICAgICAgICBkZWYgcGlwZWxpbmVfd2l0aF9kZWZhdWx0X29wdGlvbmFsX3BhcmFtZXRlcnMoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICk6CiAgICAgICAgICAgIGRlZmF1bHRfb3B0aW9uYWxfZnVuYygKICAgICAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PXJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09cmVxdWlyZWRfcGFyYW0sCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQ9cmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmVfd2l0aF9kZWZhdWx0X29wdGlvbmFsX3BhcmFtZXRlcnMoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PUlucHV0KHR5cGU9InVyaV9maWxlIiwgcGF0aD0iaHR0cHM6Ly9kcHJlcGRhdGEuYmxvYi5jb3JlLndpbmRvd3MubmV0L2RlbW8vVGl0YW5pYy5jc3YiKSwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09ImhlbGxvIiwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0PU5vbmUsCiAgICAgICAgKQogICAgICAgIHZhbGlkYXRlX3Jlc3VsdCA9IHBpcGVsaW5lLl92YWxpZGF0ZSgpCiAgICAgICAgYXNzZXJ0IHZhbGlkYXRlX3Jlc3VsdC5lcnJvcl9tZXNzYWdlcyA9PSB7CiAgICAgICAgICAgICJpbnB1dHMucmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0IjogIlJlcXVpcmVkIGlucHV0ICdyZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQnIGZvciBwaXBlbGluZSAncGlwZWxpbmVfd2l0aF9kZWZhdWx0X29wdGlvbmFsX3BhcmFtZXRlcnMnIG5vdCBwcm92aWRlZC4iCiAgICAgICAgfQoKICAgICAgICAjIE5vbmUgaW5wdXQgaXMgbm90IGJpbmRpbmcgdG8gYSByZXF1aXJlZCBpbnB1dAogICAgICAgIEBkc2wucGlwZWxpbmUoCiAgICAgICAgICAgIGRlZmF1bHRfY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICkKICAgICAgICBkZWYgcGlwZWxpbmVfd2l0aF9kZWZhdWx0X29wdGlvbmFsX3BhcmFtZXRlcnMoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbSwKICAgICAgICApOgogICAgICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMoCiAgICAgICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1yZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPXJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0PU5vbmUsCiAgICAgICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV93aXRoX2RlZmF1bHRfb3B0aW9uYWxfcGFyYW1ldGVycygKICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9SW5wdXQodHlwZT0idXJpX2ZpbGUiLCBwYXRoPSJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIpLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbT0iaGVsbG8iLAogICAgICAgICkKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lLCBleHBlcmltZW50X25hbWU9ImRlZmF1bHRfb3B0aW9uYWxfcGlwZWxpbmUiKQoKICAgICAgICAjIG9ubHkgdGhlIHR3byByZXF1aXJlZCBpbnB1dHMgZXhpc3RzCiAgICAgICAgYXNzZXJ0IGxlbihuZXh0KHBpcGVsaW5lX2pvYi5qb2JzLnZhbHVlcygpLl9faXRlcl9fKCkpLmlucHV0cykgPT0gMgogICAgICAgIHZhbGlkYXRlX3Jlc3VsdCA9IHBpcGVsaW5lLl92YWxpZGF0ZSgpCiAgICAgICAgYXNzZXJ0IHZhbGlkYXRlX3Jlc3VsdC5wYXNzZWQgaXMgVHJ1ZQoKICAgICAgICAjIE5vdCBwYXNzIHJlcXVpcmVkIHBhcmFtZXRlciB3aXRoIGRlZmF1bHQgdmFsdWUKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBkZWZhdWx0X2NvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICApCiAgICAgICAgZGVmIHBpcGVsaW5lX3dpdGhfZGVmYXVsdF9vcHRpb25hbF9wYXJhbWV0ZXJzKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW0sCiAgICAgICAgKToKICAgICAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jKAogICAgICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9cmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbT1yZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX3dpdGhfZGVmYXVsdF9vcHRpb25hbF9wYXJhbWV0ZXJzKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1JbnB1dCh0eXBlPSJ1cmlfZmlsZSIsIHBhdGg9Imh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IiksCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPSJoZWxsbyIsCiAgICAgICAgKQogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUsIGV4cGVyaW1lbnRfbmFtZT0iZGVmYXVsdF9vcHRpb25hbF9waXBlbGluZSIpCiAgICAgICAgIyBvbmx5IHRoZSB0d28gcmVxdWlyZWQgaW5wdXQgZXhpc3RzCiAgICAgICAgYXNzZXJ0IGxlbihuZXh0KHBpcGVsaW5lX2pvYi5qb2JzLnZhbHVlcygpLl9faXRlcl9fKCkpLmlucHV0cykgPT0gMgogICAgICAgIHZhbGlkYXRlX3Jlc3VsdCA9IHBpcGVsaW5lLl92YWxpZGF0ZSgpCiAgICAgICAgYXNzZXJ0IHZhbGlkYXRlX3Jlc3VsdC5wYXNzZWQgaXMgVHJ1ZQoKICAgIGRlZiB0ZXN0X3BpcGVsaW5lX3dpdGhfbm9uZV9wYXJhbWV0ZXJfbm9fZGVmYXVsdF9vcHRpb25hbF90cnVlKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPXN0cihjb21wb25lbnRzX2RpciAvICJkZWZhdWx0X29wdGlvbmFsX2NvbXBvbmVudC55bWwiKSkKCiAgICAgICAgIyBOb25lIGlucHV0IGlzIGJpbmRpbmcgdG8gYSBvcHRpb25hbCBpbnB1dAoKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBkZWZhdWx0X2NvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICApCiAgICAgICAgZGVmIHBpcGVsaW5lX3dpdGhfZGVmYXVsdF9vcHRpb25hbF9wYXJhbWV0ZXJzKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW0sCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW0sCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICApOgogICAgICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMoCiAgICAgICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1yZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPXJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0PXJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtPW9wdGlvbmFsX3BhcmFtLAogICAgICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0PW9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX3dpdGhfZGVmYXVsdF9vcHRpb25hbF9wYXJhbWV0ZXJzKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1JbnB1dCh0eXBlPSJ1cmlfZmlsZSIsIHBhdGg9Imh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IiksCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPSJoZWxsbyIsCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdD0icmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0IiwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW09Tm9uZSwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0PSJvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQiLAogICAgICAgICkKICAgICAgICAjIHRvZG86IHVuY29tbWVudCB0aGlzIHdoZW4gYmFja2VuZCByZW1vdmUgY29tcG9uZW50IGpvYiBvcHRpb25hbCBpbnB1dCB3aGljaCBpcyBiaW5kaW5nIHRvIGEgTm9uZSBwaXBlbGluZQogICAgICAgICMgIGlucHV0CiAgICAgICAgIyBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lLCBleHBlcmltZW50X25hbWU9ImRlZmF1bHRfb3B0aW9uYWxfcGlwZWxpbmUiKQogICAgICAgIGFzc2VydCAib3B0aW9uYWxfcGFyYW0iIG5vdCBpbiBwaXBlbGluZS5pbnB1dHMKCiAgICAgICAgIyBhc3NlcnQgIm9wdGlvbmFsX3BhcmFtIiBub3QgaW4gcGlwZWxpbmVfam9iLmlucHV0cwogICAgICAgICMgYXNzZXJ0ICJvcHRpb25hbF9wYXJhbSIgbm90IGluIG5leHQocGlwZWxpbmVfam9iLmpvYnMudmFsdWVzKCkuX19pdGVyX18oKSkuaW5wdXRzCgogICAgICAgICMgTm9uZSBpbnB1dCBpcyBub3QgYmluZGluZyB0byBhIG9wdGlvbmFsIGlucHV0CiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgKQogICAgICAgIGRlZiBwaXBlbGluZV93aXRoX2RlZmF1bHRfb3B0aW9uYWxfcGFyYW1ldGVycygKICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgKToKICAgICAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jKAogICAgICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9cmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbT1yZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdD1yZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgICAgICBvcHRpb25hbF9wYXJhbT1Ob25lLAogICAgICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0PW9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX3dpdGhfZGVmYXVsdF9vcHRpb25hbF9wYXJhbWV0ZXJzKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1JbnB1dCh0eXBlPSJ1cmlfZmlsZSIsIHBhdGg9Imh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IiksCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPSJoZWxsbyIsCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdD0icmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0IiwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW09Tm9uZSwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0PSJvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQiLAogICAgICAgICkKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lLCBleHBlcmltZW50X25hbWU9ImRlZmF1bHRfb3B0aW9uYWxfcGlwZWxpbmUiKQogICAgICAgIGFzc2VydCAib3B0aW9uYWxfcGFyYW0iIG5vdCBpbiBwaXBlbGluZS5pbnB1dHMKICAgICAgICBhc3NlcnQgIm9wdGlvbmFsX3BhcmFtIiBub3QgaW4gcGlwZWxpbmVfam9iLmlucHV0cwoKICAgICAgICAjIE5vdCBwYXNzIHJlcXVpcmVkIHBhcmFtZXRlciB3aXRoIGRlZmF1bHQgdmFsdWUKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBkZWZhdWx0X2NvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICApCiAgICAgICAgZGVmIHBpcGVsaW5lX3dpdGhfZGVmYXVsdF9vcHRpb25hbF9wYXJhbWV0ZXJzKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW0sCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW0sCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICApOgogICAgICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMoCiAgICAgICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1yZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPXJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0PXJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdD1vcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV93aXRoX2RlZmF1bHRfb3B0aW9uYWxfcGFyYW1ldGVycygKICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9SW5wdXQodHlwZT0idXJpX2ZpbGUiLCBwYXRoPSJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIpLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbT0iaGVsbG8iLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQ9InJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCIsCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtPU5vbmUsCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdD0ib3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0IiwKICAgICAgICApCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSwgZXhwZXJpbWVudF9uYW1lPSJkZWZhdWx0X29wdGlvbmFsX3BpcGVsaW5lIikKICAgICAgICBhc3NlcnQgIm9wdGlvbmFsX3BhcmFtIiBub3QgaW4gcGlwZWxpbmUuaW5wdXRzCiAgICAgICAgYXNzZXJ0ICJvcHRpb25hbF9wYXJhbSIgbm90IGluIHBpcGVsaW5lX2pvYi5pbnB1dHMKCiAgICBkZWYgdGVzdF9jaGVja19waXBlbGluZV9jb21wb25lbnRfcGFyYW1ldGVyKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGRlZmF1bHRfb3B0aW9uYWxfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1zdHIoY29tcG9uZW50c19kaXIgLyAiZGVmYXVsdF9vcHRpb25hbF9jb21wb25lbnQueW1sIikpCgogICAgICAgIEBkc2wucGlwZWxpbmUoKQogICAgICAgIGRlZiBwaXBlbGluZV9taXNzaW5nX3R5cGUoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbSwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICk6CiAgICAgICAgICAgIGRlZmF1bHRfb3B0aW9uYWxfZnVuYygKICAgICAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PXJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09cmVxdWlyZWRfcGFyYW0sCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQ9cmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0PW9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgKQoKICAgICAgICB3aXRoIHB5dGVzdC5yYWlzZXMoVmFsaWRhdGlvbkV4Y2VwdGlvbikgYXMgZToKICAgICAgICAgICAgY2xpZW50LmNvbXBvbmVudHMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZV9taXNzaW5nX3R5cGUpCgogICAgICAgIGFzc2VydCAoCiAgICAgICAgICAgICJVbmtub3duIHR5cGUgb2YgcGFyYW1ldGVyIFsncmVxdWlyZWRfaW5wdXQnLCAncmVxdWlyZWRfcGFyYW0nLCAncmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0JywgJ29wdGlvbmFsX3BhcmFtJywgJ29wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCddIGluIHBpcGVsaW5lIGZ1bmMgJ3BpcGVsaW5lX21pc3NpbmdfdHlwZSciCiAgICAgICAgICAgIGluIGUudmFsdWUubWVzc2FnZQogICAgICAgICkKCiAgICAgICAgQGRzbC5waXBlbGluZShub25fcGlwZWxpbmVfaW5wdXRzPVsicGFyYW0iXSkKICAgICAgICBkZWYgcGlwZWxpbmVfd2l0aF9ub25fcGlwZWxpbmVfaW5wdXRzKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dDogSW5wdXQsCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtOiBzdHIsCiAgICAgICAgICAgIHBhcmFtOiBzdHIsCiAgICAgICAgKToKICAgICAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jKAogICAgICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9cmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbT1yZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgKQoKICAgICAgICB3aXRoIHB5dGVzdC5yYWlzZXMoVmFsaWRhdGlvbkV4Y2VwdGlvbikgYXMgZToKICAgICAgICAgICAgY2xpZW50LmNvbXBvbmVudHMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZV93aXRoX25vbl9waXBlbGluZV9pbnB1dHMpCiAgICAgICAgYXNzZXJ0ICgKICAgICAgICAgICAgIkNhbm5vdCByZWdpc3RlciBwaXBlbGluZSBjb21wb25lbnQgJ3BpcGVsaW5lX3dpdGhfbm9uX3BpcGVsaW5lX2lucHV0cycgd2l0aCBub25fcGlwZWxpbmVfaW5wdXRzLiIKICAgICAgICAgICAgaW4gZS52YWx1ZS5tZXNzYWdlCiAgICAgICAgKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKCkKICAgICAgICBkZWYgcGlwZWxpbmVfd2l0aF92YXJpYWJsZV9pbnB1dHMocmVxdWlyZWRfaW5wdXQ6IElucHV0LCByZXF1aXJlZF9wYXJhbTogc3RyLCAqYXJncywgKiprd2FyZ3MpOgogICAgICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMoCiAgICAgICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1yZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPXJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICApCgogICAgICAgIHdpdGggcHl0ZXN0LnJhaXNlcyhWYWxpZGF0aW9uRXhjZXB0aW9uKSBhcyBlOgogICAgICAgICAgICBjbGllbnQuY29tcG9uZW50cy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lX3dpdGhfdmFyaWFibGVfaW5wdXRzKQogICAgICAgIGFzc2VydCAoCiAgICAgICAgICAgICJDYW5ub3QgcmVnaXN0ZXIgdGhlIGNvbXBvbmVudCBwaXBlbGluZV93aXRoX3ZhcmlhYmxlX2lucHV0cyB3aXRoIHZhcmlhYmxlIGlucHV0cyBbJ2FyZ3MnLCAna3dhcmdzJ10iCiAgICAgICAgICAgIGluIGUudmFsdWUubWVzc2FnZQogICAgICAgICkKCiAgICBkZWYgdGVzdF9jcmVhdGVfcGlwZWxpbmVfY29tcG9uZW50X2J5X2RzbChzZWxmLCBjYXBsb2csIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGRlZmF1bHRfb3B0aW9uYWxfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1zdHIoY29tcG9uZW50c19kaXIgLyAiZGVmYXVsdF9vcHRpb25hbF9jb21wb25lbnQueW1sIikpCgogICAgICAgIEBkc2wucGlwZWxpbmUoY29udGludWVfb25fc3RlcF9mYWlsdXJlPVRydWUsIGZvcmNlX3JlcnVuPVRydWUsIGRlZmF1bHRfZGF0YXN0b3JlPSJ0ZXN0IikKICAgICAgICBkZWYgdmFsaWRfcGlwZWxpbmVfZnVuYygKICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ6IElucHV0LAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbTogc3RyLAogICAgICAgICAgICBub2RlX2NvbXB1dGU6IHN0ciA9ICJjcHUtY2x1c3RlciIsCiAgICAgICAgKToKICAgICAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jKAogICAgICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9cmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbT1yZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgKQogICAgICAgICAgICBub2RlMiA9IGRlZmF1bHRfb3B0aW9uYWxfZnVuYygKICAgICAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PXJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09cmVxdWlyZWRfcGFyYW0sCiAgICAgICAgICAgICkKICAgICAgICAgICAgbm9kZTIuY29tcHV0ZSA9IG5vZGVfY29tcHV0ZQoKICAgICAgICBjb21wb25lbnQgPSB2YWxpZF9waXBlbGluZV9mdW5jLl9waXBlbGluZV9idWlsZGVyLmJ1aWxkKHVzZXJfcHJvdmlkZWRfa3dhcmdzPXt9KQogICAgICAgIGFzc2VydCBjb21wb25lbnQuX2F1dG9faW5jcmVtZW50X3ZlcnNpb24gaXMgVHJ1ZQogICAgICAgICMgU2V0IG9yaWdpbmFsIG1vZHVsZV9sb2dnZXIgd2l0aCBwa2cgbmFtZSB0byAnT3BlcmF0aW9uJyB0byBlbmFibGUgY2FwbG9nIGNhcHR1cmUgbG9ncwogICAgICAgIGZyb20gYXp1cmUuYWkubWwub3BlcmF0aW9ucyBpbXBvcnQgX2NvbXBvbmVudF9vcGVyYXRpb25zCgogICAgICAgIF9jb21wb25lbnRfb3BlcmF0aW9ucy5tb2R1bGVfbG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoIk9wZXJhdGlvbiIpCgogICAgICAgICMgQXNzZXJ0IGJpbmRpbmcgb24gY29tcHV0ZSBub3QgY2hhbmdlZCBhZnRlciByZXNvbHZlIGRlcGVuZGVuY2llcwogICAgICAgIGNsaWVudC5jb21wb25lbnRzLl9yZXNvbHZlX2RlcGVuZGVuY2llc19mb3JfcGlwZWxpbmVfY29tcG9uZW50X2pvYnMoCiAgICAgICAgICAgIGNvbXBvbmVudCwgcmVzb2x2ZXI9Y2xpZW50LmNvbXBvbmVudHMuX29yY2hlc3RyYXRvcnMuZ2V0X2Fzc2V0X2FybV9pZCwgcmVzb2x2ZV9pbnB1dHM9RmFsc2UKICAgICAgICApCiAgICAgICAgYXNzZXJ0IGNvbXBvbmVudC5qb2JzWyJub2RlMiJdLmNvbXB1dGUgPT0gIiR7e3BhcmVudC5pbnB1dHMubm9kZV9jb21wdXRlfX0iCgogICAgICAgIHdpdGggY2FwbG9nLmF0X2xldmVsKGxvZ2dpbmcuV0FSTklORyk6CiAgICAgICAgICAgIGNsaWVudC5jb21wb25lbnRzLmNyZWF0ZV9vcl91cGRhdGUodmFsaWRfcGlwZWxpbmVfZnVuYykKICAgICAgICBhc3NlcnQgKAogICAgICAgICAgICAiSm9iIHNldHRpbmdzIHsnZGVmYXVsdF9kYXRhc3RvcmUnOiAndGVzdCcsICdjb250aW51ZV9vbl9zdGVwX2ZhaWx1cmUnOiBUcnVlLCAnZm9yY2VfcmVydW4nOiBUcnVlfSBvbiBwaXBlbGluZSBmdW5jdGlvbiAndmFsaWRfcGlwZWxpbmVfZnVuYycgYXJlIGlnbm9yZWQgd2hlbiBjcmVhdGluZyBQaXBlbGluZUNvbXBvbmVudC4iCiAgICAgICAgICAgIGluIGNhcGxvZy5tZXNzYWdlcwogICAgICAgICkKCiAgICBkZWYgdGVzdF9jcmVhdGVfcGlwZWxpbmVfd2l0aF9wYXJhbWV0ZXJfZ3JvdXAoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9c3RyKGNvbXBvbmVudHNfZGlyIC8gImRlZmF1bHRfb3B0aW9uYWxfY29tcG9uZW50LnltbCIpKQoKICAgICAgICBAZ3JvdXAKICAgICAgICBjbGFzcyBTdWJHcm91cDoKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW06IHN0cgoKICAgICAgICBAZ3JvdXAKICAgICAgICBjbGFzcyBHcm91cDoKICAgICAgICAgICAgc3ViOiBTdWJHcm91cAogICAgICAgICAgICBub2RlX2NvbXB1dGU6IHN0ciA9ICJjcHUtY2x1c3RlciIKCiAgICAgICAgQGRzbC5waXBlbGluZSgpCiAgICAgICAgZGVmIHN1Yl9waXBlbGluZV9mdW5jKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dDogSW5wdXQsCiAgICAgICAgICAgIGdyb3VwOiBHcm91cCwKICAgICAgICAgICAgc3ViX2dyb3VwOiBTdWJHcm91cCwKICAgICAgICApOgogICAgICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMoCiAgICAgICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1yZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPWdyb3VwLnN1Yi5yZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgKQogICAgICAgICAgICBub2RlMiA9IGRlZmF1bHRfb3B0aW9uYWxfZnVuYygKICAgICAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PXJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09c3ViX2dyb3VwLnJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICApCiAgICAgICAgICAgIG5vZGUyLmNvbXB1dGUgPSBncm91cC5ub2RlX2NvbXB1dGUKCiAgICAgICAgQGRzbC5waXBlbGluZShkZWZhdWx0X2NvbXB1dGU9ImNwdS1jbHVzdGVyIikKICAgICAgICBkZWYgcm9vdF9waXBlbGluZV93aXRoX2dyb3VwKAogICAgICAgICAgICByX3JlcXVpcmVkX2lucHV0OiBJbnB1dCwKICAgICAgICAgICAgcl9ncm91cDogR3JvdXAsCiAgICAgICAgKToKICAgICAgICAgICAgc3ViX3BpcGVsaW5lX2Z1bmMocmVxdWlyZWRfaW5wdXQ9cl9yZXF1aXJlZF9pbnB1dCwgZ3JvdXA9cl9ncm91cCwgc3ViX2dyb3VwPXJfZ3JvdXAuc3ViKQoKICAgICAgICBqb2IgPSByb290X3BpcGVsaW5lX3dpdGhfZ3JvdXAoCiAgICAgICAgICAgIHJfcmVxdWlyZWRfaW5wdXQ9SW5wdXQodHlwZT0idXJpX2ZpbGUiLCBwYXRoPSJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIpLAogICAgICAgICAgICByX2dyb3VwPUdyb3VwKHN1Yj1TdWJHcm91cChyZXF1aXJlZF9wYXJhbT0iaGVsbG8iKSksCiAgICAgICAgKQogICAgICAgIHJlc3Rfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwoam9iLCBjbGllbnQpCiAgICAgICAgYXNzZXJ0IGxlbihyZXN0X2pvYi5pbnB1dHMpID09IDIKICAgICAgICByZXN0X2pvYl9kaWN0ID0gcmVzdF9qb2IuX3RvX2RpY3QoKQogICAgICAgIGFzc2VydCByZXN0X2pvYl9kaWN0WyJpbnB1dHMiXSA9PSB7CiAgICAgICAgICAgICJyX3JlcXVpcmVkX2lucHV0IjogewogICAgICAgICAgICAgICAgIm1vZGUiOiAicm9fbW91bnQiLAogICAgICAgICAgICAgICAgInR5cGUiOiAidXJpX2ZpbGUiLAogICAgICAgICAgICAgICAgInBhdGgiOiAiYXp1cmVtbDpodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJyX2dyb3VwLnN1Yi5yZXF1aXJlZF9wYXJhbSI6ICJoZWxsbyIsCiAgICAgICAgICAgICJyX2dyb3VwLm5vZGVfY29tcHV0ZSI6ICJjcHUtY2x1c3RlciIsCiAgICAgICAgfQogICAgICAgIGFzc2VydCByZXN0X2pvYl9kaWN0WyJqb2JzIl1bInN1Yl9waXBlbGluZV9mdW5jIl1bImlucHV0cyJdID09IHsKICAgICAgICAgICAgInJlcXVpcmVkX2lucHV0IjogeyJwYXRoIjogIiR7e3BhcmVudC5pbnB1dHMucl9yZXF1aXJlZF9pbnB1dH19In0sCiAgICAgICAgICAgICJncm91cC5zdWIucmVxdWlyZWRfcGFyYW0iOiB7InBhdGgiOiAiJHt7cGFyZW50LmlucHV0cy5yX2dyb3VwLnN1Yi5yZXF1aXJlZF9wYXJhbX19In0sCiAgICAgICAgICAgICJncm91cC5ub2RlX2NvbXB1dGUiOiB7InBhdGgiOiAiJHt7cGFyZW50LmlucHV0cy5yX2dyb3VwLm5vZGVfY29tcHV0ZX19In0sCiAgICAgICAgICAgICJzdWJfZ3JvdXAucmVxdWlyZWRfcGFyYW0iOiB7InBhdGgiOiAiJHt7cGFyZW50LmlucHV0cy5yX2dyb3VwLnN1Yi5yZXF1aXJlZF9wYXJhbX19In0sCiAgICAgICAgfQoKICAgIGRlZiB0ZXN0X3BpcGVsaW5lX3dpdGhfbm9uZV9wYXJhbWV0ZXJfaGFzX2RlZmF1bHRfb3B0aW9uYWxfdHJ1ZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGRlZmF1bHRfb3B0aW9uYWxfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1zdHIoY29tcG9uZW50c19kaXIgLyAiZGVmYXVsdF9vcHRpb25hbF9jb21wb25lbnQueW1sIikpCgogICAgICAgICMgTm9uZSBpbnB1dCBpcyBiaW5kaW5nIHRvIGEgb3B0aW9uYWwgaW5wdXQKCiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgKQogICAgICAgIGRlZiBwaXBlbGluZV93aXRoX2RlZmF1bHRfb3B0aW9uYWxfcGFyYW1ldGVycygKICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgKToKICAgICAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jKAogICAgICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9cmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbT1yZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdD1yZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgICAgICBvcHRpb25hbF9wYXJhbT1vcHRpb25hbF9wYXJhbSwKICAgICAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdD1vcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV93aXRoX2RlZmF1bHRfb3B0aW9uYWxfcGFyYW1ldGVycygKICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9SW5wdXQodHlwZT0idXJpX2ZpbGUiLCBwYXRoPSJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIpLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbT0iaGVsbG8iLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQ9InJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCIsCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtPSJvcHRpb25hbF9wYXJhbSIsCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdD1Ob25lLAogICAgICAgICkKICAgICAgICAjIHRvZG86IHVuY29tbWVudCB0aGlzIHdoZW4gYmFja2VuZCByZW1vdmUgY29tcG9uZW50IGpvYiBvcHRpb25hbCBpbnB1dCB3aGljaCBpcyBiaW5kaW5nIHRvIGEgTm9uZSBwaXBlbGluZQogICAgICAgICMgIGlucHV0CiAgICAgICAgIyBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lLCBleHBlcmltZW50X25hbWU9ImRlZmF1bHRfb3B0aW9uYWxfcGlwZWxpbmUiKQogICAgICAgIGFzc2VydCAib3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0IiBub3QgaW4gcGlwZWxpbmUuaW5wdXRzCgogICAgICAgICMgYXNzZXJ0ICJvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQiIG5vdCBpbiBwaXBlbGluZV9qb2IuaW5wdXRzCiAgICAgICAgIyBhc3NlcnQgIm9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCIgbm90IGluIG5leHQocGlwZWxpbmVfam9iLmpvYnMudmFsdWVzKCkuX19pdGVyX18oKSkuaW5wdXRzCgogICAgICAgICMgTm9uZSBpbnB1dCBpcyBub3QgYmluZGluZyB0byBhIG9wdGlvbmFsIGlucHV0CiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgKQogICAgICAgIGRlZiBwaXBlbGluZV93aXRoX2RlZmF1bHRfb3B0aW9uYWxfcGFyYW1ldGVycygKICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgKToKICAgICAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jKAogICAgICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9cmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbT1yZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdD1yZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgICAgICBvcHRpb25hbF9wYXJhbT1vcHRpb25hbF9wYXJhbSwKICAgICAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdD1Ob25lLAogICAgICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmVfd2l0aF9kZWZhdWx0X29wdGlvbmFsX3BhcmFtZXRlcnMoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PUlucHV0KHR5cGU9InVyaV9maWxlIiwgcGF0aD0iaHR0cHM6Ly9kcHJlcGRhdGEuYmxvYi5jb3JlLndpbmRvd3MubmV0L2RlbW8vVGl0YW5pYy5jc3YiKSwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09ImhlbGxvIiwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0PSJyZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQiLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbT0ib3B0aW9uYWxfcGFyYW0iLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQ9Tm9uZSwKICAgICAgICApCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSwgZXhwZXJpbWVudF9uYW1lPSJkZWZhdWx0X29wdGlvbmFsX3BpcGVsaW5lIikKICAgICAgICBhc3NlcnQgIm9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCIgbm90IGluIHBpcGVsaW5lLmlucHV0cwogICAgICAgIGFzc2VydCAib3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0IiBub3QgaW4gcGlwZWxpbmVfam9iLmlucHV0cwoKICAgICAgICAjIE5vdCBwYXNzIHJlcXVpcmVkIHBhcmFtZXRlciB3aXRoIGRlZmF1bHQgdmFsdWUKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBkZWZhdWx0X2NvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICApCiAgICAgICAgZGVmIHBpcGVsaW5lX3dpdGhfZGVmYXVsdF9vcHRpb25hbF9wYXJhbWV0ZXJzKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW0sCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW0sCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICApOgogICAgICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMoCiAgICAgICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1yZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPXJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0PXJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtPW9wdGlvbmFsX3BhcmFtLAogICAgICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmVfd2l0aF9kZWZhdWx0X29wdGlvbmFsX3BhcmFtZXRlcnMoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PUlucHV0KHR5cGU9InVyaV9maWxlIiwgcGF0aD0iaHR0cHM6Ly9kcHJlcGRhdGEuYmxvYi5jb3JlLndpbmRvd3MubmV0L2RlbW8vVGl0YW5pYy5jc3YiKSwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09ImhlbGxvIiwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0PSJyZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQiLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbT0ib3B0aW9uYWxfcGFyYW0iLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQ9Tm9uZSwKICAgICAgICApCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSwgZXhwZXJpbWVudF9uYW1lPSJkZWZhdWx0X29wdGlvbmFsX3BpcGVsaW5lIikKICAgICAgICBhc3NlcnQgIm9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCIgbm90IGluIHBpcGVsaW5lLmlucHV0cwogICAgICAgIGFzc2VydCAib3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0IiBub3QgaW4gcGlwZWxpbmVfam9iLmlucHV0cwoKICAgICAgICAjIFBhc3Mgbm90LW5vbmUgdmFsdWUgdG8gY29tcG9uZW50IGZ1bmMgZGlyZWN0bHkgYnV0IHNldCBub25lIGluIHBpcGVsaW5lIHBhcmFtZXRlcgogICAgICAgIEBkc2wucGlwZWxpbmUoCiAgICAgICAgICAgIGRlZmF1bHRfY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICkKICAgICAgICBkZWYgcGlwZWxpbmVfd2l0aF9kZWZhdWx0X29wdGlvbmFsX3BhcmFtZXRlcnMoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbSwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICk6CiAgICAgICAgICAgIGRlZmF1bHRfb3B0aW9uYWxfZnVuYygKICAgICAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PUlucHV0KHR5cGU9InVyaV9maWxlIiwgcGF0aD0iaHR0cHM6Ly9kcHJlcGRhdGEuYmxvYi5jb3JlLndpbmRvd3MubmV0L2RlbW8vVGl0YW5pYy5jc3YiKSwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPXJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0PSJyZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQiLAogICAgICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW09Im9wdGlvbmFsX3BhcmFtIiwKICAgICAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdD0ib3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0IiwKICAgICAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX3dpdGhfZGVmYXVsdF9vcHRpb25hbF9wYXJhbWV0ZXJzKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1Ob25lLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbT0iaGVsbG8iLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQ9Tm9uZSwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW09Tm9uZSwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0PU5vbmUsCiAgICAgICAgKQogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUsIGV4cGVyaW1lbnRfbmFtZT0iZGVmYXVsdF9vcHRpb25hbF9waXBlbGluZSIpCiAgICAgICAgYXNzZXJ0ICJyZXF1aXJlZF9pbnB1dCIgbm90IGluIHBpcGVsaW5lLmlucHV0cwogICAgICAgIGFzc2VydCAicmVxdWlyZWRfaW5wdXQiIG5vdCBpbiBwaXBlbGluZV9qb2IuaW5wdXRzCiAgICAgICAgYXNzZXJ0ICJyZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQiIG5vdCBpbiBwaXBlbGluZS5pbnB1dHMKICAgICAgICBhc3NlcnQgInJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCIgbm90IGluIHBpcGVsaW5lX2pvYi5pbnB1dHMKICAgICAgICBhc3NlcnQgIm9wdGlvbmFsX3BhcmFtIiBub3QgaW4gcGlwZWxpbmUuaW5wdXRzCiAgICAgICAgYXNzZXJ0ICJvcHRpb25hbF9wYXJhbSIgbm90IGluIHBpcGVsaW5lX2pvYi5pbnB1dHMKICAgICAgICBhc3NlcnQgIm9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCIgbm90IGluIHBpcGVsaW5lLmlucHV0cwogICAgICAgIGFzc2VydCAib3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0IiBub3QgaW4gcGlwZWxpbmVfam9iLmlucHV0cwoKICAgIGRlZiB0ZXN0X3BpcGVsaW5lX3dpdGhfbm9uZV9wYXJhbWV0ZXJfYmluZGluZ190b190d29fY29tcG9uZW50X2lucHV0cyhzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGRlZmF1bHRfb3B0aW9uYWxfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1zdHIoY29tcG9uZW50c19kaXIgLyAiZGVmYXVsdF9vcHRpb25hbF9jb21wb25lbnQueW1sIikpCgogICAgICAgICMgTm9uZSBwaXBlbGluZSBwYXJhbWV0ZXIgaXMgYmluZGluZyB0byB0d28gb3B0aW9uYWwgY29tcG9uZW50IGlucHV0LCByZW1vdmVkIE5vbmUgaW5wdXQKCiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgKQogICAgICAgIGRlZiBwaXBlbGluZV93aXRoX2RlZmF1bHRfb3B0aW9uYWxfcGFyYW1ldGVycygKICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgKToKICAgICAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jKAogICAgICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9cmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbT1yZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdD1yZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgICAgICBvcHRpb25hbF9wYXJhbT1vcHRpb25hbF9wYXJhbSwKICAgICAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdD1vcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgICkKICAgICAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jKAogICAgICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9cmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbT1yZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdD1yZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgICAgICBvcHRpb25hbF9wYXJhbT1vcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgICAgICBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQ9b3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmVfd2l0aF9kZWZhdWx0X29wdGlvbmFsX3BhcmFtZXRlcnMoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PUlucHV0KHR5cGU9InVyaV9maWxlIiwgcGF0aD0iaHR0cHM6Ly9kcHJlcGRhdGEuYmxvYi5jb3JlLndpbmRvd3MubmV0L2RlbW8vVGl0YW5pYy5jc3YiKSwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09ImhlbGxvIiwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0PSJyZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQiLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbT0ib3B0aW9uYWxfcGFyYW0iLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQ9Tm9uZSwKICAgICAgICApCiAgICAgICAgIyB0b2RvOiB1bmNvbW1lbnQgdGhpcyB3aGVuIGJhY2tlbmQgcmVtb3ZlIGNvbXBvbmVudCBqb2Igb3B0aW9uYWwgaW5wdXQgd2hpY2ggaXMgYmluZGluZyB0byBhIE5vbmUgcGlwZWxpbmUKICAgICAgICAjICBpbnB1dAogICAgICAgICMgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSwgZXhwZXJpbWVudF9uYW1lPSJkZWZhdWx0X29wdGlvbmFsX3BpcGVsaW5lIikKICAgICAgICBhc3NlcnQgIm9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCIgbm90IGluIHBpcGVsaW5lLmlucHV0cwogICAgICAgICMgYXNzZXJ0ICJvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQiIG5vdCBpbiBwaXBlbGluZV9qb2IuaW5wdXRzCiAgICAgICAgIyBhc3NlcnQgIm9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCIgbm90IGluIG5leHQocGlwZWxpbmVfam9iLmpvYnMudmFsdWVzKCkuX19pdGVyX18oKSkuaW5wdXRzCgogICAgQHB5dGVzdC5tYXJrLmRpc2FibGVfbW9ja19jb2RlX2hhc2gKICAgIEBweXRlc3QubWFyay5za2lwaWYoY29uZGl0aW9uPW5vdCBpc19saXZlKCksIHJlYXNvbj0icmV1c2UgdGVzdCwgdGFyZ2V0IHRvIHZlcmlmeSBzZXJ2aWNlLXNpZGUgYmVoYXZpb3IiKQogICAgZGVmIHRlc3RfY29tcG9uZW50X3JldXNlKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgcGF0aCA9ICIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50LnltbCIKICAgICAgICBjb21wb25lbnRfZnVuYzEgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9cGF0aCkKCiAgICAgICAgQGRzbC5waXBlbGluZSgpCiAgICAgICAgZGVmIHBpcGVsaW5lKGNvbXBvbmVudF9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoKToKICAgICAgICAgICAgbm9kZTEgPSBjb21wb25lbnRfZnVuYzEoY29tcG9uZW50X2luX251bWJlcj1jb21wb25lbnRfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5fcGF0aCkKICAgICAgICAgICAgbm9kZTIgPSBjb21wb25lbnRfZnVuYzEoY29tcG9uZW50X2luX251bWJlcj1jb21wb25lbnRfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5fcGF0aCkKCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMiA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1wYXRoKQogICAgICAgICAgICBub2RlMyA9IGNvbXBvbmVudF9mdW5jMihjb21wb25lbnRfaW5fbnVtYmVyPWNvbXBvbmVudF9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbl9wYXRoKQoKICAgICAgICAgICAgbm9kZTEuY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKICAgICAgICAgICAgbm9kZTIuY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKICAgICAgICAgICAgbm9kZTMuY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKCiAgICAgICAgcGlwZWxpbmUxID0gcGlwZWxpbmUoMTAsIGpvYl9pbnB1dCkKCiAgICAgICAgcGlwZWxpbmUxID0gY2xpZW50LmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUxKQoKICAgICAgICBjb21wb25lbnRfaWRzID0gc2V0KCkKICAgICAgICBmb3IgXywgam9iIGluIHBpcGVsaW5lMS5qb2JzLml0ZW1zKCk6CiAgICAgICAgICAgIGNvbXBvbmVudF9pZCA9IGpvYi5jb21wb25lbnQKICAgICAgICAgICAgY29tcG9uZW50X2lkcy5hZGQoY29tcG9uZW50X2lkKQoKICAgICAgICBhc3NlcnQgbGVuKGNvbXBvbmVudF9pZHMpID09IDEsIGYiR290IG11bHRpcGxlIGNvbXBvbmVudCBpZDoge2NvbXBvbmVudF9pZHN9IGZvciBzYW1lIGFub24gY29tcG9uZW50LiIKCiAgICBAcHl0ZXN0Lm1hcmsuZGlzYWJsZV9tb2NrX2NvZGVfaGFzaAogICAgQHB5dGVzdC5tYXJrLnNraXBpZihjb25kaXRpb249bm90IGlzX2xpdmUoKSwgcmVhc29uPSJyZXVzZSB0ZXN0LCB0YXJnZXQgdG8gdmVyaWZ5IHNlcnZpY2Utc2lkZSBiZWhhdmlvciIpCiAgICBkZWYgdGVzdF9waXBlbGluZV9yZXVzZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50LCByYW5kc3RyOiBDYWxsYWJsZVtbc3RyXSwgc3RyXSwgcmFuZGludDogQ2FsbGFibGUpIC0\u002BIE5vbmU6CiAgICAgICAgY29tcG9uZW50X3lhbWwgPSBjb21wb25lbnRzX2RpciAvICJoZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiCiAgICAgICAgY29tcG9uZW50X2Z1bmMxID0gbG9hZF9jb21wb25lbnQoc291cmNlPWNvbXBvbmVudF95YW1sLCBwYXJhbXNfb3ZlcnJpZGU9W3sibmFtZSI6IHJhbmRzdHIoImNvbXBvbmVudF9uYW1lIil9XSkKICAgICAgICBjb21wb25lbnRfZnVuYzIgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Y29tcG9uZW50X3lhbWwsIHBhcmFtc19vdmVycmlkZT1beyJuYW1lIjogcmFuZHN0cigiY29tcG9uZW50X25hbWUiKX1dKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBuYW1lPXJhbmRzdHIoInBpcGVsaW5lX25hbWUiKSwKICAgICAgICAgICAgZGVzY3JpcHRpb249IlRoZSBoZWxsbyB3b3JsZCBwaXBlbGluZSBqb2IiLAogICAgICAgICAgICB0YWdzPXsib3duZXIiOiAic2RrdGVhbSIsICJ0YWciOiAidGFndmFsdWUifSwKICAgICAgICAgICAgY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICAgICBleHBlcmltZW50X25hbWU9ZXhwZXJpbWVudF9uYW1lLAogICAgICAgICAgICBjb250aW51ZV9ydW5fb25fc3RlcF9mYWlsdXJlPVRydWUsCiAgICAgICAgKQogICAgICAgIGRlZiBwaXBlbGluZShqb2JfaW5fbnVtYmVyLCBqb2JfaW5fb3RoZXJfbnVtYmVyLCBqb2JfaW5fcGF0aCk6CiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMShjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQogICAgICAgICAgICBjb21wb25lbnRfZnVuYzIoY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fb3RoZXJfbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aCkKCiAgICAgICAgaW5wdXRfbnVtYmVyID0gcmFuZGludCgpCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZShpbnB1dF9udW1iZXIsIGlucHV0X251bWJlciwgam9iX2lucHV0KQogICAgICAgIGpvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUpCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgc2xlZXBfaWZfbGl2ZSgzMCkKICAgICAgICAgICAgY2hpbGRyZW4gPSBjbGllbnQuam9icy5saXN0KHBhcmVudF9qb2JfbmFtZT1qb2IubmFtZSkKICAgICAgICAgICAgY2hpbGRyZW4gPSBsaXN0KGNoaWxkcmVuKQogICAgICAgICAgICBpZiBsZW4oY2hpbGRyZW4pID09IDI6CiAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICBhc3NlcnQgbGVuKGNoaWxkcmVuKSA9PSAyCiAgICAgICAgY2hpbGQwLCBjaGlsZDEgPSBjaGlsZHJlbgogICAgICAgICMgY2hpbGRyZW4gc2VxdWVuY2UgaXMgbm90IGd1YXJhbnRlZWQsIHNvIHdlIG5lZWQgdG8gY2hlY2sgYm90aAogICAgICAgIGlmIFBpcGVsaW5lQ29uc3RhbnRzLlJFVVNFRF9GTEFHX0ZJRUxEIGluIGNoaWxkMC5wcm9wZXJ0aWVzLmtleXMoKToKICAgICAgICAgICAgYXNzZXJ0IGNoaWxkMC5wcm9wZXJ0aWVzW1BpcGVsaW5lQ29uc3RhbnRzLlJFVVNFRF9GTEFHX0ZJRUxEXSA9PSBQaXBlbGluZUNvbnN0YW50cy5SRVVTRURfRkxBR19UUlVFCiAgICAgICAgZWxpZiBQaXBlbGluZUNvbnN0YW50cy5SRVVTRURfRkxBR19GSUVMRCBpbiBjaGlsZDEucHJvcGVydGllcy5rZXlzKCk6CiAgICAgICAgICAgIGFzc2VydCBjaGlsZDEucHJvcGVydGllc1tQaXBlbGluZUNvbnN0YW50cy5SRVVTRURfRkxBR19GSUVMRF0gPT0gUGlwZWxpbmVDb25zdGFudHMuUkVVU0VEX0ZMQUdfVFJVRQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFzc2VydCBGYWxzZSwgIk5laXRoZXIgY2hpbGQgcmV1c2VzLiIKCiAgICBkZWYgdGVzdF9waXBlbGluZV93aXRoX2NvbXBvbmVudF9pbnB1dF9uYW1lX2Nhc2Uoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfZnVuYyA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICBzb3VyY2U9c3RyKGNvbXBvbmVudHNfZGlyIC8gImhlbGxvd29ybGRfY29tcG9uZW50X3dpdGhfdXBwZXJjYXNlX2lucHV0LnltbCIpCiAgICAgICAgKQoKICAgICAgICAjIGlucHV0IG5hbWUgaXMgdGhlIHNhbWUgd2l0aCB5YW1sIGRlZmluaXRpb24KICAgICAgICBAZHNsLnBpcGVsaW5lKGRlZmF1bHRfY29tcHV0ZT0iY3B1LWNsdXN0ZXIiKQogICAgICAgIGRlZiBoZWxsb193b3JsZF9waXBlbGluZShjb21wb25lbnRfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aCk6CiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9mdW5jKGNvbXBvbmVudF9Jbl9udW1iZXI9Y29tcG9uZW50X2luX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2luX3BhdGgpCgogICAgICAgIHBpcGVsaW5lID0gaGVsbG9fd29ybGRfcGlwZWxpbmUoY29tcG9uZW50X2luX251bWJlcj0xMCwgY29tcG9uZW50X2luX3BhdGg9am9iX2lucHV0KQogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUsIGV4cGVyaW1lbnRfbmFtZT1leHBlcmltZW50X25hbWUpCiAgICAgICAgYXNzZXJ0ICJjb21wb25lbnRfSW5fbnVtYmVyIiBpbiBuZXh0KHBpcGVsaW5lX2pvYi5qb2JzLnZhbHVlcygpLl9faXRlcl9fKCkpLmlucHV0cwoKICAgICAgICAjIGlucHV0IG5hbWUgaXMgbG93ZXIgY2FzZQogICAgICAgIEBkc2wucGlwZWxpbmUoZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIpCiAgICAgICAgZGVmIGhlbGxvX3dvcmxkX3BpcGVsaW5lKGNvbXBvbmVudF9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoKToKICAgICAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X2Z1bmMoY29tcG9uZW50X2luX251bWJlcj1jb21wb25lbnRfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5fcGF0aCkKCiAgICAgICAgcGlwZWxpbmUgPSBoZWxsb193b3JsZF9waXBlbGluZShjb21wb25lbnRfaW5fbnVtYmVyPTEwLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5wdXQpCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSwgZXhwZXJpbWVudF9uYW1lPWV4cGVyaW1lbnRfbmFtZSkKICAgICAgICBhc3NlcnQgImNvbXBvbmVudF9Jbl9udW1iZXIiIGluIG5leHQocGlwZWxpbmVfam9iLmpvYnMudmFsdWVzKCkuX19pdGVyX18oKSkuaW5wdXRzCgogICAgICAgICMgaW5wdXQgbmFtZSBpcyBlcXVhbCB0byB5YW1sIGRlZmluaXRpb24gaW5wdXQgaWYgYm90aCBjaGFuZ2UgdG8gbG93ZXIgY2FzZQogICAgICAgIEBkc2wucGlwZWxpbmUoZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIpCiAgICAgICAgZGVmIGhlbGxvX3dvcmxkX3BpcGVsaW5lKGNvbXBvbmVudF9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoKToKICAgICAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X2Z1bmMoY29tcG9uZW50X0luX051bWJlcj1jb21wb25lbnRfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5fcGF0aCkKCiAgICAgICAgcGlwZWxpbmUgPSBoZWxsb193b3JsZF9waXBlbGluZShjb21wb25lbnRfaW5fbnVtYmVyPTEwLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5wdXQpCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSwgZXhwZXJpbWVudF9uYW1lPWV4cGVyaW1lbnRfbmFtZSkKICAgICAgICBhc3NlcnQgImNvbXBvbmVudF9Jbl9udW1iZXIiIGluIG5leHQocGlwZWxpbmVfam9iLmpvYnMudmFsdWVzKCkuX19pdGVyX18oKSkuaW5wdXRzCgogICAgICAgICMgdHdvIGlkZW50aWNhbCBpbnB1dCBhcmUgZ2l2ZW4gaWYgaWdub3JlIGNhc2UKICAgICAgICBAZHNsLnBpcGVsaW5lKGRlZmF1bHRfY29tcHV0ZT0iY3B1LWNsdXN0ZXIiKQogICAgICAgIGRlZiBoZWxsb193b3JsZF9waXBlbGluZShjb21wb25lbnRfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aCk6CiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9mdW5jKGNvbXBvbmVudF9Jbl9udW1iZXI9Y29tcG9uZW50X2luX251bWJlciwgY29tcG9uZW50X2luX251bWJlcj1jb21wb25lbnRfaW5fcGF0aCkKCiAgICAgICAgd2l0aCBweXRlc3QucmFpc2VzKFZhbGlkYXRpb25FeGNlcHRpb24pIGFzIGV4OgogICAgICAgICAgICBoZWxsb193b3JsZF9waXBlbGluZShjb21wb25lbnRfaW5fbnVtYmVyPTEwLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5wdXQpCiAgICAgICAgYXNzZXJ0ICgKICAgICAgICAgICAgIkludmFsaWQgY29tcG9uZW50IGlucHV0IG5hbWVzICdjb21wb25lbnRfaW5fbnVtYmVyJyBhbmQgJ2NvbXBvbmVudF9Jbl9udW1iZXInLCB3aGljaCBhcmUgZXF1YWwiCiAgICAgICAgICAgIGluIGV4LnZhbHVlLm1lc3NhZ2UKICAgICAgICApCgogICAgZGVmIHRlc3RfcGlwZWxpbmVfam9iX2hlbHBfZnVuY3Rpb24oc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgeWFtbF9maWxlID0gIi4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnQueW1sIgoKICAgICAgICBAZHNsLnBpcGVsaW5lKGRlZmF1bHRfY29tcHV0ZT0iY3B1LWNsdXN0ZXIiKQogICAgICAgIGRlZiBwaXBlbGluZShudW1iZXIsIHBhdGgpOgogICAgICAgICAgICBjb21wb25lbnRfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT15YW1sX2ZpbGUpCiAgICAgICAgICAgIG5vZGUxID0gY29tcG9uZW50X2Z1bmMoY29tcG9uZW50X2luX251bWJlcj1udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPXBhdGgpCiAgICAgICAgICAgIHJldHVybiB7InBpcGVsaW5lX291dHB1dCI6IG5vZGUxLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRofQoKICAgICAgICBwaXBlbGluZTEgPSBwaXBlbGluZSgxMCwgam9iX2lucHV0KQogICAgICAgIHBpcGVsaW5lMSA9IGNsaWVudC5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lMSkKICAgICAgICB3aXRoIHBhdGNoKCJzeXMuc3Rkb3V0IiwgbmV3PVN0cmluZ0lPKCkpIGFzIHN0ZF9vdXQ6CiAgICAgICAgICAgIHByaW50KHBpcGVsaW5lMSkKICAgICAgICAgICAgYXNzZXJ0ICgKICAgICAgICAgICAgICAgICJkaXNwbGF5X25hbWU6IHBpcGVsaW5lXG50eXBlOiBwaXBlbGluZVxuaW5wdXRzOlxuICBudW1iZXI6ICcxMCdcbiAgcGF0aDpcbiAgICBtb2RlOiByb19tb3VudFxuICAgIHR5cGU6IHVyaV9maWxlXG4gICAgcGF0aDoiCiAgICAgICAgICAgICAgICBpbiBzdGRfb3V0LmdldHZhbHVlKCkKICAgICAgICAgICAgKQoKICAgIGRlZiB0ZXN0X25vZGVfcHJvcGVydHlfc2V0dGluZ192YWxpZGF0aW9uKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgcGF0aCA9ICIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50LnltbCIKICAgICAgICBjb21wb25lbnRfZnVuYzEgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9cGF0aCkKCiAgICAgICAgQGRzbC5waXBlbGluZSgpCiAgICAgICAgZGVmIHBpcGVsaW5lKGNvbXBvbmVudF9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoKToKICAgICAgICAgICAgbm9kZTEgPSBjb21wb25lbnRfZnVuYzEoY29tcG9uZW50X2luX251bWJlcj1jb21wb25lbnRfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5fcGF0aCkKICAgICAgICAgICAgbm9kZTEuamVmZl9zcGVjaWFsX29wdGlvbi5mb28gPSAiYmFyIgogICAgICAgICAgICBub2RlMS5jb21wdXRlID0gImNwdS1jbHVzdGVyIgoKICAgICAgICBkc2xfcGlwZWxpbmU6IFBpcGVsaW5lSm9iID0gcGlwZWxpbmUoMTAsIGpvYl9pbnB1dCkKICAgICAgICB3aXRoIHBhdGNoKCJhenVyZS5haS5tbC5lbnRpdGllcy5fdmFsaWRhdGlvbi5tb2R1bGVfbG9nZ2VyLmluZm8iKSBhcyBtb2NrX2xvZ2dpbmc6CiAgICAgICAgICAgIF8gPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKGRzbF9waXBlbGluZSkKICAgICAgICAgICAgbW9ja19sb2dnaW5nLmFzc2VydF9jYWxsZWRfd2l0aCgiV2FybmluZ3M6IFtqb2JzLm5vZGUxLmplZmZfc3BlY2lhbF9vcHRpb246IFVua25vd24gZmllbGQuXSIpCgogICAgZGVmIHRlc3RfYW5vbl9jb21wb25lbnRfaW5fcGlwZWxpbmUoCiAgICAgICAgc2VsZiwgY2xpZW50OiBNTENsaWVudCwgcmFuZHN0cjogQ2FsbGFibGVbW3N0cl0sIHN0cl0sIGhlbGxvX3dvcmxkX2NvbXBvbmVudDogQ29tcG9uZW50CiAgICApIC0\u002BIE5vbmU6CiAgICAgICAgaGVsbG9fd29ybGRfZnVuYyA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICBjbGllbnQ9Y2xpZW50LCBuYW1lPWhlbGxvX3dvcmxkX2NvbXBvbmVudC5uYW1lLCB2ZXJzaW9uPWhlbGxvX3dvcmxkX2NvbXBvbmVudC52ZXJzaW9uCiAgICAgICAgKQogICAgICAgIG9yaWdpbl9pZCA9IGhlbGxvX3dvcmxkX2Z1bmMuaWQKICAgICAgICBtcGlfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1zdHIoY29tcG9uZW50c19kaXIgLyAiaGVsbG93b3JsZF9jb21wb25lbnRfbXBpLnltbCIpKQogICAgICAgIGFzc2VydCBtcGlfZnVuYy5fdmFsaWRhdGUoKS5wYXNzZWQKCiAgICAgICAgaW52YWxpZF9jb21wb25lbnRfbmFtZSA9ICJfaW52YWxpZCIKCiAgICAgICAgIyBuYW1lIG9mIGFub255bW91cyBjb21wb25lbnQgaW4gcGlwZWxpbmUgam9iIHNob3VsZCBiZSBvdmVyd3JpdHRlbgogICAgICAgIG1waV9mdW5jLm5hbWUgPSBpbnZhbGlkX2NvbXBvbmVudF9uYW1lCiAgICAgICAgYXNzZXJ0IG5vdCBtcGlfZnVuYy5fdmFsaWRhdGUoKS5wYXNzZWQKCiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgbmFtZT1yYW5kc3RyKCJwaXBlbGluZV9uYW1lIiksCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJUaGUgaGVsbG8gd29ybGQgcGlwZWxpbmUgam9iIiwKICAgICAgICAgICAgdGFncz17Im93bmVyIjogInNka3RlYW0iLCAidGFnIjogInRhZ3ZhbHVlIn0sCiAgICAgICAgICAgIGNvbXB1dGU9ImdwdS1jbHVzdGVyIiwKICAgICAgICAgICAgZXhwZXJpbWVudF9uYW1lPWV4cGVyaW1lbnRfbmFtZSwKICAgICAgICAgICAgY29udGludWVfb25fc3RlcF9mYWlsdXJlPUZhbHNlLAogICAgICAgICkKICAgICAgICBkZWYgcGlwZWxpbmVfZGlzdHJpYnV0aW9uX2NvbXBvbmVudHMoam9iX2luX251bWJlciwgam9iX2luX3BhdGgpOgogICAgICAgICAgICBoZWxsb3dvcmxkX2NvbXBvbmVudCA9IGhlbGxvX3dvcmxkX2Z1bmMoY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aCkKICAgICAgICAgICAgaGVsbG93b3JsZF9jb21wb25lbnQub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGggPSBPdXRwdXQoZGF0YXNldD1EYXRhKG5hbWU9Im1sZGVzaWduZXJfY29tcG9uZW50X291dHB1dCIpKQogICAgICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfbXBpID0gbXBpX2Z1bmMoY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aCkKICAgICAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X21waS5kaXN0cmlidXRpb24gPSBNcGlEaXN0cmlidXRpb24oKQogICAgICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfbXBpLmRpc3RyaWJ1dGlvbi5wcm9jZXNzX2NvdW50X3Blcl9pbnN0YW5jZSA9IDIKCiAgICAgICAgcGlwZWxpbmU6IFBpcGVsaW5lSm9iID0gcGlwZWxpbmVfZGlzdHJpYnV0aW9uX2NvbXBvbmVudHMoMTAsIGpvYl9pbnB1dCkKICAgICAgICBhc3NlcnQgbXBpX2Z1bmMuX2lzX2Fub255bW91cyBpcyBGYWxzZQogICAgICAgIGFzc2VydCBwaXBlbGluZS5zZXR0aW5ncy5jb250aW51ZV9vbl9zdGVwX2ZhaWx1cmUgaXMgRmFsc2UKICAgICAgICBjcmVhdGVkX2pvYjogUGlwZWxpbmVKb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKAogICAgICAgICAgICBwaXBlbGluZSwgZXhwZXJpbWVudF9uYW1lPWV4cGVyaW1lbnRfbmFtZSwgY29udGludWVfb25fc3RlcF9mYWlsdXJlPVRydWUKICAgICAgICApCiAgICAgICAgIyBUaGVvcmV0aWNhbGx5LCB3ZSBzaG91bGQga2VlcCB0aGUgaW52YWxpZCBuYW1lIGluIHJlcXVlc3QgYm9keSwKICAgICAgICAjIGFzIGNvbXBvbmVudCBuYW1lIHZhbGlkIGluIGF6dXJlbWwtY29tcG9uZW50cyBtYXliZSBpbnZhbGlkIGluIGF6dXJlLWFpLW1sLgogICAgICAgICMgU28gd2UgbGVhdmUgdGhpcyB2YWxpZGF0aW9uIHRvIHNlcnZlci1zaWRlIGZvciBub3cuCiAgICAgICAgYXNzZXJ0IG1waV9mdW5jLl90b19yZXN0X29iamVjdCgpLnByb3BlcnRpZXMuY29tcG9uZW50X3NwZWNbIm5hbWUiXSA9PSBpbnZhbGlkX2NvbXBvbmVudF9uYW1lCgogICAgICAgICMgY29udGludWVfb25fc3RlcF9mYWlsdXJlIGNhbid0IGJlIHNldCBpbiBjcmVhdGVfb3JfdXBkYXRlCiAgICAgICAgYXNzZXJ0IGNyZWF0ZWRfam9iLnNldHRpbmdzLmNvbnRpbnVlX29uX3N0ZXBfZmFpbHVyZSBpcyBGYWxzZQogICAgICAgIGFzc2VydCBjcmVhdGVkX2pvYi5qb2JzWyJoZWxsb193b3JsZF9jb21wb25lbnRfbXBpIl0uY29tcG9uZW50LnN0YXJ0c3dpdGgoQU5PTllNT1VTX0NPTVBPTkVOVF9OQU1FKQogICAgICAgIGFzc2VydCBjcmVhdGVkX2pvYi5qb2JzWyJoZWxsb3dvcmxkX2NvbXBvbmVudCJdLmNvbXBvbmVudCA9PSAibWljcm9zb2Z0c2FtcGxlc19jb21tYW5kX2NvbXBvbmVudF9iYXNpYzowLjAuMSIKICAgICAgICBhc3NlcnQgaGVsbG9fd29ybGRfZnVuYy5faXNfYW5vbnltb3VzIGlzIEZhbHNlCiAgICAgICAgYXNzZXJ0IG9yaWdpbl9pZCA9PSBoZWxsb193b3JsZF9mdW5jLmlkCgogICAgZGVmIHRlc3RfcGlwZWxpbmVfZm9yY2VfcmVydW4oc2VsZiwgY2xpZW50OiBNTENsaWVudCwgcmFuZHN0cjogQ2FsbGFibGVbW3N0cl0sIHN0cl0pIC0\u002BIE5vbmU6CiAgICAgICAgY29tcG9uZW50X3lhbWwgPSBjb21wb25lbnRzX2RpciAvICJoZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiCiAgICAgICAgY29tcG9uZW50X2Z1bmMxID0gbG9hZF9jb21wb25lbnQoc291cmNlPWNvbXBvbmVudF95YW1sLCBwYXJhbXNfb3ZlcnJpZGU9W3sibmFtZSI6IHJhbmRzdHIoImNvbXBvbmVudF9uYW1lIil9XSkKICAgICAgICBjb21wb25lbnRfZnVuYzIgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Y29tcG9uZW50X3lhbWwsIHBhcmFtc19vdmVycmlkZT1beyJuYW1lIjogcmFuZHN0cigiY29tcG9uZW50X25hbWUiKX1dKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBuYW1lPXJhbmRzdHIoInBpcGVsaW5lX25hbWUiKSwKICAgICAgICAgICAgZGVzY3JpcHRpb249IlRoZSBoZWxsbyB3b3JsZCBwaXBlbGluZSBqb2IiLAogICAgICAgICAgICB0YWdzPXsib3duZXIiOiAic2RrdGVhbSIsICJ0YWciOiAidGFndmFsdWUifSwKICAgICAgICAgICAgY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICAgICBleHBlcmltZW50X25hbWU9ZXhwZXJpbWVudF9uYW1lLAogICAgICAgICAgICBjb250aW51ZV9vbl9zdGVwX2ZhaWx1cmU9VHJ1ZSwKICAgICAgICApCiAgICAgICAgZGVmIHBpcGVsaW5lKGpvYl9pbl9udW1iZXIsIGpvYl9pbl9vdGhlcl9udW1iZXIsIGpvYl9pbl9wYXRoKToKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMxKGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9am9iX2luX3BhdGgpCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMihjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9vdGhlcl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lKDEwLCAxNSwgam9iX2lucHV0KQogICAgICAgIGpvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUpCiAgICAgICAgYXNzZXJ0IGpvYi5zZXR0aW5ncy5mb3JjZV9yZXJ1biBpcyBOb25lCgogICAgICAgIEBkc2wucGlwZWxpbmUoCiAgICAgICAgICAgIG5hbWU9cmFuZHN0cigicGlwZWxpbmVfbmFtZSIpLAogICAgICAgICAgICBkZXNjcmlwdGlvbj0iVGhlIGhlbGxvIHdvcmxkIHBpcGVsaW5lIGpvYiIsCiAgICAgICAgICAgIHRhZ3M9eyJvd25lciI6ICJzZGt0ZWFtIiwgInRhZyI6ICJ0YWd2YWx1ZSJ9LAogICAgICAgICAgICBjb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgICAgIGV4cGVyaW1lbnRfbmFtZT1leHBlcmltZW50X25hbWUsCiAgICAgICAgICAgIGNvbnRpbnVlX29uX3N0ZXBfZmFpbHVyZT1UcnVlLAogICAgICAgICAgICBmb3JjZV9yZXJ1bj1UcnVlLAogICAgICAgICkKICAgICAgICBkZWYgcGlwZWxpbmUoam9iX2luX251bWJlciwgam9iX2luX290aGVyX251bWJlciwgam9iX2luX3BhdGgpOgogICAgICAgICAgICBjb21wb25lbnRfZnVuYzEoY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aCkKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMyKGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX290aGVyX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9am9iX2luX3BhdGgpCgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmUoMTAsIDE1LCBqb2JfaW5wdXQpCiAgICAgICAgam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSwgZm9yY2VfcmVydW49VHJ1ZSkKICAgICAgICBhc3NlcnQgam9iLnNldHRpbmdzLmZvcmNlX3JlcnVuIGlzIFRydWUKCiAgICBkZWYgdGVzdF9wYXJhbGxlbF9jb21wb25lbnRzX3dpdGhfdGFidWxhcl9pbnB1dChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGNvbXBvbmVudHNfZGlyID0gdGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2RzbF9waXBlbGluZS9wYXJhbGxlbF9jb21wb25lbnRfd2l0aF90YWJ1bGFyX2lucHV0IgoKICAgICAgICBiYXRjaF9pbmZlcmVuY2UgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9c3RyKGNvbXBvbmVudHNfZGlyIC8gInRhYnVsYXJfaW5wdXRfZTJlLnltbCIpKQoKICAgICAgICAjIENvbnN0cnVjdCBwaXBlbGluZQogICAgICAgIEBkc2wucGlwZWxpbmUoZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIpCiAgICAgICAgZGVmIHBhcmFsbGVsX2luX3BpcGVsaW5lKGpvYl9kYXRhX3BhdGgsIHNjb3JlX21vZGVsKToKICAgICAgICAgICAgYmF0Y2hfaW5mZXJlbmNlX25vZGUgPSBiYXRjaF9pbmZlcmVuY2Uoam9iX2RhdGFfcGF0aD1qb2JfZGF0YV9wYXRoLCBzY29yZV9tb2RlbD1zY29yZV9tb2RlbCkKICAgICAgICAgICAgYmF0Y2hfaW5mZXJlbmNlX25vZGUubWluaV9iYXRjaF9zaXplID0gNQoKICAgICAgICBwaXBlbGluZSA9IHBhcmFsbGVsX2luX3BpcGVsaW5lKAogICAgICAgICAgICBqb2JfZGF0YV9wYXRoPUlucHV0KAogICAgICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgICAgICBwYXRoPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9kYXRhc2V0L25ldXJhbC1pcmlzLW1sdGFibGUiLAogICAgICAgICAgICAgICAgbW9kZT1JbnB1dE91dHB1dE1vZGVzLkRJUkVDVCwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgc2NvcmVfbW9kZWw9SW5wdXQoCiAgICAgICAgICAgICAgICBwYXRoPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9tb2RlbCIsIHR5cGU9QXNzZXRUeXBlcy5VUklfRk9MREVSLCBtb2RlPUlucHV0T3V0cHV0TW9kZXMuRE9XTkxPQUQKICAgICAgICAgICAgKSwKICAgICAgICApCiAgICAgICAgIyBzdWJtaXQgcGlwZWxpbmUgam9iCiAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCwgZXhwZXJpbWVudF9uYW1lPSJwYXJhbGxlbF9pbl9waXBlbGluZSIpCgogICAgICAgICMgY2hlY2sgcmVxdWlyZWQgZmllbGRzIGluIGpvYiBkaWN0CiAgICAgICAgam9iX2RpY3QgPSBwaXBlbGluZV9qb2IuX3RvX2RpY3QoKQogICAgICAgIGV4cGVjdGVkX2tleXMgPSBbInN0YXR1cyIsICJwcm9wZXJ0aWVzIiwgImNyZWF0aW9uX2NvbnRleHQiXQogICAgICAgIGZvciBrIGluIGV4cGVjdGVkX2tleXM6CiAgICAgICAgICAgIGFzc2VydCBrIGluIGpvYl9kaWN0LmtleXMoKSwgZiJmYWlsZWQgdG8gZ2V0IHtrfSBpbiB7am9iX2RpY3R9IgoKICAgICAgICAjIG9yaWdpbmFsIGpvYiBkaWQgbm90IGNoYW5nZQogICAgICAgIGFzc2VydF9qb2JfaW5wdXRfb3V0cHV0X3R5cGVzKHBpcGVsaW5lX2pvYikKICAgICAgICBhc3NlcnQgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9PSAiY3B1LWNsdXN0ZXIiCgogICAgZGVmIHRlc3RfcGFyYWxsZWxfY29tcG9uZW50c193aXRoX3RhYnVsYXJfaW5wdXRfYmluZF90b19saXRlcmFsX2lucHV0KHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgY29tcG9uZW50c19kaXIgPSB0ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvZHNsX3BpcGVsaW5lL3BhcmFsbGVsX2NvbXBvbmVudF93aXRoX3RhYnVsYXJfaW5wdXQiCgogICAgICAgIGJhdGNoX2luZmVyZW5jZSA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1zdHIoY29tcG9uZW50c19kaXIgLyAidGFidWxhcl9pbnB1dF9lMmUueW1sIikpCgogICAgICAgICMgQ29uc3RydWN0IHBpcGVsaW5lCiAgICAgICAgQGRzbC5waXBlbGluZShkZWZhdWx0X2NvbXB1dGU9ImNwdS1jbHVzdGVyIikKICAgICAgICBkZWYgcGFyYWxsZWxfaW5fcGlwZWxpbmUoam9iX2RhdGFfcGF0aCwgc2NvcmVfbW9kZWwsIGxpdGVyYWxfaW5wdXQpOgogICAgICAgICAgICBiYXRjaF9pbmZlcmVuY2Vfbm9kZSA9IGJhdGNoX2luZmVyZW5jZShqb2JfZGF0YV9wYXRoPWpvYl9kYXRhX3BhdGgsIHNjb3JlX21vZGVsPXNjb3JlX21vZGVsKQogICAgICAgICAgICBiYXRjaF9pbmZlcmVuY2Vfbm9kZS5taW5pX2JhdGNoX3NpemUgPSA1CiAgICAgICAgICAgIGJhdGNoX2luZmVyZW5jZV9ub2RlLm1heF9jb25jdXJyZW5jeV9wZXJfaW5zdGFuY2UgPSBsaXRlcmFsX2lucHV0CiAgICAgICAgICAgIGJhdGNoX2luZmVyZW5jZV9ub2RlLmVycm9yX3RocmVzaG9sZCA9IGxpdGVyYWxfaW5wdXQKICAgICAgICAgICAgYmF0Y2hfaW5mZXJlbmNlX25vZGUubWluaV9iYXRjaF9lcnJvcl90aHJlc2hvbGQgPSBsaXRlcmFsX2lucHV0CgogICAgICAgIHBpcGVsaW5lID0gcGFyYWxsZWxfaW5fcGlwZWxpbmUoCiAgICAgICAgICAgIGpvYl9kYXRhX3BhdGg9SW5wdXQoCiAgICAgICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgICAgIHBhdGg9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2RhdGFzZXQvbmV1cmFsLWlyaXMtbWx0YWJsZSIsCiAgICAgICAgICAgICAgICBtb2RlPUlucHV0T3V0cHV0TW9kZXMuRElSRUNULAogICAgICAgICAgICApLAogICAgICAgICAgICBzY29yZV9tb2RlbD1JbnB1dCgKICAgICAgICAgICAgICAgIHBhdGg9Ii4vdGVzdHMvdGVzdF9jb25maWdzL21vZGVsIiwgdHlwZT1Bc3NldFR5cGVzLlVSSV9GT0xERVIsIG1vZGU9SW5wdXRPdXRwdXRNb2Rlcy5ET1dOTE9BRAogICAgICAgICAgICApLAogICAgICAgICAgICBsaXRlcmFsX2lucHV0PTIsCiAgICAgICAgKQogICAgICAgICMgc3VibWl0IHBpcGVsaW5lIGpvYgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQsIGV4cGVyaW1lbnRfbmFtZT0icGFyYWxsZWxfaW5fcGlwZWxpbmUiKQoKICAgICAgICAjIGNoZWNrIHJlcXVpcmVkIGZpZWxkcyBpbiBqb2IgZGljdAogICAgICAgIGpvYl9kaWN0ID0gcGlwZWxpbmVfam9iLl90b19kaWN0KCkKICAgICAgICBleHBlY3RlZF9rZXlzID0gWyJzdGF0dXMiLCAicHJvcGVydGllcyIsICJjcmVhdGlvbl9jb250ZXh0Il0KICAgICAgICBmb3IgayBpbiBleHBlY3RlZF9rZXlzOgogICAgICAgICAgICBhc3NlcnQgayBpbiBqb2JfZGljdC5rZXlzKCksIGYiZmFpbGVkIHRvIGdldCB7a30gaW4ge2pvYl9kaWN0fSIKCiAgICAgICAgIyBvcmlnaW5hbCBqb2IgZGlkIG5vdCBjaGFuZ2UKICAgICAgICBhc3NlcnRfam9iX2lucHV0X291dHB1dF90eXBlcyhwaXBlbGluZV9qb2IpCiAgICAgICAgYXNzZXJ0IHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPT0gImNwdS1jbHVzdGVyIgoKICAgIGRlZiB0ZXN0X3BhcmFsbGVsX2NvbXBvbmVudHNfd2l0aF9maWxlX2lucHV0KHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgY29tcG9uZW50c19kaXIgPSB0ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvZHNsX3BpcGVsaW5lL3BhcmFsbGVsX2NvbXBvbmVudF93aXRoX2ZpbGVfaW5wdXQiCgogICAgICAgIGJhdGNoX2luZmVyZW5jZSA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1zdHIoY29tcG9uZW50c19kaXIgLyAic2NvcmUueW1sIikpCgogICAgICAgICMgQ29uc3RydWN0IHBpcGVsaW5lCiAgICAgICAgQGRzbC5waXBlbGluZShkZWZhdWx0X2NvbXB1dGU9ImNwdS1jbHVzdGVyIikKICAgICAgICBkZWYgcGFyYWxsZWxfaW5fcGlwZWxpbmUoam9iX2RhdGFfcGF0aCk6CiAgICAgICAgICAgIGJhdGNoX2luZmVyZW5jZV9ub2RlID0gYmF0Y2hfaW5mZXJlbmNlKGpvYl9kYXRhX3BhdGg9am9iX2RhdGFfcGF0aCkKICAgICAgICAgICAgYmF0Y2hfaW5mZXJlbmNlX25vZGUubWluaV9iYXRjaF9zaXplID0gNQoKICAgICAgICBwaXBlbGluZSA9IHBhcmFsbGVsX2luX3BpcGVsaW5lKAogICAgICAgICAgICBqb2JfZGF0YV9wYXRoPUlucHV0KAogICAgICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgICAgICBwYXRoPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9kYXRhc2V0L21uaXN0LWRhdGEiLAogICAgICAgICAgICAgICAgbW9kZT1JbnB1dE91dHB1dE1vZGVzLkVWQUxfTU9VTlQsCiAgICAgICAgICAgICksCiAgICAgICAgKQogICAgICAgICMgc3VibWl0IHBpcGVsaW5lIGpvYgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQsIGV4cGVyaW1lbnRfbmFtZT0icGFyYWxsZWxfaW5fcGlwZWxpbmUiKQogICAgICAgICMgY2hlY2sgcmVxdWlyZWQgZmllbGRzIGluIGpvYiBkaWN0CiAgICAgICAgam9iX2RpY3QgPSBwaXBlbGluZV9qb2IuX3RvX2RpY3QoKQogICAgICAgIGV4cGVjdGVkX2tleXMgPSBbInN0YXR1cyIsICJwcm9wZXJ0aWVzIiwgImNyZWF0aW9uX2NvbnRleHQiXQogICAgICAgIGZvciBrIGluIGV4cGVjdGVkX2tleXM6CiAgICAgICAgICAgIGFzc2VydCBrIGluIGpvYl9kaWN0LmtleXMoKSwgZiJmYWlsZWQgdG8gZ2V0IHtrfSBpbiB7am9iX2RpY3R9IgoKICAgICAgICAjIG9yaWdpbmFsIGpvYiBkaWQgbm90IGNoYW5nZQogICAgICAgIGFzc2VydF9qb2JfaW5wdXRfb3V0cHV0X3R5cGVzKHBpcGVsaW5lX2pvYikKICAgICAgICBhc3NlcnQgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9PSAiY3B1LWNsdXN0ZXIiCgogICAgZGVmIHRlc3RfcGFyYWxsZWxfcnVuX2Z1bmN0aW9uKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGRhdGEgPSBJbnB1dCgKICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgIHBhdGg9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2RhdGFzZXQvbW5pc3QtZGF0YSIsCiAgICAgICAgICAgIG1vZGU9SW5wdXRPdXRwdXRNb2Rlcy5FVkFMX01PVU5ULAogICAgICAgICkKICAgICAgICBwaXBlbGluZSA9IGJ1aWxkX3BpcGVsaW5lX3dpdGhfcGFyYWxsZWxfcnVuX2Z1bmN0aW9uKGRhdGEpCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lKSAgIyBzdWJtaXQgcGlwZWxpbmUgam9iCgogICAgICAgIGFjdHVhbF9qb2IgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLnByb3BlcnRpZXMuYXNfZGljdCgpLCAqY29tbW9uX29taXRfZmllbGRzKQogICAgICAgIGV4cGVjdGVkX2pvYiA9IHsKICAgICAgICAgICAgInRhZ3MiOiB7fSwKICAgICAgICAgICAgImlzX2FyY2hpdmVkIjogRmFsc2UsCiAgICAgICAgICAgICJqb2JfdHlwZSI6ICJQaXBlbGluZSIsCiAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAiam9iX2RhdGFfcGF0aCI6IHsiam9iX2lucHV0X3R5cGUiOiAibWx0YWJsZSIsICJtb2RlIjogIkV2YWxNb3VudCJ9LAogICAgICAgICAgICB9LAogICAgICAgICAgICAiam9icyI6IHsKICAgICAgICAgICAgICAgICJub2RlMSI6IHsKICAgICAgICAgICAgICAgICAgICAiaW5wdXRfZGF0YSI6ICIke3tpbnB1dHMuam9iX2RhdGFfcGF0aH19IiwKICAgICAgICAgICAgICAgICAgICAiZGlzcGxheV9uYW1lIjogIm15LWV2YWx1YXRlLWpvYiIsCiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9kYXRhX3BhdGgiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5qb2JfZGF0YV9wYXRofX0iLAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJub2RlMSIsCiAgICAgICAgICAgICAgICAgICAgIm1pbmlfYmF0Y2hfc2l6ZSI6IDUsCiAgICAgICAgICAgICAgICAgICAgImxvZ2dpbmdfbGV2ZWwiOiAiREVCVUciLAogICAgICAgICAgICAgICAgICAgICJtYXhfY29uY3VycmVuY3lfcGVyX2luc3RhbmNlIjogMSwKICAgICAgICAgICAgICAgICAgICAiZXJyb3JfdGhyZXNob2xkIjogMSwKICAgICAgICAgICAgICAgICAgICAibWluaV9iYXRjaF9lcnJvcl90aHJlc2hvbGQiOiAxLAogICAgICAgICAgICAgICAgICAgICJvdXRwdXRzIjogeyJqb2Jfb3V0cHV0X3BhdGgiOiB7InR5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy5waXBlbGluZV9vdXRwdXR9fSJ9fSwKICAgICAgICAgICAgICAgICAgICAicmVzb3VyY2VzIjogeyJpbnN0YW5jZV9jb3VudCI6IDJ9LAogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogInBhcmFsbGVsIiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJvdXRwdXRzIjogewogICAgICAgICAgICAgICAgInBpcGVsaW5lX291dHB1dCI6IHsKICAgICAgICAgICAgICAgICAgICAibW9kZSI6ICJSZWFkV3JpdGVNb3VudCIsCiAgICAgICAgICAgICAgICAgICAgImpvYl9vdXRwdXRfdHlwZSI6ICJ1cmlfZm9sZGVyIiwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgInNldHRpbmdzIjogeyJkZWZhdWx0X2NvbXB1dGUiOiAiY3B1LWNsdXN0ZXIifSwKICAgICAgICB9CiAgICAgICAgYXNzZXJ0IGV4cGVjdGVkX2pvYiA9PSBhY3R1YWxfam9iCgogICAgICAgICMgY2hlY2sgcmVxdWlyZWQgZmllbGRzIGluIGpvYiBkaWN0CiAgICAgICAgam9iX2RpY3QgPSBwaXBlbGluZV9qb2IuX3RvX2RpY3QoKQogICAgICAgIGV4cGVjdGVkX2tleXMgPSBbInN0YXR1cyIsICJwcm9wZXJ0aWVzIiwgImNyZWF0aW9uX2NvbnRleHQiXQogICAgICAgIGZvciBrIGluIGV4cGVjdGVkX2tleXM6CiAgICAgICAgICAgIGFzc2VydCBrIGluIGpvYl9kaWN0LmtleXMoKSwgZiJmYWlsZWQgdG8gZ2V0IHtrfSBpbiB7am9iX2RpY3R9IgoKICAgICAgICAjIG9yaWdpbmFsIGpvYiBkaWQgbm90IGNoYW5nZQogICAgICAgIGFzc2VydF9qb2JfaW5wdXRfb3V0cHV0X3R5cGVzKHBpcGVsaW5lX2pvYikKICAgICAgICBhc3NlcnQgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9PSAiY3B1LWNsdXN0ZXIiCgogICAgZGVmIHRlc3RfcGFyYWxsZWxfcnVuX2Z1bmN0aW9uX3J1bl9zZXR0aW5nc19iaW5kX3RvX2xpdGVyYWxfaW5wdXQoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgZGF0YSA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvZGF0YXNldC9tbmlzdC1kYXRhIiwKICAgICAgICAgICAgbW9kZT1JbnB1dE91dHB1dE1vZGVzLkVWQUxfTU9VTlQsCiAgICAgICAgKQogICAgICAgIHBpcGVsaW5lID0gYnVpbGRfcGlwZWxpbmVfd2l0aF9wYXJhbGxlbF9ydW5fZnVuY3Rpb24oZGF0YSwgMikKCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUpICAjIHN1Ym1pdCBwaXBlbGluZSBqb2IKCiAgICAgICAgYWN0dWFsX2pvYiA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkucHJvcGVydGllcy5hc19kaWN0KCksICpjb21tb25fb21pdF9maWVsZHMpCiAgICAgICAgZXhwZWN0ZWRfam9iID0gewogICAgICAgICAgICAidGFncyI6IHt9LAogICAgICAgICAgICAiaXNfYXJjaGl2ZWQiOiBGYWxzZSwKICAgICAgICAgICAgImpvYl90eXBlIjogIlBpcGVsaW5lIiwKICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICJqb2JfZGF0YV9wYXRoIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJtbHRhYmxlIiwgIm1vZGUiOiAiRXZhbE1vdW50In0sCiAgICAgICAgICAgICAgICAibGl0ZXJhbF9pbnB1dCI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIyIn0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJqb2JzIjogewogICAgICAgICAgICAgICAgIm5vZGUxIjogewogICAgICAgICAgICAgICAgICAgICJpbnB1dF9kYXRhIjogIiR7e2lucHV0cy5qb2JfZGF0YV9wYXRofX0iLAogICAgICAgICAgICAgICAgICAgICJkaXNwbGF5X25hbWUiOiAibXktZXZhbHVhdGUtam9iIiwKICAgICAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAiam9iX2RhdGFfcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmpvYl9kYXRhX3BhdGh9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIm5vZGUxIiwKICAgICAgICAgICAgICAgICAgICAibWluaV9iYXRjaF9zaXplIjogNSwKICAgICAgICAgICAgICAgICAgICAibG9nZ2luZ19sZXZlbCI6ICJERUJVRyIsCiAgICAgICAgICAgICAgICAgICAgIm1heF9jb25jdXJyZW5jeV9wZXJfaW5zdGFuY2UiOiAiJHt7cGFyZW50LmlucHV0cy5saXRlcmFsX2lucHV0fX0iLAogICAgICAgICAgICAgICAgICAgICJlcnJvcl90aHJlc2hvbGQiOiAiJHt7cGFyZW50LmlucHV0cy5saXRlcmFsX2lucHV0fX0iLAogICAgICAgICAgICAgICAgICAgICJtaW5pX2JhdGNoX2Vycm9yX3RocmVzaG9sZCI6ICIke3twYXJlbnQuaW5wdXRzLmxpdGVyYWxfaW5wdXR9fSIsCiAgICAgICAgICAgICAgICAgICAgIm91dHB1dHMiOiB7ImpvYl9vdXRwdXRfcGF0aCI6IHsidHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5vdXRwdXRzLnBpcGVsaW5lX291dHB1dH19In19LAogICAgICAgICAgICAgICAgICAgICJyZXNvdXJjZXMiOiB7Imluc3RhbmNlX2NvdW50IjogIiR7e3BhcmVudC5pbnB1dHMubGl0ZXJhbF9pbnB1dH19In0sCiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAicGFyYWxsZWwiLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm91dHB1dHMiOiB7CiAgICAgICAgICAgICAgICAicGlwZWxpbmVfb3V0cHV0IjogewogICAgICAgICAgICAgICAgICAgICJtb2RlIjogIlJlYWRXcml0ZU1vdW50IiwKICAgICAgICAgICAgICAgICAgICAiam9iX291dHB1dF90eXBlIjogInVyaV9mb2xkZXIiLAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAic2V0dGluZ3MiOiB7ImRlZmF1bHRfY29tcHV0ZSI6ICJjcHUtY2x1c3RlciJ9LAogICAgICAgIH0KICAgICAgICBhc3NlcnQgZXhwZWN0ZWRfam9iID09IGFjdHVhbF9qb2IKICAgICAgICAjIGNoZWNrIHJlcXVpcmVkIGZpZWxkcyBpbiBqb2IgZGljdAogICAgICAgIGpvYl9kaWN0ID0gcGlwZWxpbmVfam9iLl90b19kaWN0KCkKICAgICAgICBleHBlY3RlZF9rZXlzID0gWyJzdGF0dXMiLCAicHJvcGVydGllcyIsICJjcmVhdGlvbl9jb250ZXh0Il0KICAgICAgICBmb3IgayBpbiBleHBlY3RlZF9rZXlzOgogICAgICAgICAgICBhc3NlcnQgayBpbiBqb2JfZGljdC5rZXlzKCksIGYiZmFpbGVkIHRvIGdldCB7a30gaW4ge2pvYl9kaWN0fSIKCiAgICAgICAgIyBvcmlnaW5hbCBqb2IgZGlkIG5vdCBjaGFuZ2UKICAgICAgICBhc3NlcnRfam9iX2lucHV0X291dHB1dF90eXBlcyhwaXBlbGluZV9qb2IpCiAgICAgICAgYXNzZXJ0IHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPT0gImNwdS1jbHVzdGVyIgoKICAgIGRlZiB0ZXN0X3BhcmFsbGVsX2pvYihzZWxmLCByYW5kc3RyOiBDYWxsYWJsZVtbc3RyXSwgc3RyXSwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgZW52aXJvbm1lbnQgPSAiQXp1cmVNTC1za2xlYXJuLTEuMC11YnVudHUyMC4wNC1weTM4LWNwdTozMyIKICAgICAgICBpbnB1dHMgPSB7CiAgICAgICAgICAgICJqb2JfZGF0YV9wYXRoIjogSW5wdXQoCiAgICAgICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgICAgIHBhdGg9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2RhdGFzZXQvbW5pc3QtZGF0YSIsCiAgICAgICAgICAgICAgICBtb2RlPUlucHV0T3V0cHV0TW9kZXMuRVZBTF9NT1VOVCwKICAgICAgICAgICAgKSwKICAgICAgICB9CiAgICAgICAgaW5wdXRfZGF0YSA9ICIke3tpbnB1dHMuam9iX2RhdGFfcGF0aH19IgogICAgICAgIG91dHB1dHMgPSB7ImpvYl9vdXRwdXRfcGF0aCI6IE91dHB1dCh0eXBlPUFzc2V0VHlwZXMuVVJJX0ZPTERFUiwgbW9kZT0icndfbW91bnQiKX0KICAgICAgICByZXNvdXJjZXMgPSB7Imluc3RhbmNlX2NvdW50IjogMn0KICAgICAgICB0YXNrID0gUnVuRnVuY3Rpb24oCiAgICAgICAgICAgIGNvZGU9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2RzbF9waXBlbGluZS9wYXJhbGxlbF9jb21wb25lbnRfd2l0aF9maWxlX2lucHV0L3NyYy8iLAogICAgICAgICAgICBlbnRyeV9zY3JpcHQ9InNjb3JlLnB5IiwKICAgICAgICAgICAgcHJvZ3JhbV9hcmd1bWVudHM9Ii0tam9iX291dHB1dF9wYXRoICR7e291dHB1dHMuam9iX291dHB1dF9wYXRofX0iLAogICAgICAgICAgICBlbnZpcm9ubWVudD1lbnZpcm9ubWVudCwKICAgICAgICApCiAgICAgICAgbG9nZ2luZ19sZXZlbCA9ICJERUJVRyIKICAgICAgICBtYXhfY29uY3VycmVuY3lfcGVyX2luc3RhbmNlID0gMQogICAgICAgIGVycm9yX3RocmVzaG9sZCA9IDEKICAgICAgICBtaW5pX2JhdGNoX2Vycm9yX3RocmVzaG9sZCA9IDEKICAgICAgICBtaW5pX2JhdGNoX3NpemUgPSAiNSIKICAgICAgICBlbnZpcm9ubWVudF92YXJpYWJsZXMgPSB7ImVudmlyb25tZW50IjogInZhbCJ9CgogICAgICAgIEBkc2wucGlwZWxpbmUoCiAgICAgICAgICAgIG5hbWU9cmFuZHN0cigicGlwZWxpbmVfbmFtZSIpLAogICAgICAgICAgICBkZXNjcmlwdGlvbj0iVGhlIHBpcGVsaW5lIGpvYiB3aXRoIHBhcmFsbGVsIGZ1bmN0aW9uIiwKICAgICAgICAgICAgdGFncz17Im93bmVyIjogInNka3RlYW0iLCAidGFnIjogInRhZ3ZhbHVlIn0sCiAgICAgICAgKQogICAgICAgIGRlZiBwYXJhbGxlbF9pbl9waXBlbGluZShqb2JfZGF0YV9wYXRoKToKICAgICAgICAgICAgcGFyYWxsZWxfam9iID0gUGFyYWxsZWxKb2IoCiAgICAgICAgICAgICAgICBkaXNwbGF5X25hbWU9Im15LWV2YWx1YXRlLWpvYiIsCiAgICAgICAgICAgICAgICByZXNvdXJjZXM9cmVzb3VyY2VzLAogICAgICAgICAgICAgICAgbWluaV9iYXRjaF9zaXplPW1pbmlfYmF0Y2hfc2l6ZSwKICAgICAgICAgICAgICAgIHRhc2s9dGFzaywKICAgICAgICAgICAgICAgIGlucHV0X2RhdGE9aW5wdXRfZGF0YSwKICAgICAgICAgICAgICAgIGxvZ2dpbmdfbGV2ZWw9bG9nZ2luZ19sZXZlbCwKICAgICAgICAgICAgICAgIG1heF9jb25jdXJyZW5jeV9wZXJfaW5zdGFuY2U9bWF4X2NvbmN1cnJlbmN5X3Blcl9pbnN0YW5jZSwKICAgICAgICAgICAgICAgIGVycm9yX3RocmVzaG9sZD1lcnJvcl90aHJlc2hvbGQsCiAgICAgICAgICAgICAgICBtaW5pX2JhdGNoX2Vycm9yX3RocmVzaG9sZD1taW5pX2JhdGNoX2Vycm9yX3RocmVzaG9sZCwKICAgICAgICAgICAgICAgIGVudmlyb25tZW50X3ZhcmlhYmxlcz1lbnZpcm9ubWVudF92YXJpYWJsZXMsCiAgICAgICAgICAgICAgICBpbnB1dHM9aW5wdXRzLAogICAgICAgICAgICAgICAgb3V0cHV0cz1vdXRwdXRzLAogICAgICAgICAgICApCiAgICAgICAgICAgIHBhcmFsbGVsX2pvYl9mdW5jID0gdG9fY29tcG9uZW50KGpvYj1wYXJhbGxlbF9qb2IpCiAgICAgICAgICAgIHBhcmFsbGVsX25vZGUgPSBwYXJhbGxlbF9qb2JfZnVuYyhqb2JfZGF0YV9wYXRoPWpvYl9kYXRhX3BhdGgpCgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInBpcGVsaW5lX2pvYl9vdXQiOiBwYXJhbGxlbF9ub2RlLm91dHB1dHMuam9iX291dHB1dF9wYXRoLAogICAgICAgICAgICB9CgogICAgICAgIHBpcGVsaW5lID0gcGFyYWxsZWxfaW5fcGlwZWxpbmUoCiAgICAgICAgICAgIElucHV0KAogICAgICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgICAgICBwYXRoPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9kYXRhc2V0L21uaXN0LWRhdGEiLAogICAgICAgICAgICAgICAgbW9kZT1JbnB1dE91dHB1dE1vZGVzLkVWQUxfTU9VTlQsCiAgICAgICAgICAgICksCiAgICAgICAgKQogICAgICAgIHBpcGVsaW5lLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKICAgICAgICAjIHN1Ym1pdCBqb2IgdG8gd29ya3NwYWNlCiAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCwgZXhwZXJpbWVudF9uYW1lPSJwYXJhbGxlbF9pbl9waXBlbGluZSIpCiAgICAgICAgb21pdF9maWVsZHMgPSBbCiAgICAgICAgICAgICJqb2JzLnBhcmFsbGVsX25vZGUudGFzay5jb2RlIiwKICAgICAgICAgICAgImpvYnMucGFyYWxsZWxfbm9kZS50YXNrLmVudmlyb25tZW50IiwKICAgICAgICBdICsgY29tbW9uX29taXRfZmllbGRzCiAgICAgICAgYWN0dWFsX2pvYiA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkucHJvcGVydGllcy5hc19kaWN0KCksICpvbWl0X2ZpZWxkcykKICAgICAgICBleHBlY3RlZF9qb2IgPSB7CiAgICAgICAgICAgICJ0YWdzIjogeyJvd25lciI6ICJzZGt0ZWFtIiwgInRhZyI6ICJ0YWd2YWx1ZSJ9LAogICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiVGhlIHBpcGVsaW5lIGpvYiB3aXRoIHBhcmFsbGVsIGZ1bmN0aW9uIiwKICAgICAgICAgICAgImlzX2FyY2hpdmVkIjogRmFsc2UsCiAgICAgICAgICAgICJqb2JfdHlwZSI6ICJQaXBlbGluZSIsCiAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAiam9iX2RhdGFfcGF0aCI6IHsiam9iX2lucHV0X3R5cGUiOiAibWx0YWJsZSIsICJtb2RlIjogIkV2YWxNb3VudCJ9LAogICAgICAgICAgICB9LAogICAgICAgICAgICAiam9icyI6IHsKICAgICAgICAgICAgICAgICJwYXJhbGxlbF9ub2RlIjogewogICAgICAgICAgICAgICAgICAgICJpbnB1dF9kYXRhIjogIiR7e2lucHV0cy5qb2JfZGF0YV9wYXRofX0iLAogICAgICAgICAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfZGF0YV9wYXRoIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuam9iX2RhdGFfcGF0aH19IiwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIm1pbmlfYmF0Y2hfc2l6ZSI6IDUsCiAgICAgICAgICAgICAgICAgICAgIm1heF9jb25jdXJyZW5jeV9wZXJfaW5zdGFuY2UiOiAxLAogICAgICAgICAgICAgICAgICAgICJtaW5pX2JhdGNoX2Vycm9yX3RocmVzaG9sZCI6IDEsCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAicGFyYWxsZWxfbm9kZSIsCiAgICAgICAgICAgICAgICAgICAgIm91dHB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJqb2Jfb3V0cHV0X3BhdGgiOiB7InZhbHVlIjogIiR7e3BhcmVudC5vdXRwdXRzLnBpcGVsaW5lX2pvYl9vdXR9fSIsICJ0eXBlIjogImxpdGVyYWwifQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgInJlc291cmNlcyI6IHsiaW5zdGFuY2VfY291bnQiOiAyfSwKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJwYXJhbGxlbCIsCiAgICAgICAgICAgICAgICAgICAgInRhc2siOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogInJ1bl9mdW5jdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJlbnRyeV9zY3JpcHQiOiAic2NvcmUucHkiLAogICAgICAgICAgICAgICAgICAgICAgICAicHJvZ3JhbV9hcmd1bWVudHMiOiAiLS1qb2Jfb3V0cHV0X3BhdGggJHt7b3V0cHV0cy5qb2Jfb3V0cHV0X3BhdGh9fSIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJvdXRwdXRzIjogewogICAgICAgICAgICAgICAgInBpcGVsaW5lX2pvYl9vdXQiOiB7CiAgICAgICAgICAgICAgICAgICAgIm1vZGUiOiAiUmVhZFdyaXRlTW91bnQiLAogICAgICAgICAgICAgICAgICAgICJqb2Jfb3V0cHV0X3R5cGUiOiAidXJpX2ZvbGRlciIsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJzZXR0aW5ncyI6IHsiZGVmYXVsdF9jb21wdXRlIjogImNwdS1jbHVzdGVyIn0sCiAgICAgICAgfQogICAgICAgIGFzc2VydCBleHBlY3RlZF9qb2IgPT0gYWN0dWFsX2pvYgoKICAgIGRlZiB0ZXN0X211bHRpX3BhcmFsbGVsX2NvbXBvbmVudHNfd2l0aF9maWxlX2lucHV0X3BpcGVsaW5lX291dHB1dCgKICAgICAgICBzZWxmLCBjbGllbnQ6IE1MQ2xpZW50LCByYW5kc3RyOiBDYWxsYWJsZVtbc3RyXSwgc3RyXQogICAgKSAtPiBOb25lOgogICAgICAgIGNvbXBvbmVudHNfZGlyID0gdGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2RzbF9waXBlbGluZS9wYXJhbGxlbF9jb21wb25lbnRfd2l0aF9maWxlX2lucHV0IgogICAgICAgIGJhdGNoX2luZmVyZW5jZTEgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9c3RyKGNvbXBvbmVudHNfZGlyIC8gInNjb3JlLnltbCIpKQogICAgICAgIGJhdGNoX2luZmVyZW5jZTIgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9c3RyKGNvbXBvbmVudHNfZGlyIC8gInNjb3JlLnltbCIpKQogICAgICAgIGNvbnZlcnRfZGF0YSA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1zdHIoY29tcG9uZW50c19kaXIgLyAiY29udmVydF9kYXRhLnltbCIpKQoKICAgICAgICAjIENvbnN0cnVjdCBwaXBlbGluZQogICAgICAgIEBkc2wucGlwZWxpbmUoZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIpCiAgICAgICAgZGVmIHBhcmFsbGVsX2luX3BpcGVsaW5lKGpvYl9kYXRhX3BhdGgpOgogICAgICAgICAgICBiYXRjaF9pbmZlcmVuY2Vfbm9kZTEgPSBiYXRjaF9pbmZlcmVuY2UxKGpvYl9kYXRhX3BhdGg9am9iX2RhdGFfcGF0aCkKICAgICAgICAgICAgY29udmVydF9kYXRhX25vZGUgPSBjb252ZXJ0X2RhdGEoaW5wdXRfZGF0YT1iYXRjaF9pbmZlcmVuY2Vfbm9kZTEub3V0cHV0cy5qb2Jfb3V0cHV0X3BhdGgpCiAgICAgICAgICAgIGNvbnZlcnRfZGF0YV9ub2RlLm91dHB1dHMuZmlsZV9vdXRwdXRfZGF0YS50eXBlID0gQXNzZXRUeXBlcy5NTFRBQkxFCiAgICAgICAgICAgIGJhdGNoX2luZmVyZW5jZV9ub2RlMiA9IGJhdGNoX2luZmVyZW5jZTIoam9iX2RhdGFfcGF0aD1jb252ZXJ0X2RhdGFfbm9kZS5vdXRwdXRzLmZpbGVfb3V0cHV0X2RhdGEpCiAgICAgICAgICAgIGJhdGNoX2luZmVyZW5jZV9ub2RlMi5pbnB1dHMuam9iX2RhdGFfcGF0aC5tb2RlID0gSW5wdXRPdXRwdXRNb2Rlcy5FVkFMX01PVU5UCgogICAgICAgICAgICByZXR1cm4geyJqb2Jfb3V0X2RhdGEiOiBiYXRjaF9pbmZlcmVuY2Vfbm9kZTIub3V0cHV0cy5qb2Jfb3V0cHV0X3BhdGh9CgogICAgICAgIHBpcGVsaW5lID0gcGFyYWxsZWxfaW5fcGlwZWxpbmUoCiAgICAgICAgICAgIGpvYl9kYXRhX3BhdGg9SW5wdXQoCiAgICAgICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgICAgIHBhdGg9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2RhdGFzZXQvbW5pc3QtZGF0YS8iLAogICAgICAgICAgICAgICAgbW9kZT1JbnB1dE91dHB1dE1vZGVzLkVWQUxfTU9VTlQsCiAgICAgICAgICAgICksCiAgICAgICAgKQogICAgICAgIHBpcGVsaW5lLm91dHB1dHMuam9iX291dF9kYXRhLm1vZGUgPSAidXBsb2FkIgoKICAgICAgICAjIHN1Ym1pdCBwaXBlbGluZSBqb2IKICAgICAgICBwaXBlbGluZV9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50LCBleHBlcmltZW50X25hbWU9InBhcmFsbGVsX2luX3BpcGVsaW5lIikKCiAgICAgICAgb21pdF9maWVsZHMgPSBbCiAgICAgICAgICAgICJqb2JzLioudGFzay5jb2RlIiwKICAgICAgICAgICAgImpvYnMuKi50YXNrLmVudmlyb25tZW50IiwKICAgICAgICBdICsgY29tbW9uX29taXRfZmllbGRzCiAgICAgICAgYWN0dWFsX2pvYiA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkucHJvcGVydGllcy5hc19kaWN0KCksICpvbWl0X2ZpZWxkcykKICAgICAgICBleHBlY3RlZF9qb2IgPSB7CiAgICAgICAgICAgICJ0YWdzIjoge30sCiAgICAgICAgICAgICJpc19hcmNoaXZlZCI6IEZhbHNlLAogICAgICAgICAgICAiam9iX3R5cGUiOiAiUGlwZWxpbmUiLAogICAgICAgICAgICAiaW5wdXRzIjogeyJqb2JfZGF0YV9wYXRoIjogeyJtb2RlIjogIkV2YWxNb3VudCIsICJqb2JfaW5wdXRfdHlwZSI6ICJtbHRhYmxlIn19LAogICAgICAgICAgICAiam9icyI6IHsKICAgICAgICAgICAgICAgICJiYXRjaF9pbmZlcmVuY2Vfbm9kZTEiOiB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAicGFyYWxsZWwiLAogICAgICAgICAgICAgICAgICAgICJuYW1lIjogImJhdGNoX2luZmVyZW5jZV9ub2RlMSIsCiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9kYXRhX3BhdGgiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5qb2JfZGF0YV9wYXRofX0ifQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIm1pbmlfYmF0Y2hfc2l6ZSI6IDEsCiAgICAgICAgICAgICAgICAgICAgInRhc2siOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogInJ1bl9mdW5jdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJlbnRyeV9zY3JpcHQiOiAic2NvcmUucHkiLAogICAgICAgICAgICAgICAgICAgICAgICAicHJvZ3JhbV9hcmd1bWVudHMiOiAiLS1qb2Jfb3V0cHV0X3BhdGggJHt7b3V0cHV0cy5qb2Jfb3V0cHV0X3BhdGh9fSIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiaW5wdXRfZGF0YSI6ICIke3tpbnB1dHMuam9iX2RhdGFfcGF0aH19IiwKICAgICAgICAgICAgICAgICAgICAicmVzb3VyY2VzIjogeyJpbnN0YW5jZV9jb3VudCI6IDJ9LAogICAgICAgICAgICAgICAgICAgICJtYXhfY29uY3VycmVuY3lfcGVyX2luc3RhbmNlIjogMSwKICAgICAgICAgICAgICAgICAgICAibWluaV9iYXRjaF9lcnJvcl90aHJlc2hvbGQiOiAxLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJjb252ZXJ0X2RhdGFfbm9kZSI6IHsKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJjb252ZXJ0X2RhdGFfbm9kZSIsCiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImlucHV0X2RhdGEiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmpvYnMuYmF0Y2hfaW5mZXJlbmNlX25vZGUxLm91dHB1dHMuam9iX291dHB1dF9wYXRofX0iLAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAib3V0cHV0cyI6IHsiZmlsZV9vdXRwdXRfZGF0YSI6IHsiam9iX291dHB1dF90eXBlIjogIm1sdGFibGUifX0sCiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImJhdGNoX2luZmVyZW5jZV9ub2RlMiI6IHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJwYXJhbGxlbCIsCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiYmF0Y2hfaW5mZXJlbmNlX25vZGUyIiwKICAgICAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAiam9iX2RhdGFfcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuam9icy5jb252ZXJ0X2RhdGFfbm9kZS5vdXRwdXRzLmZpbGVfb3V0cHV0X2RhdGF9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibW9kZSI6ICJFdmFsTW91bnQiLAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAib3V0cHV0cyI6IHsiam9iX291dHB1dF9wYXRoIjogeyJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy5qb2Jfb3V0X2RhdGF9fSIsICJ0eXBlIjogImxpdGVyYWwifX0sCiAgICAgICAgICAgICAgICAgICAgIm1pbmlfYmF0Y2hfc2l6ZSI6IDEsCiAgICAgICAgICAgICAgICAgICAgInRhc2siOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogInJ1bl9mdW5jdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJlbnRyeV9zY3JpcHQiOiAic2NvcmUucHkiLAogICAgICAgICAgICAgICAgICAgICAgICAicHJvZ3JhbV9hcmd1bWVudHMiOiAiLS1qb2Jfb3V0cHV0X3BhdGggJHt7b3V0cHV0cy5qb2Jfb3V0cHV0X3BhdGh9fSIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiaW5wdXRfZGF0YSI6ICIke3tpbnB1dHMuam9iX2RhdGFfcGF0aH19IiwKICAgICAgICAgICAgICAgICAgICAicmVzb3VyY2VzIjogeyJpbnN0YW5jZV9jb3VudCI6IDJ9LAogICAgICAgICAgICAgICAgICAgICJtYXhfY29uY3VycmVuY3lfcGVyX2luc3RhbmNlIjogMSwKICAgICAgICAgICAgICAgICAgICAibWluaV9iYXRjaF9lcnJvcl90aHJlc2hvbGQiOiAxLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm91dHB1dHMiOiB7ImpvYl9vdXRfZGF0YSI6IHsibW9kZSI6ICJVcGxvYWQiLCAiam9iX291dHB1dF90eXBlIjogInVyaV9mb2xkZXIifX0sCiAgICAgICAgICAgICJzZXR0aW5ncyI6IHsiZGVmYXVsdF9jb21wdXRlIjogImNwdS1jbHVzdGVyIn0sCiAgICAgICAgfQogICAgICAgIGFzc2VydCBleHBlY3RlZF9qb2IgPT0gYWN0dWFsX2pvYgoKICAgIGRlZiB0ZXN0X2dldF9jaGlsZF9qb2Ioc2VsZiwgY2xpZW50OiBNTENsaWVudCwgcmFuZHN0cjogQ2FsbGFibGVbW3N0cl0sIHN0cl0pIC0\u002BIE5vbmU6CiAgICAgICAgY29tcG9uZW50X3lhbWwgPSBjb21wb25lbnRzX2RpciAvICJoZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiCiAgICAgICAgY29tcG9uZW50X2Z1bmMxID0gbG9hZF9jb21wb25lbnQoc291cmNlPWNvbXBvbmVudF95YW1sLCBwYXJhbXNfb3ZlcnJpZGU9W3sibmFtZSI6IHJhbmRzdHIoImNvbXBvbmVudF9uYW1lIil9XSkKICAgICAgICBjb21wb25lbnRfZnVuYzIgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Y29tcG9uZW50X3lhbWwsIHBhcmFtc19vdmVycmlkZT1beyJuYW1lIjogcmFuZHN0cigiY29tcG9uZW50X25hbWUiKX1dKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBuYW1lPXJhbmRzdHIoInBpcGVsaW5lX25hbWUiKSwKICAgICAgICAgICAgZGVzY3JpcHRpb249IlRoZSBoZWxsbyB3b3JsZCBwaXBlbGluZSBqb2IiLAogICAgICAgICAgICB0YWdzPXsib3duZXIiOiAic2RrdGVhbSIsICJ0YWciOiAidGFndmFsdWUifSwKICAgICAgICAgICAgY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICAgICBleHBlcmltZW50X25hbWU9ZXhwZXJpbWVudF9uYW1lLAogICAgICAgICAgICBjb250aW51ZV9vbl9zdGVwX2ZhaWx1cmU9VHJ1ZSwKICAgICAgICApCiAgICAgICAgZGVmIHBpcGVsaW5lKGpvYl9pbl9udW1iZXIsIGpvYl9pbl9vdGhlcl9udW1iZXIsIGpvYl9pbl9wYXRoKToKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMxKGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9am9iX2luX3BhdGgpCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMihjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9vdGhlcl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lKDEwLCAxNSwgam9iX2lucHV0KQogICAgICAgIGpvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUpCiAgICAgICAgY2xpZW50LmpvYnMuZ2V0KGpvYi5uYW1lKQogICAgICAgIGNsaWVudC5qb2JzLmdldChqb2IubmFtZSkuX3JlcHJfaHRtbF8oKSAgIyB0byB0ZXN0IGNsaWVudC5qb2JzLmdldCgpIHdvcmtzIGluIG5vdGVib29rCgogICAgICAgIGNoaWxkcmVuID0gbGlzdChjbGllbnQuam9icy5saXN0KHBhcmVudF9qb2JfbmFtZT1qb2IubmFtZSkpCiAgICAgICAgZm9yIGNoaWxkIGluIGNoaWxkcmVuOgogICAgICAgICAgICBjbGllbnQuam9icy5nZXQoY2hpbGQubmFtZSkKICAgICAgICAgICAgY2xpZW50LmpvYnMuZ2V0KGNoaWxkLm5hbWUpLl9yZXByX2h0bWxfKCkKCiAgICBkZWYgdGVzdF9kc2xfcGlwZWxpbmVfd2l0aG91dF9zZXR0aW5nX2JpbmRpbmdfbm9kZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5waXBlbGluZV93aXRoX3NldF9iaW5kaW5nX291dHB1dF9pbnB1dC5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBwaXBlbGluZV93aXRob3V0X3NldHRpbmdfYmluZGluZ19ub2RlLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV93aXRob3V0X3NldHRpbmdfYmluZGluZ19ub2RlKCkKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lKQoKICAgICAgICBhY3R1YWxfam9iID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5wcm9wZXJ0aWVzLmFzX2RpY3QoKSwgKmNvbW1vbl9vbWl0X2ZpZWxkcykKICAgICAgICBleHBlY3RlZF9qb2IgPSB7CiAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJFMkUgZHVtbXkgcGlwZWxpbmUgd2l0aCBjb21wb25lbnRzIGRlZmluZWQgdmlhIHlhbWwuIiwKICAgICAgICAgICAgInRhZ3MiOiB7fSwKICAgICAgICAgICAgImNvbXB1dGVfaWQiOiAiY3B1LWNsdXN0ZXIiLAogICAgICAgICAgICAiaXNfYXJjaGl2ZWQiOiBGYWxzZSwKICAgICAgICAgICAgImpvYl90eXBlIjogIlBpcGVsaW5lIiwKICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICJ0cmFpbmluZ19pbnB1dCI6IHsibW9kZSI6ICJSZWFkT25seU1vdW50IiwgImpvYl9pbnB1dF90eXBlIjogInVyaV9mb2xkZXIifSwKICAgICAgICAgICAgICAgICJ0cmFpbmluZ19tYXhfZXBvY2hzIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjIwIn0sCiAgICAgICAgICAgICAgICAidHJhaW5pbmdfbGVhcm5pbmdfcmF0ZSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIxLjgifSwKICAgICAgICAgICAgICAgICJsZWFybmluZ19yYXRlX3NjaGVkdWxlIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogInRpbWUtYmFzZWQifSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImpvYnMiOiB7CiAgICAgICAgICAgICAgICAidHJhaW5fd2l0aF9zYW1wbGVfZGF0YSI6IHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJ0cmFpbl93aXRoX3NhbXBsZV9kYXRhIiwKICAgICAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAidHJhaW5pbmdfZGF0YSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLnRyYWluaW5nX2lucHV0fX0ifSwKICAgICAgICAgICAgICAgICAgICAgICAgIm1heF9lcG9jaHMiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy50cmFpbmluZ19tYXhfZXBvY2hzfX0ifSwKICAgICAgICAgICAgICAgICAgICAgICAgImxlYXJuaW5nX3JhdGUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy50cmFpbmluZ19sZWFybmluZ19yYXRlfX0iLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAibGVhcm5pbmdfcmF0ZV9zY2hlZHVsZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmxlYXJuaW5nX3JhdGVfc2NoZWR1bGV9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAib3V0cHV0cyI6IHsibW9kZWxfb3V0cHV0IjogeyJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy50cmFpbmVkX21vZGVsfX0iLCAidHlwZSI6ICJsaXRlcmFsIn19LAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAib3V0cHV0cyI6IHsidHJhaW5lZF9tb2RlbCI6IHsibW9kZSI6ICJSZWFkV3JpdGVNb3VudCIsICJqb2Jfb3V0cHV0X3R5cGUiOiAidXJpX2ZvbGRlciJ9fSwKICAgICAgICAgICAgInNldHRpbmdzIjoge30sCiAgICAgICAgfQogICAgICAgIGFzc2VydCBleHBlY3RlZF9qb2IgPT0gYWN0dWFsX2pvYgoKICAgIGRlZiB0ZXN0X2RzbF9waXBlbGluZV93aXRoX29ubHlfc2V0dGluZ19waXBlbGluZV9sZXZlbChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUucGlwZWxpbmVfd2l0aF9zZXRfYmluZGluZ19vdXRwdXRfaW5wdXQucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgcGlwZWxpbmVfd2l0aF9vbmx5X3NldHRpbmdfcGlwZWxpbmVfbGV2ZWwsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX3dpdGhfb25seV9zZXR0aW5nX3BpcGVsaW5lX2xldmVsKCkKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lKQoKICAgICAgICBhY3R1YWxfam9iID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5wcm9wZXJ0aWVzLmFzX2RpY3QoKSwgKmNvbW1vbl9vbWl0X2ZpZWxkcykKICAgICAgICBleHBlY3RlZF9qb2IgPSB7CiAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJFMkUgZHVtbXkgcGlwZWxpbmUgd2l0aCBjb21wb25lbnRzIGRlZmluZWQgdmlhIHlhbWwuIiwKICAgICAgICAgICAgInRhZ3MiOiB7fSwKICAgICAgICAgICAgImNvbXB1dGVfaWQiOiAiY3B1LWNsdXN0ZXIiLAogICAgICAgICAgICAiaXNfYXJjaGl2ZWQiOiBGYWxzZSwKICAgICAgICAgICAgImpvYl90eXBlIjogIlBpcGVsaW5lIiwKICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICJ0cmFpbmluZ19pbnB1dCI6IHsibW9kZSI6ICJSZWFkT25seU1vdW50IiwgImpvYl9pbnB1dF90eXBlIjogInVyaV9mb2xkZXIifSwKICAgICAgICAgICAgICAgICJ0cmFpbmluZ19tYXhfZXBvY2hzIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjIwIn0sCiAgICAgICAgICAgICAgICAidHJhaW5pbmdfbGVhcm5pbmdfcmF0ZSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIxLjgifSwKICAgICAgICAgICAgICAgICJsZWFybmluZ19yYXRlX3NjaGVkdWxlIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogInRpbWUtYmFzZWQifSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImpvYnMiOiB7CiAgICAgICAgICAgICAgICAidHJhaW5fd2l0aF9zYW1wbGVfZGF0YSI6IHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJ0cmFpbl93aXRoX3NhbXBsZV9kYXRhIiwKICAgICAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAidHJhaW5pbmdfZGF0YSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLnRyYWluaW5nX2lucHV0fX0ifSwKICAgICAgICAgICAgICAgICAgICAgICAgIm1heF9lcG9jaHMiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy50cmFpbmluZ19tYXhfZXBvY2hzfX0ifSwKICAgICAgICAgICAgICAgICAgICAgICAgImxlYXJuaW5nX3JhdGUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy50cmFpbmluZ19sZWFybmluZ19yYXRlfX0iLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAibGVhcm5pbmdfcmF0ZV9zY2hlZHVsZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmxlYXJuaW5nX3JhdGVfc2NoZWR1bGV9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAib3V0cHV0cyI6IHsibW9kZWxfb3V0cHV0IjogeyJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy50cmFpbmVkX21vZGVsfX0iLCAidHlwZSI6ICJsaXRlcmFsIn19LAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAib3V0cHV0cyI6IHsidHJhaW5lZF9tb2RlbCI6IHsibW9kZSI6ICJVcGxvYWQiLCAiam9iX291dHB1dF90eXBlIjogInVyaV9mb2xkZXIifX0sCiAgICAgICAgICAgICJzZXR0aW5ncyI6IHt9LAogICAgICAgIH0KICAgICAgICBhc3NlcnQgZXhwZWN0ZWRfam9iID09IGFjdHVhbF9qb2IKCiAgICBAcHl0ZXN0Lm1hcmsuc2tpcGlmKGNvbmRpdGlvbj1ub3QgaXNfbGl2ZSgpLCByZWFzb249IlRPRE8oMjE3NzM1Myk6IGludmVzdGlnYXRlIHdoeSB0aGlzIHRlc3QgZmFpbHMuIikKICAgIGRlZiB0ZXN0X2RzbF9waXBlbGluZV93aXRoX29ubHlfc2V0dGluZ19iaW5kaW5nX25vZGUoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgIyBUb2RvOiBjaGVja291dCBydW4gcHJpb3JpdHkgd2hlbiBiYWNrZW5kIGlzIHJlYWR5CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLnBpcGVsaW5lX3dpdGhfc2V0X2JpbmRpbmdfb3V0cHV0X2lucHV0LnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIHBpcGVsaW5lX3dpdGhfb25seV9zZXR0aW5nX2JpbmRpbmdfbm9kZSwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmVfd2l0aF9vbmx5X3NldHRpbmdfYmluZGluZ19ub2RlKCkKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lKQoKICAgICAgICBhY3R1YWxfam9iID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5wcm9wZXJ0aWVzLmFzX2RpY3QoKSwgKmNvbW1vbl9vbWl0X2ZpZWxkcykKICAgICAgICBleHBlY3RlZF9qb2IgPSB7CiAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJFMkUgZHVtbXkgcGlwZWxpbmUgd2l0aCBjb21wb25lbnRzIGRlZmluZWQgdmlhIHlhbWwuIiwKICAgICAgICAgICAgInRhZ3MiOiB7fSwKICAgICAgICAgICAgImNvbXB1dGVfaWQiOiAiY3B1LWNsdXN0ZXIiLAogICAgICAgICAgICAiaXNfYXJjaGl2ZWQiOiBGYWxzZSwKICAgICAgICAgICAgImpvYl90eXBlIjogIlBpcGVsaW5lIiwKICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICJ0cmFpbmluZ19pbnB1dCI6IHsibW9kZSI6ICJSZWFkT25seU1vdW50IiwgImpvYl9pbnB1dF90eXBlIjogInVyaV9mb2xkZXIifSwKICAgICAgICAgICAgICAgICJ0cmFpbmluZ19tYXhfZXBvY2hzIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjIwIn0sCiAgICAgICAgICAgICAgICAidHJhaW5pbmdfbGVhcm5pbmdfcmF0ZSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIxLjgifSwKICAgICAgICAgICAgICAgICJsZWFybmluZ19yYXRlX3NjaGVkdWxlIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogInRpbWUtYmFzZWQifSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImpvYnMiOiB7CiAgICAgICAgICAgICAgICAidHJhaW5fd2l0aF9zYW1wbGVfZGF0YSI6IHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJ0cmFpbl93aXRoX3NhbXBsZV9kYXRhIiwKICAgICAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAidHJhaW5pbmdfZGF0YSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJtb2RlIjogIlJlYWRPbmx5TW91bnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMudHJhaW5pbmdfaW5wdXR9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJtYXhfZXBvY2hzIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMudHJhaW5pbmdfbWF4X2Vwb2Noc319In0sCiAgICAgICAgICAgICAgICAgICAgICAgICJsZWFybmluZ19yYXRlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMudHJhaW5pbmdfbGVhcm5pbmdfcmF0ZX19IiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgImxlYXJuaW5nX3JhdGVfc2NoZWR1bGUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5sZWFybmluZ19yYXRlX3NjaGVkdWxlfX0iLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIm91dHB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtb2RlbF9vdXRwdXQiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibW9kZSI6ICJVcGxvYWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5vdXRwdXRzLnRyYWluZWRfbW9kZWx9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICMgbW9kZSB3aWxsIGJlIGNvcGllZCB0byBwaXBlbGluZSBsZXZlbAogICAgICAgICAgICAib3V0cHV0cyI6IHsidHJhaW5lZF9tb2RlbCI6IHsibW9kZSI6ICJVcGxvYWQiLCAiam9iX291dHB1dF90eXBlIjogInVyaV9mb2xkZXIifX0sCiAgICAgICAgICAgICJzZXR0aW5ncyI6IHt9LAogICAgICAgIH0KICAgICAgICBhc3NlcnQgZXhwZWN0ZWRfam9iID09IGFjdHVhbF9qb2IKCiAgICBAcHl0ZXN0Lm1hcmsuc2tpcGlmKGNvbmRpdGlvbj1ub3QgaXNfbGl2ZSgpLCByZWFzb249IlRPRE8oMjE3NzM1Myk6IGludmVzdGlnYXRlIHdoeSB0aGlzIHRlc3QgZmFpbHMuIikKICAgIGRlZiB0ZXN0X2RzbF9waXBlbGluZV93aXRoX3NldHRpbmdfYmluZGluZ19ub2RlX2FuZF9waXBlbGluZV9sZXZlbChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5waXBlbGluZV93aXRoX3NldF9iaW5kaW5nX291dHB1dF9pbnB1dC5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBwaXBlbGluZV93aXRoX3NldHRpbmdfYmluZGluZ19ub2RlX2FuZF9waXBlbGluZV9sZXZlbCwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmVfd2l0aF9zZXR0aW5nX2JpbmRpbmdfbm9kZV9hbmRfcGlwZWxpbmVfbGV2ZWwoKQogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUpCgogICAgICAgIGFjdHVhbF9qb2IgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLnByb3BlcnRpZXMuYXNfZGljdCgpLCAqY29tbW9uX29taXRfZmllbGRzKQogICAgICAgIGV4cGVjdGVkX2pvYiA9IHsKICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogIkUyRSBkdW1teSBwaXBlbGluZSB3aXRoIGNvbXBvbmVudHMgZGVmaW5lZCB2aWEgeWFtbC4iLAogICAgICAgICAgICAidGFncyI6IHt9LAogICAgICAgICAgICAiY29tcHV0ZV9pZCI6ICJjcHUtY2x1c3RlciIsCiAgICAgICAgICAgICJpc19hcmNoaXZlZCI6IEZhbHNlLAogICAgICAgICAgICAiam9iX3R5cGUiOiAiUGlwZWxpbmUiLAogICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgInRyYWluaW5nX2lucHV0IjogeyJtb2RlIjogIkRvd25sb2FkIiwgImpvYl9pbnB1dF90eXBlIjogInVyaV9mb2xkZXIifSwKICAgICAgICAgICAgICAgICJ0cmFpbmluZ19tYXhfZXBvY2hzIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjIwIn0sCiAgICAgICAgICAgICAgICAidHJhaW5pbmdfbGVhcm5pbmdfcmF0ZSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIxLjgifSwKICAgICAgICAgICAgICAgICJsZWFybmluZ19yYXRlX3NjaGVkdWxlIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogInRpbWUtYmFzZWQifSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImpvYnMiOiB7CiAgICAgICAgICAgICAgICAidHJhaW5fd2l0aF9zYW1wbGVfZGF0YSI6IHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJ0cmFpbl93aXRoX3NhbXBsZV9kYXRhIiwKICAgICAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAidHJhaW5pbmdfZGF0YSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJtb2RlIjogIlJlYWRPbmx5TW91bnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMudHJhaW5pbmdfaW5wdXR9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJtYXhfZXBvY2hzIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMudHJhaW5pbmdfbWF4X2Vwb2Noc319In0sCiAgICAgICAgICAgICAgICAgICAgICAgICJsZWFybmluZ19yYXRlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMudHJhaW5pbmdfbGVhcm5pbmdfcmF0ZX19IiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgImxlYXJuaW5nX3JhdGVfc2NoZWR1bGUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5sZWFybmluZ19yYXRlX3NjaGVkdWxlfX0iLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIm91dHB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtb2RlbF9vdXRwdXQiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibW9kZSI6ICJVcGxvYWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5vdXRwdXRzLnRyYWluZWRfbW9kZWx9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICMgcGlwZWxpbmUgbGV2ZWwgb3V0cHV0IHNldHRpbmcgdGFraW5nIGVmZmVjdAogICAgICAgICAgICAib3V0cHV0cyI6IHsidHJhaW5lZF9tb2RlbCI6IHsibW9kZSI6ICJSZWFkV3JpdGVNb3VudCIsICJqb2Jfb3V0cHV0X3R5cGUiOiAidXJpX2ZvbGRlciJ9fSwKICAgICAgICAgICAgInNldHRpbmdzIjoge30sCiAgICAgICAgfQogICAgICAgIGFzc2VydCBleHBlY3RlZF9qb2IgPT0gYWN0dWFsX2pvYgoKICAgIGRlZiB0ZXN0X2RzbF9waXBlbGluZV93aXRoX2NvbW1hbmRfYnVpbGRlcl9zZXR0aW5nX2JpbmRpbmdfbm9kZV9hbmRfcGlwZWxpbmVfbGV2ZWwoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUucGlwZWxpbmVfd2l0aF9zZXRfYmluZGluZ19vdXRwdXRfaW5wdXQucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgcGlwZWxpbmVfd2l0aF9jb21tYW5kX2J1aWxkZXJfc2V0dGluZ19iaW5kaW5nX25vZGVfYW5kX3BpcGVsaW5lX2xldmVsLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV93aXRoX2NvbW1hbmRfYnVpbGRlcl9zZXR0aW5nX2JpbmRpbmdfbm9kZV9hbmRfcGlwZWxpbmVfbGV2ZWwoKQogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUpCgogICAgICAgIGFjdHVhbF9qb2IgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLnByb3BlcnRpZXMuYXNfZGljdCgpLCAqY29tbW9uX29taXRfZmllbGRzKQoKICAgICAgICBleHBlY3RlZF9qb2IgPSB7CiAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJFMkUgZHVtbXkgcGlwZWxpbmUgd2l0aCBjb21wb25lbnRzIGRlZmluZWQgdmlhIHlhbWwuIiwKICAgICAgICAgICAgInRhZ3MiOiB7fSwKICAgICAgICAgICAgImNvbXB1dGVfaWQiOiAiY3B1LWNsdXN0ZXIiLAogICAgICAgICAgICAiaXNfYXJjaGl2ZWQiOiBGYWxzZSwKICAgICAgICAgICAgImpvYl90eXBlIjogIlBpcGVsaW5lIiwKICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICJ0cmFpbmluZ19pbnB1dCI6IHsibW9kZSI6ICJEb3dubG9hZCIsICJqb2JfaW5wdXRfdHlwZSI6ICJ1cmlfZm9sZGVyIn0sCiAgICAgICAgICAgICAgICAidHJhaW5pbmdfbWF4X2Vwb2NocyI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIyMCJ9LAogICAgICAgICAgICAgICAgInRyYWluaW5nX2xlYXJuaW5nX3JhdGUiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMS44In0sCiAgICAgICAgICAgICAgICAibGVhcm5pbmdfcmF0ZV9zY2hlZHVsZSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICJ0aW1lLWJhc2VkIn0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJqb2JzIjogewogICAgICAgICAgICAgICAgInRyYWluX3dpdGhfc2FtcGxlX2RhdGEiOiB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgICAgICAgICAgImRpc3RyaWJ1dGlvbiI6IHsiZGlzdHJpYnV0aW9uX3R5cGUiOiAiUHlUb3JjaCIsICJwcm9jZXNzX2NvdW50X3Blcl9pbnN0YW5jZSI6IDJ9LAogICAgICAgICAgICAgICAgICAgICJuYW1lIjogInRyYWluX3dpdGhfc2FtcGxlX2RhdGEiLAogICAgICAgICAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJ0cmFpbmluZ19kYXRhIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIm1vZGUiOiAiUmVhZE9ubHlNb3VudCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy50cmFpbmluZ19pbnB1dH19IiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgIm1heF9lcG9jaHMiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy50cmFpbmluZ19tYXhfZXBvY2hzfX0ifSwKICAgICAgICAgICAgICAgICAgICAgICAgImxlYXJuaW5nX3JhdGUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy50cmFpbmluZ19sZWFybmluZ19yYXRlfX0iLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAibGVhcm5pbmdfcmF0ZV9zY2hlZHVsZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmxlYXJuaW5nX3JhdGVfc2NoZWR1bGV9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAib3V0cHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1vZGVsX291dHB1dCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJtb2RlIjogIlVwbG9hZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50Lm91dHB1dHMudHJhaW5lZF9tb2RlbH19IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm91dHB1dHMiOiB7InRyYWluZWRfbW9kZWwiOiB7Im1vZGUiOiAiUmVhZFdyaXRlTW91bnQiLCAiam9iX291dHB1dF90eXBlIjogInVyaV9mb2xkZXIifX0sCiAgICAgICAgICAgICJzZXR0aW5ncyI6IHt9LAogICAgICAgIH0KICAgICAgICBhc3NlcnQgZXhwZWN0ZWRfam9iID09IGFjdHVhbF9qb2IKCiAgICBkZWYgdGVzdF9zcGFya19jb21wb25lbnRzKHNlbGYsIGNsaWVudDogTUxDbGllbnQsIHJhbmRzdHI6IENhbGxhYmxlW1tzdHJdLCBzdHJdKSAtPiBOb25lOgogICAgICAgIGNvbXBvbmVudHNfZGlyID0gdGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2RzbF9waXBlbGluZS9zcGFya19qb2JfaW5fcGlwZWxpbmUiCiAgICAgICAgYWRkX2dyZWV0aW5nX2NvbHVtbiA9IGxvYWRfY29tcG9uZW50KHN0cihjb21wb25lbnRzX2RpciAvICJhZGRfZ3JlZXRpbmdfY29sdW1uX2NvbXBvbmVudC55bWwiKSkKICAgICAgICBjb3VudF9ieV9yb3cgPSBsb2FkX2NvbXBvbmVudChzdHIoY29tcG9uZW50c19kaXIgLyAiY291bnRfYnlfcm93X2NvbXBvbmVudC55bWwiKSkKCiAgICAgICAgIyBDb25zdHJ1Y3QgcGlwZWxpbmUKICAgICAgICBAZHNsLnBpcGVsaW5lKCkKICAgICAgICBkZWYgc3BhcmtfcGlwZWxpbmVfZnJvbV95YW1sKGlyaXNfZGF0YSk6CiAgICAgICAgICAgIGFkZF9ncmVldGluZ19jb2x1bW5fbm9kZSA9IGFkZF9ncmVldGluZ19jb2x1bW4oZmlsZV9pbnB1dD1pcmlzX2RhdGEpCiAgICAgICAgICAgIGFkZF9ncmVldGluZ19jb2x1bW5fbm9kZS5yZXNvdXJjZXMgPSB7Imluc3RhbmNlX3R5cGUiOiAic3RhbmRhcmRfZTRzX3YzIiwgInJ1bnRpbWVfdmVyc2lvbiI6ICIzLjIuMCJ9CiAgICAgICAgICAgIGNvdW50X2J5X3Jvd19ub2RlID0gY291bnRfYnlfcm93KGZpbGVfaW5wdXQ9aXJpc19kYXRhKQogICAgICAgICAgICBjb3VudF9ieV9yb3dfbm9kZS5yZXNvdXJjZXMgPSB7Imluc3RhbmNlX3R5cGUiOiAic3RhbmRhcmRfZTRzX3YzIiwgInJ1bnRpbWVfdmVyc2lvbiI6ICIzLjIuMCJ9CiAgICAgICAgICAgIHJldHVybiB7Im91dHB1dCI6IGNvdW50X2J5X3Jvd19ub2RlLm91dHB1dHMub3V0cHV0fQoKICAgICAgICBwaXBlbGluZSA9IHNwYXJrX3BpcGVsaW5lX2Zyb21feWFtbCgKICAgICAgICAgICAgaXJpc19kYXRhPUlucHV0KAogICAgICAgICAgICAgICAgcGF0aD0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvZHNsX3BpcGVsaW5lL3NwYXJrX2pvYl9pbl9waXBlbGluZS9kYXRhc2V0L2lyaXMuY3N2IiwKICAgICAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5VUklfRklMRSwKICAgICAgICAgICAgICAgIG1vZGU9SW5wdXRPdXRwdXRNb2Rlcy5ESVJFQ1QsCiAgICAgICAgICAgICksCiAgICAgICAgKQogICAgICAgIHBpcGVsaW5lLm91dHB1dHMub3V0cHV0Lm1vZGUgPSAiRGlyZWN0IgogICAgICAgIHBpcGVsaW5lLm91dHB1dHMub3V0cHV0LnR5cGUgPSAidXJpX2ZpbGUiCgogICAgICAgICMgc3VibWl0IHBpcGVsaW5lIGpvYgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQsIGV4cGVyaW1lbnRfbmFtZT0ic3BhcmtfaW5fcGlwZWxpbmUiKQogICAgICAgICMgY2hlY2sgcmVxdWlyZWQgZmllbGRzIGluIGpvYiBkaWN0CiAgICAgICAgam9iX2RpY3QgPSBwaXBlbGluZV9qb2IuX3RvX2RpY3QoKQogICAgICAgIGV4cGVjdGVkX2tleXMgPSBbInN0YXR1cyIsICJwcm9wZXJ0aWVzIiwgImNyZWF0aW9uX2NvbnRleHQiXQogICAgICAgIGZvciBrIGluIGV4cGVjdGVkX2tleXM6CiAgICAgICAgICAgIGFzc2VydCBrIGluIGpvYl9kaWN0LmtleXMoKSwgZiJmYWlsZWQgdG8gZ2V0IHtrfSBpbiB7am9iX2RpY3R9IgoKICAgICAgICAjIG9yaWdpbmFsIGpvYiBkaWQgbm90IGNoYW5nZQogICAgICAgIGFzc2VydF9qb2JfaW5wdXRfb3V0cHV0X3R5cGVzKHBpcGVsaW5lX2pvYikKCiAgICBkZWYgdGVzdF9waXBlbGluZV93aXRoX2dyb3VwKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGZyb20gZW51bSBpbXBvcnQgRW51bQoKICAgICAgICBjbGFzcyBFbnVtT3BzKEVudW0pOgogICAgICAgICAgICBPcHRpb24xID0gImhlbGxvIgogICAgICAgICAgICBPcHRpb24yID0gIndvcmxkIgoKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfeWFtbCA9ICIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2lucHV0X3R5cGVzX2NvbXBvbmVudC55bWwiCiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X2Z1bmMgPSBsb2FkX2NvbXBvbmVudChoZWxsb193b3JsZF9jb21wb25lbnRfeWFtbCkKICAgICAgICBmcm9tIGF6dXJlLmFpLm1sLmRzbC5fZ3JvdXBfZGVjb3JhdG9yIGltcG9ydCBncm91cAoKICAgICAgICBAZ3JvdXAKICAgICAgICBjbGFzcyBQYXJhbUNsYXNzOgogICAgICAgICAgICBpbnRfcGFyYW06IElucHV0KG1pbj0xLjAsIG1heD01LjAsIHR5cGU9ImludGVnZXIiKQogICAgICAgICAgICBlbnVtX3BhcmFtOiBFbnVtT3BzCiAgICAgICAgICAgIHN0cl9wYXJhbTogc3RyID0gInRlc3QiCiAgICAgICAgICAgIGJvb2xfcGFyYW06IGJvb2wgPSBUcnVlCiAgICAgICAgICAgIG51bWJlcl9wYXJhbSA9IDQuMAoKICAgICAgICBkZWZhdWx0X3BhcmFtID0gUGFyYW1DbGFzcyhpbnRfcGFyYW09MiwgZW51bV9wYXJhbT1FbnVtT3BzLk9wdGlvbjEsIGJvb2xfcGFyYW09RmFsc2UpCgogICAgICAgIEBkc2wucGlwZWxpbmUoZGVmYXVsdF9jb21wdXRlX3RhcmdldD0iY3B1LWNsdXN0ZXIiKQogICAgICAgIGRlZiBwaXBlbGluZV93aXRoX2dyb3VwKGdyb3VwOiBQYXJhbUNsYXNzKToKICAgICAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X2Z1bmMoCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fc3RyaW5nPWdyb3VwLnN0cl9wYXJhbSwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9yYW5nZWRfbnVtYmVyPWdyb3VwLm51bWJlcl9wYXJhbSwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9lbnVtPWdyb3VwLmVudW1fcGFyYW0sCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fYm9vbGVhbj1ncm91cC5ib29sX3BhcmFtLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3JhbmdlZF9pbnRlZ2VyPWdyb3VwLmludF9wYXJhbSwKICAgICAgICAgICAgKQoKICAgICAgICBwaXBlbGluZV9qb2IgPSBwaXBlbGluZV93aXRoX2dyb3VwKGRlZmF1bHRfcGFyYW0pCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZV9qb2IpCgogICAgICAgIGFjdHVhbF9qb2IgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLnByb3BlcnRpZXMuYXNfZGljdCgpLCAqY29tbW9uX29taXRfZmllbGRzKQogICAgICAgIGV4cGVjdGVkX2pvYl9pbnB1dHMgPSB7CiAgICAgICAgICAgICJncm91cC5pbnRfcGFyYW0iOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMiJ9LAogICAgICAgICAgICAiZ3JvdXAuZW51bV9wYXJhbSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICJoZWxsbyJ9LAogICAgICAgICAgICAiZ3JvdXAuc3RyX3BhcmFtIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogInRlc3QifSwKICAgICAgICAgICAgImdyb3VwLmJvb2xfcGFyYW0iOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiRmFsc2UifSwKICAgICAgICAgICAgImdyb3VwLm51bWJlcl9wYXJhbSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICI0LjAifSwKICAgICAgICB9CiAgICAgICAgZXhwZWN0ZWRfbm9kZV9pbnB1dHMgPSB7CiAgICAgICAgICAgICJjb21wb25lbnRfaW5fc3RyaW5nIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuZ3JvdXAuc3RyX3BhcmFtfX0ifSwKICAgICAgICAgICAgImNvbXBvbmVudF9pbl9yYW5nZWRfaW50ZWdlciI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmdyb3VwLmludF9wYXJhbX19In0sCiAgICAgICAgICAgICJjb21wb25lbnRfaW5fZW51bSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmdyb3VwLmVudW1fcGFyYW19fSJ9LAogICAgICAgICAgICAiY29tcG9uZW50X2luX2Jvb2xlYW4iOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5ncm91cC5ib29sX3BhcmFtfX0ifSwKICAgICAgICAgICAgImNvbXBvbmVudF9pbl9yYW5nZWRfbnVtYmVyIjogewogICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuZ3JvdXAubnVtYmVyX3BhcmFtfX0iLAogICAgICAgICAgICB9LAogICAgICAgIH0KICAgICAgICBhc3NlcnQgYWN0dWFsX2pvYlsiaW5wdXRzIl0gPT0gZXhwZWN0ZWRfam9iX2lucHV0cwogICAgICAgIGFzc2VydCBhY3R1YWxfam9iWyJqb2JzIl1bIm1pY3Jvc29mdF9zYW1wbGVzX2NvbW1hbmRfY29tcG9uZW50X2Jhc2ljX2lucHV0cyJdWyJpbnB1dHMiXSA9PSBleHBlY3RlZF9ub2RlX2lucHV0cwoKICAgIGRlZiB0ZXN0X3JlZ2lzdGVyZWRfcGlwZWxpbmVfd2l0aF9ncm91cChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfeWFtbCA9ICIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2lucHV0X3R5cGVzX2NvbXBvbmVudC55bWwiCiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X2Z1bmMgPSBsb2FkX2NvbXBvbmVudChoZWxsb193b3JsZF9jb21wb25lbnRfeWFtbCkKICAgICAgICBmcm9tIGF6dXJlLmFpLm1sLmRzbC5fZ3JvdXBfZGVjb3JhdG9yIGltcG9ydCBncm91cAoKICAgICAgICBAZ3JvdXAKICAgICAgICBjbGFzcyBTdWJQYXJhbUNsYXNzOgogICAgICAgICAgICBpbnRfcGFyYW06IElucHV0KG1pbj0xLjAsIG1heD01LjAsIHR5cGU9ImludGVnZXIiKQoKICAgICAgICBAZ3JvdXAKICAgICAgICBjbGFzcyBQYXJhbUNsYXNzOgogICAgICAgICAgICBzdWI6IFN1YlBhcmFtQ2xhc3MKICAgICAgICAgICAgc3RyX3BhcmFtOiBzdHIgPSAidGVzdCIKICAgICAgICAgICAgYm9vbF9wYXJhbTogYm9vbCA9IFRydWUKICAgICAgICAgICAgbnVtYmVyX3BhcmFtID0gNC4wCgogICAgICAgIEBkc2wucGlwZWxpbmUoKQogICAgICAgIGRlZiBwaXBlbGluZV93aXRoX2dyb3VwKGdyb3VwOiBQYXJhbUNsYXNzKToKICAgICAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X2Z1bmMoCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fc3RyaW5nPWdyb3VwLnN0cl9wYXJhbSwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9yYW5nZWRfbnVtYmVyPWdyb3VwLm51bWJlcl9wYXJhbSwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9ib29sZWFuPWdyb3VwLmJvb2xfcGFyYW0sCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fcmFuZ2VkX2ludGVnZXI9Z3JvdXAuc3ViLmludF9wYXJhbSwKICAgICAgICAgICAgKQoKICAgICAgICBjb21wb25lbnQgPSBjbGllbnQuY29tcG9uZW50cy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lX3dpdGhfZ3JvdXApCiAgICAgICAgIyBBc3NlcnQga2V5IG5vdCBleGlzdHMKICAgICAgICBtYXRjaCA9ICgKICAgICAgICAgICAgIiguKil1bmV4cGVjdGVkIGtleXdvcmQgYXJndW1lbnQgJ2dyb3VwLm5vdF9leGlzdCcoLiopdmFsaWQga2V5d29yZHM6ICIKICAgICAgICAgICAgIidncm91cCcsICdncm91cC5zdWIuaW50X3BhcmFtJywgJ2dyb3VwLnN0cl9wYXJhbScsICdncm91cC5ib29sX3BhcmFtJywgJ2dyb3VwLm51bWJlcl9wYXJhbSciCiAgICAgICAgKQogICAgICAgIHdpdGggcHl0ZXN0LnJhaXNlcyhVbmV4cGVjdGVkS2V5d29yZEVycm9yLCBtYXRjaD1tYXRjaCk6CiAgICAgICAgICAgIGNvbXBvbmVudCgKICAgICAgICAgICAgICAgICoqewogICAgICAgICAgICAgICAgICAgICJncm91cC5udW1iZXJfcGFyYW0iOiA0LjAsCiAgICAgICAgICAgICAgICAgICAgImdyb3VwLnN0cl9wYXJhbSI6ICJ0ZXN0aW5nIiwKICAgICAgICAgICAgICAgICAgICAiZ3JvdXAuc3ViLmludF9wYXJhbSI6IDQsCiAgICAgICAgICAgICAgICAgICAgImdyb3VwLm5vdF9leGlzdCI6IDQsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkKICAgICAgICAjIEFzc2VydCBjb25mbGljdCBhc3NpZ25tZW50CiAgICAgICAgd2l0aCBweXRlc3QucmFpc2VzKEV4Y2VwdGlvbiwgbWF0Y2g9IkNvbmZsaWN0IHBhcmFtZXRlciBrZXkgJ2dyb3VwJyBhbmQgJ2dyb3VwLm51bWJlcl9wYXJhbSciKToKICAgICAgICAgICAgcGlwZWxpbmUgPSBjb21wb25lbnQoCiAgICAgICAgICAgICAgICAqKnsKICAgICAgICAgICAgICAgICAgICAiZ3JvdXAubnVtYmVyX3BhcmFtIjogNC4wLAogICAgICAgICAgICAgICAgICAgICJncm91cC5zdHJfcGFyYW0iOiAidGVzdGluZyIsCiAgICAgICAgICAgICAgICAgICAgImdyb3VwLnN1Yi5pbnRfcGFyYW0iOiA0LAogICAgICAgICAgICAgICAgICAgICJncm91cCI6IFBhcmFtQ2xhc3Moc3ViPVN1YlBhcmFtQ2xhc3MoaW50X3BhcmFtPTEpKSwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICBwaXBlbGluZS5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCiAgICAgICAgICAgIGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUpCiAgICAgICAgIyBBc3NlcnQgaGFwcHkgcGF0aAogICAgICAgIGlucHV0cyA9IHsiZ3JvdXAubnVtYmVyX3BhcmFtIjogNC4wLCAiZ3JvdXAuc3RyX3BhcmFtIjogInRlc3RpbmciLCAiZ3JvdXAuc3ViLmludF9wYXJhbSI6IDR9CiAgICAgICAgcGlwZWxpbmUgPSBjb21wb25lbnQoKippbnB1dHMpCiAgICAgICAgcGlwZWxpbmUuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImNwdS1jbHVzdGVyIgogICAgICAgIHJlc3RfcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSkKICAgICAgICBhc3NlcnQgcmVzdF9waXBlbGluZV9qb2IuX3RvX2RpY3QoKVsiaW5wdXRzIl0gPT0ge2tleTogc3RyKHZhbCkgZm9yIGtleSwgdmFsIGluIGlucHV0cy5pdGVtcygpfQoKICAgIGRlZiB0ZXN0X2RzbF9waXBlbGluZV93aXRoX2RlZmF1bHRfY29tcG9uZW50KAogICAgICAgIHNlbGYsCiAgICAgICAgY2xpZW50OiBNTENsaWVudCwKICAgICAgICByYW5kc3RyOiBDYWxsYWJsZVtbc3RyXSwgc3RyXSwKICAgICkgLT4gTm9uZToKICAgICAgICB5YW1sX3BhdGg6IHN0ciA9ICIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50LnltbCIKICAgICAgICBjb21wb25lbnRfbmFtZSA9IHJhbmRzdHIoImNvbXBvbmVudF9uYW1lIikKICAgICAgICBjb21wb25lbnQ6IENvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT15YW1sX3BhdGgsIHBhcmFtc19vdmVycmlkZT1beyJuYW1lIjogY29tcG9uZW50X25hbWV9XSkKICAgICAgICBjbGllbnQuY29tcG9uZW50cy5jcmVhdGVfb3JfdXBkYXRlKGNvbXBvbmVudCkKCiAgICAgICAgZGVmYXVsdF9jb21wb25lbnRfZnVuYyA9IGNsaWVudC5jb21wb25lbnRzLmdldChjb21wb25lbnRfbmFtZSkKCiAgICAgICAgQGRzbC5waXBlbGluZSgpCiAgICAgICAgZGVmIHBpcGVsaW5lX3dpdGhfZGVmYXVsdF9jb21wb25lbnQoKToKICAgICAgICAgICAgbm9kZTEgPSBkZWZhdWx0X2NvbXBvbmVudF9mdW5jKGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbnB1dCkKICAgICAgICAgICAgbm9kZTEuY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKCiAgICAgICAgIyBjb21wb25lbnQgZnJvbSBjbGllbnQuY29tcG9uZW50cy5nZXQKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lX3dpdGhfZGVmYXVsdF9jb21wb25lbnQoKSkKICAgICAgICBjcmVhdGVkX3BpcGVsaW5lX2pvYjogUGlwZWxpbmVKb2IgPSBjbGllbnQuam9icy5nZXQocGlwZWxpbmVfam9iLm5hbWUpCiAgICAgICAgYXNzZXJ0IGNyZWF0ZWRfcGlwZWxpbmVfam9iLmpvYnNbIm5vZGUxIl0uY29tcG9uZW50ID09IGYie2NvbXBvbmVudF9uYW1lfUBkZWZhdWx0IgoKICAgIGRlZiB0ZXN0X3BpcGVsaW5lX25vZGVfaWRlbnRpdHlfd2l0aF9jb21wb25lbnQoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgcGF0aCA9ICIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50LnltbCIKICAgICAgICBjb21wb25lbnRfZnVuYyA9IGxvYWRfY29tcG9uZW50KHBhdGgpCgogICAgICAgIEBkc2wucGlwZWxpbmUKICAgICAgICBkZWYgcGlwZWxpbmVfZnVuYyhjb21wb25lbnRfaW5fcGF0aCk6CiAgICAgICAgICAgIG5vZGUxID0gY29tcG9uZW50X2Z1bmMoY29tcG9uZW50X2luX251bWJlcj0xLCBjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5fcGF0aCkKICAgICAgICAgICAgbm9kZTEuaWRlbnRpdHkgPSBBbWxUb2tlbkNvbmZpZ3VyYXRpb24oKQoKICAgICAgICAgICAgbm9kZTIgPSBjb21wb25lbnRfZnVuYyhjb21wb25lbnRfaW5fbnVtYmVyPTEsIGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbl9wYXRoKQogICAgICAgICAgICBub2RlMi5pZGVudGl0eSA9IFVzZXJJZGVudGl0eUNvbmZpZ3VyYXRpb24oKQoKICAgICAgICAgICAgbm9kZTMgPSBjb21wb25lbnRfZnVuYyhjb21wb25lbnRfaW5fbnVtYmVyPTEsIGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbl9wYXRoKQogICAgICAgICAgICBub2RlMy5pZGVudGl0eSA9IE1hbmFnZWRJZGVudGl0eUNvbmZpZ3VyYXRpb24oKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX2Z1bmMoY29tcG9uZW50X2luX3BhdGg9am9iX2lucHV0KQogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUsIGNvbXB1dGU9ImNwdS1jbHVzdGVyIikKICAgICAgICBvbWl0X2ZpZWxkcyA9IFsiam9icy4qLmNvbXBvbmVudElkIiwgImpvYnMuKi5fc291cmNlIl0KICAgICAgICBhY3R1YWxfZGljdCA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpWyJwcm9wZXJ0aWVzIl0sICpvbWl0X2ZpZWxkcykKICAgICAgICBhc3NlcnQgYWN0dWFsX2RpY3RbImpvYnMiXSA9PSB7CiAgICAgICAgICAgICJub2RlMSI6IHsKICAgICAgICAgICAgICAgICJpZGVudGl0eSI6IHsidHlwZSI6ICJhbWxfdG9rZW4ifSwKICAgICAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9pbl9udW1iZXIiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMSJ9LAogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmNvbXBvbmVudF9pbl9wYXRofX0ifSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibmFtZSI6ICJub2RlMSIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm5vZGUyIjogewogICAgICAgICAgICAgICAgImlkZW50aXR5IjogeyJ0eXBlIjogInVzZXJfaWRlbnRpdHkifSwKICAgICAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9pbl9udW1iZXIiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMSJ9LAogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmNvbXBvbmVudF9pbl9wYXRofX0ifSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibmFtZSI6ICJub2RlMiIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm5vZGUzIjogewogICAgICAgICAgICAgICAgImlkZW50aXR5IjogeyJ0eXBlIjogIm1hbmFnZWRfaWRlbnRpdHkifSwKICAgICAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9pbl9udW1iZXIiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMSJ9LAogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmNvbXBvbmVudF9pbl9wYXRofX0ifSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibmFtZSI6ICJub2RlMyIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgfSwKICAgICAgICB9CgogICAgZGVmIHRlc3RfZGVmYXVsdF9waXBlbGluZV9qb2Jfc2VydmljZXMoc2VsZiwgY2xpZW50OiBNTENsaWVudCwgcmFuZHN0cjogQ2FsbGFibGVbW3N0cl0sIHN0cl0pIC0\u002BIE5vbmU6CiAgICAgICAgY29tcG9uZW50X3lhbWwgPSBjb21wb25lbnRzX2RpciAvICJoZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiCiAgICAgICAgY29tcG9uZW50X2Z1bmMxID0gbG9hZF9jb21wb25lbnQoc291cmNlPWNvbXBvbmVudF95YW1sLCBwYXJhbXNfb3ZlcnJpZGU9W3sibmFtZSI6IHJhbmRzdHIoImNvbXBvbmVudF9uYW1lIil9XSkKICAgICAgICBjb21wb25lbnRfZnVuYzIgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Y29tcG9uZW50X3lhbWwsIHBhcmFtc19vdmVycmlkZT1beyJuYW1lIjogcmFuZHN0cigiY29tcG9uZW50X25hbWUiKX1dKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBuYW1lPXJhbmRzdHIoInBpcGVsaW5lX25hbWUiKSwKICAgICAgICAgICAgZGVzY3JpcHRpb249IlRoZSBoZWxsbyB3b3JsZCBwaXBlbGluZSBqb2IiLAogICAgICAgICAgICB0YWdzPXsib3duZXIiOiAic2RrdGVhbSIsICJ0YWciOiAidGFndmFsdWUifSwKICAgICAgICAgICAgY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICAgICBleHBlcmltZW50X25hbWU9ZXhwZXJpbWVudF9uYW1lLAogICAgICAgICAgICBjb250aW51ZV9vbl9zdGVwX2ZhaWx1cmU9VHJ1ZSwKICAgICAgICApCiAgICAgICAgZGVmIHBpcGVsaW5lKGpvYl9pbl9udW1iZXIsIGpvYl9pbl9vdGhlcl9udW1iZXIsIGpvYl9pbl9wYXRoKToKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMxKGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9am9iX2luX3BhdGgpCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMihjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9vdGhlcl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lKDEwLCAxNSwgam9iX2lucHV0KQogICAgICAgIGpvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUpCiAgICAgICAgIyBjaGVjayByZXF1aXJlZCBmaWVsZHMgaW4gam9iIGRpY3QKICAgICAgICBkZWZhdWx0X3NlcnZpY2VzID0gam9iLl90b19kaWN0KClbInNlcnZpY2VzIl0KICAgICAgICBhc3NlcnQgIlN0dWRpbyIgaW4gZGVmYXVsdF9zZXJ2aWNlcwogICAgICAgIGFzc2VydCAiVHJhY2tpbmciIGluIGRlZmF1bHRfc2VydmljZXMKICAgICAgICBhc3NlcnQgZGVmYXVsdF9zZXJ2aWNlc1siU3R1ZGlvIl1bImVuZHBvaW50Il0uc3RhcnRzd2l0aCgiaHR0cHM6Ly9tbC5henVyZS5jb20vcnVucy8iKQogICAgICAgIGFzc2VydCBkZWZhdWx0X3NlcnZpY2VzWyJTdHVkaW8iXVsidHlwZSJdID09ICJTdHVkaW8iCiAgICAgICAgYXNzZXJ0IGRlZmF1bHRfc2VydmljZXNbIlRyYWNraW5nIl1bImVuZHBvaW50Il0uc3RhcnRzd2l0aCgiYXp1cmVtbDovLyIpCiAgICAgICAgYXNzZXJ0IGRlZmF1bHRfc2VydmljZXNbIlRyYWNraW5nIl1bInR5cGUiXSA9PSAiVHJhY2tpbmciCgogICAgZGVmIHRlc3RfZ3JvdXBfb3V0cHV0c19kZXNjcmlwdGlvbl9vdmVyd3JpdGUoc2VsZiwgY2xpZW50KToKICAgICAgICAjIHRlc3QgZ3JvdXAgb3V0cHV0cyBkZXNjcmlwdGlvbiBvdmVyd3JpdGUKICAgICAgICBAZ3JvdXAKICAgICAgICBjbGFzcyBPdXRwdXRzOgogICAgICAgICAgICBvdXRwdXQxOiBPdXRwdXQodHlwZT0idXJpX2ZvbGRlciIsIGRlc2NyaXB0aW9uPSJuZXcgZGVzY3JpcHRpb24iKQoKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfeWFtbCA9ICIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50LnltbCIKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1oZWxsb193b3JsZF9jb21wb25lbnRfeWFtbCkKCiAgICAgICAgQGRzbC5waXBlbGluZShkZWZhdWx0X2NvbXB1dGVfdGFyZ2V0PSJjcHUtY2x1c3RlciIpCiAgICAgICAgZGVmIG15X3BpcGVsaW5lKCkgLT4gT3V0cHV0czoKICAgICAgICAgICAgbm9kZTEgPSBoZWxsb193b3JsZF9jb21wb25lbnRfZnVuYyhjb21wb25lbnRfaW5fbnVtYmVyPTEsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbnB1dCkKICAgICAgICAgICAgcmV0dXJuIE91dHB1dHMoCiAgICAgICAgICAgICAgICBvdXRwdXQxPW5vZGUxLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLAogICAgICAgICAgICApCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IG15X3BpcGVsaW5lKCkKICAgICAgICAjIG92ZXJ3cml0ZSBncm91cCBvdXRwdXRzIG1vZGUgd2lsbCBhcHBlYXIgaW4gcGlwZWxpbmUgam9iJmNvbXBvbmVudCBsZXZlbAogICAgICAgIGV4cGVjdGVkX291dHB1dHMgPSB7Im91dHB1dDEiOiB7ImRlc2NyaXB0aW9uIjogIm5ldyBkZXNjcmlwdGlvbiIsICJ0eXBlIjogInVyaV9mb2xkZXIifX0KICAgICAgICBleHBlY3RlZF9qb2Jfb3V0cHV0cyA9IHsib3V0cHV0MSI6IHsiZGVzY3JpcHRpb24iOiAibmV3IGRlc2NyaXB0aW9uIiwgImpvYl9vdXRwdXRfdHlwZSI6ICJ1cmlfZm9sZGVyIn19CiAgICAgICAgcmVzdF9qb2JfZGljdCA9IHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCkKCiAgICAgICAgIyBhc3NlcnQgcGlwZWxpbmUgam9iIGxldmVsIG1vZGUgb3ZlcndyaXRlCiAgICAgICAgYXNzZXJ0IHJlc3Rfam9iX2RpY3RbInByb3BlcnRpZXMiXVsib3V0cHV0cyJdID09IGV4cGVjdGVkX2pvYl9vdXRwdXRzCiAgICAgICAgIyBhc3NlcnQgcGlwZWxpbmUgY29tcG9uZW50IGxldmVsIG1vZGUgb3ZlcndyaXRlCiAgICAgICAgYXNzZXJ0IHBpcGVsaW5lX2pvYi5jb21wb25lbnQuX3RvX2RpY3QoKVsib3V0cHV0cyJdID09IGV4cGVjdGVkX291dHB1dHMKCiAgICAgICAgcmVzdF9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZV9qb2IsIGNsaWVudCkKICAgICAgICByZXN0X2pvYl9kaWN0ID0gcmVzdF9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpCiAgICAgICAgYXNzZXJ0IHJlc3Rfam9iX2RpY3RbInByb3BlcnRpZXMiXVsib3V0cHV0cyJdWyJvdXRwdXQxIl1bImRlc2NyaXB0aW9uIl0gPT0gIm5ldyBkZXNjcmlwdGlvbiIKCiAgICAgICAgY29tcG9uZW50ID0gY2xpZW50LmNvbXBvbmVudHMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZV9qb2IuY29tcG9uZW50LCBfaXNfYW5vbnltb3VzPVRydWUpCiAgICAgICAgYXNzZXJ0IGNvbXBvbmVudC5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KClbInByb3BlcnRpZXMiXVsiY29tcG9uZW50X3NwZWMiXVsib3V0cHV0cyJdID09IGV4cGVjdGVkX291dHB1dHMKCiAgICBkZWYgdGVzdF9ncm91cF9vdXRwdXRzX21vZGVfb3ZlcndyaXRlKHNlbGYsIGNsaWVudCk6CiAgICAgICAgIyB0ZXN0IGdyb3VwIG91dHB1dHMgbW9kZSBvdmVyd3JpdGUKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfeWFtbCA9ICIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50LnltbCIKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1oZWxsb193b3JsZF9jb21wb25lbnRfeWFtbCkKCiAgICAgICAgQGdyb3VwCiAgICAgICAgY2xhc3MgT3V0cHV0czoKICAgICAgICAgICAgb3V0cHV0MTogT3V0cHV0KHR5cGU9InVyaV9mb2xkZXIiLCBtb2RlPSJ1cGxvYWQiKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKGRlZmF1bHRfY29tcHV0ZV90YXJnZXQ9ImNwdS1jbHVzdGVyIikKICAgICAgICBkZWYgbXlfcGlwZWxpbmUoKSAtPiBPdXRwdXRzOgogICAgICAgICAgICBub2RlMSA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudF9mdW5jKGNvbXBvbmVudF9pbl9udW1iZXI9MSwgY29tcG9uZW50X2luX3BhdGg9am9iX2lucHV0KQogICAgICAgICAgICByZXR1cm4gT3V0cHV0cygKICAgICAgICAgICAgICAgIG91dHB1dDE9bm9kZTEub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgsCiAgICAgICAgICAgICkKCiAgICAgICAgcGlwZWxpbmVfam9iID0gbXlfcGlwZWxpbmUoKQogICAgICAgICMgb3ZlcndyaXRlIGdyb3VwIG91dHB1dHMgbW9kZSB3aWxsIGFwcGVhciBpbiBwaXBlbGluZSBqb2ImY29tcG9uZW50IGxldmVsCiAgICAgICAgZXhwZWN0ZWRfam9iX291dHB1dHMgPSB7Im91dHB1dDEiOiB7Im1vZGUiOiAiVXBsb2FkIiwgImpvYl9vdXRwdXRfdHlwZSI6ICJ1cmlfZm9sZGVyIn19CiAgICAgICAgZXhwZWN0ZWRfb3V0cHV0cyA9IHsib3V0cHV0MSI6IHsibW9kZSI6ICJ1cGxvYWQiLCAidHlwZSI6ICJ1cmlfZm9sZGVyIn19CiAgICAgICAgcmVzdF9qb2JfZGljdCA9IHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCkKICAgICAgICAjIGFzc2VydCBwaXBlbGluZSBqb2IgbGV2ZWwgbW9kZSBvdmVyd3JpdGUKICAgICAgICBhc3NlcnQgcmVzdF9qb2JfZGljdFsicHJvcGVydGllcyJdWyJvdXRwdXRzIl0gPT0gZXhwZWN0ZWRfam9iX291dHB1dHMKICAgICAgICAjIGFzc2VydCBwaXBlbGluZSBjb21wb25lbnQgbGV2ZWwgbW9kZSBvdmVyd3JpdGUKICAgICAgICBhc3NlcnQgcGlwZWxpbmVfam9iLmNvbXBvbmVudC5fdG9fZGljdCgpWyJvdXRwdXRzIl0gPT0gZXhwZWN0ZWRfb3V0cHV0cwoKICAgICAgICByZXN0X2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQogICAgICAgIHJlc3Rfam9iX2RpY3QgPSByZXN0X2pvYi5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCkKICAgICAgICBhc3NlcnQgcmVzdF9qb2JfZGljdFsicHJvcGVydGllcyJdWyJvdXRwdXRzIl0gPT0gZXhwZWN0ZWRfam9iX291dHB1dHMKCiAgICAgICAgY29tcG9uZW50ID0gY2xpZW50LmNvbXBvbmVudHMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZV9qb2IuY29tcG9uZW50LCBfaXNfYW5vbnltb3VzPVRydWUpCiAgICAgICAgIyBwaXBlbGluZSBjb21wb25lbnQgb3V0cHV0IG1vZGUgaXMgdW5kZWZpbmVkIGJlaGF2aW9yIHNvIHdlIHNraXAgYXNzZXJ0IGl0CiAgICAgICAgIyBhc3NlcnQgY29tcG9uZW50Ll90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKVsicHJvcGVydGllcyJdWyJjb21wb25lbnRfc3BlYyJdWyJvdXRwdXRzIl0gPT0gZXhwZWN0ZWRfb3V0cHV0cwoKICAgIGRlZiB0ZXN0X2xvY2FsX2RhdGFfYXNfbm9kZV9pbnB1dChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfeWFtbCA9ICIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50LnltbCIKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1oZWxsb193b3JsZF9jb21wb25lbnRfeWFtbCkKICAgICAgICBsb2NhbF9kYXRhX2lucHV0ID0gSW5wdXQodHlwZT0idXJpX2ZvbGRlciIsIHBhdGg9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2RhdGEiKQoKICAgICAgICBAZHNsLnBpcGVsaW5lCiAgICAgICAgZGVmIG15X3BpcGVsaW5lKCk6CiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9mdW5jKGNvbXBvbmVudF9pbl9udW1iZXI9MSwgY29tcG9uZW50X2luX3BhdGg9bG9jYWxfZGF0YV9pbnB1dCkKCiAgICAgICAgcGlwZWxpbmVfam9iOiBQaXBlbGluZUpvYiA9IG15X3BpcGVsaW5lKCkKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImNwdS1jbHVzdGVyIgogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5kaXNhYmxlX21vY2tfY29kZV9oYXNoCiAgICBkZWYgdGVzdF9yZWdpc3Rlcl9vdXRwdXRfc2RrKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGZyb20gYXp1cmUuYWkubWwuc3dlZXAgaW1wb3J0ICgKICAgICAgICAgICAgQmFuZGl0UG9saWN5LAogICAgICAgICAgICBDaG9pY2UsCiAgICAgICAgICAgIExvZ05vcm1hbCwKICAgICAgICAgICAgTG9nVW5pZm9ybSwKICAgICAgICAgICAgTm9ybWFsLAogICAgICAgICAgICBRTG9nTm9ybWFsLAogICAgICAgICAgICBRTG9nVW5pZm9ybSwKICAgICAgICAgICAgUU5vcm1hbCwKICAgICAgICAgICAgUVVuaWZvcm0sCiAgICAgICAgICAgIFJhbmRpbnQsCiAgICAgICAgICAgIFVuaWZvcm0sCiAgICAgICAgKQoKICAgICAgICBjb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnQueW1sIikKICAgICAgICBjb21wb25lbnRfaW5wdXQgPSBJbnB1dCh0eXBlPSJ1cmlfZmlsZSIsIHBhdGg9Imh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IikKICAgICAgICBzcGFya19jb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL3NwYXJrX2NvbXBvbmVudC9jb21wb25lbnQueW1sIikKICAgICAgICBwYXJhbGxlbF9jb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudCgKICAgICAgICAgICAgc291cmNlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL3BhcmFsbGVsX2NvbXBvbmVudF93aXRoX2ZpbGVfaW5wdXQueW1sIgogICAgICAgICkKICAgICAgICBzd2VlcF9jb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnRfZm9yX3N3ZWVwLnltbCIpCgogICAgICAgIEBkc2wucGlwZWxpbmUoKQogICAgICAgIGRlZiByZWdpc3Rlcl9ub2RlX291dHB1dCgpOgogICAgICAgICAgICBub2RlID0gY29tcG9uZW50KGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbnB1dCkKICAgICAgICAgICAgbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aC5uYW1lID0gImFfb3V0cHV0IgogICAgICAgICAgICBub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLnZlcnNpb24gPSAiMSIKCiAgICAgICAgICAgIHNwYXJrX25vZGUgPSBzcGFya19jb21wb25lbnQoZmlsZV9pbnB1dD1jb21wb25lbnRfaW5wdXQpCiAgICAgICAgICAgIHNwYXJrX25vZGUuY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKICAgICAgICAgICAgc3Bhcmtfbm9kZS5vdXRwdXRzLm91dHB1dC5uYW1lID0gInNwYXJrX291dHB1dCIKICAgICAgICAgICAgc3Bhcmtfbm9kZS5vdXRwdXRzLm91dHB1dC52ZXJzaW9uID0gIjEiCgogICAgICAgICAgICBwYXJhbGxlbF9ub2RlID0gcGFyYWxsZWxfY29tcG9uZW50KAogICAgICAgICAgICAgICAgam9iX2RhdGFfcGF0aD1JbnB1dCh0eXBlPSJtbHRhYmxlIiwgcGF0aD0iaHR0cHM6Ly9kcHJlcGRhdGEuYmxvYi5jb3JlLndpbmRvd3MubmV0L2RlbW8vVGl0YW5pYy5jc3YiKQogICAgICAgICAgICApCiAgICAgICAgICAgIHBhcmFsbGVsX25vZGUub3V0cHV0cy5qb2Jfb3V0cHV0X3BhdGgubmFtZSA9ICJwYXJhbGxlbF9vdXRwdXQiCiAgICAgICAgICAgIHBhcmFsbGVsX25vZGUub3V0cHV0cy5qb2Jfb3V0cHV0X3BhdGgudmVyc2lvbiA9ICIxMjNfcGFyYWxsZWwiCgogICAgICAgICAgICBjbWRfbm9kZTEgPSBzd2VlcF9jb21wb25lbnQoCiAgICAgICAgICAgICAgICBiYXRjaF9zaXplPUNob2ljZShbMjUsIDM1XSksCiAgICAgICAgICAgICAgICBmaXJzdF9sYXllcl9uZXVyb25zPVJhbmRpbnQodXBwZXI9NTApLAogICAgICAgICAgICAgICAgc2Vjb25kX2xheWVyX25ldXJvbnM9UVVuaWZvcm0obWluX3ZhbHVlPTEwLCBtYXhfdmFsdWU9NTAsIHE9NSksCiAgICAgICAgICAgICAgICB0aGlyZF9sYXllcl9uZXVyb25zPVFMb2dOb3JtYWwobXU9NSwgc2lnbWE9MSwgcT01KSwKICAgICAgICAgICAgICAgIGVwb2Nocz1RTG9nVW5pZm9ybShtaW5fdmFsdWU9MSwgbWF4X3ZhbHVlPTUsIHE9NSksCiAgICAgICAgICAgICAgICBtb21lbnR1bT1RTm9ybWFsKG11PTEwLCBzaWdtYT01LCBxPTIpLAogICAgICAgICAgICAgICAgd2VpZ2h0X2RlY2F5PUxvZ05vcm1hbChtdT0wLCBzaWdtYT0xKSwKICAgICAgICAgICAgICAgIGxlYXJuaW5nX3JhdGU9TG9nVW5pZm9ybShtaW5fdmFsdWU9LTYsIG1heF92YWx1ZT0tMSksCiAgICAgICAgICAgICAgICBmMT1Ob3JtYWwobXU9MCwgc2lnbWE9MSksCiAgICAgICAgICAgICAgICBmMj1Vbmlmb3JtKG1pbl92YWx1ZT0xMCwgbWF4X3ZhbHVlPTIwKSwKICAgICAgICAgICAgICAgIGRhdGFfZm9sZGVyPUlucHV0KAogICAgICAgICAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5NTFRBQkxFLAogICAgICAgICAgICAgICAgICAgIHBhdGg9Imh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vLyIsCiAgICAgICAgICAgICAgICAgICAgbW9kZT1JbnB1dE91dHB1dE1vZGVzLlJPX01PVU5ULAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKQogICAgICAgICAgICBzd2VlcF9ub2RlID0gY21kX25vZGUxLnN3ZWVwKAogICAgICAgICAgICAgICAgcHJpbWFyeV9tZXRyaWM9InZhbGlkYXRpb25fYWNjIiwKICAgICAgICAgICAgICAgIGdvYWw9Im1heGltaXplIiwKICAgICAgICAgICAgICAgIHNhbXBsaW5nX2FsZ29yaXRobT0icmFuZG9tIiwKICAgICAgICAgICAgKQogICAgICAgICAgICBzd2VlcF9ub2RlLmNvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCiAgICAgICAgICAgIHN3ZWVwX25vZGUuc2V0X2xpbWl0cyhtYXhfdG90YWxfdHJpYWxzPTIsIG1heF9jb25jdXJyZW50X3RyaWFscz0zLCB0aW1lb3V0PTYwMCkKICAgICAgICAgICAgc3dlZXBfbm9kZS5lYXJseV90ZXJtaW5hdGlvbiA9IEJhbmRpdFBvbGljeShldmFsdWF0aW9uX2ludGVydmFsPTIsIHNsYWNrX2ZhY3Rvcj0wLjEsIGRlbGF5X2V2YWx1YXRpb249MSkKICAgICAgICAgICAgc3dlZXBfbm9kZS5vdXRwdXRzLnRyYWluZWRfbW9kZWxfZGlyLm5hbWUgPSAic3dlZXBfb3V0cHV0IgogICAgICAgICAgICBzd2VlcF9ub2RlLm91dHB1dHMudHJhaW5lZF9tb2RlbF9kaXIudmVyc2lvbiA9ICJzd2VlcF8yIgoKICAgICAgICBwaXBlbGluZSA9IHJlZ2lzdGVyX25vZGVfb3V0cHV0KCkKICAgICAgICBwaXBlbGluZS5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiYXp1cmVtbDpjcHUtY2x1c3RlciIKICAgICAgICBwaXBlbGluZV9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQogICAgICAgIG91dHB1dCA9IHBpcGVsaW5lX2pvYi5qb2JzWyJub2RlIl0ub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgKICAgICAgICBhc3NlcnQgb3V0cHV0Lm5hbWUgPT0gImFfb3V0cHV0IgogICAgICAgIGFzc2VydCBvdXRwdXQudmVyc2lvbiA9PSAiMSIKICAgICAgICBvdXRwdXQgPSBwaXBlbGluZV9qb2Iuam9ic1sic3Bhcmtfbm9kZSJdLm91dHB1dHMub3V0cHV0CiAgICAgICAgYXNzZXJ0IG91dHB1dC5uYW1lID09ICJzcGFya19vdXRwdXQiCiAgICAgICAgYXNzZXJ0IG91dHB1dC52ZXJzaW9uID09ICIxIgogICAgICAgIG91dHB1dCA9IHBpcGVsaW5lX2pvYi5qb2JzWyJwYXJhbGxlbF9ub2RlIl0ub3V0cHV0cy5qb2Jfb3V0cHV0X3BhdGgKICAgICAgICBhc3NlcnQgb3V0cHV0Lm5hbWUgPT0gInBhcmFsbGVsX291dHB1dCIKICAgICAgICBhc3NlcnQgb3V0cHV0LnZlcnNpb24gPT0gIjEyM19wYXJhbGxlbCIKICAgICAgICBvdXRwdXQgPSBwaXBlbGluZV9qb2Iuam9ic1sic3dlZXBfbm9kZSJdLm91dHB1dHMudHJhaW5lZF9tb2RlbF9kaXIKICAgICAgICBhc3NlcnQgb3V0cHV0Lm5hbWUgPT0gInN3ZWVwX291dHB1dCIKICAgICAgICBhc3NlcnQgb3V0cHV0LnZlcnNpb24gPT0gInN3ZWVwXzIiCgogICAgICAgIEBkc2wucGlwZWxpbmUoKQogICAgICAgIGRlZiByZWdpc3Rlcl9waXBlbGluZV9vdXRwdXQoKToKICAgICAgICAgICAgbm9kZSA9IGNvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5wdXQpCiAgICAgICAgICAgIHJldHVybiB7InBpcGVpbmVfYV9vdXRwdXQiOiBub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRofQoKICAgICAgICBwaXBlbGluZSA9IHJlZ2lzdGVyX3BpcGVsaW5lX291dHB1dCgpCiAgICAgICAgcGlwZWxpbmUub3V0cHV0cy5waXBlaW5lX2Ffb3V0cHV0Lm5hbWUgPSAiYV9vdXRwdXQiCiAgICAgICAgcGlwZWxpbmUub3V0cHV0cy5waXBlaW5lX2Ffb3V0cHV0LnZlcnNpb24gPSAiMSIKICAgICAgICBwaXBlbGluZS5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiYXp1cmVtbDpjcHUtY2x1c3RlciIKICAgICAgICBwaXBlbGluZV9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQogICAgICAgIG91dHB1dCA9IHBpcGVsaW5lX2pvYi5vdXRwdXRzLnBpcGVpbmVfYV9vdXRwdXQKICAgICAgICBhc3NlcnQgb3V0cHV0Lm5hbWUgPT0gImFfb3V0cHV0IgogICAgICAgIGFzc2VydCBvdXRwdXQudmVyc2lvbiA9PSAiMSIKCiAgICAgICAgQGRzbC5waXBlbGluZSgpCiAgICAgICAgZGVmIHJlZ2lzdGVyX2JvdGhfb3V0cHV0KCk6CiAgICAgICAgICAgIG5vZGUgPSBjb21wb25lbnQoY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2lucHV0KQogICAgICAgICAgICBub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLm5hbWUgPSAiYV9vdXRwdXQiCiAgICAgICAgICAgIG5vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgudmVyc2lvbiA9ICIxIgogICAgICAgICAgICByZXR1cm4geyJwaXBlaW5lX2Ffb3V0cHV0Ijogbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH0KCiAgICAgICAgcGlwZWxpbmUgPSByZWdpc3Rlcl9ib3RoX291dHB1dCgpCiAgICAgICAgcGlwZWxpbmUub3V0cHV0cy5waXBlaW5lX2Ffb3V0cHV0Lm5hbWUgPSAiYl9vdXRwdXQiCiAgICAgICAgcGlwZWxpbmUub3V0cHV0cy5waXBlaW5lX2Ffb3V0cHV0LnZlcnNpb24gPSAiMiIKICAgICAgICBwaXBlbGluZS5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiYXp1cmVtbDpjcHUtY2x1c3RlciIKICAgICAgICBwaXBlbGluZV9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgICAgICBwaXBlbGluZV9vdXRwdXQgPSBwaXBlbGluZV9qb2Iub3V0cHV0cy5waXBlaW5lX2Ffb3V0cHV0CiAgICAgICAgYXNzZXJ0IHBpcGVsaW5lX291dHB1dC5uYW1lID09ICJiX291dHB1dCIKICAgICAgICBhc3NlcnQgcGlwZWxpbmVfb3V0cHV0LnZlcnNpb24gPT0gIjIiCiAgICAgICAgbm9kZV9vdXRwdXQgPSBwaXBlbGluZV9qb2Iuam9ic1sibm9kZSJdLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoCiAgICAgICAgYXNzZXJ0IG5vZGVfb3V0cHV0Lm5hbWUgPT0gTm9uZQogICAgICAgIGFzc2VydCBub2RlX291dHB1dC52ZXJzaW9uID09IE5vbmUKCiAgICBkZWYgdGVzdF9kc2xfcGlwZWxpbmVfd2l0aF9kYXRhX3RyYW5zZmVyX2NvcHlfMnVyaWZvbGRlcihzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5kYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZS5jb3B5X2RhdGEucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lX2Zyb21feWFtbCBhcyBkYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZSwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUoKQoKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lKQoKICAgICAgICBhY3R1YWxfam9iID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5wcm9wZXJ0aWVzLmFzX2RpY3QoKSwgKmNvbW1vbl9vbWl0X2ZpZWxkcykKCiAgICAgICAgZXhwZWN0ZWRfam9iID0gewogICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAic3VibWl0IGEgcGlwZWxpbmUgd2l0aCBkYXRhIHRyYW5zZmVyIGNvcHkgam9iIiwKICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICJjb3Ntb3NfZm9sZGVyIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJ1cmlfZm9sZGVyIiwgIm1vZGUiOiAiUmVhZE9ubHlNb3VudCJ9LAogICAgICAgICAgICAgICAgImNvc21vc19mb2xkZXJfZHVwIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJ1cmlfZm9sZGVyIiwgIm1vZGUiOiAiUmVhZE9ubHlNb3VudCJ9LAogICAgICAgICAgICB9LAogICAgICAgICAgICAiaXNfYXJjaGl2ZWQiOiBGYWxzZSwKICAgICAgICAgICAgImpvYl90eXBlIjogIlBpcGVsaW5lIiwKICAgICAgICAgICAgImpvYnMiOiB7CiAgICAgICAgICAgICAgICAibWVyZ2VfZmlsZXMiOiB7CiAgICAgICAgICAgICAgICAgICAgImRhdGFfY29weV9tb2RlIjogIm1lcmdlX3dpdGhfb3ZlcndyaXRlIiwKICAgICAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAiZm9sZGVyMSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmNvc21vc19mb2xkZXJ9fSJ9LAogICAgICAgICAgICAgICAgICAgICAgICAiZm9sZGVyMiI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmNvc21vc19mb2xkZXJfZHVwfX0ifSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIm1lcmdlX2ZpbGVzIiwKICAgICAgICAgICAgICAgICAgICAib3V0cHV0cyI6IHsib3V0cHV0X2ZvbGRlciI6IHsidHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5vdXRwdXRzLm1lcmdlZF9ibG9ifX0ifX0sCiAgICAgICAgICAgICAgICAgICAgInRhc2siOiAiY29weV9kYXRhIiwKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJkYXRhX3RyYW5zZmVyIiwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm91dHB1dHMiOiB7Im1lcmdlZF9ibG9iIjogeyJqb2Jfb3V0cHV0X3R5cGUiOiAidXJpX2ZvbGRlciIsICJtb2RlIjogIlJlYWRXcml0ZU1vdW50In19LAogICAgICAgICAgICAic2V0dGluZ3MiOiB7ImRlZmF1bHRfY29tcHV0ZSI6ICJzZXJ2ZXJsZXNzIn0sCiAgICAgICAgICAgICJ0YWdzIjoge30sCiAgICAgICAgfQogICAgICAgIGFzc2VydCBleHBlY3RlZF9qb2IgPT0gYWN0dWFsX2pvYgoKICAgIGRlZiB0ZXN0X291dHB1dF9zZXR0aW5nX3BhdGgoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBjb21wb25lbnRfeWFtbCA9IGNvbXBvbmVudHNfZGlyIC8gImhlbGxvd29ybGRfY29tcG9uZW50LnltbCIKICAgICAgICBjb21wb25lbnRfZnVuYzEgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Y29tcG9uZW50X3lhbWwpCgogICAgICAgICMgY2FzZSAxOiBvbmx5IG5vZGUgbGV2ZWwgaGFzIHNldHRpbmcKICAgICAgICBAZHNsLnBpcGVsaW5lKCkKICAgICAgICBkZWYgcGlwZWxpbmUoKToKICAgICAgICAgICAgbm9kZTEgPSBjb21wb25lbnRfZnVuYzEoY29tcG9uZW50X2luX251bWJlcj0xLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5wdXQpCiAgICAgICAgICAgIG5vZGUxLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLnBhdGggPSAiYXp1cmVtbDovL2RhdGFzdG9yZXMvd29ya3NwYWNlYmxvYnN0b3JlL3BhdGhzL291dHB1dHMvMSIKICAgICAgICAgICAgcmV0dXJuIG5vZGUxLm91dHB1dHMKCiAgICAgICAgcGlwZWxpbmVfam9iID0gcGlwZWxpbmUoKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCiAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCiAgICAgICAgam9iX2RpY3QgPSBwaXBlbGluZV9qb2IuX3RvX2RpY3QoKQogICAgICAgIGV4cGVjdGVkX25vZGVfb3V0cHV0X2RpY3QgPSB7CiAgICAgICAgICAgICJjb21wb25lbnRfb3V0X3BhdGgiOiAiJHt7cGFyZW50Lm91dHB1dHMuY29tcG9uZW50X291dF9wYXRofX0iLAogICAgICAgIH0KICAgICAgICBleHBlY3RlZF9waXBlbGluZV9vdXRwdXRfZGljdCA9IHsKICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHsKICAgICAgICAgICAgICAgICMgZGVmYXVsdCBtb2RlIGFkZGVkIGJ5IG10LCBkZWZhdWx0IHR5cGUgYWRkZWQgYnkgU0RLCiAgICAgICAgICAgICAgICAibW9kZSI6ICJyd19tb3VudCIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJ1cmlfZm9sZGVyIiwKICAgICAgICAgICAgICAgICMgbm9kZSBsZXZlbCBjb25maWcgd2lsbCBiZSBjb3BpZWQgdG8gcGlwZWxpbmUgbGV2ZWwKICAgICAgICAgICAgICAgICJwYXRoIjogImF6dXJlbWw6Ly9kYXRhc3RvcmVzL3dvcmtzcGFjZWJsb2JzdG9yZS9wYXRocy9vdXRwdXRzLzEiLAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGFzc2VydCBqb2JfZGljdFsiam9icyJdWyJub2RlMSJdWyJvdXRwdXRzIl0gPT0gZXhwZWN0ZWRfbm9kZV9vdXRwdXRfZGljdAogICAgICAgIGFzc2VydCBqb2JfZGljdFsib3V0cHV0cyJdID09IGV4cGVjdGVkX3BpcGVsaW5lX291dHB1dF9kaWN0CgogICAgZGVmIHRlc3RfcGlwZWxpbmVfY29tcG9uZW50X291dHB1dF9zZXR0aW5nKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgY29tcG9uZW50X3lhbWwgPSBjb21wb25lbnRzX2RpciAvICJoZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiCiAgICAgICAgY29tcG9uZW50X2Z1bmMxID0gbG9hZF9jb21wb25lbnQoc291cmNlPWNvbXBvbmVudF95YW1sKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKCkKICAgICAgICBkZWYgaW5uZXJfcGlwZWxpbmUoKToKICAgICAgICAgICAgbm9kZTEgPSBjb21wb25lbnRfZnVuYzEoY29tcG9uZW50X2luX251bWJlcj0xLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5wdXQpCiAgICAgICAgICAgIG5vZGUxLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLnBhdGggPSAiYXp1cmVtbDovL2RhdGFzdG9yZXMvd29ya3NwYWNlYmxvYnN0b3JlL3BhdGhzL291dHB1dHMvMSIKICAgICAgICAgICAgIyBub2RlMSdzIG91dHB1dCBzZXR0aW5nIHdpbGwgYmUgY29waWVkIHRvIHBpcGVsaW5lJ3Mgc2V0dGluZwogICAgICAgICAgICByZXR1cm4gbm9kZTEub3V0cHV0cwoKICAgICAgICBAZHNsLnBpcGVsaW5lKCkKICAgICAgICBkZWYgb3V0ZXJfcGlwZWxpbmUoKToKICAgICAgICAgICAgIyBpbm5lcl9waXBlbGluZSdzIG91dHB1dCBzZXR0aW5nIHdpbGwgYmUgY29waWVkIHRvIG5vZGUxJ3Mgc2V0dGluZwogICAgICAgICAgICBub2RlMSA9IGlubmVyX3BpcGVsaW5lKCkKICAgICAgICAgICAgIyBub2RlMSdzIG91dHB1dCBzZXR0aW5nIHdpbGwgYmUgY29waWVkIHRvIHBpcGVsaW5lJ3Mgc2V0dGluZwogICAgICAgICAgICByZXR1cm4gbm9kZTEub3V0cHV0cwoKICAgICAgICBwaXBlbGluZV9qb2IgPSBvdXRlcl9waXBlbGluZSgpCiAgICAgICAgcGlwZWxpbmVfam9iX2RpY3QgPSBwaXBlbGluZV9qb2IuX3RvX2RpY3QoKQogICAgICAgIGFzc2VydCBwaXBlbGluZV9qb2JfZGljdFsib3V0cHV0cyJdID09IHsKICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHsKICAgICAgICAgICAgICAgICJwYXRoIjogImF6dXJlbWw6Ly9kYXRhc3RvcmVzL3dvcmtzcGFjZWJsb2JzdG9yZS9wYXRocy9vdXRwdXRzLzEiLAogICAgICAgICAgICAgICAgInR5cGUiOiAidXJpX2ZvbGRlciIsCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcGlwZWxpbmVfY29tcG9uZW50ID0gcGlwZWxpbmVfam9iLmpvYnNbIm5vZGUxIl0uY29tcG9uZW50CiAgICAgICAgcGlwZWxpbmVfY29tcG9uZW50X2RpY3QgPSBwaXBlbGluZV9jb21wb25lbnQuX3RvX2RpY3QoKQogICAgICAgIGFzc2VydCBwaXBlbGluZV9jb21wb25lbnRfZGljdFsib3V0cHV0cyJdID09IHsiY29tcG9uZW50X291dF9wYXRoIjogeyJ0eXBlIjogInVyaV9mb2xkZXIifX0KICAgICAgICBhc3NlcnQgcGlwZWxpbmVfY29tcG9uZW50X2RpY3RbImpvYnMiXVsibm9kZTEiXVsib3V0cHV0cyJdID09IHsKICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6ICIke3twYXJlbnQub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9fSIKICAgICAgICB9CgogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZV9qb2IpCiAgICAgICAgY2xpZW50LmpvYnMuYmVnaW5fY2FuY2VsKHBpcGVsaW5lX2pvYi5uYW1lKQogICAgICAgIGpvYl9kaWN0ID0gcGlwZWxpbmVfam9iLl90b19kaWN0KCkKICAgICAgICAjIG91dGVyIHBpcGVsaW5lJ3Mgbm9kZTEgc2hvdWxkIGhhdmUgdGhlIG91dHB1dCBzZXR0aW5nCiAgICAgICAgYXNzZXJ0IGpvYl9kaWN0WyJqb2JzIl1bIm5vZGUxIl1bIm91dHB1dHMiXSA9PSB7ImNvbXBvbmVudF9vdXRfcGF0aCI6ICIke3twYXJlbnQub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9fSJ9CiAgICAgICAgYXNzZXJ0IGpvYl9kaWN0WyJvdXRwdXRzIl0gPT0gewogICAgICAgICAgICAiY29tcG9uZW50X291dF9wYXRoIjogewogICAgICAgICAgICAgICAgIm1vZGUiOiAicndfbW91bnQiLAogICAgICAgICAgICAgICAgInR5cGUiOiAidXJpX2ZvbGRlciIsCiAgICAgICAgICAgICAgICAjIG5vZGUgbGV2ZWwgY29uZmlnIHdpbGwgYmUgY29waWVkIHRvIHBpcGVsaW5lIGxldmVsCiAgICAgICAgICAgICAgICAicGF0aCI6ICJhenVyZW1sOi8vZGF0YXN0b3Jlcy93b3Jrc3BhY2VibG9ic3RvcmUvcGF0aHMvb3V0cHV0cy8xIiwKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICBAcHl0ZXN0Lm1hcmsuZGlzYWJsZV9tb2NrX2NvZGVfaGFzaAogICAgZGVmIHRlc3RfcmVnaXN0ZXJfb3V0cHV0X3Nka19zdWNjZWVkKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGNvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiKQogICAgICAgIGNvbXBvbmVudF9pbnB1dCA9IElucHV0KHR5cGU9InVyaV9maWxlIiwgcGF0aD0iaHR0cHM6Ly9kcHJlcGRhdGEuYmxvYi5jb3JlLndpbmRvd3MubmV0L2RlbW8vVGl0YW5pYy5jc3YiKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKCkKICAgICAgICBkZWYgc3ViX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIG5vZGUgPSBjb21wb25lbnQoY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2lucHV0KQogICAgICAgICAgICBub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLm5hbWUgPSAic3ViX3BpcGVsaW5lX291dHB1dCIKICAgICAgICAgICAgbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aC52ZXJzaW9uID0gInYxIgogICAgICAgICAgICByZXR1cm4geyJzdWJfcGlwZWluZV9hX291dHB1dCI6IG5vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9CgogICAgICAgIEBkc2wucGlwZWxpbmUoKQogICAgICAgIGRlZiByZWdpc3Rlcl9ib3RoX291dHB1dCgpOgogICAgICAgICAgICAjIHJlZ2lzdGVyIE5vZGVPdXRwdXQgd2hpY2ggaXMgYmluZGluZyB0byBQaXBlbGluZU91dHB1dAogICAgICAgICAgICBub2RlID0gY29tcG9uZW50KGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbnB1dCkKICAgICAgICAgICAgbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aC5uYW1lID0gIm4xX291dHB1dCIKICAgICAgICAgICAgbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aC52ZXJzaW9uID0gInYxIgoKICAgICAgICAgICAgIyByZWdpc3RlciBOb2RlT3V0cHV0IHdoaWNoIGlzbid0IGJpbmRpbmcgdG8gUGlwZWxpbmVPdXRwdXQKICAgICAgICAgICAgbm9kZV8yID0gY29tcG9uZW50KGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbnB1dCkKICAgICAgICAgICAgbm9kZV8yLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLm5hbWUgPSAibjJfb3V0cHV0IgogICAgICAgICAgICBub2RlXzIub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgudmVyc2lvbiA9ICJ2MSIKCiAgICAgICAgICAgICMgcmVnaXN0ZXIgTm9kZU91dHB1dCB3aXRob3V0IHZlcnNpb24sIGluIHRoaXMgY2FzZSB0aGUgcnVuIHJlc3VsdCBjYW4gYmUgcmV1c2VkCiAgICAgICAgICAgIG5vZGVfMyA9IGNvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5wdXQpCiAgICAgICAgICAgIG5vZGVfMy5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aC5uYW1lID0gIm4zX291dHB1dCIKCiAgICAgICAgICAgICMgcmVnaXN0ZXIgTm9kZU91dHB1dCBvZiBzdWJncmFwaAogICAgICAgICAgICBzdWJfbm9kZSA9IHN1Yl9waXBlbGluZSgpCiAgICAgICAgICAgIHN1Yl9ub2RlLm91dHB1dHMuc3ViX3BpcGVpbmVfYV9vdXRwdXQubmFtZSA9ICJzdWJfcGlwZWxpbmUiCiAgICAgICAgICAgIHN1Yl9ub2RlLm91dHB1dHMuc3ViX3BpcGVpbmVfYV9vdXRwdXQudmVyc2lvbiA9ICJ2MSIKCiAgICAgICAgICAgIHJldHVybiB7InBpcGVpbmVfYV9vdXRwdXQiOiBub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRofQoKICAgICAgICBwaXBlbGluZSA9IHJlZ2lzdGVyX2JvdGhfb3V0cHV0KCkKICAgICAgICBwaXBlbGluZS5vdXRwdXRzLnBpcGVpbmVfYV9vdXRwdXQubmFtZSA9ICJwMV9vdXRwdXQiCiAgICAgICAgcGlwZWxpbmUub3V0cHV0cy5waXBlaW5lX2Ffb3V0cHV0LnZlcnNpb24gPSAidjEiCiAgICAgICAgcGlwZWxpbmUuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImNwdS1jbHVzdGVyIgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgICAgIGNoZWNrX25hbWVfYW5kX3ZlcnNpb24ocGlwZWxpbmVfam9iLm91dHB1dHMucGlwZWluZV9hX291dHB1dCwgInAxX291dHB1dCIsICJ2MSIpCiAgICAgICAgY2hlY2tfbmFtZV9hbmRfdmVyc2lvbihwaXBlbGluZV9qb2Iuam9ic1sibm9kZV8yIl0ub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgsICJuMl9vdXRwdXQiLCAidjEiKQogICAgICAgIGFzc2VydCBwaXBlbGluZV9qb2Iuam9ic1sibm9kZV8zIl0ub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgubmFtZSA9PSAibjNfb3V0cHV0IgogICAgICAgIGNoZWNrX25hbWVfYW5kX3ZlcnNpb24ocGlwZWxpbmVfam9iLmpvYnNbInN1Yl9ub2RlIl0ub3V0cHV0cy5zdWJfcGlwZWluZV9hX291dHB1dCwgInN1Yl9waXBlbGluZSIsICJ2MSIpCgogICAgQHB5dGVzdC5tYXJrLnNraXAocmVhc29uPSJLZXlFcnJvcjogJ25vZGVfMiciKQogICAgQHB5dGVzdC5tYXJrLmRpc2FibGVfbW9ja19jb2RlX2hhc2gKICAgIGRlZiB0ZXN0X3JlZ2lzdGVyX291dHB1dF9mb3JfcGlwZWxpbmVfY29tcG9uZW50KHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGNvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiKQogICAgICAgIGNvbXBvbmVudF9pbnB1dCA9IElucHV0KHR5cGU9InVyaV9maWxlIiwgcGF0aD0iaHR0cHM6Ly9kcHJlcGRhdGEuYmxvYi5jb3JlLndpbmRvd3MubmV0L2RlbW8vVGl0YW5pYy5jc3YiKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKCkKICAgICAgICBkZWYgc3ViX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIG5vZGVfMSA9IGNvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5wdXQpICAjIHRlc3QgdXNlIE91dHB1dCB0byBpbml0aWFsaXplIHN1YmdyYXBoLmpvYnMub3V0cHV0CiAgICAgICAgICAgIG5vZGVfMS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCA9IE91dHB1dChuYW1lPSJzdWJfcGlwZWxpbmVfMV9vdXRwdXQiLCB2ZXJzaW9uPSJ2MSIpCgogICAgICAgICAgICBub2RlXzIgPSBjb21wb25lbnQoY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2lucHV0KSAgIyB0ZXN0IHdlIGNhbiBwYXNzIE5vZGVPdXRwdXQgaW4gUGlwZWxpbmVDb21wb25lbnQKICAgICAgICAgICAgbm9kZV8yLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLm5hbWUgPSAic3ViX3BpcGVsaW5lXzJfb3V0cHV0IgogICAgICAgICAgICBub2RlXzIub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgudmVyc2lvbiA9ICJ2MiIKCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAic3ViX25vZGVfMSI6IG5vZGVfMS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwKICAgICAgICAgICAgfQoKICAgICAgICBAZHNsLnBpcGVsaW5lKCkKICAgICAgICBkZWYgcmVnaXN0ZXJfYm90aF9vdXRwdXQoKToKICAgICAgICAgICAgc3ViZ3JhcGggPSBzdWJfcGlwZWxpbmUoKQoKICAgICAgICBwaXBlbGluZSA9IHJlZ2lzdGVyX2JvdGhfb3V0cHV0KCkKICAgICAgICBwaXBlbGluZS5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCiAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICAgICAgY2hlY2tfbmFtZV9hbmRfdmVyc2lvbihwaXBlbGluZV9qb2Iuam9ic1sic3ViZ3JhcGgiXS5vdXRwdXRzWyJzdWJfbm9kZV8xIl0sICJzdWJfcGlwZWxpbmVfMV9vdXRwdXQiLCAidjEiKQoKICAgICAgICBzdWJncmFwaF9pZCA9IHBpcGVsaW5lX2pvYi5qb2JzWyJzdWJncmFwaCJdLmNvbXBvbmVudAogICAgICAgIHN1YmdyYXBoX2lkID0gc3ViZ3JhcGhfaWQuc3BsaXQoIjoiKQogICAgICAgIHN1YmdyYXBoID0gY2xpZW50LmNvbXBvbmVudHMuZ2V0KG5hbWU9c3ViZ3JhcGhfaWRbMF0sIHZlcnNpb249c3ViZ3JhcGhfaWRbMV0pCiAgICAgICAgIyBUT0RPOiBlbmFibGUgdGhpcyBjaGVjayBpbiBwbGF5YmFjayBtb2RlIGFmdGVyIHBpcGVsaW5lX2NvbXBvbmVudC5qb2JzIGlzIG9wZW5lZCBpbiBhbGwgc3Vic2NyaXB0aW9ucwogICAgICAgIGlmIGlzX2xpdmUoKToKICAgICAgICAgICAgY2hlY2tfbmFtZV9hbmRfdmVyc2lvbihzdWJncmFwaC5qb2JzWyJub2RlXzIiXS5vdXRwdXRzWyJjb21wb25lbnRfb3V0X3BhdGgiXSwgInN1Yl9waXBlbGluZV8yX291dHB1dCIsICJ2MiIpCgogICAgQHB5dGVzdC5tYXJrLmRpc2FibGVfbW9ja19jb2RlX2hhc2gKICAgICMgd2l0aG91dCB0aGlzIG1hcmssIHRoZSBjb2RlIHdvdWxkIGJlIHBhc3NlZCB3aXRoIGRpZmZlcmVudCBpZCBldmVuIHdoZW4gd2UgdXBsb2FkIHRoZSBzYW1lIGNvbXBvbmVudCwKICAgICMgYWRkIHRoaXMgbWFyayB0byByZXVzZSBub2RlIGFuZCBmdXJ0aGVyIHJldXNlIHBpcGVsaW5lCiAgICBkZWYgdGVzdF9yZWdpc3Rlcl93aXRoX291dHB1dF9mb3JtYXQoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgY29tcG9uZW50ID0gbG9hZF9jb21wb25lbnQoc291cmNlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50LnltbCIpCiAgICAgICAgY29tcG9uZW50X2lucHV0ID0gSW5wdXQodHlwZT0idXJpX2ZpbGUiLCBwYXRoPSJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIpCgogICAgICAgIEBkc2wucGlwZWxpbmUoKQogICAgICAgIGRlZiBzdWJfcGlwZWxpbmUoKToKICAgICAgICAgICAgbm9kZSA9IGNvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5wdXQpCiAgICAgICAgICAgIG5vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGggPSBPdXRwdXQobmFtZT0ic3ViX3BpcGVsaW5lX29fb3V0cHV0IiwgdmVyc2lvbj0idjEiKQogICAgICAgICAgICByZXR1cm4geyJzdWJfcGlwZWluZV9hX291dHB1dCI6IG5vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9CgogICAgICAgIEBkc2wucGlwZWxpbmUoKQogICAgICAgIGRlZiByZWdpc3Rlcl9ib3RoX291dHB1dCgpOgogICAgICAgICAgICAjIHJlZ2lzdGVyIE5vZGVPdXRwdXQgd2hpY2ggaXMgYmluZGluZyB0byBQaXBlbGluZU91dHB1dAogICAgICAgICAgICBub2RlID0gY29tcG9uZW50KGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbnB1dCkgICMgYmluZGluZyBhbmQgcmUtZGVmaW5lIG5hbWUgYW5kIHZlcnNpb24KICAgICAgICAgICAgbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCA9IE91dHB1dChuYW1lPSJuMV9vX291dHB1dCIsIHZlcnNpb249IjEiKQoKICAgICAgICAgICAgbm9kZV8yID0gY29tcG9uZW50KGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbnB1dCkgICMgYmluZGluZwogICAgICAgICAgICBub2RlXzIub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGggPSBPdXRwdXQobmFtZT0ibjJfb19vdXRwdXQiLCB2ZXJzaW9uPSIyIikKCiAgICAgICAgICAgIG5vZGVfMyA9IGNvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5wdXQpICAjIGlzbid0IGJpbmRpbmcKICAgICAgICAgICAgbm9kZV8zLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoID0gT3V0cHV0KG5hbWU9Im4zX29fb3V0cHV0IiwgdmVyc2lvbj0iNCIpCgogICAgICAgICAgICBzdWJfbm9kZSA9IHN1Yl9waXBlbGluZSgpICAjIHRlc3Qgc2V0IE91dHB1dCBmb3IgUGlwZWxpbmVDb21wb25lbnQKICAgICAgICAgICAgc3ViX25vZGUub3V0cHV0cy5zdWJfcGlwZWluZV9hX291dHB1dCA9IE91dHB1dChuYW1lPSJzdWJncmFwaF9vX291dHB1dCIsIHZlcnNpb249IjEiKQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInBpcGVpbmVfYV9vdXRwdXQiOiBub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLAogICAgICAgICAgICAgICAgInBpcGVpbmVfYl9vdXRwdXQiOiBub2RlXzIub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgsCiAgICAgICAgICAgIH0KCiAgICAgICAgcGlwZWxpbmUgPSByZWdpc3Rlcl9ib3RoX291dHB1dCgpCiAgICAgICAgcGlwZWxpbmUuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImNwdS1jbHVzdGVyIgogICAgICAgIHBpcGVsaW5lLm91dHB1dHMucGlwZWluZV9hX291dHB1dC5uYW1lID0gIm5wX291dHB1dCIKICAgICAgICBwaXBlbGluZS5vdXRwdXRzLnBpcGVpbmVfYV9vdXRwdXQudmVyc2lvbiA9ICIxIgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgICAgIGNoZWNrX25hbWVfYW5kX3ZlcnNpb24ocGlwZWxpbmVfam9iLm91dHB1dHMucGlwZWluZV9hX291dHB1dCwgIm5wX291dHB1dCIsICIxIikKICAgICAgICBjaGVja19uYW1lX2FuZF92ZXJzaW9uKHBpcGVsaW5lX2pvYi5vdXRwdXRzLnBpcGVpbmVfYl9vdXRwdXQsICJuMl9vX291dHB1dCIsICIyIikKICAgICAgICBjaGVja19uYW1lX2FuZF92ZXJzaW9uKHBpcGVsaW5lX2pvYi5qb2JzWyJub2RlXzMiXS5vdXRwdXRzWyJjb21wb25lbnRfb3V0X3BhdGgiXSwgIm4zX29fb3V0cHV0IiwgIjQiKQogICAgICAgIGNoZWNrX25hbWVfYW5kX3ZlcnNpb24ocGlwZWxpbmVfam9iLmpvYnNbInN1Yl9ub2RlIl0ub3V0cHV0c1sic3ViX3BpcGVpbmVfYV9vdXRwdXQiXSwgInN1YmdyYXBoX29fb3V0cHV0IiwgIjEiKQoKICAgIGRlZiB0ZXN0X3BpcGVsaW5lX2lucHV0X2JpbmRpbmdfbGltaXRzX3RpbWVvdXQoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgY29tcG9uZW50X3lhbWwgPSByIi4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnRfbm9fcGF0aHMueW1sIgogICAgICAgIGNvbXBvbmVudF9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPWNvbXBvbmVudF95YW1sKQoKICAgICAgICBAZHNsLnBpcGVsaW5lCiAgICAgICAgZGVmIG15X3BpcGVsaW5lKHRpbWVvdXQpIC0\u002BIFBpcGVsaW5lSm9iOgogICAgICAgICAgICAjIGNhc2UgMTogaWYgdGltZW91dCBpcyBQaXBlbGluZUlucHV0LCBnZXQgYmluZGluZyBmcm9tIHJlc3BvbnNlCiAgICAgICAgICAgIG5vZGVfMCA9IGNvbXBvbmVudF9mdW5jKGNvbXBvbmVudF9pbl9udW1iZXI9MSkKICAgICAgICAgICAgbm9kZV8wLnNldF9saW1pdHModGltZW91dD10aW1lb3V0KQogICAgICAgICAgICAjIGNhc2UgMjogaWYgdGltZW91dCBpcyBub3QgUGlwZWxpbmVJbnB1dCwgcmVzcG9uc2UgdGltZW91dCB3aWxsIGJlIHBhcnNlZCB0byBpbnQKICAgICAgICAgICAgbm9kZV8xID0gY29tcG9uZW50X2Z1bmMoY29tcG9uZW50X2luX251bWJlcj0xKQogICAgICAgICAgICBub2RlXzEuc2V0X2xpbWl0cyh0aW1lb3V0PTEpCgogICAgICAgIHBpcGVsaW5lID0gbXlfcGlwZWxpbmUoMikKICAgICAgICBwaXBlbGluZS5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCiAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKICAgICAgICBhc3NlcnQgcGlwZWxpbmVfam9iLmpvYnNbIm5vZGVfMCJdLmxpbWl0cy50aW1lb3V0ID09ICIke3twYXJlbnQuaW5wdXRzLnRpbWVvdXR9fSIKICAgICAgICBhc3NlcnQgcGlwZWxpbmVfam9iLmpvYnNbIm5vZGVfMSJdLmxpbWl0cy50aW1lb3V0ID09IDEKCiAgICBkZWYgdGVzdF9waXBlbGluZV9jb21wb25lbnRfcHJpbWl0aXZlX3R5cGVfY29uc3VtcHRpb24oc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgYmFpc2NfY29tcG9uZW50X2Z1bmMgPSBsb2FkX2NvbXBvbmVudCgKICAgICAgICAgICAgIi4vdGVzdHMvdGVzdF9jb25maWdzL2RzbF9waXBlbGluZS9wcmltaXRpdmVfdHlwZV9jb21wb25lbnRzL2Jhc2ljX2NvbXBvbmVudC55bWwiCiAgICAgICAgKQogICAgICAgIGJvb2xlYW5fZnVuYyA9IGxvYWRfY29tcG9uZW50KCIuL3Rlc3RzL3Rlc3RfY29uZmlncy9kc2xfcGlwZWxpbmUvcHJpbWl0aXZlX3R5cGVfY29tcG9uZW50cy9ib29sZWFuLnltbCIpCiAgICAgICAgaW50ZWdlcl9mdW5jID0gbG9hZF9jb21wb25lbnQoIi4vdGVzdHMvdGVzdF9jb25maWdzL2RzbF9waXBlbGluZS9wcmltaXRpdmVfdHlwZV9jb21wb25lbnRzL2ludGVnZXIueW1sIikKICAgICAgICBudW1iZXJfZnVuYyA9IGxvYWRfY29tcG9uZW50KCIuL3Rlc3RzL3Rlc3RfY29uZmlncy9kc2xfcGlwZWxpbmUvcHJpbWl0aXZlX3R5cGVfY29tcG9uZW50cy9udW1iZXIueW1sIikKICAgICAgICBzdHJpbmdfZnVuYyA9IGxvYWRfY29tcG9uZW50KCIuL3Rlc3RzL3Rlc3RfY29uZmlncy9kc2xfcGlwZWxpbmUvcHJpbWl0aXZlX3R5cGVfY29tcG9uZW50cy9zdHJpbmcueW1sIikKCiAgICAgICAgQGRzbC5waXBlbGluZQogICAgICAgIGRlZiBwaXBlbGluZV9jb21wb25lbnRfZnVuYyhib29sX3BhcmFtOiBib29sLCBpbnRfcGFyYW06IGludCwgZmxvYXRfcGFyYW06IGZsb2F0LCBzdHJfcGFyYW06IHN0cik6CiAgICAgICAgICAgIGJhaXNjX2NvbXBvbmVudF9mdW5jKAogICAgICAgICAgICAgICAgYm9vbF9wYXJhbT1ib29sX3BhcmFtLAogICAgICAgICAgICAgICAgaW50X3BhcmFtPWludF9wYXJhbSwKICAgICAgICAgICAgICAgIGZsb2F0X3BhcmFtPWZsb2F0X3BhcmFtLAogICAgICAgICAgICAgICAgc3RyX3BhcmFtPXN0cl9wYXJhbSwKICAgICAgICAgICAgKQoKICAgICAgICBAZHNsLnBpcGVsaW5lCiAgICAgICAgZGVmIHBpcGVsaW5lX2Z1bmMoKToKICAgICAgICAgICAgIyBjb21wb25lbnRzIHJldHVybiBwcmltaXRpdmUgdHlwZSBvdXRwdXRzCiAgICAgICAgICAgIGJvb2xfbm9kZSA9IGJvb2xlYW5fZnVuYygpCiAgICAgICAgICAgIGludF9ub2RlID0gaW50ZWdlcl9mdW5jKCkKICAgICAgICAgICAgZmxvYXRfbm9kZSA9IG51bWJlcl9mdW5jKCkKICAgICAgICAgICAgc3RyX25vZGUgPSBzdHJpbmdfZnVuYygpCiAgICAgICAgICAgICMgcGlwZWxpbmUgY29tcG9uZW50IGNvbnN1bWUgYWJvdmUgcHJpbWl0aXZlIHR5cGUgb3V0cHV0cwogICAgICAgICAgICBwaXBlbGluZV9ub2RlID0gcGlwZWxpbmVfY29tcG9uZW50X2Z1bmMoICAjIG5vcWE6IEY4NDEKICAgICAgICAgICAgICAgIGJvb2xfcGFyYW09Ym9vbF9ub2RlLm91dHB1dHMub3V0cHV0LAogICAgICAgICAgICAgICAgaW50X3BhcmFtPWludF9ub2RlLm91dHB1dHMub3V0cHV0LAogICAgICAgICAgICAgICAgZmxvYXRfcGFyYW09ZmxvYXRfbm9kZS5vdXRwdXRzLm91dHB1dCwKICAgICAgICAgICAgICAgIHN0cl9wYXJhbT1zdHJfbm9kZS5vdXRwdXRzLm91dHB1dCwKICAgICAgICAgICAgKQoKICAgICAgICBwaXBlbGluZV9qb2IgPSBwaXBlbGluZV9mdW5jKCkKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImNwdS1jbHVzdGVyIgoKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZV9qb2IsIGNsaWVudCkKCiAgICBkZWYgdGVzdF9waXBlbGluZV92YXJpYWJsZV9uYW1lX3VwcGVyY2FzZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBjb21wb25lbnRfeWFtbCA9ICIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50LnltbCIKICAgICAgICBjb21wb25lbnRfZnVuYyA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICBzb3VyY2U9Y29tcG9uZW50X3lhbWwsCiAgICAgICAgKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKG5hbWU9InBpcGVsaW5lX3dpdGhfdXBwZXJjYXNlX25vZGVfbmFtZXMiKQogICAgICAgIGRlZiBwaXBlbGluZV93aXRoX3VzZXJfZGVmaW5lZF9ub2Rlc18xKCk6CiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDIpOgogICAgICAgICAgICAgICAgbm9kZTEgPSBjb21wb25lbnRfZnVuYyhjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5wdXQpCiAgICAgICAgICAgICAgICAjIGNoYW5nZSBub2RlIG5hbWUgdG8gbG93ZXIgd2hlbiBzZXR0aW5nIGl0IHRvIGF2b2lkIHVwcGVyIGNhc2UgaW4gbnh0X2lucHV0J3MgYmluZGluZwogICAgICAgICAgICAgICAgbm9kZTEubmFtZSA9IGYiRHVtbXlfe2l9IgogICAgICAgICAgICAgICAgbnh0X2lucHV0ID0gSW5wdXQoCiAgICAgICAgICAgICAgICAgICAgcGF0aD1ub2RlMS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwKICAgICAgICAgICAgICAgICAgICBtb2RlPUlucHV0T3V0cHV0TW9kZXMuRElSRUNULAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgbm9kZTIgPSBjb21wb25lbnRfZnVuYyhjb21wb25lbnRfaW5fcGF0aD1ueHRfaW5wdXQpCiAgICAgICAgICAgICAgICBub2RlMi5uYW1lID0gZiJBbm90aGVyX3tpfSIKCiAgICAgICAgcGlwZWxpbmVfam9iID0gcGlwZWxpbmVfd2l0aF91c2VyX2RlZmluZWRfbm9kZXNfMSgpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKICAgICAgICBwaXBlbGluZV9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZV9qb2IsIGNsaWVudCkKICAgICAgICBhY3R1YWxfam9iID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5wcm9wZXJ0aWVzLmFzX2RpY3QoKSwgKmNvbW1vbl9vbWl0X2ZpZWxkcykKICAgICAgICBhc3NlcnQgYWN0dWFsX2pvYlsiam9icyJdID09IHsKICAgICAgICAgICAgImFub3RoZXJfMCI6IHsKICAgICAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9pbl9wYXRoIjogewogICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJtb2RlIjogIkRpcmVjdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuam9icy5kdW1teV8wLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRofX0iLAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibmFtZSI6ICJhbm90aGVyXzAiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJhbm90aGVyXzEiOiB7CiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAibW9kZSI6ICJEaXJlY3QiLAogICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmpvYnMuZHVtbXlfMS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH19IiwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm5hbWUiOiAiYW5vdGhlcl8xIiwKICAgICAgICAgICAgICAgICJ0eXBlIjogImNvbW1hbmQiLAogICAgICAgICAgICB9LAogICAgICAgICAgICAiZHVtbXlfMCI6IHsKICAgICAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9pbl9wYXRoIjogewogICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAidXJpX2ZpbGUiLAogICAgICAgICAgICAgICAgICAgICAgICAidXJpIjogImh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IiwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm5hbWUiOiAiZHVtbXlfMCIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImR1bW15XzEiOiB7CiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogInVyaV9maWxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgInVyaSI6ICJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJuYW1lIjogImR1bW15XzEiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgfQoKICAgIGRlZiB0ZXN0X3BpcGVsaW5lX3Npbmd1bGFyaXR5X3N0cm9uZ190eXBlX3N1Ym1pc3Npb24oc2VsZiwgY2xpZW50OiBNTENsaWVudCwgbW9ja19zaW5ndWxhcml0eV9hcm1faWQ6IHN0cik6CiAgICAgICAgY29tcG9uZW50X3lhbWwgPSAiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudF9zaW5ndWxhcml0eS55bWwiCiAgICAgICAgY29tcG9uZW50X2Z1bmMgPSBsb2FkX2NvbXBvbmVudChjb21wb25lbnRfeWFtbCkKCiAgICAgICAgaW5zdGFuY2VfdHlwZSA9ICJTaW5ndWxhcml0eS5ORDQwcnNfdjIiCgogICAgICAgIEBkc2wucGlwZWxpbmUKICAgICAgICBkZWYgcGlwZWxpbmVfZnVuYygpOgogICAgICAgICAgICAjIGJhc2ljIGpvYl90aWVyICsgTG93IHByaW9yaXR5CiAgICAgICAgICAgIGJhc2ljX2xvd19ub2RlID0gY29tcG9uZW50X2Z1bmMoKQogICAgICAgICAgICBiYXNpY19sb3dfbm9kZS5yZXNvdXJjZXMgPSBKb2JSZXNvdXJjZUNvbmZpZ3VyYXRpb24oaW5zdGFuY2VfY291bnQ9MiwgaW5zdGFuY2VfdHlwZT1pbnN0YW5jZV90eXBlKQogICAgICAgICAgICBiYXNpY19sb3dfbm9kZS5xdWV1ZV9zZXR0aW5ncyA9IFF1ZXVlU2V0dGluZ3Moam9iX3RpZXI9ImJhc2ljIiwgcHJpb3JpdHk9ImxvdyIpCiAgICAgICAgICAgICMgc3RhbmRhcmQgam9iX3RpZXIgKyBNZWRpdW0gcHJpb3JpdHkKICAgICAgICAgICAgc3RhbmRhcmRfbWVkaXVtX25vZGUgPSBjb21wb25lbnRfZnVuYygpCiAgICAgICAgICAgIHN0YW5kYXJkX21lZGl1bV9ub2RlLnJlc291cmNlcyA9IEpvYlJlc291cmNlQ29uZmlndXJhdGlvbihpbnN0YW5jZV9jb3VudD0yLCBpbnN0YW5jZV90eXBlPWluc3RhbmNlX3R5cGUpCiAgICAgICAgICAgIHN0YW5kYXJkX21lZGl1bV9ub2RlLnF1ZXVlX3NldHRpbmdzID0gUXVldWVTZXR0aW5ncyhqb2JfdGllcj0ic3RhbmRhcmQiLCBwcmlvcml0eT0ibWVkaXVtIikKICAgICAgICAgICAgIyBwcmVtaXVtIGpvYl90aWVyICsgSGlnaCBwcmlvcml0eQogICAgICAgICAgICBwcmVtaXVtX2hpZ2hfbm9kZSA9IGNvbXBvbmVudF9mdW5jKCkKICAgICAgICAgICAgcHJlbWl1bV9oaWdoX25vZGUucmVzb3VyY2VzID0gSm9iUmVzb3VyY2VDb25maWd1cmF0aW9uKGluc3RhbmNlX2NvdW50PTIsIGluc3RhbmNlX3R5cGU9aW5zdGFuY2VfdHlwZSkKICAgICAgICAgICAgcHJlbWl1bV9oaWdoX25vZGUucXVldWVfc2V0dGluZ3MgPSBRdWV1ZVNldHRpbmdzKGpvYl90aWVyPSJwcmVtaXVtIiwgcHJpb3JpdHk9ImhpZ2giKQogICAgICAgICAgICAjIHByb3BlcnRpZXMKICAgICAgICAgICAgbm9kZV93aXRoX3Byb3BlcnRpZXMgPSBjb21wb25lbnRfZnVuYygpCiAgICAgICAgICAgIHByb3BlcnRpZXMgPSB7IlNpbmd1bGFyaXR5IjogeyJpbWFnZVZlcnNpb24iOiAiIiwgImludGVyYWN0aXZlIjogRmFsc2V9fQogICAgICAgICAgICBub2RlX3dpdGhfcHJvcGVydGllcy5yZXNvdXJjZXMgPSBKb2JSZXNvdXJjZUNvbmZpZ3VyYXRpb24oCiAgICAgICAgICAgICAgICBpbnN0YW5jZV9jb3VudD0yLCBpbnN0YW5jZV90eXBlPWluc3RhbmNlX3R5cGUsIHByb3BlcnRpZXM9cHJvcGVydGllcwogICAgICAgICAgICApCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBpcGVsaW5lX2Z1bmMoKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSBtb2NrX3Npbmd1bGFyaXR5X2FybV9pZAogICAgICAgICMgdGhpcyBwaXBlbGluZSBqb2IgaXMgZXhwZWN0ZWQgdG8gZmFpbCBhcyBTaW5ndWxhcml0eSBpcyBtb2NrZWQsIGZvY3VzIG9uIFJFU1Qgb2JqZWN0IGFzc2VydGlvbgogICAgICAgIGNyZWF0ZWRfcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCiAgICAgICAgcmVzdF9vYmogPSBjcmVhdGVkX3BpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKQogICAgICAgIGFzc2VydCByZXN0X29iai5wcm9wZXJ0aWVzLnNldHRpbmdzWyJkZWZhdWx0X2NvbXB1dGUiXSA9PSBtb2NrX3Npbmd1bGFyaXR5X2FybV9pZAogICAgICAgICMgYmFzaWMgam9iX3RpZXIgKyBMb3cgcHJpb3JpdHkKICAgICAgICBiYXNpY19sb3dfbm9kZV9kaWN0ID0gcmVzdF9vYmoucHJvcGVydGllcy5qb2JzWyJiYXNpY19sb3dfbm9kZSJdCiAgICAgICAgYXNzZXJ0IGJhc2ljX2xvd19ub2RlX2RpY3RbInF1ZXVlX3NldHRpbmdzIl0gPT0geyJqb2JfdGllciI6ICJCYXNpYyIsICJwcmlvcml0eSI6IDF9CiAgICAgICAgYXNzZXJ0IGJhc2ljX2xvd19ub2RlX2RpY3RbInJlc291cmNlcyJdID09IHsiaW5zdGFuY2VfY291bnQiOiAyLCAiaW5zdGFuY2VfdHlwZSI6IGluc3RhbmNlX3R5cGV9CiAgICAgICAgIyBzdGFuZGFyZCBqb2JfdGllciArIE1lZGl1bSBwcmlvcml0eQogICAgICAgIHN0YW5kYXJkX21lZGl1bV9ub2RlX2RpY3QgPSByZXN0X29iai5wcm9wZXJ0aWVzLmpvYnNbInN0YW5kYXJkX21lZGl1bV9ub2RlIl0KICAgICAgICBhc3NlcnQgc3RhbmRhcmRfbWVkaXVtX25vZGVfZGljdFsicXVldWVfc2V0dGluZ3MiXSA9PSB7ImpvYl90aWVyIjogIlN0YW5kYXJkIiwgInByaW9yaXR5IjogMn0KICAgICAgICBhc3NlcnQgc3RhbmRhcmRfbWVkaXVtX25vZGVfZGljdFsicmVzb3VyY2VzIl0gPT0geyJpbnN0YW5jZV9jb3VudCI6IDIsICJpbnN0YW5jZV90eXBlIjogaW5zdGFuY2VfdHlwZX0KICAgICAgICAjIHByZW1pdW0gam9iX3RpZXIgKyBIaWdoIHByaW9yaXR5CiAgICAgICAgcHJlbWl1bV9oaWdoX25vZGVfZGljdCA9IHJlc3Rfb2JqLnByb3BlcnRpZXMuam9ic1sicHJlbWl1bV9oaWdoX25vZGUiXQogICAgICAgIGFzc2VydCBwcmVtaXVtX2hpZ2hfbm9kZV9kaWN0WyJxdWV1ZV9zZXR0aW5ncyJdID09IHsiam9iX3RpZXIiOiAiUHJlbWl1bSIsICJwcmlvcml0eSI6IDN9CiAgICAgICAgYXNzZXJ0IHByZW1pdW1faGlnaF9ub2RlX2RpY3RbInJlc291cmNlcyJdID09IHsiaW5zdGFuY2VfY291bnQiOiAyLCAiaW5zdGFuY2VfdHlwZSI6IGluc3RhbmNlX3R5cGV9CiAgICAgICAgIyBwcm9wZXJ0aWVzCiAgICAgICAgbm9kZV93aXRoX3Byb3BlcnRpZXNfZGljdCA9IHJlc3Rfb2JqLnByb3BlcnRpZXMuam9ic1sibm9kZV93aXRoX3Byb3BlcnRpZXMiXQogICAgICAgIGFzc2VydCBub2RlX3dpdGhfcHJvcGVydGllc19kaWN0WyJyZXNvdXJjZXMiXSA9PSB7CiAgICAgICAgICAgICJpbnN0YW5jZV9jb3VudCI6IDIsCiAgICAgICAgICAgICJpbnN0YW5jZV90eXBlIjogaW5zdGFuY2VfdHlwZSwKICAgICAgICAgICAgIyB0aGUgbWFwcGluZyBTaW5ndWxhcml0eSA9PiBBSVN1cGVyQ29tcHV0ZXIgaXMgZXhwZWN0ZWQKICAgICAgICAgICAgInByb3BlcnRpZXMiOiB7IkFJU3VwZXJDb21wdXRlciI6IHsiaW1hZ2VWZXJzaW9uIjogIiIsICJpbnRlcmFjdGl2ZSI6IEZhbHNlfX0sCiAgICAgICAgfQoKICAgIGRlZiB0ZXN0X3BpcGVsaW5lX3Npbmd1bGFyaXR5X3Byb3BlcnR5X2JhZ19zdWJtaXNzaW9uKHNlbGYsIGNsaWVudDogTUxDbGllbnQsIG1vY2tfc2luZ3VsYXJpdHlfYXJtX2lkOiBzdHIpOgogICAgICAgIGNvbXBvbmVudF95YW1sID0gIi4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnRfc2luZ3VsYXJpdHkueW1sIgogICAgICAgIGNvbXBvbmVudF9mdW5jID0gbG9hZF9jb21wb25lbnQoY29tcG9uZW50X3lhbWwpCgogICAgICAgICMgcHJvcGVydHkgYmFnIGlzIHN1cHBvcnRlZCwgd2l0aCBsb3dlciBwcmlvcml0eSB0aGFuIHN0cm9uZyB0eXBlCiAgICAgICAgdmNfY29uZmlnID0gewogICAgICAgICAgICAiaW5zdGFuY2VfdHlwZSI6ICJTaW5ndWxhcml0eS5ORDQwcnNfdjIiLAogICAgICAgICAgICAiaW5zdGFuY2VfY291bnQiOiAyLAogICAgICAgICAgICAicHJvcGVydGllcyI6IHsKICAgICAgICAgICAgICAgICJBSVN1cGVyQ29tcHV0ZXIiOiB7CiAgICAgICAgICAgICAgICAgICAgImludGVyYWN0aXZlIjogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgImltYWdlVmVyc2lvbiI6ICJweXRvcmNoIiwKICAgICAgICAgICAgICAgICAgICAic2xhVGllciI6ICJQcmVtaXVtIiwKICAgICAgICAgICAgICAgICAgICAidGVuc29yYm9hcmRMb2dEaXJlY3RvcnkiOiAiL3NjcmF0Y2gvdGVuc29yYm9hcmRfbG9ncyIsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgfQoKICAgICAgICBAZHNsLnBpcGVsaW5lCiAgICAgICAgZGVmIHBpcGVsaW5lX2Z1bmMoKToKICAgICAgICAgICAgbm9kZSA9IGNvbXBvbmVudF9mdW5jKCkKICAgICAgICAgICAgbm9kZS5yZXNvdXJjZXMgPSB2Y19jb25maWcKICAgICAgICAgICAgbm9kZS5jb21wdXRlID0gbW9ja19zaW5ndWxhcml0eV9hcm1faWQKCiAgICAgICAgcGlwZWxpbmVfam9iID0gcGlwZWxpbmVfZnVuYygpCiAgICAgICAgIyBhcyBTaW5ndWxhcml0eSBpcyBtb2NrZWQgYW5kIGV4cGVjdGVkIHRvIGZhaWwgdmFsaWRhdGlvbiwgc2tpcCBpdCBmb3Igc3VibWlzc2lvbjsKICAgICAgICAjIHRoZW4gbWFudWFsbHkgY2FuY2VsIGl0IGFzIG90aGVyIHRlc3RzLgogICAgICAgIGNyZWF0ZWRfcGlwZWxpbmVfam9iID0gY2xpZW50LmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmVfam9iLCBza2lwX3ZhbGlkYXRpb249VHJ1ZSkKICAgICAgICBjbGllbnQuam9icy5iZWdpbl9jYW5jZWwoY3JlYXRlZF9waXBlbGluZV9qb2IubmFtZSkucmVzdWx0KCkKICAgICAgICByZXN0X29iaiA9IGNyZWF0ZWRfcGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpCiAgICAgICAgYXNzZXJ0IHJlc3Rfb2JqLnByb3BlcnRpZXMuam9ic1sibm9kZSJdWyJjb21wdXRlSWQiXSA9PSBtb2NrX3Npbmd1bGFyaXR5X2FybV9pZAogICAgICAgIGFzc2VydCByZXN0X29iai5wcm9wZXJ0aWVzLmpvYnNbIm5vZGUiXVsicmVzb3VyY2VzIl0gPT0gdmNfY29uZmlnCgogICAgQHB5dGVzdC5tYXJrLnNraXBpZihjb25kaXRpb249bm90IGlzX2xpdmUoKSwgcmVhc29uPSJyZWNvcmRpbmcgd2lsbCBleHBvc2UgU2luZ3VsYXJpdHkgaW5mb3JtYXRpb24iKQogICAgZGVmIHRlc3RfcGlwZWxpbmVfc2luZ3VsYXJpdHlfbGl2ZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50LCBzaW5ndWxhcml0eV92Yyk6CiAgICAgICAgIyBmdWxsIG5hbWUgYW5kIHNob3J0IG5hbWUgYXJlIHN5bnRheCBzdWdhciwgU0RLIHdpbGwgcmVzb2x2ZSBpdCB0byBTaW5ndWxhcml0eSBBUk0gaWQgYmVmb3JlIHJlcXVlc3QsCiAgICAgICAgIyB0aGlzIG5lZWRzIGNsaWVudCB0byBnZXQgJiBzZWFyY2ggYXZhaWxhYmxlIFZDcyAtIHRoYXQncyB3aHkgd2UgcGxhY2UgdGhpcyB0ZXN0IGluIGVuZC10by1lbmQgdGVzdCAtCiAgICAgICAgIyBhbmQgY29tcHV0ZSB2YWx1ZXMgaW4gcmV0dXJuZWQgUkVTVCBvYmplY3Qgc2hvdWxkIGFsbCBiZSBBUk0gaWQuCiAgICAgICAgY29tcG9uZW50X3lhbWwgPSAiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudF9zaW5ndWxhcml0eS55bWwiCiAgICAgICAgY29tcG9uZW50X2Z1bmMgPSBsb2FkX2NvbXBvbmVudChjb21wb25lbnRfeWFtbCkKCiAgICAgICAgIyBnZW5lcmF0ZSBTaW5ndWxhcml0eSBBUk0gaWQsIGZ1bGwgbmFtZSBhbmQgc2hvcnQgbmFtZSBmcm9tIFZDCiAgICAgICAgYXJtX2lkID0gU0lOR1VMQVJJVFlfSURfRk9STUFULmZvcm1hdCgKICAgICAgICAgICAgc2luZ3VsYXJpdHlfdmMuc3Vic2NyaXB0aW9uX2lkLCBzaW5ndWxhcml0eV92Yy5yZXNvdXJjZV9ncm91cF9uYW1lLCBzaW5ndWxhcml0eV92Yy5uYW1lCiAgICAgICAgKQogICAgICAgIGZ1bGxfbmFtZSA9ICJhenVyZW1sOi8vc3Vic2NyaXB0aW9ucy97fS9yZXNvdXJjZUdyb3Vwcy97fS92aXJ0dWFsY2x1c3RlcnMve30iLmZvcm1hdCgKICAgICAgICAgICAgc2luZ3VsYXJpdHlfdmMuc3Vic2NyaXB0aW9uX2lkLCBzaW5ndWxhcml0eV92Yy5yZXNvdXJjZV9ncm91cF9uYW1lLCBzaW5ndWxhcml0eV92Yy5uYW1lCiAgICAgICAgKQogICAgICAgIHNob3J0X25hbWUgPSBmImF6dXJlbWw6Ly92aXJ0dWFsY2x1c3RlcnMve3Npbmd1bGFyaXR5X3ZjLm5hbWV9IgoKICAgICAgICBAZHNsLnBpcGVsaW5lCiAgICAgICAgZGVmIHBpcGVsaW5lX2Z1bmMoKToKICAgICAgICAgICAgbm9kZV93aXRoX2lkID0gY29tcG9uZW50X2Z1bmMoKQogICAgICAgICAgICBub2RlX3dpdGhfaWQuY29tcHV0ZSA9IGFybV9pZAogICAgICAgICAgICBub2RlX3dpdGhfZnVsbF9uYW1lID0gY29tcG9uZW50X2Z1bmMoKQogICAgICAgICAgICBub2RlX3dpdGhfZnVsbF9uYW1lLmNvbXB1dGUgPSBmdWxsX25hbWUKICAgICAgICAgICAgbm9kZV93aXRoX3Nob3J0X25hbWUgPSBjb21wb25lbnRfZnVuYygpCiAgICAgICAgICAgIG5vZGVfd2l0aF9zaG9ydF9uYW1lLmNvbXB1dGUgPSBzaG9ydF9uYW1lCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBpcGVsaW5lX2Z1bmMoKQogICAgICAgIGNyZWF0ZWRfcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCiAgICAgICAgcmVzdF9vYmogPSBjcmVhdGVkX3BpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKQoKICAgICAgICBmb3Igbm9kZV9uYW1lIGluIFsibm9kZV93aXRoX2lkIiwgIm5vZGVfd2l0aF9mdWxsX25hbWUiLCAibm9kZV93aXRoX3Nob3J0X25hbWUiXToKICAgICAgICAgICAgbm9kZV9jb21wdXRlID0gcmVzdF9vYmoucHJvcGVydGllcy5qb2JzW25vZGVfbmFtZV1bImNvbXB1dGVJZCJdCiAgICAgICAgICAgIGFzc2VydCBpc19zaW5ndWxhcml0eV9pZF9mb3JfcmVzb3VyY2Uobm9kZV9jb21wdXRlKQogICAgICAgICAgICBhc3NlcnQgbm9kZV9jb21wdXRlLmVuZHN3aXRoKHNpbmd1bGFyaXR5X3ZjLm5hbWUpCg==",
      "StatusCode": 201,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Content-MD5": "I4y4Qh7esHSfKFgWjfBTwA==",
        "Date": "Mon, 24 Apr 2023 03:22:27 GMT",
        "ETag": "\u00220x8DB447321BBFF42\u0022",
        "Last-Modified": "Mon, 24 Apr 2023 03:22:28 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-content-crc64": "HBVdcxlkiWE=",
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://samcw32zcnpjldw.blob.core.windows.net/azureml-blobstore-72e8eff8-148b-4582-a07d-efc79559f19f/LocalUpload/00000000000000000000000000000000/e2etests/__init__.py?comp=metadata",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "0",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)",
        "x-ms-date": "Mon, 24 Apr 2023 03:22:26 GMT",
        "x-ms-meta-name": "fe1b43db-ac61-4d47-8853-9899a880a7d5",
        "x-ms-meta-upload_status": "completed",
        "x-ms-meta-version": "35d467be-ec7d-4a69-ac90-0e6abb08cb30",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": null,
      "StatusCode": 200,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Date": "Mon, 24 Apr 2023 03:22:27 GMT",
        "ETag": "\u00220x8DB447321C59AD3\u0022",
        "Last-Modified": "Mon, 24 Apr 2023 03:22:28 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/jobs/000000000000000000000?api-version=2023-04-01-preview",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "2957",
        "Content-Type": "application/json",
        "User-Agent": "azure-ai-ml/1.6.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)"
      },
      "RequestBody": {
        "properties": {
          "properties": {},
          "tags": {},
          "displayName": "pipeline_with_do_while",
          "experimentName": "azure-ai-ml",
          "isArchived": false,
          "jobType": "Pipeline",
          "inputs": {
            "component_in_number": {
              "jobInputType": "literal",
              "value": "2"
            },
            "component_in_path": {
              "uri": "azureml://datastores/workspaceblobstore/paths/LocalUpload/00000000000000000000000000000000/e2etests/",
              "jobInputType": "uri_folder"
            }
          },
          "jobs": {
            "do_while_body_pipeline": {
              "name": "do_while_body_pipeline",
              "type": "pipeline",
              "inputs": {
                "component_in_number": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_number}}"
                },
                "component_in_path": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_path}}"
                }
              },
              "_source": "DSL",
              "componentId": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/6840d832-11ef-4d1a-97b1-5f55acfaf9e7"
            },
            "do_while_with_pipeline": {
              "body": "${{parent.jobs.do_while_body_pipeline}}",
              "type": "do_while",
              "condition": "is_number_larger_than_zero",
              "mapping": {
                "${{parent.jobs.do_while_body_pipeline.outputs.output_in_path}}": [
                  "component_in_path"
                ]
              },
              "limits": {
                "max_iteration_count": 5
              },
              "_source": "DSL"
            },
            "command_component": {
              "name": "command_component",
              "type": "command",
              "inputs": {
                "component_in_number": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_number}}"
                },
                "component_in_path": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_path}}"
                }
              },
              "_source": "YAML.COMPONENT",
              "componentId": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/cf16a3af-2aa5-4dfc-955d-350566f92393"
            },
            "do_while_with_command_component": {
              "body": "${{parent.jobs.command_component}}",
              "type": "do_while",
              "condition": "is_number_larger_than_zero",
              "mapping": {
                "output_in_number": [
                  "component_in_number"
                ],
                "${{parent.jobs.command_component.outputs.output_in_path}}": [
                  "component_in_path"
                ]
              },
              "limits": {
                "max_iteration_count": 5
              },
              "_source": "DSL"
            },
            "basic_component": {
              "name": "basic_component",
              "type": "pipeline",
              "inputs": {
                "component_in_path": {
                  "job_input_type": "literal",
                  "value": "${{parent.jobs.command_component.outputs.output_in_path}}"
                }
              },
              "outputs": {
                "output_in_path": {
                  "value": "${{parent.outputs.output_in_path}}",
                  "type": "literal"
                }
              },
              "_source": "DSL",
              "componentId": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/6840d832-11ef-4d1a-97b1-5f55acfaf9e7"
            }
          },
          "outputs": {
            "output_in_path": {
              "jobOutputType": "uri_folder"
            }
          },
          "settings": {
            "default_compute": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/computes/cpu-cluster",
            "_source": "DSL"
          }
        }
      },
      "StatusCode": 201,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "4135",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Mon, 24 Apr 2023 03:22:35 GMT",
        "Expires": "-1",
        "Location": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/jobs/000000000000000000000?api-version=2023-04-01-preview",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-5dc49d82ec0781b15ccf2c9d3f97e065-48777249f884603e-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "3bb19bec-9e46-4a63-99d0-9bfd2d201200",
        "x-ms-ratelimit-remaining-subscription-writes": "1192",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "CANADACENTRAL:20230424T032235Z:3bb19bec-9e46-4a63-99d0-9bfd2d201200",
        "x-request-time": "0.371"
      },
      "ResponseBody": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/jobs/000000000000000000000",
        "name": "000000000000000000000",
        "type": "Microsoft.MachineLearningServices/workspaces/jobs",
        "properties": {
          "description": null,
          "tags": {},
          "properties": {},
          "displayName": "pipeline_with_do_while",
          "status": "NotStarted",
          "experimentName": "azure-ai-ml",
          "services": {
            "Tracking": {
              "jobServiceType": "Tracking",
              "port": null,
              "endpoint": "azureml://eastus.api.azureml.ms/mlflow/v1.0/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000?",
              "status": null,
              "errorMessage": null,
              "properties": null,
              "nodes": null
            },
            "Studio": {
              "jobServiceType": "Studio",
              "port": null,
              "endpoint": "https://ml.azure.com/runs/000000000000000000000?wsid=/subscriptions/00000000-0000-0000-0000-000000000/resourcegroups/00000/workspaces/00000",
              "status": null,
              "errorMessage": null,
              "properties": null,
              "nodes": null
            }
          },
          "computeId": null,
          "isArchived": false,
          "identity": null,
          "componentId": null,
          "notificationSetting": null,
          "secretsConfiguration": null,
          "jobType": "Pipeline",
          "settings": {
            "default_compute": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/computes/cpu-cluster",
            "_source": "DSL"
          },
          "jobs": {
            "do_while_body_pipeline": {
              "name": "do_while_body_pipeline",
              "type": "pipeline",
              "inputs": {
                "component_in_number": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_number}}"
                },
                "component_in_path": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_path}}"
                }
              },
              "_source": "DSL",
              "componentId": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/6840d832-11ef-4d1a-97b1-5f55acfaf9e7"
            },
            "do_while_with_pipeline": {
              "body": "${{parent.jobs.do_while_body_pipeline}}",
              "type": "do_while",
              "condition": "is_number_larger_than_zero",
              "mapping": {
                "${{parent.jobs.do_while_body_pipeline.outputs.output_in_path}}": [
                  "component_in_path"
                ]
              },
              "limits": {
                "max_iteration_count": 5
              },
              "_source": "DSL"
            },
            "command_component": {
              "name": "command_component",
              "type": "command",
              "inputs": {
                "component_in_number": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_number}}"
                },
                "component_in_path": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_path}}"
                }
              },
              "_source": "YAML.COMPONENT",
              "componentId": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/cf16a3af-2aa5-4dfc-955d-350566f92393"
            },
            "do_while_with_command_component": {
              "body": "${{parent.jobs.command_component}}",
              "type": "do_while",
              "condition": "is_number_larger_than_zero",
              "mapping": {
                "output_in_number": [
                  "component_in_number"
                ],
                "${{parent.jobs.command_component.outputs.output_in_path}}": [
                  "component_in_path"
                ]
              },
              "limits": {
                "max_iteration_count": 5
              },
              "_source": "DSL"
            },
            "basic_component": {
              "name": "basic_component",
              "type": "pipeline",
              "inputs": {
                "component_in_path": {
                  "job_input_type": "literal",
                  "value": "${{parent.jobs.command_component.outputs.output_in_path}}"
                }
              },
              "outputs": {
                "output_in_path": {
                  "value": "${{parent.outputs.output_in_path}}",
                  "type": "literal"
                }
              },
              "_source": "DSL",
              "componentId": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/6840d832-11ef-4d1a-97b1-5f55acfaf9e7"
            }
          },
          "inputs": {
            "component_in_number": {
              "description": null,
              "jobInputType": "literal",
              "value": "2"
            },
            "component_in_path": {
              "description": null,
              "uri": "azureml://datastores/workspaceblobstore/paths/LocalUpload/00000000000000000000000000000000/e2etests/",
              "mode": "ReadOnlyMount",
              "jobInputType": "uri_folder"
            }
          },
          "outputs": {
            "output_in_path": {
              "description": null,
              "uri": null,
              "assetName": null,
              "assetVersion": null,
              "mode": "ReadWriteMount",
              "autoDeleteSetting": null,
              "jobOutputType": "uri_folder"
            }
          },
          "sourceJobId": null
        },
        "systemData": {
          "createdAt": "2023-04-24T03:22:35.7033346\u002B00:00",
          "createdBy": "Firstname Lastname",
          "createdByType": "User"
        }
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/jobs/000000000000000000000/cancel?api-version=2023-04-01-preview",
      "RequestMethod": "POST",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "0",
        "User-Agent": "azure-ai-ml/1.6.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)"
      },
      "RequestBody": null,
      "StatusCode": 202,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "4",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Mon, 24 Apr 2023 03:22:43 GMT",
        "Expires": "-1",
        "Location": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/providers/Microsoft.MachineLearningServices/locations/eastus/mfeOperationResults/jc:72e8eff8-148b-4582-a07d-efc79559f19f:000000000000000000000?api-version=2023-04-01-preview",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-async-operation-timeout": "PT1H",
        "x-ms-correlation-request-id": "05bb94c5-7099-44f3-8267-a95d835ae064",
        "x-ms-ratelimit-remaining-subscription-writes": "1197",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "CANADACENTRAL:20230424T032244Z:05bb94c5-7099-44f3-8267-a95d835ae064",
        "x-request-time": "0.597"
      },
      "ResponseBody": "null"
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/providers/Microsoft.MachineLearningServices/locations/eastus/mfeOperationResults/jc:72e8eff8-148b-4582-a07d-efc79559f19f:000000000000000000000?api-version=2023-04-01-preview",
      "RequestMethod": "GET",
      "RequestHeaders": {
        "Accept": "*/*",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "User-Agent": "azure-ai-ml/1.6.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)"
      },
      "RequestBody": null,
      "StatusCode": 202,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "2",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Mon, 24 Apr 2023 03:22:44 GMT",
        "Expires": "-1",
        "Location": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/providers/Microsoft.MachineLearningServices/locations/eastus/mfeOperationResults/jc:72e8eff8-148b-4582-a07d-efc79559f19f:000000000000000000000?api-version=2023-04-01-preview",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "97d09528-4dc7-4c78-a0a4-c677ccef3bec",
        "x-ms-ratelimit-remaining-subscription-reads": "11995",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "CANADACENTRAL:20230424T032244Z:97d09528-4dc7-4c78-a0a4-c677ccef3bec",
        "x-request-time": "0.055"
      },
      "ResponseBody": {}
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/providers/Microsoft.MachineLearningServices/locations/eastus/mfeOperationResults/jc:72e8eff8-148b-4582-a07d-efc79559f19f:000000000000000000000?api-version=2023-04-01-preview",
      "RequestMethod": "GET",
      "RequestHeaders": {
        "Accept": "*/*",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "User-Agent": "azure-ai-ml/1.6.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.7.13 (Linux-5.15.90.1-microsoft-standard-WSL2-x86_64-with-debian-bookworm-sid)"
      },
      "RequestBody": null,
      "StatusCode": 200,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "0",
        "Date": "Mon, 24 Apr 2023 03:23:13 GMT",
        "Expires": "-1",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-c978e74b2adf6a053bd3e69dbad60f1a-8ac5590cfacd3c49-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "ecc022be-0230-4539-87ec-045f9845cdf1",
        "x-ms-ratelimit-remaining-subscription-reads": "11994",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "CANADACENTRAL:20230424T032314Z:ecc022be-0230-4539-87ec-045f9845cdf1",
        "x-request-time": "0.042"
      },
      "ResponseBody": null
    }
  ],
  "Variables": {}
}
