{
  "Entries": [
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94?api-version=2023-04-01-preview",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "379",
        "Content-Type": "application/json",
        "User-Agent": "azure-ai-ml/1.8.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)"
      },
      "RequestBody": {
        "properties": {
          "isAnonymous": true,
          "isArchived": false,
          "condaFile": "channels:\n- defaults\ndependencies:\n- python=3.8.12\n- pip=21.2.2\n- pip:\n  - --extra-index-url=https://azuremlsdktestpypi.azureedge.net/sdk-cli-v2\n  - mldesigner==0.0.71974906\n  - mlflow\n  - azureml-mlflow\nname: example-environment\n",
          "image": "mcr.microsoft.com/azureml/openmpi3.1.2-ubuntu18.04"
        }
      },
      "StatusCode": 201,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "1436",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Tue, 30 May 2023 07:28:49 GMT",
        "Expires": "-1",
        "Location": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94?api-version=2023-04-01-preview",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-064c5109ff2eafdfc9183b9b9fb1f4f4-ccfcdd5be9476783-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus2-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "1907f10c-9226-4241-a02f-b318e6e35351",
        "x-ms-ratelimit-remaining-subscription-writes": "1199",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "JAPANEAST:20230530T072850Z:1907f10c-9226-4241-a02f-b318e6e35351",
        "x-request-time": "0.755"
      },
      "ResponseBody": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94",
        "name": "7926e182b294d8644f987381c0081e94",
        "type": "Microsoft.MachineLearningServices/workspaces/environments/versions",
        "properties": {
          "description": null,
          "tags": {},
          "properties": {},
          "isArchived": false,
          "isAnonymous": true,
          "autoDeleteSetting": null,
          "environmentType": "UserCreated",
          "image": "mcr.microsoft.com/azureml/openmpi3.1.2-ubuntu18.04",
          "condaFile": "{\n  \u0022channels\u0022: [\n    \u0022defaults\u0022\n  ],\n  \u0022dependencies\u0022: [\n    \u0022python=3.8.12\u0022,\n    \u0022pip=21.2.2\u0022,\n    {\n      \u0022pip\u0022: [\n        \u0022--extra-index-url=https://azuremlsdktestpypi.azureedge.net/sdk-cli-v2\u0022,\n        \u0022mldesigner==0.0.71974906\u0022,\n        \u0022mlflow\u0022,\n        \u0022azureml-mlflow\u0022\n      ]\n    }\n  ],\n  \u0022name\u0022: \u0022example-environment\u0022\n}",
          "osType": "Linux",
          "autoRebuild": "Disabled",
          "provisioningState": "Succeeded",
          "stage": "Logged",
          "intellectualProperty": null
        },
        "systemData": {
          "createdAt": "2023-05-24T03:02:26.6953544\u002B00:00",
          "createdBy": "Chenyang Zhang",
          "createdByType": "User",
          "lastModifiedAt": "2023-05-24T03:02:26.6953544\u002B00:00",
          "lastModifiedBy": "Chenyang Zhang",
          "lastModifiedByType": "User"
        }
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94?api-version=2023-04-01-preview",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "379",
        "Content-Type": "application/json",
        "User-Agent": "azure-ai-ml/1.8.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)"
      },
      "RequestBody": {
        "properties": {
          "isAnonymous": true,
          "isArchived": false,
          "condaFile": "channels:\n- defaults\ndependencies:\n- python=3.8.12\n- pip=21.2.2\n- pip:\n  - --extra-index-url=https://azuremlsdktestpypi.azureedge.net/sdk-cli-v2\n  - mldesigner==0.0.71974906\n  - mlflow\n  - azureml-mlflow\nname: example-environment\n",
          "image": "mcr.microsoft.com/azureml/openmpi3.1.2-ubuntu18.04"
        }
      },
      "StatusCode": 201,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "1436",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Tue, 30 May 2023 07:28:50 GMT",
        "Expires": "-1",
        "Location": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94?api-version=2023-04-01-preview",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-04e537e1853e589fae724db846e84570-04b872ad7a480c8d-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus2-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "b9f68e90-06cb-4ff2-b610-43709af16a9e",
        "x-ms-ratelimit-remaining-subscription-writes": "1198",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "JAPANEAST:20230530T072850Z:b9f68e90-06cb-4ff2-b610-43709af16a9e",
        "x-request-time": "0.206"
      },
      "ResponseBody": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94",
        "name": "7926e182b294d8644f987381c0081e94",
        "type": "Microsoft.MachineLearningServices/workspaces/environments/versions",
        "properties": {
          "description": null,
          "tags": {},
          "properties": {},
          "isArchived": false,
          "isAnonymous": true,
          "autoDeleteSetting": null,
          "environmentType": "UserCreated",
          "image": "mcr.microsoft.com/azureml/openmpi3.1.2-ubuntu18.04",
          "condaFile": "{\n  \u0022channels\u0022: [\n    \u0022defaults\u0022\n  ],\n  \u0022dependencies\u0022: [\n    \u0022python=3.8.12\u0022,\n    \u0022pip=21.2.2\u0022,\n    {\n      \u0022pip\u0022: [\n        \u0022--extra-index-url=https://azuremlsdktestpypi.azureedge.net/sdk-cli-v2\u0022,\n        \u0022mldesigner==0.0.71974906\u0022,\n        \u0022mlflow\u0022,\n        \u0022azureml-mlflow\u0022\n      ]\n    }\n  ],\n  \u0022name\u0022: \u0022example-environment\u0022\n}",
          "osType": "Linux",
          "autoRebuild": "Disabled",
          "provisioningState": "Succeeded",
          "stage": "Logged",
          "intellectualProperty": null
        },
        "systemData": {
          "createdAt": "2023-05-24T03:02:26.6953544\u002B00:00",
          "createdBy": "Chenyang Zhang",
          "createdByType": "User",
          "lastModifiedAt": "2023-05-24T03:02:26.6953544\u002B00:00",
          "lastModifiedBy": "Chenyang Zhang",
          "lastModifiedByType": "User"
        }
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94?api-version=2023-04-01-preview",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "379",
        "Content-Type": "application/json",
        "User-Agent": "azure-ai-ml/1.8.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)"
      },
      "RequestBody": {
        "properties": {
          "isAnonymous": true,
          "isArchived": false,
          "condaFile": "channels:\n- defaults\ndependencies:\n- python=3.8.12\n- pip=21.2.2\n- pip:\n  - --extra-index-url=https://azuremlsdktestpypi.azureedge.net/sdk-cli-v2\n  - mldesigner==0.0.71974906\n  - mlflow\n  - azureml-mlflow\nname: example-environment\n",
          "image": "mcr.microsoft.com/azureml/openmpi3.1.2-ubuntu18.04"
        }
      },
      "StatusCode": 201,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "1436",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Tue, 30 May 2023 07:28:50 GMT",
        "Expires": "-1",
        "Location": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94?api-version=2023-04-01-preview",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-befb07678df05bca65d7579d60d4b957-5b168ba9f9b8b382-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus2-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "8b06b7a3-5883-426c-bd53-efdacce7118b",
        "x-ms-ratelimit-remaining-subscription-writes": "1197",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "JAPANEAST:20230530T072851Z:8b06b7a3-5883-426c-bd53-efdacce7118b",
        "x-request-time": "0.192"
      },
      "ResponseBody": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94",
        "name": "7926e182b294d8644f987381c0081e94",
        "type": "Microsoft.MachineLearningServices/workspaces/environments/versions",
        "properties": {
          "description": null,
          "tags": {},
          "properties": {},
          "isArchived": false,
          "isAnonymous": true,
          "autoDeleteSetting": null,
          "environmentType": "UserCreated",
          "image": "mcr.microsoft.com/azureml/openmpi3.1.2-ubuntu18.04",
          "condaFile": "{\n  \u0022channels\u0022: [\n    \u0022defaults\u0022\n  ],\n  \u0022dependencies\u0022: [\n    \u0022python=3.8.12\u0022,\n    \u0022pip=21.2.2\u0022,\n    {\n      \u0022pip\u0022: [\n        \u0022--extra-index-url=https://azuremlsdktestpypi.azureedge.net/sdk-cli-v2\u0022,\n        \u0022mldesigner==0.0.71974906\u0022,\n        \u0022mlflow\u0022,\n        \u0022azureml-mlflow\u0022\n      ]\n    }\n  ],\n  \u0022name\u0022: \u0022example-environment\u0022\n}",
          "osType": "Linux",
          "autoRebuild": "Disabled",
          "provisioningState": "Succeeded",
          "stage": "Logged",
          "intellectualProperty": null
        },
        "systemData": {
          "createdAt": "2023-05-24T03:02:26.6953544\u002B00:00",
          "createdBy": "Chenyang Zhang",
          "createdByType": "User",
          "lastModifiedAt": "2023-05-24T03:02:26.6953544\u002B00:00",
          "lastModifiedBy": "Chenyang Zhang",
          "lastModifiedByType": "User"
        }
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/codes/000000000000000000000/versions?api-version=2023-04-01\u0026hash=634b294c48adbaa95bcf5efb308a0fcad4c9a1e4a5e7dcf6a44403430acd7a9a\u0026hashVersion=202208",
      "RequestMethod": "GET",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "User-Agent": "azure-ai-ml/1.8.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)"
      },
      "RequestBody": null,
      "StatusCode": 200,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Encoding": "gzip",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Tue, 30 May 2023 07:28:52 GMT",
        "Expires": "-1",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-d2c02edfc1fcc4eb6c5aa532a917fb85-7e2f002d2fadb0fd-00\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "Transfer-Encoding": "chunked",
        "Vary": "Accept-Encoding",
        "x-aml-cluster": "vienna-eastus2-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "e093ea6b-cbc3-4aa6-95da-e16893a5a983",
        "x-ms-ratelimit-remaining-subscription-reads": "11999",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "JAPANEAST:20230530T072853Z:e093ea6b-cbc3-4aa6-95da-e16893a5a983",
        "x-request-time": "0.062"
      },
      "ResponseBody": {
        "value": []
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/codes/000000000000000000000/versions/1/startPendingUpload?api-version=2023-04-01",
      "RequestMethod": "POST",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "47",
        "Content-Type": "application/json",
        "User-Agent": "azure-ai-ml/1.8.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)"
      },
      "RequestBody": {
        "pendingUploadType": "TemporaryBlobReference"
      },
      "StatusCode": 200,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Encoding": "gzip",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Tue, 30 May 2023 07:28:53 GMT",
        "Expires": "-1",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-841facdb914e8a8d5464311ee637b54a-4305ef166eb4c888-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "Transfer-Encoding": "chunked",
        "Vary": [
          "Accept-Encoding",
          "Accept-Encoding"
        ],
        "x-aml-cluster": "vienna-eastus2-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "5df963f4-6f58-44f8-b56c-b2878f678408",
        "x-ms-ratelimit-remaining-subscription-writes": "1196",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "JAPANEAST:20230530T072854Z:5df963f4-6f58-44f8-b56c-b2878f678408",
        "x-request-time": "0.331"
      },
      "ResponseBody": {
        "blobReferenceForConsumption": {
          "blobUri": "https://amltest5899420437.blob.core.windows.net:443/0bdd51b6-c-1528b478-eba7-5304-8464-339b5ebaec88",
          "storageAccountArmId": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.Storage/storageAccounts/amltest5899420437",
          "credential": {
            "credentialType": "SAS",
            "sasUri": "https://amltest5899420437.blob.core.windows.net/0bdd51b6-c-1528b478-eba7-5304-8464-339b5ebaec88?skoid=372c30a9-c04f-422f-b38c-872e6b7d5540\u0026sktid=72f988bf-86f1-41af-91ab-2d7cd011db47\u0026skt=2023-05-30T07%3A11%3A03Z\u0026ske=2023-05-31T15%3A21%3A03Z\u0026sks=b\u0026skv=2019-07-07\u0026sv=2021-10-04\u0026st=2023-05-30T07%3A18%3A54Z\u0026se=2023-05-30T15%3A28%3A54Z\u0026sr=c\u0026sp=rcwl\u0026sig=000000000000000000000000000000000000"
          }
        },
        "pendingUploadId": "1f2f93b4-3a67-450a-bb23-0f4ab7d6ed39",
        "pendingUploadType": "None"
      }
    },
    {
      "RequestUri": "https://amltest5899420437.blob.core.windows.net/0bdd51b6-c-1528b478-eba7-5304-8464-339b5ebaec88/src/baisc_component.py?skoid=372c30a9-c04f-422f-b38c-872e6b7d5540\u0026sktid=72f988bf-86f1-41af-91ab-2d7cd011db47\u0026skt=2023-05-30T07%3A11%3A03Z\u0026ske=2023-05-31T15%3A21%3A03Z\u0026sks=b\u0026skv=2019-07-07\u0026sv=2021-10-04\u0026st=2023-05-30T07%3A18%3A54Z\u0026se=2023-05-30T15%3A28%3A54Z\u0026sr=c\u0026sp=rcwl\u0026sig=000000000000000000000000000000000000",
      "RequestMethod": "HEAD",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)",
        "x-ms-date": "Tue, 30 May 2023 07:28:52 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": null,
      "StatusCode": 404,
      "ResponseHeaders": {
        "Date": "Tue, 30 May 2023 07:28:54 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "Transfer-Encoding": "chunked",
        "Vary": "Origin",
        "x-ms-error-code": "BlobNotFound",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://amltest5899420437.blob.core.windows.net/0bdd51b6-c-1528b478-eba7-5304-8464-339b5ebaec88/src/baisc_component.py?skoid=372c30a9-c04f-422f-b38c-872e6b7d5540\u0026sktid=72f988bf-86f1-41af-91ab-2d7cd011db47\u0026skt=2023-05-30T07%3A11%3A03Z\u0026ske=2023-05-31T15%3A21%3A03Z\u0026sks=b\u0026skv=2019-07-07\u0026sv=2021-10-04\u0026st=2023-05-30T07%3A18%3A54Z\u0026se=2023-05-30T15%3A28%3A54Z\u0026sr=c\u0026sp=rcwl\u0026sig=000000000000000000000000000000000000",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "1443",
        "Content-MD5": "zNiWfv/6Ym24qYJAsT0CDA==",
        "Content-Type": "application/octet-stream",
        "If-None-Match": "*",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)",
        "x-ms-blob-type": "BlockBlob",
        "x-ms-date": "Tue, 30 May 2023 07:28:53 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": "aW1wb3J0IGFyZ3BhcnNlCmltcG9ydCBvcwoKZnJvbSBtbGRlc2lnbmVyLl9jb21wb25lbnRfZXhlY3V0b3IgaW1wb3J0IEV4ZWN1dG9yQmFzZQoKcGFyc2VyID0gYXJncGFyc2UuQXJndW1lbnRQYXJzZXIoKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWNvbXBvbmVudF9pbl9udW1iZXIiLCB0eXBlPWludCkKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1jb21wb25lbnRfaW5fbnVtYmVyXzEiLCB0eXBlPWludCkKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1jb21wb25lbnRfaW5fcGF0aCIsIHR5cGU9c3RyKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLW91dHB1dF9pbl9wYXRoIiwgdHlwZT1zdHIpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tb3V0cHV0X2luX251bWJlciIsIHR5cGU9c3RyKQoKCmFyZ3MgPSBwYXJzZXIucGFyc2VfYXJncygpCgpsaW5lcyA9IFsKICAgIGYiY29tcG9uZW50X2luX251bWJlcjoge2FyZ3MuY29tcG9uZW50X2luX251bWJlcn0iLAogICAgZiJjb21wb25lbnRfaW5fbnVtYmVyXzE6IHthcmdzLmNvbXBvbmVudF9pbl9udW1iZXJfMX0iLAogICAgZiJjb21wb25lbnRfaW5fcGF0aDoge2FyZ3MuY29tcG9uZW50X2luX3BhdGh9IiwKXQoKaWYgYXJncy5jb21wb25lbnRfaW5fbnVtYmVyIGlzIG5vdCBOb25lOgogICAgY29tcG9uZW50X2luX251bWJlciA9IGFyZ3MuY29tcG9uZW50X2luX251bWJlcgplbGlmIG9zLnBhdGguZXhpc3RzKG9zLnBhdGguam9pbihhcmdzLmNvbXBvbmVudF9pbl9wYXRoLCAib3V0cHV0LnR4dCIpKToKICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oYXJncy5jb21wb25lbnRfaW5fcGF0aCwgIm91dHB1dC50eHQiKSwgInIiKSBhcyBmaWxlOgogICAgICAgIGNvbnRlbnQgPSBmaWxlLnJlYWQoKQogICAgICAgIHRyeToKICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlciA9IGludChjb250ZW50KQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXIgPSBhcmdzLmNvbXBvbmVudF9pbl9udW1iZXIKZWxzZToKICAgIGNvbXBvbmVudF9pbl9udW1iZXIgPSAwCgpvdXRwdXRfaW5fbnVtID0gY29tcG9uZW50X2luX251bWJlciAtIDEKCndpdGggb3Blbihvcy5wYXRoLmpvaW4oYXJncy5vdXRwdXRfaW5fcGF0aCwgIm91dHB1dC50eHQiKSwgInciKSBhcyBmaWxlOgogICAgZmlsZS53cml0ZShzdHIob3V0cHV0X2luX251bSkpCgpjb250cm9sX291dHB1dF9jb250ZW50ID0gJ3siaXNfbnVtYmVyX2xhcmdlcl90aGFuX3plcm8iOiAiJXMiLCAib3V0cHV0X2luX251bWJlciI6ICIlcyJ9JyAlICgKICAgIHN0cihvdXRwdXRfaW5fbnVtID4gMCksCiAgICBvdXRwdXRfaW5fbnVtLAopCkV4ZWN1dG9yQmFzZS5fd3JpdGVfY29udHJvbF9vdXRwdXRzX3RvX3J1bl9oaXN0b3J5KGNvbnRyb2xfb3V0cHV0X2NvbnRlbnQ9Y29udHJvbF9vdXRwdXRfY29udGVudCkK",
      "StatusCode": 201,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Content-MD5": "zNiWfv/6Ym24qYJAsT0CDA==",
        "Date": "Tue, 30 May 2023 07:28:54 GMT",
        "ETag": "\u00220x8DB60DF86A7D4A9\u0022",
        "Last-Modified": "Tue, 30 May 2023 07:28:55 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-content-crc64": "qXP\u002BqljsVoo=",
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://amltest5899420437.blob.core.windows.net/0bdd51b6-c-1528b478-eba7-5304-8464-339b5ebaec88/src/baisc_component.py?comp=metadata\u0026skoid=372c30a9-c04f-422f-b38c-872e6b7d5540\u0026sktid=72f988bf-86f1-41af-91ab-2d7cd011db47\u0026skt=2023-05-30T07%3A11%3A03Z\u0026ske=2023-05-31T15%3A21%3A03Z\u0026sks=b\u0026skv=2019-07-07\u0026sv=2021-10-04\u0026st=2023-05-30T07%3A18%3A54Z\u0026se=2023-05-30T15%3A28%3A54Z\u0026sr=c\u0026sp=rcwl\u0026sig=000000000000000000000000000000000000",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "0",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)",
        "x-ms-date": "Tue, 30 May 2023 07:28:53 GMT",
        "x-ms-meta-name": "000000000000000000000",
        "x-ms-meta-upload_status": "completed",
        "x-ms-meta-version": "1",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": null,
      "StatusCode": 200,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Date": "Tue, 30 May 2023 07:28:55 GMT",
        "ETag": "\u00220x8DB60DF86CC6E3C\u0022",
        "Last-Modified": "Tue, 30 May 2023 07:28:55 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/codes/000000000000000000000/versions/1?api-version=2023-04-01",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "246",
        "Content-Type": "application/json",
        "User-Agent": "azure-ai-ml/1.8.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)"
      },
      "RequestBody": {
        "properties": {
          "properties": {
            "hash_sha256": "0000000000000",
            "hash_version": "0000000000000"
          },
          "isAnonymous": true,
          "isArchived": false,
          "codeUri": "https://amltest5899420437.blob.core.windows.net:443/0bdd51b6-c-1528b478-eba7-5304-8464-339b5ebaec88/src"
        }
      },
      "StatusCode": 201,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "795",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Tue, 30 May 2023 07:28:55 GMT",
        "Expires": "-1",
        "Location": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/codes/000000000000000000000/versions/1?api-version=2023-04-01",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-913a301e65e76b61d7dad996a4910701-accbec755276e669-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus2-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "3491448c-8f4a-4d76-a2bf-27548cab73d2",
        "x-ms-ratelimit-remaining-subscription-writes": "1195",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "JAPANEAST:20230530T072856Z:3491448c-8f4a-4d76-a2bf-27548cab73d2",
        "x-request-time": "0.269"
      },
      "ResponseBody": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/codes/000000000000000000000/versions/1",
        "name": "1",
        "type": "Microsoft.MachineLearningServices/workspaces/codes/versions",
        "properties": {
          "description": null,
          "tags": {},
          "properties": {
            "hash_sha256": "0000000000000",
            "hash_version": "0000000000000"
          },
          "isArchived": false,
          "isAnonymous": false,
          "codeUri": "https://amltest5899420437.blob.core.windows.net:443/0bdd51b6-c-1528b478-eba7-5304-8464-339b5ebaec88/src",
          "provisioningState": "Succeeded"
        },
        "systemData": {
          "createdAt": "2023-05-30T07:28:56.4186371\u002B00:00",
          "createdBy": "Chenyang Zhang",
          "createdByType": "User",
          "lastModifiedAt": "2023-05-30T07:28:56.4186371\u002B00:00",
          "lastModifiedBy": "Chenyang Zhang",
          "lastModifiedByType": "User"
        }
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/000000000000000000000?api-version=2022-10-01",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "1404",
        "Content-Type": "application/json",
        "User-Agent": "azure-ai-ml/1.8.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)"
      },
      "RequestBody": {
        "properties": {
          "properties": {},
          "tags": {},
          "isAnonymous": true,
          "isArchived": false,
          "componentSpec": {
            "command": "python basic_component.py $[[--component_in_number ${{inputs.component_in_number}}]] $[[--component_in_number_1 ${{inputs.component_in_number_1}}]] --component_in_path ${{inputs.component_in_path}} --output_in_path ${{outputs.output_in_path}}",
            "code": "azureml:/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/codes/000000000000000000000/versions/1",
            "environment": "azureml:/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94",
            "name": "basic_component",
            "version": "0.0.1",
            "$schema": "https://azuremlschemas.azureedge.net/latest/commandComponent.schema.json",
            "display_name": "Basic component",
            "is_deterministic": true,
            "inputs": {
              "component_in_number": {
                "type": "integer",
                "optional": true
              },
              "component_in_number_1": {
                "type": "integer",
                "optional": true
              },
              "component_in_path": {
                "type": "uri_folder"
              }
            },
            "outputs": {
              "output_in_path": {
                "type": "uri_folder"
              },
              "output_in_number": {
                "type": "integer",
                "is_control": true
              },
              "is_number_larger_than_zero": {
                "type": "boolean",
                "is_control": true
              }
            },
            "type": "command",
            "_source": "YAML.COMPONENT"
          }
        }
      },
      "StatusCode": 201,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "2443",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Tue, 30 May 2023 07:28:58 GMT",
        "Expires": "-1",
        "Location": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/000000000000000000000?api-version=2022-10-01",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-eaff0babb3e7e38a9b6bcb34cbc8d08a-fee2ec13695889b5-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus2-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "d8ba48e3-7c6e-47dc-a290-0b8e5069da2f",
        "x-ms-ratelimit-remaining-subscription-writes": "1194",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "JAPANEAST:20230530T072858Z:d8ba48e3-7c6e-47dc-a290-0b8e5069da2f",
        "x-request-time": "0.414"
      },
      "ResponseBody": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/744e2b52-597b-47b6-b06b-2cebd143bcdf",
        "name": "744e2b52-597b-47b6-b06b-2cebd143bcdf",
        "type": "Microsoft.MachineLearningServices/workspaces/components/versions",
        "properties": {
          "description": null,
          "tags": {},
          "properties": {},
          "isArchived": false,
          "isAnonymous": true,
          "componentSpec": {
            "$schema": "https://azuremlschemas.azureedge.net/latest/commandComponent.schema.json",
            "name": "basic_component",
            "version": "0.0.1",
            "display_name": "Basic component",
            "is_deterministic": "True",
            "type": "command",
            "inputs": {
              "component_in_path": {
                "type": "uri_folder",
                "optional": "False"
              },
              "component_in_number": {
                "type": "integer",
                "optional": "True"
              },
              "component_in_number_1": {
                "type": "integer",
                "optional": "True"
              }
            },
            "outputs": {
              "output_in_path": {
                "type": "uri_folder"
              },
              "output_in_number": {
                "type": "integer",
                "is_control": "True"
              },
              "is_number_larger_than_zero": {
                "type": "boolean",
                "is_control": "True"
              }
            },
            "code": "azureml:/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/codes/000000000000000000000/versions/1",
            "environment": "azureml:/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/environments/CliV2AnonymousEnvironment/versions/7926e182b294d8644f987381c0081e94",
            "resources": {
              "instance_count": "1"
            },
            "command": "python basic_component.py $[[--component_in_number ${{inputs.component_in_number}}]] $[[--component_in_number_1 ${{inputs.component_in_number_1}}]] --component_in_path ${{inputs.component_in_path}} --output_in_path ${{outputs.output_in_path}}"
          }
        },
        "systemData": {
          "createdAt": "2023-05-30T07:28:58.6543145\u002B00:00",
          "createdBy": "Chenyang Zhang",
          "createdByType": "User",
          "lastModifiedAt": "2023-05-30T07:28:58.6543145\u002B00:00",
          "lastModifiedBy": "Chenyang Zhang",
          "lastModifiedByType": "User"
        }
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/000000000000000000000?api-version=2022-10-01",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "1778",
        "Content-Type": "application/json",
        "User-Agent": "azure-ai-ml/1.8.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)"
      },
      "RequestBody": {
        "properties": {
          "description": "E2E dummy train-score-eval pipeline with components defined via yaml.",
          "properties": {},
          "tags": {},
          "isAnonymous": true,
          "isArchived": false,
          "componentSpec": {
            "name": "do_while_body_pipeline_component",
            "description": "E2E dummy train-score-eval pipeline with components defined via yaml.",
            "display_name": "do_while_body_pipeline_component",
            "inputs": {
              "component_in_number": {
                "type": "integer",
                "optional": true
              },
              "component_in_number_1": {
                "type": "integer",
                "optional": true
              },
              "component_in_path": {
                "type": "uri_folder"
              }
            },
            "outputs": {
              "output_in_path": {
                "type": "uri_folder"
              },
              "output_in_number": {
                "type": "integer",
                "is_control": true
              },
              "is_number_larger_than_zero": {
                "type": "boolean",
                "is_control": true
              }
            },
            "type": "pipeline",
            "jobs": {
              "train_with_sample_data": {
                "name": "train_with_sample_data",
                "type": "command",
                "inputs": {
                  "component_in_number": {
                    "job_input_type": "literal",
                    "value": "${{parent.inputs.component_in_number}}"
                  },
                  "component_in_number_1": {
                    "job_input_type": "literal",
                    "value": "${{parent.inputs.component_in_number_1}}"
                  },
                  "component_in_path": {
                    "job_input_type": "literal",
                    "value": "${{parent.inputs.component_in_path}}"
                  }
                },
                "outputs": {
                  "output_in_path": {
                    "value": "${{parent.outputs.output_in_path}}",
                    "type": "literal"
                  },
                  "output_in_number": {
                    "value": "${{parent.outputs.output_in_number}}",
                    "type": "literal"
                  },
                  "is_number_larger_than_zero": {
                    "value": "${{parent.outputs.is_number_larger_than_zero}}",
                    "type": "literal"
                  }
                },
                "_source": "YAML.COMPONENT",
                "componentId": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/744e2b52-597b-47b6-b06b-2cebd143bcdf"
              }
            },
            "_source": "DSL",
            "sourceJobId": null
          }
        }
      },
      "StatusCode": 201,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "1692",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Tue, 30 May 2023 07:28:59 GMT",
        "Expires": "-1",
        "Location": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/000000000000000000000?api-version=2022-10-01",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-b5d110a815b83696fec6c560a7b1cfa0-cb7de634c85a0eaa-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus2-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "bac9a2a2-b998-497b-b86d-19809f2a0daa",
        "x-ms-ratelimit-remaining-subscription-writes": "1193",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "JAPANEAST:20230530T072900Z:bac9a2a2-b998-497b-b86d-19809f2a0daa",
        "x-request-time": "0.661"
      },
      "ResponseBody": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/ae52818b-d81e-44df-aef4-fc6cc33a9d40",
        "name": "ae52818b-d81e-44df-aef4-fc6cc33a9d40",
        "type": "Microsoft.MachineLearningServices/workspaces/components/versions",
        "properties": {
          "description": null,
          "tags": {},
          "properties": {},
          "isArchived": false,
          "isAnonymous": true,
          "componentSpec": {
            "name": "do_while_body_pipeline_component",
            "display_name": "do_while_body_pipeline_component",
            "is_deterministic": "False",
            "type": "pipeline",
            "description": "E2E dummy train-score-eval pipeline with components defined via yaml.",
            "inputs": {
              "component_in_path": {
                "type": "uri_folder",
                "optional": "False"
              },
              "component_in_number": {
                "type": "integer",
                "optional": "True"
              },
              "component_in_number_1": {
                "type": "integer",
                "optional": "True"
              }
            },
            "outputs": {
              "output_in_path": {
                "type": "uri_folder"
              },
              "output_in_number": {
                "type": "integer",
                "is_control": "True"
              },
              "is_number_larger_than_zero": {
                "type": "boolean",
                "is_control": "True"
              }
            }
          }
        },
        "systemData": {
          "createdAt": "2023-05-30T07:29:00.0543157\u002B00:00",
          "createdBy": "Chenyang Zhang",
          "createdByType": "User",
          "lastModifiedAt": "2023-05-30T07:29:00.0543157\u002B00:00",
          "lastModifiedBy": "Chenyang Zhang",
          "lastModifiedByType": "User"
        }
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/datastores/workspaceblobstore?api-version=2022-10-01",
      "RequestMethod": "GET",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "User-Agent": "azure-ai-ml/1.8.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)"
      },
      "RequestBody": null,
      "StatusCode": 200,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Encoding": "gzip",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Tue, 30 May 2023 07:29:00 GMT",
        "Expires": "-1",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-0514aac997117c1ca28e6027ea1a7757-7119bc30eb367479-00\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "Transfer-Encoding": "chunked",
        "Vary": [
          "Accept-Encoding",
          "Accept-Encoding"
        ],
        "x-aml-cluster": "vienna-eastus2-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "aa9256c3-6ce8-46bc-b101-d997a832556d",
        "x-ms-ratelimit-remaining-subscription-reads": "11998",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "JAPANEAST:20230530T072900Z:aa9256c3-6ce8-46bc-b101-d997a832556d",
        "x-request-time": "0.120"
      },
      "ResponseBody": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/datastores/workspaceblobstore",
        "name": "workspaceblobstore",
        "type": "Microsoft.MachineLearningServices/workspaces/datastores",
        "properties": {
          "description": null,
          "tags": null,
          "properties": null,
          "isDefault": true,
          "credentials": {
            "credentialsType": "AccountKey"
          },
          "datastoreType": "AzureBlob",
          "accountName": "amltest5899420437",
          "containerName": "azureml-blobstore-0bdd51b6-cd9c-4978-b870-99997b393b81",
          "endpoint": "core.windows.net",
          "protocol": "https",
          "serviceDataAccessAuthIdentity": "WorkspaceSystemAssignedIdentity"
        },
        "systemData": {
          "createdAt": "2023-05-19T09:41:55.3790868\u002B00:00",
          "createdBy": "779301c0-18b2-4cdc-801b-a0a3368fee0a",
          "createdByType": "Application",
          "lastModifiedAt": "2023-05-19T09:41:56.0641774\u002B00:00",
          "lastModifiedBy": "779301c0-18b2-4cdc-801b-a0a3368fee0a",
          "lastModifiedByType": "Application"
        }
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/datastores/workspaceblobstore/listSecrets?api-version=2022-10-01",
      "RequestMethod": "POST",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "0",
        "User-Agent": "azure-ai-ml/1.8.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)"
      },
      "RequestBody": null,
      "StatusCode": 200,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Encoding": "gzip",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Tue, 30 May 2023 07:29:00 GMT",
        "Expires": "-1",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-a882ffbf3eb22994ea8e90794817a267-f9cb184c7ff562c9-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "Transfer-Encoding": "chunked",
        "Vary": "Accept-Encoding",
        "x-aml-cluster": "vienna-eastus2-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "a45183d1-a5ca-4f12-91e6-842122191468",
        "x-ms-ratelimit-remaining-subscription-writes": "1199",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "JAPANEAST:20230530T072901Z:a45183d1-a5ca-4f12-91e6-842122191468",
        "x-request-time": "0.083"
      },
      "ResponseBody": {
        "secretsType": "AccountKey",
        "key": "dGhpcyBpcyBmYWtlIGtleQ=="
      }
    },
    {
      "RequestUri": "https://amltest5899420437.blob.core.windows.net/azureml-blobstore-0bdd51b6-cd9c-4978-b870-99997b393b81/LocalUpload/00000000000000000000000000000000/e2etests/__init__.py",
      "RequestMethod": "HEAD",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)",
        "x-ms-date": "Tue, 30 May 2023 07:28:59 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": null,
      "StatusCode": 404,
      "ResponseHeaders": {
        "Date": "Tue, 30 May 2023 07:29:00 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "Transfer-Encoding": "chunked",
        "Vary": "Origin",
        "x-ms-error-code": "BlobNotFound",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://amltest5899420437.blob.core.windows.net/azureml-blobstore-0bdd51b6-cd9c-4978-b870-99997b393b81/LocalUpload/00000000000000000000000000000000/e2etests/test_dsl_pipeline_with_specific_nodes.py",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "12855",
        "Content-MD5": "1Eejn94qxLQlrgO40sYwwA==",
        "Content-Type": "application/octet-stream",
        "If-None-Match": "*",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)",
        "x-ms-blob-type": "BlockBlob",
        "x-ms-date": "Tue, 30 May 2023 07:28:59 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": "aW1wb3J0IG11bHRpcHJvY2Vzc2luZwppbXBvcnQgdXVpZApmcm9tIGZ1bmN0b29scyBpbXBvcnQgcGFydGlhbApmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKZnJvbSB0eXBpbmcgaW1wb3J0IENhbGxhYmxlLCBVbmlvbgoKaW1wb3J0IHB5dGVzdApmcm9tIGRldnRvb2xzX3Rlc3R1dGlscyBpbXBvcnQgQXp1cmVSZWNvcmRlZFRlc3RDYXNlCmZyb20gbW9jayBpbXBvcnQgbW9jawpmcm9tIHB5dGVzdF9tb2NrIGltcG9ydCBNb2NrRml4dHVyZQoKZnJvbSBhenVyZS5haS5tbC5vcGVyYXRpb25zLl9vcGVyYXRpb25fb3JjaGVzdHJhdG9yIGltcG9ydCBPcGVyYXRpb25PcmNoZXN0cmF0b3IKZnJvbSB0ZXN0X3V0aWxpdGllcy51dGlscyBpbXBvcnQgKAogICAgX1BZVEVTVF9USU1FT1VUX01FVEhPRCwKICAgIGFzc2VydF9qb2JfY2FuY2VsLAogICAgc3VibWl0X2FuZF9jYW5jZWxfbmV3X2RzbF9waXBlbGluZSwKICAgIG9taXRfd2l0aF93aWxkY2FyZCwKKQoKZnJvbSBhenVyZS5haS5tbCBpbXBvcnQgKAogICAgSW5wdXQsCiAgICBNTENsaWVudCwKICAgIGRzbCwKICAgIGxvYWRfY29tcG9uZW50LAopCmZyb20gYXp1cmUuYWkubWwuY29uc3RhbnRzLl9jb21tb24gaW1wb3J0IEFzc2V0VHlwZXMKZnJvbSBhenVyZS5haS5tbC5lbnRpdGllcyBpbXBvcnQgQ29tbWFuZENvbXBvbmVudCwgQ29tbWFuZCwgQ2hvaWNlLCBTd2VlcCwgQ29tcG9uZW50LCBFbnZpcm9ubWVudCwgUGlwZWxpbmVDb21wb25lbnQKZnJvbSBhenVyZS5haS5tbC5lbnRpdGllcyBpbXBvcnQgUGlwZWxpbmVKb2IKCmZyb20gLi5fdXRpbCBpbXBvcnQgX0RTTF9USU1FT1VUX1NFQ09ORAoKdGVzdHNfcm9vdF9kaXIgPSBQYXRoKF9fZmlsZV9fKS5wYXJlbnQucGFyZW50LnBhcmVudApjb21wb25lbnRzX2RpciA9IHRlc3RzX3Jvb3RfZGlyIC8gInRlc3RfY29uZmlncy9jb21wb25lbnRzLyIKam9iX2lucHV0ID0gSW5wdXQoCiAgICB0eXBlPUFzc2V0VHlwZXMuVVJJX0ZJTEUsCiAgICBwYXRoPSJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIsCikKZXhwZXJpbWVudF9uYW1lID0gImRzbF9waXBlbGluZV9lMmUiCmNvbW1vbl9vbWl0X2ZpZWxkcyA9IFsKICAgICJwcm9wZXJ0aWVzIiwKICAgICJkaXNwbGF5X25hbWUiLAogICAgImV4cGVyaW1lbnRfbmFtZSIsCiAgICAiam9icy4qLmNvbXBvbmVudElkIiwKICAgICJpbnB1dHMuKi51cmkiLAogICAgImpvYnMuKi5fc291cmNlIiwKICAgICJqb2JzLioucHJvcGVydGllcyIsCiAgICAic2V0dGluZ3MuX3NvdXJjZSIsCiAgICAic291cmNlX2pvYl9pZCIsCiAgICAic2VydmljZXMiLApdCgoKZGVmIF9nZXRfY29tcG9uZW50X2luX2ZpcnN0X2NoaWxkKF93aXRoX2pvYnM6IFVuaW9uW1BpcGVsaW5lSm9iLCBQaXBlbGluZUNvbXBvbmVudF0sIGNsaWVudDogTUxDbGllbnQpIC0\u002BIENvbXBvbmVudDoKICAgIGlmIG5vdCBfd2l0aF9qb2JzLmpvYnM6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiTm8gam9icyBmb3VuZCBpbiB0aGUgcGlwZWxpbmUiKQogICAgX3Jlc3VsdCA9IG5leHQoaXRlcihfd2l0aF9qb2JzLmpvYnMudmFsdWVzKCkpKS5jb21wb25lbnQuc3BsaXQoIjoiKQogICAgaWYgbGVuKF9yZXN1bHQpID09IDI6CiAgICAgICAgX25hbWUsIF92ZXJzaW9uID0gX3Jlc3VsdAogICAgZWxpZiBsZW4oX3Jlc3VsdCkgPT0gMzoKICAgICAgICBfLCBfbmFtZSwgX3ZlcnNpb24gPSBfcmVzdWx0CiAgICBlbHNlOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoIkludmFsaWQgY29tcG9uZW50IGFybSBzdHJpbmc6IHt9Ii5mb3JtYXQoX3Jlc3VsdCkpCiAgICByZXR1cm4gY2xpZW50LmNvbXBvbmVudHMuZ2V0KF9uYW1lLCBfdmVyc2lvbikKCgpAcHl0ZXN0Lm1hcmsudXNlZml4dHVyZXMoCiAgICAiZW5hYmxlX2Vudmlyb25tZW50X2lkX2FybV9leHBhbnNpb24iLAogICAgImVuYWJsZV9waXBlbGluZV9wcml2YXRlX3ByZXZpZXdfZmVhdHVyZXMiLAogICAgIm1vY2tfY29kZV9oYXNoIiwKICAgICJtb2NrX2NvbXBvbmVudF9oYXNoIiwKICAgICJtb2NrX3NldF9oZWFkZXJzX3dpdGhfdXNlcl9hbWxfdG9rZW4iLAogICAgInJlY29yZGVkX3Rlc3QiLAopCkBweXRlc3QubWFyay50aW1lb3V0KHRpbWVvdXQ9X0RTTF9USU1FT1VUX1NFQ09ORCwgbWV0aG9kPV9QWVRFU1RfVElNRU9VVF9NRVRIT0QpCkBweXRlc3QubWFyay5lMmV0ZXN0CkBweXRlc3QubWFyay5waXBlbGluZV90ZXN0CmNsYXNzIFRlc3REU0xQaXBlbGluZVdpdGhTcGVjaWZpY05vZGVzKEF6dXJlUmVjb3JkZWRUZXN0Q2FzZSk6CiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgX2dlbmVyYXRlX211bHRpX2xheWVyX3BpcGVsaW5lX2Z1bmMoKToKICAgICAgICBwYXRoID0gIi4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnQueW1sIgoKICAgICAgICBAZHNsLnBpcGVsaW5lCiAgICAgICAgZGVmIHBpcGVsaW5lX2xlYWYoY29tcG9uZW50X2luX3BhdGg6IElucHV0KToKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMxID0gbG9hZF9jb21wb25lbnQoc291cmNlPXBhdGgpCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMShjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5fcGF0aCwgY29tcG9uZW50X2luX251bWJlcj0xKQoKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMyID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgICAgICBzb3VyY2U9cGF0aCwKICAgICAgICAgICAgICAgIHBhcmFtc19vdmVycmlkZT1bCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJhbm90aGVyX2NvbXBvbmVudF9uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZlcnNpb24iOiAiYW5vdGhlcl9jb21wb25lbnRfdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgKQogICAgICAgICAgICBjb21wb25lbnRfZnVuYzIoY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2luX3BhdGgsIGNvbXBvbmVudF9pbl9udW1iZXI9MSkKCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMyA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICAgICAgc291cmNlPXBhdGgsIHBhcmFtc19vdmVycmlkZT1beyJlbnZpcm9ubWVudCI6ICJhenVyZW1sOkF6dXJlTUwtc2tsZWFybi0xLjAtdWJ1bnR1MjAuMDQtcHkzOC1jcHU6MzIifV0KICAgICAgICAgICAgKQogICAgICAgICAgICBjb21wb25lbnRfZnVuYzMoY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2luX3BhdGgsIGNvbXBvbmVudF9pbl9udW1iZXI9MSkKCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jNCA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1wYXRoKQogICAgICAgICAgICBjb21wb25lbnRfZnVuYzQuY29tbWFuZCArPSAiICYgZWNobyB1cGRhdGVkMSIKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmM0KGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbl9wYXRoLCBjb21wb25lbnRfaW5fbnVtYmVyPTEpCgogICAgICAgIEBkc2wucGlwZWxpbmUKICAgICAgICBkZWYgcGlwZWxpbmVfbWlkKGpvYl9pbl9wYXRoOiBJbnB1dCk6CiAgICAgICAgICAgIHBpcGVsaW5lX2xlYWYoam9iX2luX3BhdGgpCiAgICAgICAgICAgIHBpcGVsaW5lX2xlYWYoam9iX2luX3BhdGgpCgogICAgICAgIEBkc2wucGlwZWxpbmUKICAgICAgICBkZWYgcGlwZWxpbmVfcm9vdChqb2JfaW5fcGF0aDogSW5wdXQpOgogICAgICAgICAgICBwaXBlbGluZV9taWQoam9iX2luX3BhdGgpCiAgICAgICAgICAgIHBpcGVsaW5lX21pZChqb2JfaW5fcGF0aCkKCiAgICAgICAgcmV0dXJuIHBpcGVsaW5lX3Jvb3QKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgX2dlbmVyYXRlX3BpcGVsaW5lX2Z1bmNfZm9yX2NvbmN1cnJlbnRfY29tcG9uZW50X3JlZ2lzdHJhdGlvbl90ZXN0KHNoYXJlZF9pbnB1dCk6CiAgICAgICAgcGF0aCA9ICIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50LnltbCIKICAgICAgICBjb25kYV9maWxlX3BhdGggPSAiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvZW52aXJvbm1lbnQvZW52aXJvbm1lbnRfZmlsZXMvZW52aXJvbm1lbnQueW1sIgoKICAgICAgICBlbnZpcm9ubWVudCA9IEVudmlyb25tZW50KAogICAgICAgICAgICBuYW1lPSJ0ZXN0LWVudmlyb25tZW50IiwKICAgICAgICAgICAgY29uZGFfZmlsZT1jb25kYV9maWxlX3BhdGgsCiAgICAgICAgICAgIGltYWdlPSJtY3IubWljcm9zb2Z0LmNvbS9henVyZW1sL29wZW5tcGk0LjEuMC11YnVudHUyMC4wNCIsCiAgICAgICAgICAgIHZlcnNpb249IjIiLCAgIyBUT0RPOiBhbm9ueW1vdXMgZW52aXJvbm1lbnQgaGFzIHBvdGVudGlhbCB2ZXJzaW9uIGNvbmZsaWN0PwogICAgICAgICAgICBkZXNjcmlwdGlvbj0iVGhpcyBpcyBhbiBhbm9ueW1vdXMgZW52aXJvbm1lbnQiLAogICAgICAgICkKCiAgICAgICAgQGRzbC5waXBlbGluZQogICAgICAgIGRlZiBwaXBlbGluZV9sZWFmKCk6CiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMWEgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9cGF0aCkKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMxYS5lbnZpcm9ubWVudCA9IGVudmlyb25tZW50CiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMWEuY29tbWFuZCArPSAiICYgZWNobyB1cGRhdGVkMSIKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMxYShjb21wb25lbnRfaW5fcGF0aD1zaGFyZWRfaW5wdXQsIGNvbXBvbmVudF9pbl9udW1iZXI9MSkKCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMWIgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9cGF0aCkKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMxYi5lbnZpcm9ubWVudCA9IGVudmlyb25tZW50CiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMWIuY29tbWFuZCArPSAiICYgZWNobyB1cGRhdGVkMSIKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMxYihjb21wb25lbnRfaW5fcGF0aD1zaGFyZWRfaW5wdXQsIGNvbXBvbmVudF9pbl9udW1iZXI9MSkKCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMiA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1wYXRoKQogICAgICAgICAgICBjb21wb25lbnRfZnVuYzIuY29tbWFuZCArPSAiICYgZWNobyB1cGRhdGVkMiIKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMyLmVudmlyb25tZW50ID0gZW52aXJvbm1lbnQKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMyKGNvbXBvbmVudF9pbl9wYXRoPXNoYXJlZF9pbnB1dCwgY29tcG9uZW50X2luX251bWJlcj0xKQoKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMzID0gbG9hZF9jb21wb25lbnQoc291cmNlPXBhdGgpCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMy5jb21tYW5kICs9ICIgJiBlY2hvIHVwZGF0ZWQzIgogICAgICAgICAgICBjb21wb25lbnRfZnVuYzMuZW52aXJvbm1lbnQgPSBlbnZpcm9ubWVudAogICAgICAgICAgICBjb21wb25lbnRfZnVuYzMoY29tcG9uZW50X2luX3BhdGg9c2hhcmVkX2lucHV0LCBjb21wb25lbnRfaW5fbnVtYmVyPTEpCgogICAgICAgICMgVE9ETzogdGVzdCB3aXRoIG11bHRpcGxlIHBpcGVsaW5lcyBhZnRlciBzZXJ2ZXItc2lkZSByZXR1cm4gam9icyBmb3IgcGlwZWxpbmUgY29tcG9uZW50CiAgICAgICAgIyBAZHNsLnBpcGVsaW5lCiAgICAgICAgIyBkZWYgcGlwZWxpbmVfbWlkKCk6CiAgICAgICAgIyAgICAgcGlwZWxpbmVfbGVhZigpCiAgICAgICAgIyAgICAgcGlwZWxpbmVfbGVhZigpCiAgICAgICAgIwogICAgICAgICMgQGRzbC5waXBlbGluZQogICAgICAgICMgZGVmIHBpcGVsaW5lX3Jvb3QoKToKICAgICAgICAjICAgICBwaXBlbGluZV9taWQoKQogICAgICAgICMgICAgIHBpcGVsaW5lX21pZCgpCgogICAgICAgIHJldHVybiBwaXBlbGluZV9sZWFmCgogICAgZGVmIHRlc3RfZHNsX3BpcGVsaW5lX3N3ZWVwX25vZGUoc2VsZiwgY2xpZW50OiBNTENsaWVudCwgcmFuZHN0cjogQ2FsbGFibGVbW3N0cl0sIHN0cl0pIC0\u002BIE5vbmU6CiAgICAgICAgeWFtbF9maWxlID0gIi4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnQueW1sIgoKICAgICAgICBAZHNsLnBpcGVsaW5lCiAgICAgICAgZGVmIHRyYWluX3dpdGhfc3dlZXBfaW5fcGlwZWxpbmUocmF3X2RhdGEsIHByaW1hcnlfbWV0cmljOiBzdHIgPSAiQVVDIiwgbWF4X3RvdGFsX3RyaWFsczogaW50ID0gMTApOgogICAgICAgICAgICBjb21wb25lbnRfdG9fc3dlZXA6IENvbW1hbmRDb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9eWFtbF9maWxlKQogICAgICAgICAgICAjIHRvIGNoZWNrIHRoZSBsb2dpYyB0byBzZXQgZGVmYXVsdCBkaXNwbGF5IG5hbWUgZm9yIGNvbXBvbmVudHMKICAgICAgICAgICAgY29tcG9uZW50X3RvX3N3ZWVwLmRpc3BsYXlfbmFtZSA9IE5vbmUKCiAgICAgICAgICAgIGNtZF9ub2RlMTogQ29tbWFuZCA9IGNvbXBvbmVudF90b19zd2VlcCgKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9Q2hvaWNlKFsyLCAzLCA0LCA1XSksIGNvbXBvbmVudF9pbl9wYXRoPXJhd19kYXRhCiAgICAgICAgICAgICkKCiAgICAgICAgICAgIHN3ZWVwX2pvYjE6IFN3ZWVwID0gY21kX25vZGUxLnN3ZWVwKAogICAgICAgICAgICAgICAgcHJpbWFyeV9tZXRyaWM9IkFVQyIsICAjIHByaW1hcnlfbWV0cmljLAogICAgICAgICAgICAgICAgZ29hbD0ibWF4aW1pemUiLAogICAgICAgICAgICAgICAgc2FtcGxpbmdfYWxnb3JpdGhtPSJyYW5kb20iLAogICAgICAgICAgICApCiAgICAgICAgICAgIHN3ZWVwX2pvYjEuY29tcHV0ZSA9ICJncHUtY2x1c3RlciIKICAgICAgICAgICAgc3dlZXBfam9iMS5zZXRfbGltaXRzKG1heF90b3RhbF90cmlhbHM9MTApICAjIG1heF90b3RhbF90cmlhbHMKCiAgICAgICAgICAgIGNtZF9ub2RlMjogQ29tbWFuZCA9IGNvbXBvbmVudF90b19zd2VlcCgKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9Q2hvaWNlKFsyLCAzLCA0LCA1XSksIGNvbXBvbmVudF9pbl9wYXRoPXJhd19kYXRhCiAgICAgICAgICAgICkKICAgICAgICAgICAgc3dlZXBfam9iMjogU3dlZXAgPSBjbWRfbm9kZTIuc3dlZXAoCiAgICAgICAgICAgICAgICBwcmltYXJ5X21ldHJpYz0iQVVDIiwKICAgICAgICAgICAgICAgIGdvYWw9Im1pbmltaXplIiwKICAgICAgICAgICAgICAgIHNhbXBsaW5nX2FsZ29yaXRobT0icmFuZG9tIiwKICAgICAgICAgICAgICAgIG1heF90b3RhbF90cmlhbHM9MTAsCiAgICAgICAgICAgICkKICAgICAgICAgICAgc3dlZXBfam9iMi5jb21wdXRlID0gImdwdS1jbHVzdGVyIgoKICAgICAgICAgICAgc3dlZXBfam9iMzogU3dlZXAgPSBjb21wb25lbnRfdG9fc3dlZXAoCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyPUNob2ljZShbMiwgMywgNCwgNV0pLCBjb21wb25lbnRfaW5fcGF0aD1yYXdfZGF0YQogICAgICAgICAgICApLnN3ZWVwKAogICAgICAgICAgICAgICAgcHJpbWFyeV9tZXRyaWM9ImFjY3VyYWN5IiwKICAgICAgICAgICAgICAgIGdvYWw9Im1heGltaXplIiwKICAgICAgICAgICAgICAgIHNhbXBsaW5nX2FsZ29yaXRobT0icmFuZG9tIiwKICAgICAgICAgICAgICAgIG1heF90b3RhbF90cmlhbHM9MTAsCiAgICAgICAgICAgICkKCiAgICAgICAgICAgIGNvbXBvbmVudF90b19saW5rID0gbG9hZF9jb21wb25lbnQoc291cmNlPXlhbWxfZmlsZSwgcGFyYW1zX292ZXJyaWRlPVt7Im5hbWUiOiAibm9kZV90b19saW5rIn1dKQogICAgICAgICAgICBsaW5rX25vZGUgPSBjb21wb25lbnRfdG9fbGluaygKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9MiwgY29tcG9uZW50X2luX3BhdGg9c3dlZXBfam9iMS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aAogICAgICAgICAgICApCgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInBpcGVsaW5lX2pvYl9iZXN0X21vZGVsMSI6IHN3ZWVwX2pvYjEub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgsCiAgICAgICAgICAgICAgICAicGlwZWxpbmVfam9iX2Jlc3RfbW9kZWwyIjogc3dlZXBfam9iMi5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwKICAgICAgICAgICAgICAgICJwaXBlbGluZV9qb2JfYmVzdF9tb2RlbDMiOiBzd2VlcF9qb2IzLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLAogICAgICAgICAgICAgICAgInBpcGVsaW5lX21vZGVsX3Rlc3RfcmVzdWx0IjogbGlua19ub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLAogICAgICAgICAgICB9CgogICAgICAgIHBpcGVsaW5lOiBQaXBlbGluZUpvYiA9IHRyYWluX3dpdGhfc3dlZXBfaW5fcGlwZWxpbmUoCiAgICAgICAgICAgIHJhd19kYXRhPWpvYl9pbnB1dCwgbWF4X3RvdGFsX3RyaWFscz0xMDAsIHByaW1hcnlfbWV0cmljPSJhY2N1cmFjeSIKICAgICAgICApCiAgICAgICAgcGlwZWxpbmUuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImNwdS1jbHVzdGVyIgogICAgICAgIGNyZWF0ZWRfcGlwZWxpbmUgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQogICAgICAgIG5hbWUsIHZlcnNpb24gPSBjcmVhdGVkX3BpcGVsaW5lLmpvYnNbInN3ZWVwX2pvYjEiXS50cmlhbC5zcGxpdCgiOiIpCiAgICAgICAgY3JlYXRlZF9jb21wb25lbnQgPSBjbGllbnQuY29tcG9uZW50cy5nZXQobmFtZSwgdmVyc2lvbikKICAgICAgICAjIGtlZXAgb3JpZ2luYWwgY29tcG9uZW50IGRpc3BsYXkgbmFtZSB0byBndWFyYW50ZWUgcmV1c2UKICAgICAgICBhc3NlcnQgY3JlYXRlZF9jb21wb25lbnQuZGlzcGxheV9uYW1lIGlzIE5vbmUKCiAgICBkZWYgdGVzdF9kc2xfcGlwZWxpbmVfY29tcG9uZW50X2NhY2hlX2luX3Jlc29sdmVyKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgaW5wdXRfZGF0YV9wYXRoID0gIi4vdGVzdHMvdGVzdF9jb25maWdzL2RhdGEvIgogICAgICAgIHBpcGVsaW5lX3Jvb3QgPSBzZWxmLl9nZW5lcmF0ZV9tdWx0aV9sYXllcl9waXBlbGluZV9mdW5jKCkKCiAgICAgICAgX3N1Ym1pdF9hbmRfY2FuY2VsID0gcGFydGlhbCgKICAgICAgICAgICAgc3VibWl0X2FuZF9jYW5jZWxfbmV3X2RzbF9waXBlbGluZSwgY2xpZW50PWNsaWVudCwgam9iX2luX3BhdGg9SW5wdXQocGF0aD1pbnB1dF9kYXRhX3BhdGgpCiAgICAgICAgKQoKICAgICAgICBkZWYgX21vY2tfZ2V0X2NvbXBvbmVudF9hcm1faWQoX2NvbXBvbmVudDogQ29tcG9uZW50KSAtPiBzdHI6CiAgICAgICAgICAgICMgdGhlIGxvZ2ljIGhhcyBubyBkaWZmIGNvbXBhcmluZyB0byBvcmlnaW5hbCBmdW5jdGlvbiBvdGhlciB0aGFuIGFsd2F5cyB1c2luZyBzaG93X3Byb2dyZXNzPUZhbHNlCiAgICAgICAgICAgICMganVzdCB0byBtb2NrIHRoZSBmdW5jdGlvbiBhbmQgY2hlY2sgY2FsbCBpbmZvcm1hdGlvbgogICAgICAgICAgICBpZiBub3QgX2NvbXBvbmVudC5pZDoKICAgICAgICAgICAgICAgIF9jb21wb25lbnQuX2lkID0gY2xpZW50LmNvbXBvbmVudHMuY3JlYXRlX29yX3VwZGF0ZSgKICAgICAgICAgICAgICAgICAgICBfY29tcG9uZW50LCBpc19hbm9ueW1vdXM9VHJ1ZSwgc2hvd19wcm9ncmVzcz1GYWxzZQogICAgICAgICAgICAgICAgKS5pZAogICAgICAgICAgICByZXR1cm4gX2NvbXBvbmVudC5pZAoKICAgICAgICB3aXRoIG1vY2sucGF0Y2gub2JqZWN0KAogICAgICAgICAgICBPcGVyYXRpb25PcmNoZXN0cmF0b3IsICJfZ2V0X2NvbXBvbmVudF9hcm1faWQiLCBzaWRlX2VmZmVjdD1fbW9ja19nZXRfY29tcG9uZW50X2FybV9pZAogICAgICAgICkgYXMgbW9ja19yZXNvbHZlOgogICAgICAgICAgICBfc3VibWl0X2FuZF9jYW5jZWwocGlwZWxpbmVfcm9vdCkKICAgICAgICAgICAgIyBwaXBlbGluZV9sZWFmLCBwaXBlbGluZV9taWQgYW5kIDMgY29tbWFuZCBjb21wb25lbnRzIHdpbGwgYmUgcmVzb2x2ZWQKICAgICAgICAgICAgYXNzZXJ0IG1vY2tfcmVzb2x2ZS5jYWxsX2NvdW50ID09IDUKCiAgICAgICAgd2l0aCBtb2NrLnBhdGNoLm9iamVjdCgKICAgICAgICAgICAgT3BlcmF0aW9uT3JjaGVzdHJhdG9yLCAiX2dldF9jb21wb25lbnRfYXJtX2lkIiwgc2lkZV9lZmZlY3Q9X21vY2tfZ2V0X2NvbXBvbmVudF9hcm1faWQKICAgICAgICApIGFzIG1vY2tfcmVzb2x2ZToKICAgICAgICAgICAgX3N1Ym1pdF9hbmRfY2FuY2VsKHBpcGVsaW5lX3Jvb3QpCiAgICAgICAgICAgICMgbm8gbW9yZSByZXF1ZXN0cyB0byByZXNvbHZlIGNvbXBvbmVudHMgYXMgbG9jYWwgY2FjaGUgaXMgaGl0CiAgICAgICAgICAgIGFzc2VydCBtb2NrX3Jlc29sdmUuY2FsbF9jb3VudCA9PSAwCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBpcGVsaW5lX3Jvb3Qoam9iX2luX3BhdGg9SW5wdXQocGF0aD1pbnB1dF9kYXRhX3BhdGgpKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCiAgICAgICAgbGVhZl9zdWJncmFwaCA9IHBpcGVsaW5lX2pvYi5qb2JzWyJwaXBlbGluZV9taWQiXS5jb21wb25lbnQuam9ic1sicGlwZWxpbmVfbGVhZiJdLmNvbXBvbmVudAogICAgICAgIGxlYWZfc3ViZ3JhcGguam9ic1siYW5vdGhlcl9jb21wb25lbnRfbmFtZSJdLmNvbXBvbmVudC5jb21tYW5kICs9ICIgJiBlY2hvIHVwZGF0ZWQyIgogICAgICAgIHdpdGggbW9jay5wYXRjaC5vYmplY3QoCiAgICAgICAgICAgIE9wZXJhdGlvbk9yY2hlc3RyYXRvciwgIl9nZXRfY29tcG9uZW50X2FybV9pZCIsIHNpZGVfZWZmZWN0PV9tb2NrX2dldF9jb21wb25lbnRfYXJtX2lkCiAgICAgICAgKSBhcyBtb2NrX3Jlc29sdmU6CiAgICAgICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQogICAgICAgICAgICAjIHVwZGF0ZWQgY29tbWFuZCBjb21wb25lbnQgYW5kIGl0cyBwYXJlbnRzIChwaXBlbGluZV9sZWFmIGFuZCBwaXBlbGluZV9taWQpIHdpbGwgYmUgcmVzb2x2ZWQKICAgICAgICAgICAgYXNzZXJ0IG1vY2tfcmVzb2x2ZS5jYWxsX2NvdW50ID09IDMKCiAgICBkZWYgdGVzdF9kc2xfcGlwZWxpbmVfY29uY3VycmVudF9jb21wb25lbnRfcmVnaXN0cmF0aW9uKHNlbGYsIGNsaWVudDogTUxDbGllbnQsIG1vY2tlcjogTW9ja0ZpeHR1cmUpIC0\u002BIE5vbmU6CiAgICAgICAgIyBkaXNhYmxlIG9uLWRpc2sgY2FjaGUgdG8gdGVzdCBjb25jdXJyZW50IGNvbXBvbmVudCByZWdpc3RyYXRpb24KICAgICAgICBtb2NrZXIucGF0Y2goImF6dXJlLmFpLm1sLl91dGlscy51dGlscy5pc19vbl9kaXNrX2NhY2hlX2VuYWJsZWQiLCByZXR1cm5fdmFsdWU9RmFsc2UpCgogICAgICAgIGlucHV0X2RhdGFfcGF0aCA9ICIuL3Rlc3RzL3Rlc3RfY29uZmlncy9kYXRhLyIKICAgICAgICBwaXBlbGluZV9yb290ID0gc2VsZi5fZ2VuZXJhdGVfcGlwZWxpbmVfZnVuY19mb3JfY29uY3VycmVudF9jb21wb25lbnRfcmVnaXN0cmF0aW9uX3Rlc3QoCiAgICAgICAgICAgIHNoYXJlZF9pbnB1dD1JbnB1dChwYXRoPWlucHV0X2RhdGFfcGF0aCkKICAgICAgICApCgogICAgICAgIF9zdWJtaXRfYW5kX2NhbmNlbCA9IHBhcnRpYWwoCiAgICAgICAgICAgIHN1Ym1pdF9hbmRfY2FuY2VsX25ld19kc2xfcGlwZWxpbmUsCiAgICAgICAgICAgIGNsaWVudD1jbGllbnQsCiAgICAgICAgKQoKICAgICAgICB0cmVhdG1lbnRfcGlwZWxpbmVfam9iID0gX3N1Ym1pdF9hbmRfY2FuY2VsKHBpcGVsaW5lX3Jvb3QpCgogICAgICAgIHdpdGggbW9jay5wYXRjaCgiYXp1cmUuYWkubWwuX3V0aWxzLnV0aWxzLmlzX2NvbmN1cnJlbnRfY29tcG9uZW50X3JlZ2lzdHJhdGlvbl9lbmFibGVkIiwgcmV0dXJuX3ZhbHVlPUZhbHNlKToKICAgICAgICAgICAgYmFzZV9waXBlbGluZV9qb2IgPSBfc3VibWl0X2FuZF9jYW5jZWwocGlwZWxpbmVfcm9vdCkKCiAgICAgICAgIyBTZXJ2ZXItc2lkZSBkb2VzIG5vdCBndWFyYW50ZWUgdGhlIHNhbWUgYW5vbnltb3VzIHBpcGVsaW5lIGNvbXBvbmVudCBzaGFyZSB0aGUgc2FtZSB2ZXJzaW9uCiAgICAgICAgIyBTbyBvbWl0IG5hbWUgYW5kIHZlcnNpb24gYW5kIGRvIGNvbXBhcmlzb24gbGF5ZXIgYnkgbGF5ZXIKICAgICAgICBvbWl0X2ZpZWxkcyA9IFsiaWQiLCAibmFtZSIsICJ2ZXJzaW9uIiwgImNyZWF0aW9uX2NvbnRleHQiLCAic2VydmljZXMiLCAiam9icy4qLmNvbXBvbmVudCJdCgogICAgICAgIGJhc2UsIHRyZWF0ID0gYmFzZV9waXBlbGluZV9qb2IsIHRyZWF0bWVudF9waXBlbGluZV9qb2IKICAgICAgICAjIFRPRE86IHRlc3Qgd2l0aCBtdWx0aXBsZSBwaXBlbGluZXMgYWZ0ZXIgc2VydmVyLXNpZGUgcmV0dXJuIGpvYnMgZm9yIHBpcGVsaW5lIGNvbXBvbmVudAogICAgICAgIGZvciBfIGluIHJhbmdlKDAsIDApOgogICAgICAgICAgICBhc3NlcnQgb21pdF93aXRoX3dpbGRjYXJkKGJhc2UuX3RvX2RpY3QoKSwgKm9taXRfZmllbGRzKSA9PSBvbWl0X3dpdGhfd2lsZGNhcmQoCiAgICAgICAgICAgICAgICB0cmVhdC5fdG9fZGljdCgpLCAqb21pdF9maWVsZHMKICAgICAgICAgICAgKQogICAgICAgICAgICBiYXNlID0gX2dldF9jb21wb25lbnRfaW5fZmlyc3RfY2hpbGQoYmFzZSwgY2xpZW50KQogICAgICAgICAgICB0cmVhdCA9IF9nZXRfY29tcG9uZW50X2luX2ZpcnN0X2NoaWxkKHRyZWF0LCBjbGllbnQpCgogICAgICAgICMgVGhlIGxhc3QgbGF5ZXIgY29udGFpbnMgdGhlIGNvbW1hbmQgY29tcG9uZW50cwogICAgICAgIG9taXRfZmllbGRzLnBvcCgpCiAgICAgICAgYXNzZXJ0IG9taXRfd2l0aF93aWxkY2FyZChiYXNlLl90b19kaWN0KCksICpvbWl0X2ZpZWxkcykgPT0gb21pdF93aXRoX3dpbGRjYXJkKHRyZWF0Ll90b19kaWN0KCksICpvbWl0X2ZpZWxkcykK",
      "StatusCode": 201,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Content-MD5": "1Eejn94qxLQlrgO40sYwwA==",
        "Date": "Tue, 30 May 2023 07:29:01 GMT",
        "ETag": "\u00220x8DB60DF8A7A1D7C\u0022",
        "Last-Modified": "Tue, 30 May 2023 07:29:02 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-content-crc64": "JlZ2Rw/sEnA=",
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://amltest5899420437.blob.core.windows.net/azureml-blobstore-0bdd51b6-cd9c-4978-b870-99997b393b81/LocalUpload/00000000000000000000000000000000/e2etests/test_dsl_pipeline.py",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "157567",
        "Content-MD5": "vjglRb3ueWA43cCojSpZxA==",
        "Content-Type": "application/octet-stream",
        "If-None-Match": "*",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)",
        "x-ms-blob-type": "BlockBlob",
        "x-ms-date": "Tue, 30 May 2023 07:28:59 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": "aW1wb3J0IGxvZ2dpbmcKZnJvbSBpbyBpbXBvcnQgU3RyaW5nSU8KZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmZyb20gdHlwaW5nIGltcG9ydCBDYWxsYWJsZQpmcm9tIHVuaXR0ZXN0Lm1vY2sgaW1wb3J0IHBhdGNoCgppbXBvcnQgcHlkYXNoCmltcG9ydCBweXRlc3QKZnJvbSBkZXZ0b29sc190ZXN0dXRpbHMgaW1wb3J0IEF6dXJlUmVjb3JkZWRUZXN0Q2FzZSwgaXNfbGl2ZQpmcm9tIHBpcGVsaW5lX2pvYi5lMmV0ZXN0cy50ZXN0X3BpcGVsaW5lX2pvYiBpbXBvcnQgYXNzZXJ0X2pvYl9pbnB1dF9vdXRwdXRfdHlwZXMKZnJvbSB0ZXN0X3V0aWxpdGllcy51dGlscyBpbXBvcnQgKAogICAgX1BZVEVTVF9USU1FT1VUX01FVEhPRCwKICAgIGFzc2VydF9qb2JfY2FuY2VsLAogICAgb21pdF93aXRoX3dpbGRjYXJkLAogICAgc2xlZXBfaWZfbGl2ZSwKKQoKZnJvbSBhenVyZS5haS5tbCBpbXBvcnQgKAogICAgQW1sVG9rZW5Db25maWd1cmF0aW9uLAogICAgSW5wdXQsCiAgICBNYW5hZ2VkSWRlbnRpdHlDb25maWd1cmF0aW9uLAogICAgTUxDbGllbnQsCiAgICBNcGlEaXN0cmlidXRpb24sCiAgICBPdXRwdXQsCiAgICBQeVRvcmNoRGlzdHJpYnV0aW9uLAogICAgVGVuc29yRmxvd0Rpc3RyaWJ1dGlvbiwKICAgIFVzZXJJZGVudGl0eUNvbmZpZ3VyYXRpb24sCiAgICBjb21tYW5kLAogICAgZHNsLAogICAgbG9hZF9jb21wb25lbnQsCikKZnJvbSBhenVyZS5haS5tbC5fdXRpbHMuX2FybV9pZF91dGlscyBpbXBvcnQgKAogICAgaXNfQVJNX2lkX2Zvcl9yZXNvdXJjZSwKICAgIGlzX3Npbmd1bGFyaXR5X2lkX2Zvcl9yZXNvdXJjZSwKKQpmcm9tIGF6dXJlLmFpLm1sLmNvbnN0YW50cy5fY29tbW9uIGltcG9ydCAoCiAgICBBTk9OWU1PVVNfQ09NUE9ORU5UX05BTUUsCiAgICBTSU5HVUxBUklUWV9JRF9GT1JNQVQsCiAgICBBc3NldFR5cGVzLAogICAgSW5wdXRPdXRwdXRNb2RlcywKKQpmcm9tIGF6dXJlLmFpLm1sLmNvbnN0YW50cy5fam9iLnBpcGVsaW5lIGltcG9ydCBQaXBlbGluZUNvbnN0YW50cwpmcm9tIGF6dXJlLmFpLm1sLmRzbC5fZ3JvdXBfZGVjb3JhdG9yIGltcG9ydCBncm91cApmcm9tIGF6dXJlLmFpLm1sLmRzbC5fbG9hZF9pbXBvcnQgaW1wb3J0IHRvX2NvbXBvbmVudApmcm9tIGF6dXJlLmFpLm1sLmVudGl0aWVzIGltcG9ydCBDb21tYW5kQ29tcG9uZW50LCBDb21tYW5kSm9iCmZyb20gYXp1cmUuYWkubWwuZW50aXRpZXMgaW1wb3J0IENvbXBvbmVudApmcm9tIGF6dXJlLmFpLm1sLmVudGl0aWVzIGltcG9ydCBDb21wb25lbnQgYXMgQ29tcG9uZW50RW50aXR5CmZyb20gYXp1cmUuYWkubWwuZW50aXRpZXMgaW1wb3J0ICgKICAgIERhdGEsCiAgICBKb2JSZXNvdXJjZUNvbmZpZ3VyYXRpb24sCiAgICBQaXBlbGluZUpvYiwKICAgIFF1ZXVlU2V0dGluZ3MsCikKZnJvbSBhenVyZS5haS5tbC5leGNlcHRpb25zIGltcG9ydCBVbmV4cGVjdGVkS2V5d29yZEVycm9yLCBWYWxpZGF0aW9uRXhjZXB0aW9uCmZyb20gYXp1cmUuYWkubWwucGFyYWxsZWwgaW1wb3J0IFBhcmFsbGVsSm9iLCBSdW5GdW5jdGlvbiwgcGFyYWxsZWxfcnVuX2Z1bmN0aW9uCgpmcm9tIC4uX3V0aWwgaW1wb3J0IF9EU0xfVElNRU9VVF9TRUNPTkQKCnRlc3RzX3Jvb3RfZGlyID0gUGF0aChfX2ZpbGVfXykucGFyZW50LnBhcmVudC5wYXJlbnQKY29tcG9uZW50c19kaXIgPSB0ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy8iCmpvYl9pbnB1dCA9IElucHV0KAogICAgdHlwZT1Bc3NldFR5cGVzLlVSSV9GSUxFLAogICAgcGF0aD0iaHR0cHM6Ly9kcHJlcGRhdGEuYmxvYi5jb3JlLndpbmRvd3MubmV0L2RlbW8vVGl0YW5pYy5jc3YiLAopCmV4cGVyaW1lbnRfbmFtZSA9ICJkc2xfcGlwZWxpbmVfZTJlIgpjb21tb25fb21pdF9maWVsZHMgPSBbCiAgICAicHJvcGVydGllcyIsCiAgICAiZGlzcGxheV9uYW1lIiwKICAgICJleHBlcmltZW50X25hbWUiLAogICAgImpvYnMuKi5jb21wb25lbnRJZCIsCiAgICAiaW5wdXRzLioudXJpIiwKICAgICJqb2JzLiouX3NvdXJjZSIsCiAgICAiam9icy4qLnByb3BlcnRpZXMiLAogICAgInNldHRpbmdzLl9zb3VyY2UiLAogICAgInNvdXJjZV9qb2JfaWQiLAogICAgInNlcnZpY2VzIiwKXQoKCmRlZiBjaGVja19uYW1lX2FuZF92ZXJzaW9uKG91dHB1dCwgb3V0cHV0X25hbWUsIG91dHB1dF92ZXJzaW9uKToKICAgIGFzc2VydCBvdXRwdXQubmFtZSA9PSBvdXRwdXRfbmFtZQogICAgYXNzZXJ0IG91dHB1dC52ZXJzaW9uID09IG91dHB1dF92ZXJzaW9uCgoKZGVmIGJ1aWxkX3BpcGVsaW5lX3dpdGhfcGFyYWxsZWxfcnVuX2Z1bmN0aW9uKGRhdGEsIGxpdGVyYWxfaW5wdXQ9Tm9uZSk6CiAgICAjIGNvbW1hbmQgam9iIHdpdGggZGljdCBkaXN0cmlidXRpb24KICAgIGVudmlyb25tZW50ID0gIkF6dXJlTUwtc2tsZWFybi0xLjAtdWJ1bnR1MjAuMDQtcHkzOC1jcHU6MzMiCiAgICBpbnB1dHMgPSB7CiAgICAgICAgImpvYl9kYXRhX3BhdGgiOiBJbnB1dCgKICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgIHBhdGg9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2RhdGFzZXQvbW5pc3QtZGF0YSIsCiAgICAgICAgICAgIG1vZGU9SW5wdXRPdXRwdXRNb2Rlcy5FVkFMX01PVU5ULAogICAgICAgICksCiAgICAgICAgImpvYl9kYXRhX3BhdGhfb3B0aW9uYWwiOiBJbnB1dCgKICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgIG1vZGU9SW5wdXRPdXRwdXRNb2Rlcy5FVkFMX01PVU5ULAogICAgICAgICAgICBvcHRpb25hbD1UcnVlLAogICAgICAgICksCiAgICB9CiAgICBpbnB1dF9kYXRhID0gIiR7e2lucHV0cy5qb2JfZGF0YV9wYXRofX0iCiAgICBvdXRwdXRzID0geyJqb2Jfb3V0cHV0X3BhdGgiOiBPdXRwdXQodHlwZT1Bc3NldFR5cGVzLlVSSV9GT0xERVIsIG1vZGU9InJ3X21vdW50Iil9CiAgICBleHBlY3RlZF9yZXNvdXJjZXMgPSB7Imluc3RhbmNlX2NvdW50IjogMn0KCiAgICB0YXNrID0gUnVuRnVuY3Rpb24oCiAgICAgICAgY29kZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvZHNsX3BpcGVsaW5lL3BhcmFsbGVsX2NvbXBvbmVudF93aXRoX2ZpbGVfaW5wdXQvc3JjLyIsCiAgICAgICAgZW50cnlfc2NyaXB0PSJzY29yZS5weSIsCiAgICAgICAgcHJvZ3JhbV9hcmd1bWVudHM9Ii0tam9iX291dHB1dF9wYXRoICR7e291dHB1dHMuam9iX291dHB1dF9wYXRofX0iLAogICAgICAgIGVudmlyb25tZW50PWVudmlyb25tZW50LAogICAgKQogICAgbG9nZ2luZ19sZXZlbCA9ICJERUJVRyIKICAgIG1heF9jb25jdXJyZW5jeV9wZXJfaW5zdGFuY2UgPSAxCiAgICBlcnJvcl90aHJlc2hvbGQgPSAxCiAgICBtaW5pX2JhdGNoX2Vycm9yX3RocmVzaG9sZCA9IDEKICAgIG1pbmlfYmF0Y2hfc2l6ZSA9ICI1IgoKICAgICMgUGFyYWxsZWwgZnJvbSBwYXJhbGxlbF9ydW5fZnVuY3Rpb24oKQogICAgcGFyYWxsZWxfZnVuY3Rpb24gPSBwYXJhbGxlbF9ydW5fZnVuY3Rpb24oCiAgICAgICAgZGlzcGxheV9uYW1lPSJteS1ldmFsdWF0ZS1qb2IiLAogICAgICAgIGlucHV0cz1pbnB1dHMsCiAgICAgICAgb3V0cHV0cz1vdXRwdXRzLAogICAgICAgIG1pbmlfYmF0Y2hfc2l6ZT1taW5pX2JhdGNoX3NpemUsCiAgICAgICAgdGFzaz10YXNrLAogICAgICAgIGxvZ2dpbmdfbGV2ZWw9bG9nZ2luZ19sZXZlbCwKICAgICAgICBtYXhfY29uY3VycmVuY3lfcGVyX2luc3RhbmNlPW1heF9jb25jdXJyZW5jeV9wZXJfaW5zdGFuY2UsCiAgICAgICAgZXJyb3JfdGhyZXNob2xkPWVycm9yX3RocmVzaG9sZCwKICAgICAgICBtaW5pX2JhdGNoX2Vycm9yX3RocmVzaG9sZD1taW5pX2JhdGNoX2Vycm9yX3RocmVzaG9sZCwKICAgICAgICByZXNvdXJjZXM9ZXhwZWN0ZWRfcmVzb3VyY2VzLAogICAgICAgIGlucHV0X2RhdGE9aW5wdXRfZGF0YSwKICAgICkKICAgIGlmIGxpdGVyYWxfaW5wdXQgaXMgTm9uZToKCiAgICAgICAgQGRzbC5waXBlbGluZShleHBlcmltZW50X25hbWU9InRlc3RfcGlwZWxpbmVfd2l0aF9wYXJhbGxlbF9mdW5jdGlvbiIsIGRlZmF1bHRfY29tcHV0ZT0iY3B1LWNsdXN0ZXIiKQogICAgICAgIGRlZiBwYXJhbGxlbF9pbl9waXBlbGluZShqb2JfZGF0YV9wYXRoKToKICAgICAgICAgICAgbm9kZTEgPSBwYXJhbGxlbF9mdW5jdGlvbihqb2JfZGF0YV9wYXRoPWpvYl9kYXRhX3BhdGgpCiAgICAgICAgICAgICMgVE9ETyAyMTA0MjQ3OiBub2RlMS50YXNrIHdpbGwgYmUga2VwdCBhcyBhIGxvY2FsIHBhdGggd2hlbiBzdWJtaXR0aW5nIHRoZSBwaXBlbGluZSBqb2IuCiAgICAgICAgICAgIG5vZGUxLnRhc2sgPSBOb25lCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAicGlwZWxpbmVfb3V0cHV0Ijogbm9kZTEub3V0cHV0cy5qb2Jfb3V0cHV0X3BhdGgsCiAgICAgICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHBhcmFsbGVsX2luX3BpcGVsaW5lKGRhdGEpCiAgICBlbHNlOgoKICAgICAgICBAZHNsLnBpcGVsaW5lKGV4cGVyaW1lbnRfbmFtZT0idGVzdF9waXBlbGluZV93aXRoX3BhcmFsbGVsX2Z1bmN0aW9uIiwgZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIpCiAgICAgICAgZGVmIHBhcmFsbGVsX2luX3BpcGVsaW5lKGpvYl9kYXRhX3BhdGgsIGxpdGVyYWxfaW5wdXQpOgogICAgICAgICAgICBub2RlMSA9IHBhcmFsbGVsX2Z1bmN0aW9uKGpvYl9kYXRhX3BhdGg9am9iX2RhdGFfcGF0aCkKICAgICAgICAgICAgIyBUT0RPIDIxMDQyNDc6IG5vZGUxLnRhc2sgd2lsbCBiZSBrZXB0IGFzIGEgbG9jYWwgcGF0aCB3aGVuIHN1Ym1pdHRpbmcgdGhlIHBpcGVsaW5lIGpvYi4KICAgICAgICAgICAgbm9kZTEudGFzayA9IE5vbmUKICAgICAgICAgICAgbm9kZTEucmVzb3VyY2VzLmluc3RhbmNlX2NvdW50ID0gbGl0ZXJhbF9pbnB1dAogICAgICAgICAgICBub2RlMS5tYXhfY29uY3VycmVuY3lfcGVyX2luc3RhbmNlID0gbGl0ZXJhbF9pbnB1dAogICAgICAgICAgICBub2RlMS5lcnJvcl90aHJlc2hvbGQgPSBsaXRlcmFsX2lucHV0CiAgICAgICAgICAgIG5vZGUxLm1pbmlfYmF0Y2hfZXJyb3JfdGhyZXNob2xkID0gbGl0ZXJhbF9pbnB1dAogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInBpcGVsaW5lX291dHB1dCI6IG5vZGUxLm91dHB1dHMuam9iX291dHB1dF9wYXRoLAogICAgICAgICAgICB9CgogICAgICAgIHJldHVybiBwYXJhbGxlbF9pbl9waXBlbGluZShkYXRhLCBsaXRlcmFsX2lucHV0KQoKCkBweXRlc3QubWFyay51c2VmaXh0dXJlcygKICAgICJlbmFibGVfZW52aXJvbm1lbnRfaWRfYXJtX2V4cGFuc2lvbiIsCiAgICAiZW5hYmxlX3BpcGVsaW5lX3ByaXZhdGVfcHJldmlld19mZWF0dXJlcyIsCiAgICAiZW5hYmxlX3ByaXZhdGVfcHJldmlld19zY2hlbWFfZmVhdHVyZXMiLAogICAgIm1vY2tfY29kZV9oYXNoIiwKICAgICJtb2NrX2NvbXBvbmVudF9oYXNoIiwKICAgICJtb2NrX3NldF9oZWFkZXJzX3dpdGhfdXNlcl9hbWxfdG9rZW4iLAogICAgInJlY29yZGVkX3Rlc3QiLAogICAgIm1vY2tfYXNzZXRfbmFtZSIsCikKQHB5dGVzdC5tYXJrLnRpbWVvdXQodGltZW91dD1fRFNMX1RJTUVPVVRfU0VDT05ELCBtZXRob2Q9X1BZVEVTVF9USU1FT1VUX01FVEhPRCkKQHB5dGVzdC5tYXJrLmUyZXRlc3QKQHB5dGVzdC5tYXJrLnBpcGVsaW5lX3Rlc3QKY2xhc3MgVGVzdERTTFBpcGVsaW5lKEF6dXJlUmVjb3JkZWRUZXN0Q2FzZSk6CiAgICBkZWYgdGVzdF9jb21tYW5kX2NvbXBvbmVudF9jcmVhdGUoc2VsZiwgY2xpZW50OiBNTENsaWVudCwgcmFuZHN0cjogQ2FsbGFibGVbW3N0cl0sIHN0cl0pIC0\u002BIE5vbmU6CiAgICAgICAgY29tcG9uZW50X3lhbWwgPSBjb21wb25lbnRzX2RpciAvICJoZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiCiAgICAgICAgY29tcG9uZW50X2Z1bmMxID0gbG9hZF9jb21wb25lbnQoc291cmNlPWNvbXBvbmVudF95YW1sLCBwYXJhbXNfb3ZlcnJpZGU9W3sibmFtZSI6IHJhbmRzdHIoImNvbXBvbmVudF9uYW1lIil9XSkKICAgICAgICBjb21wb25lbnRfZnVuYzIgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Y29tcG9uZW50X3lhbWwsIHBhcmFtc19vdmVycmlkZT1beyJuYW1lIjogcmFuZHN0cigiY29tcG9uZW50X25hbWUiKX1dKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBuYW1lPXJhbmRzdHIoInBpcGVsaW5lX25hbWUiKSwKICAgICAgICAgICAgZGVzY3JpcHRpb249IlRoZSBoZWxsbyB3b3JsZCBwaXBlbGluZSBqb2IiLAogICAgICAgICAgICB0YWdzPXsib3duZXIiOiAic2RrdGVhbSIsICJ0YWciOiAidGFndmFsdWUifSwKICAgICAgICAgICAgY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICAgICBleHBlcmltZW50X25hbWU9ZXhwZXJpbWVudF9uYW1lLAogICAgICAgICAgICBjb250aW51ZV9vbl9zdGVwX2ZhaWx1cmU9VHJ1ZSwKICAgICAgICApCiAgICAgICAgZGVmIHBpcGVsaW5lKGpvYl9pbl9udW1iZXIsIGpvYl9pbl9vdGhlcl9udW1iZXIsIGpvYl9pbl9wYXRoKToKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMxKGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9am9iX2luX3BhdGgpCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMihjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9vdGhlcl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lKDEwLCAxNSwgam9iX2lucHV0KQogICAgICAgIGpvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUpCiAgICAgICAgIyBjaGVjayByZXF1aXJlZCBmaWVsZHMgaW4gam9iIGRpY3QKICAgICAgICBqb2JfZGljdCA9IGpvYi5fdG9fZGljdCgpCiAgICAgICAgZXhwZWN0ZWRfa2V5cyA9IFsic3RhdHVzIiwgInByb3BlcnRpZXMiLCAidGFncyIsICJjcmVhdGlvbl9jb250ZXh0Il0KICAgICAgICBmb3IgayBpbiBleHBlY3RlZF9rZXlzOgogICAgICAgICAgICBhc3NlcnQgayBpbiBqb2JfZGljdC5rZXlzKCksIGYiZmFpbGVkIHRvIGdldCB7a30gaW4ge2pvYl9kaWN0fSIKCiAgICAgICAgIyBvcmlnaW5hbCBqb2IgZGlkIG5vdCBjaGFuZ2UKICAgICAgICBhc3NlcnRfam9iX2lucHV0X291dHB1dF90eXBlcyhqb2IpCiAgICAgICAgYXNzZXJ0IGpvYi5zZXR0aW5ncy5jb250aW51ZV9vbl9zdGVwX2ZhaWx1cmUgaXMgVHJ1ZQogICAgICAgIGFzc2VydCBqb2IuY29tcHV0ZSA9PSAiY3B1LWNsdXN0ZXIiCgogICAgZGVmIHRlc3RfcGlwZWxpbmVfam9iX2NyZWF0ZV93aXRoX3Jlc29sdmVfcmV1c2Uoc2VsZiwgY2xpZW50OiBNTENsaWVudCwgcmFuZHN0cjogQ2FsbGFibGVbW3N0cl0sIHN0cl0pIC0\u002BIE5vbmU6CiAgICAgICAgY29tcG9uZW50X3lhbWwgPSBjb21wb25lbnRzX2RpciAvICJoZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiCiAgICAgICAgY29tcG9uZW50X2Z1bmMxOiBDb21tYW5kQ29tcG9uZW50ID0gbG9hZF9jb21wb25lbnQoc291cmNlPWNvbXBvbmVudF95YW1sKQogICAgICAgIGNvbXBvbmVudF9mdW5jMjogQ29tbWFuZENvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1jb21wb25lbnRfeWFtbCkKICAgICAgICBjb21wb25lbnRfZnVuYzM6IENvbW1hbmRDb21wb25lbnQgPSBjb21wb25lbnRfZnVuYzEKCiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgbmFtZT1yYW5kc3RyKCJwaXBlbGluZV9uYW1lIiksCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJUaGUgaGVsbG8gd29ybGQgcGlwZWxpbmUgam9iIiwKICAgICAgICAgICAgdGFncz17Im93bmVyIjogInNka3RlYW0iLCAidGFnIjogInRhZ3ZhbHVlIn0sCiAgICAgICAgICAgIGNvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICAgICAgZXhwZXJpbWVudF9uYW1lPWV4cGVyaW1lbnRfbmFtZSwKICAgICAgICAgICAgY29udGludWVfb25fc3RlcF9mYWlsdXJlPVRydWUsCiAgICAgICAgKQogICAgICAgIGRlZiBwaXBlbGluZShqb2JfaW5fbnVtYmVyLCBqb2JfaW5fb3RoZXJfbnVtYmVyLCBqb2JfaW5fcGF0aCk6CiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMShjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQogICAgICAgICAgICBjb21wb25lbnRfZnVuYzMoY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fb3RoZXJfbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aCkKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMxKGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX290aGVyX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9am9iX2luX3BhdGgpCgogICAgICAgICAgICBjb21wb25lbnRfZnVuYzIoY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fb3RoZXJfbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aCkKCiAgICAgICAgZHNsX3BpcGVsaW5lID0gcGlwZWxpbmUoMTAsIDE1LCBqb2JfaW5wdXQpCiAgICAgICAgY29tcG9uZW50X2lkX3NldCA9IHNldChtYXAobGFtYmRhIHg6IGlkKHguY29tcG9uZW50KSwgZHNsX3BpcGVsaW5lLmpvYnMudmFsdWVzKCkpKQogICAgICAgIGFzc2VydCBsZW4oY29tcG9uZW50X2lkX3NldCkgPT0gMgoKICAgICAgICBmb3Igam9iX2luc3RhbmNlIGluIGRzbF9waXBlbGluZS5qb2JzLnZhbHVlcygpOgogICAgICAgICAgICBhc3NlcnQgam9iX2luc3RhbmNlLmNvbXBvbmVudC5pZCBpcyBOb25lLCAiY29tcG9uZW50IGlkIHdvbid0IGJlIHJlc29sdmVkIGJlZm9yZSBjcmVhdGVfb3JfdXBkYXRlIgoKICAgICAgICAjIFRPRE86IG5lZWQgZXh0cmEgbW9jayBiYXNlZCB0ZXN0cyB0byB2ZXJpZnkgaWYgdGhlIGNvbXBvbmVudCBpcyByZXNvbHZlZCBvbmx5IG9uY2UKICAgICAgICBfID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShkc2xfcGlwZWxpbmUpCiAgICAgICAgZm9yIGpvYl9pbnN0YW5jZSBpbiBkc2xfcGlwZWxpbmUuam9icy52YWx1ZXMoKToKICAgICAgICAgICAgYXNzZXJ0ICgKICAgICAgICAgICAgICAgIGlzaW5zdGFuY2Uoam9iX2luc3RhbmNlLmNvbXBvbmVudCwgc3RyKSBvciBqb2JfaW5zdGFuY2UuY29tcG9uZW50LmlkIGlzIG5vdCBOb25lCiAgICAgICAgICAgICksICJjb21wb25lbnQgaWQgd2lsbCBiZSBmaWxsZWQgYmFjayB0byB0aGUgaW5zdGFuY2UgZHVyaW5nIGNyZWF0ZV9vcl91cGRhdGUiCgogICAgZGVmIHRlc3RfY29tbWFuZF9jb21wb25lbnRfY3JlYXRlX3dpdGhfb3V0cHV0KHNlbGYsIGNsaWVudDogTUxDbGllbnQsIHJhbmRzdHI6IENhbGxhYmxlW1tzdHJdLCBzdHJdKSAtPiBOb25lOgogICAgICAgIGNvbXBvbmVudF95YW1sID0gY29tcG9uZW50c19kaXIgLyAiaGVsbG93b3JsZF9jb21wb25lbnQueW1sIgogICAgICAgIGNvbXBvbmVudF9mdW5jMSA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1jb21wb25lbnRfeWFtbCwgcGFyYW1zX292ZXJyaWRlPVt7Im5hbWUiOiByYW5kc3RyKCJjb21wb25lbnRfbmFtZSIpfV0pCiAgICAgICAgY29tcG9uZW50X2Z1bmMyID0gbG9hZF9jb21wb25lbnQoc291cmNlPWNvbXBvbmVudF95YW1sLCBwYXJhbXNfb3ZlcnJpZGU9W3sibmFtZSI6IHJhbmRzdHIoImNvbXBvbmVudF9uYW1lIil9XSkKCiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgbmFtZT1yYW5kc3RyKCJwaXBlbGluZV9uYW1lIiksCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJUaGUgaGVsbG8gd29ybGQgcGlwZWxpbmUgam9iIiwKICAgICAgICAgICAgdGFncz17Im93bmVyIjogInNka3RlYW0iLCAidGFnIjogInRhZ3ZhbHVlIn0sCiAgICAgICAgICAgIGNvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICApCiAgICAgICAgZGVmIHBpcGVsaW5lX3dpdGhfb3V0cHV0KGpvYl9pbl9udW1iZXIsIGpvYl9pbl9vdGhlcl9udW1iZXIsIGpvYl9pbl9wYXRoKToKICAgICAgICAgICAgbm9kZTEgPSBjb21wb25lbnRfZnVuYzEoY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aCkKCiAgICAgICAgICAgIG5vZGUyID0gY29tcG9uZW50X2Z1bmMyKAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fb3RoZXJfbnVtYmVyLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9bm9kZTEub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgsCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIHsiam9iX291dF9kYXRhIjogbm9kZTIub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9CgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmVfd2l0aF9vdXRwdXQoMTAsIDE1LCBqb2JfaW5wdXQpCiAgICAgICAgcGlwZWxpbmUub3V0cHV0cy5qb2Jfb3V0X2RhdGEgPSBPdXRwdXQoZGF0YXNldD1EYXRhKG5hbWU9ImRzbF9waXBlbGluZV9vdXRwdXQiLCB2ZXJzaW9uPSIxIikpCiAgICAgICAgY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSwgZXhwZXJpbWVudF9uYW1lPWV4cGVyaW1lbnRfbmFtZSkKCiAgICBkZWYgdGVzdF9jb21tYW5kX2NvbXBvbmVudF9jcmVhdGVfZnJvbV9yZW1vdGUoCiAgICAgICAgc2VsZiwKICAgICAgICBjbGllbnQ6IE1MQ2xpZW50LAogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudDogQ29tcG9uZW50RW50aXR5LAogICAgICAgIHJhbmRzdHI6IENhbGxhYmxlW1tzdHJdLCBzdHJdLAogICAgKSAtPiBOb25lOgogICAgICAgIGNvbXBvbmVudF9mdW5jID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgIGNsaWVudD1jbGllbnQsCiAgICAgICAgICAgIG5hbWU9aGVsbG9fd29ybGRfY29tcG9uZW50Lm5hbWUsCiAgICAgICAgICAgIHZlcnNpb249aGVsbG9fd29ybGRfY29tcG9uZW50LnZlcnNpb24sCiAgICAgICAgKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBuYW1lPXJhbmRzdHIoInBpcGVsaW5lX25hbWUiKSwKICAgICAgICAgICAgZGVzY3JpcHRpb249IlRoZSBoZWxsbyB3b3JsZCBwaXBlbGluZSBqb2IiLAogICAgICAgICAgICB0YWdzPXsib3duZXIiOiAic2RrdGVhbSIsICJ0YWciOiAidGFndmFsdWUifSwKICAgICAgICAgICAgY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICkKICAgICAgICBkZWYgcGlwZWxpbmVfcmVtb3RlX2NvbXBvbmVudChqb2JfaW5fbnVtYmVyLCBqb2JfaW5fb3RoZXJfbnVtYmVyLCBqb2JfaW5fcGF0aCk6CiAgICAgICAgICAgIG5vZGUxID0gY29tcG9uZW50X2Z1bmMoY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aCkKICAgICAgICAgICAgIyB1bi1jb25maWd1cmVkIGRhdGEgYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkCiAgICAgICAgICAgIG5vZGUxLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoID0gT3V0cHV0KGRhdGFzZXQ9RGF0YShuYW1lPSJtbGRlc2lnbmVyX2NvbXBvbmVudF9vdXRwdXQiKSkKCiAgICAgICAgICAgIG5vZGUyID0gY29tcG9uZW50X2Z1bmMoCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9vdGhlcl9udW1iZXIsCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fcGF0aD1ub2RlMS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4geyJqb2Jfb3V0X2RhdGEiOiBub2RlMi5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH0KCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV9yZW1vdGVfY29tcG9uZW50KDEwLCAxNSwgam9iX2lucHV0KQogICAgICAgIGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUsIGV4cGVyaW1lbnRfbmFtZT1leHBlcmltZW50X25hbWUpCgogICAgZGVmIHRlc3RfY29tcG9uZW50X2xvYWRfZnJvbV9yZW1vdGUoc2VsZiwgY2xpZW50OiBNTENsaWVudCwgaGVsbG9fd29ybGRfY29tcG9uZW50OiBDb21wb25lbnRFbnRpdHkpIC0\u002BIE5vbmU6CiAgICAgICAgY29tcG9uZW50X2Z1bmMgPSBsb2FkX2NvbXBvbmVudCgKICAgICAgICAgICAgY2xpZW50PWNsaWVudCwKICAgICAgICAgICAgbmFtZT1oZWxsb193b3JsZF9jb21wb25lbnQubmFtZSwKICAgICAgICAgICAgdmVyc2lvbj1oZWxsb193b3JsZF9jb21wb25lbnQudmVyc2lvbiwKICAgICAgICApCgogICAgICAgIGNvbXBvbmVudF9ub2RlID0gY29tcG9uZW50X2Z1bmMoY29tcG9uZW50X2luX251bWJlcj0xMCwgY29tcG9uZW50X2luX3BhdGg9am9iX2lucHV0KQoKICAgICAgICBjb21wb25lbnRfam9iX2RpY3QgPSBjb21wb25lbnRfbm9kZS5fdG9fcmVzdF9vYmplY3QoKQogICAgICAgIGFzc2VydCBpc19BUk1faWRfZm9yX3Jlc291cmNlKGNvbXBvbmVudF9qb2JfZGljdFsiY29tcG9uZW50SWQiXSkKICAgICAgICBvbWl0X2ZpZWxkcyA9IFsiY29tcG9uZW50SWQiLCAiX3NvdXJjZSIsICJwcm9wZXJ0aWVzIl0KICAgICAgICBjb21wb25lbnRfam9iX2RpY3QgPSBweWRhc2gub21pdChjb21wb25lbnRfam9iX2RpY3QsICpvbWl0X2ZpZWxkcykKICAgICAgICBhc3NlcnQgY29tcG9uZW50X2pvYl9kaWN0ID09IHsKICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fbnVtYmVyIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjEwIn0sCiAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX3BhdGgiOiB7CiAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogInVyaV9maWxlIiwKICAgICAgICAgICAgICAgICAgICAidXJpIjogImh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJyZXNvdXJjZXMiOiB7Imluc3RhbmNlX2NvdW50IjogMX0sCiAgICAgICAgICAgICJ0eXBlIjogImNvbW1hbmQiLAogICAgICAgIH0KCiAgICBkZWYgdGVzdF9kaXN0cmlidXRpb25fY29tcG9uZW50cyhzZWxmLCBjbGllbnQ6IE1MQ2xpZW50LCByYW5kc3RyOiBDYWxsYWJsZVtbc3RyXSwgc3RyXSkgLT4gTm9uZToKICAgICAgICBtcGlfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1zdHIoY29tcG9uZW50c19kaXIgLyAiaGVsbG93b3JsZF9jb21wb25lbnRfbXBpLnltbCIpKQogICAgICAgIHB5dG9yY2hfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1zdHIoY29tcG9uZW50c19kaXIgLyAiaGVsbG93b3JsZF9jb21wb25lbnRfcHl0b3JjaC55bWwiKSkKICAgICAgICB0ZW5zb3JmbG93X2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9c3RyKGNvbXBvbmVudHNfZGlyIC8gImhlbGxvd29ybGRfY29tcG9uZW50X3RlbnNvcmZsb3cueW1sIikpCgogICAgICAgIEBkc2wucGlwZWxpbmUoCiAgICAgICAgICAgIG5hbWU9cmFuZHN0cigicGlwZWxpbmVfbmFtZSIpLAogICAgICAgICAgICBkZXNjcmlwdGlvbj0iVGhlIGhlbGxvIHdvcmxkIHBpcGVsaW5lIGpvYiIsCiAgICAgICAgICAgIHRhZ3M9eyJvd25lciI6ICJzZGt0ZWFtIiwgInRhZyI6ICJ0YWd2YWx1ZSJ9LAogICAgICAgICAgICBjb21wdXRlPSJncHUtY2x1c3RlciIsCiAgICAgICAgICAgIGV4cGVyaW1lbnRfbmFtZT1leHBlcmltZW50X25hbWUsCiAgICAgICAgKQogICAgICAgIGRlZiBwaXBlbGluZV9kaXN0cmlidXRpb25fY29tcG9uZW50cyhqb2JfaW5fbnVtYmVyLCBqb2JfaW5fcGF0aCk6CiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9tcGkgPSBtcGlfZnVuYyhjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQogICAgICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfbXBpLmRpc3RyaWJ1dGlvbiA9IE1waURpc3RyaWJ1dGlvbigpCiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9tcGkuZGlzdHJpYnV0aW9uLnByb2Nlc3NfY291bnRfcGVyX2luc3RhbmNlID0gMgoKICAgICAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X3B5dG9yY2ggPSBweXRvcmNoX2Z1bmMoCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoCiAgICAgICAgICAgICkKICAgICAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X3B5dG9yY2guZGlzdHJpYnV0aW9uID0gUHlUb3JjaERpc3RyaWJ1dGlvbigpCiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9weXRvcmNoLmRpc3RyaWJ1dGlvbi5wcm9jZXNzX2NvdW50X3Blcl9pbnN0YW5jZSA9IDIKCiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF90ZW5zb3JmbG93ID0gdGVuc29yZmxvd19mdW5jKAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aAogICAgICAgICAgICApCiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF90ZW5zb3JmbG93LmRpc3RyaWJ1dGlvbiA9IFRlbnNvckZsb3dEaXN0cmlidXRpb24oKQogICAgICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfdGVuc29yZmxvdy5kaXN0cmlidXRpb24ud29ya2VyX2NvdW50ID0gMgoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX2Rpc3RyaWJ1dGlvbl9jb21wb25lbnRzKDEwLCBqb2JfaW5wdXQpCiAgICAgICAgY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSwgZXhwZXJpbWVudF9uYW1lPWV4cGVyaW1lbnRfbmFtZSkKCiAgICBkZWYgdGVzdF9jb21wb25lbnRfd2l0aF9iaW5kaW5nKHNlbGYsIGNsaWVudDogTUxDbGllbnQsIHJhbmRzdHI6IENhbGxhYmxlW1tzdHJdLCBzdHJdKToKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfeWFtbCA9IHN0cihjb21wb25lbnRzX2RpciAvICJoZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiKQogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPWhlbGxvX3dvcmxkX2NvbXBvbmVudF95YW1sKQoKICAgICAgICBtZXJnZV9vdXRwdXRzX2NvbXBvbmVudF95YW1sID0gc3RyKGNvbXBvbmVudHNfZGlyIC8gIm1lcmdlX291dHB1dHNfY29tcG9uZW50LnltbCIpCiAgICAgICAgbWVyZ2Vfb3V0cHV0c19jb21wb25lbnRfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1tZXJnZV9vdXRwdXRzX2NvbXBvbmVudF95YW1sKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBuYW1lPXJhbmRzdHIoInBpcGVsaW5lX25hbWUiKSwKICAgICAgICAgICAgZGVzY3JpcHRpb249IlRoZSBoZWxsbyB3b3JsZCBwaXBlbGluZSBqb2IiLAogICAgICAgICAgICB0YWdzPXsib3duZXIiOiAic2RrdGVhbSIsICJ0YWciOiAidGFndmFsdWUifSwKICAgICAgICAgICAgY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICkKICAgICAgICBkZWYgcGlwZWxpbmVfd2l0aF9iaW5kaW5nKGpvYl9pbl9udW1iZXIsIGpvYl9pbl9vdGhlcl9udW1iZXIsIGpvYl9pbl9wYXRoKToKICAgICAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50XzEgPSBoZWxsb193b3JsZF9jb21wb25lbnRfZnVuYygKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9am9iX2luX3BhdGgKICAgICAgICAgICAgKQogICAgICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfMiA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudF9mdW5jKAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aAogICAgICAgICAgICApCgogICAgICAgICAgICAjIGNvbmZpZ3VyZSBjb21wb25lbnQgb3ZlcnJpZGVzLCBjdXJhdGVkIFNESyBub3Qgc3VwcG9ydGVkIHlldAogICAgICAgICAgICAjIGhlbGxvX3dvcmxkX2NvbXBvbmVudF8yLnJlc291cmNlcy5pbnN0YW5jZV9jb3VudCA9IDIKCiAgICAgICAgICAgICMgY29uZmlndXJlIGNvbXBvbmVudCBvdXRwdXRzCiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF8xLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLm1vZGUgPSAiVXBsb2FkIgogICAgICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfMi5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aC5tb2RlID0gIlVwbG9hZCIKCiAgICAgICAgICAgIG1lcmdlX2NvbXBvbmVudF9vdXRwdXRzID0gbWVyZ2Vfb3V0cHV0c19jb21wb25lbnRfZnVuYygKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX290aGVyX251bWJlciwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9wYXRoXzE9aGVsbG9fd29ybGRfY29tcG9uZW50XzEub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgsCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fcGF0aF8yPWhlbGxvX3dvcmxkX2NvbXBvbmVudF8yLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLAogICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAiam9iX291dF9kYXRhXzEiOiBtZXJnZV9jb21wb25lbnRfb3V0cHV0cy5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aF8xLAogICAgICAgICAgICAgICAgImpvYl9vdXRfZGF0YV8yIjogbWVyZ2VfY29tcG9uZW50X291dHB1dHMub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGhfMiwKICAgICAgICAgICAgfQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX3dpdGhfYmluZGluZygxMCwgMTYsIGpvYl9pbnB1dCkKICAgICAgICBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKAogICAgICAgICAgICBwaXBlbGluZSwKICAgICAgICAgICAgZXhwZXJpbWVudF9uYW1lPSJkc2xfcGlwZWxpbmVfZTJlIiwKICAgICAgICApCgogICAgZGVmIHRlc3RfZGF0YV9pbnB1dChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIHBhcmVudF9kaXIgPSBzdHIodGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2RzbF9waXBlbGluZS9ueWNfdGF4aV9kYXRhX3JlZ3Jlc3Npb24iKQoKICAgICAgICBkZWYgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lKCk6CiAgICAgICAgICAgICMgMS4gTG9hZCBjb21wb25lbnQgZnVuY3MKICAgICAgICAgICAgcHJlcF9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPXBhcmVudF9kaXIgKyAiL3ByZXAueW1sIikKICAgICAgICAgICAgdHJhbnNmb3JtX2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9cGFyZW50X2RpciArICIvdHJhbnNmb3JtLnltbCIpCiAgICAgICAgICAgIHRyYWluX2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9cGFyZW50X2RpciArICIvdHJhaW4ueW1sIikKICAgICAgICAgICAgcHJlZGljdF9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPXBhcmVudF9kaXIgKyAiL3ByZWRpY3QueW1sIikKICAgICAgICAgICAgc2NvcmVfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1wYXJlbnRfZGlyICsgIi9zY29yZS55bWwiKQoKICAgICAgICAgICAgIyAyLiBDb25zdHJ1Y3QgcGlwZWxpbmUKICAgICAgICAgICAgQGRzbC5waXBlbGluZShjb21wdXRlPSJjcHUtY2x1c3RlciIsIGRlZmF1bHRfZGF0YXN0b3JlPSJ3b3Jrc3BhY2VibG9ic3RvcmUiKQogICAgICAgICAgICBkZWYgc2FtcGxlX3BpcGVsaW5lKHBpcGVsaW5lX2pvYl9pbnB1dCk6CiAgICAgICAgICAgICAgICBwcmVwX2pvYiA9IHByZXBfZnVuYyhyYXdfZGF0YT1waXBlbGluZV9qb2JfaW5wdXQpCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1fam9iID0gdHJhbnNmb3JtX2Z1bmMoY2xlYW5fZGF0YT1wcmVwX2pvYi5vdXRwdXRzLnByZXBfZGF0YSkKICAgICAgICAgICAgICAgIHRyYWluX2pvYiA9IHRyYWluX2Z1bmModHJhaW5pbmdfZGF0YT10cmFuc2Zvcm1fam9iLm91dHB1dHMudHJhbnNmb3JtZWRfZGF0YSkKICAgICAgICAgICAgICAgIHByZWRpY3Rfam9iID0gcHJlZGljdF9mdW5jKAogICAgICAgICAgICAgICAgICAgIG1vZGVsX2lucHV0PXRyYWluX2pvYi5vdXRwdXRzLm1vZGVsX291dHB1dCwKICAgICAgICAgICAgICAgICAgICB0ZXN0X2RhdGE9dHJhaW5fam9iLm91dHB1dHMudGVzdF9kYXRhLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgc2NvcmVfam9iID0gc2NvcmVfZnVuYygKICAgICAgICAgICAgICAgICAgICBwcmVkaWN0aW9ucz1wcmVkaWN0X2pvYi5vdXRwdXRzLnByZWRpY3Rpb25zLAogICAgICAgICAgICAgICAgICAgIG1vZGVsPXRyYWluX2pvYi5vdXRwdXRzLm1vZGVsX291dHB1dCwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgInBpcGVsaW5lX2pvYl9wcmVwcGVkX2RhdGEiOiBwcmVwX2pvYi5vdXRwdXRzLnByZXBfZGF0YSwKICAgICAgICAgICAgICAgICAgICAicGlwZWxpbmVfam9iX3RyYW5zZm9ybWVkX2RhdGEiOiB0cmFuc2Zvcm1fam9iLm91dHB1dHMudHJhbnNmb3JtZWRfZGF0YSwKICAgICAgICAgICAgICAgICAgICAicGlwZWxpbmVfam9iX3RyYWluZWRfbW9kZWwiOiB0cmFpbl9qb2Iub3V0cHV0cy5tb2RlbF9vdXRwdXQsCiAgICAgICAgICAgICAgICAgICAgInBpcGVsaW5lX2pvYl90ZXN0X2RhdGEiOiB0cmFpbl9qb2Iub3V0cHV0cy50ZXN0X2RhdGEsCiAgICAgICAgICAgICAgICAgICAgInBpcGVsaW5lX2pvYl9wcmVkaWN0aW9ucyI6IHByZWRpY3Rfam9iLm91dHB1dHMucHJlZGljdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgInBpcGVsaW5lX2pvYl9zY29yZV9yZXBvcnQiOiBzY29yZV9qb2Iub3V0cHV0cy5zY29yZV9yZXBvcnQsCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICBwaXBlbGluZSA9IHNhbXBsZV9waXBlbGluZShJbnB1dCh0eXBlPUFzc2V0VHlwZXMuVVJJX0ZPTERFUiwgcGF0aD1wYXJlbnRfZGlyICsgIi9kYXRhLyIpKQogICAgICAgICAgICBwaXBlbGluZS5vdXRwdXRzLnBpcGVsaW5lX2pvYl9wcmVwcGVkX2RhdGEuZGF0YSA9ICIvcHJlcHBlZF9kYXRhIgogICAgICAgICAgICBwaXBlbGluZS5vdXRwdXRzLnBpcGVsaW5lX2pvYl9wcmVwcGVkX2RhdGEubW9kZSA9ICJyd19tb3VudCIKICAgICAgICAgICAgcGlwZWxpbmUub3V0cHV0cy5waXBlbGluZV9qb2JfdHJhbnNmb3JtZWRfZGF0YS5kYXRhID0gIi90cmFuc2Zvcm1lZF9kYXRhIgogICAgICAgICAgICBwaXBlbGluZS5vdXRwdXRzLnBpcGVsaW5lX2pvYl90cmFuc2Zvcm1lZF9kYXRhLm1vZGUgPSAicndfbW91bnQiCiAgICAgICAgICAgIHBpcGVsaW5lLm91dHB1dHMucGlwZWxpbmVfam9iX3RyYWluZWRfbW9kZWwuZGF0YSA9ICIvdHJhaW5lZC1tb2RlbCIKICAgICAgICAgICAgcGlwZWxpbmUub3V0cHV0cy5waXBlbGluZV9qb2JfdHJhaW5lZF9tb2RlbC5tb2RlID0gInJ3X21vdW50IgogICAgICAgICAgICBwaXBlbGluZS5vdXRwdXRzLnBpcGVsaW5lX2pvYl90ZXN0X2RhdGEuZGF0YSA9ICIvdGVzdF9kYXRhIgogICAgICAgICAgICBwaXBlbGluZS5vdXRwdXRzLnBpcGVsaW5lX2pvYl90ZXN0X2RhdGEubW9kZSA9ICJyd19tb3VudCIKICAgICAgICAgICAgcGlwZWxpbmUub3V0cHV0cy5waXBlbGluZV9qb2JfcHJlZGljdGlvbnMuZGF0YSA9ICIvcHJlZGljdGlvbnMiCiAgICAgICAgICAgIHBpcGVsaW5lLm91dHB1dHMucGlwZWxpbmVfam9iX3ByZWRpY3Rpb25zLm1vZGUgPSAicndfbW91bnQiCiAgICAgICAgICAgIHBpcGVsaW5lLm91dHB1dHMucGlwZWxpbmVfam9iX3Njb3JlX3JlcG9ydC5kYXRhID0gIi9yZXBvcnQiCiAgICAgICAgICAgIHBpcGVsaW5lLm91dHB1dHMucGlwZWxpbmVfam9iX3Njb3JlX3JlcG9ydC5tb2RlID0gInJ3X21vdW50IgogICAgICAgICAgICByZXR1cm4gcGlwZWxpbmUKCiAgICAgICAgIyBjcmVhdGUgcGlwZWxpbmUgaW5zdGFuY2UKICAgICAgICBwaXBlbGluZSA9IGdlbmVyYXRlX2RzbF9waXBlbGluZSgpCiAgICAgICAgIyBzdWJtaXQgam9iIHRvIHdvcmtzcGFjZQogICAgICAgIGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUoCiAgICAgICAgICAgIHBpcGVsaW5lLAogICAgICAgICAgICBleHBlcmltZW50X25hbWU9Im55Y190YXhpX2RhdGFfcmVncmVzc2lvbiIsCiAgICAgICAgKQoKICAgIGRlZiB0ZXN0X2NvbW1hbmRfZnVuY3Rpb24oc2VsZiwgcmFuZHN0cjogQ2FsbGFibGVbW3N0cl0sIHN0cl0sIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF95YW1sID0gc3RyKGNvbXBvbmVudHNfZGlyIC8gImhlbGxvd29ybGRfY29tcG9uZW50LnltbCIpCiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9aGVsbG9fd29ybGRfY29tcG9uZW50X3lhbWwpCiAgICAgICAgIyB1cGRhdGUgY29tcG9uZW50IGRpc3BsYXkgbmFtZSB0byB3b3JrIGFyb3VuZCBzYW1lIGNvbXBvbmVudCByZWdpc3RlciBtdWx0aXBsZSB0aW1lIGlzc3VlCiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X2Z1bmMuZGlzcGxheV9uYW1lID0gInRlc3RfY29tbWFuZF9mdW5jdGlvbl9ub2RlIgoKICAgICAgICBlbnZpcm9ubWVudCA9ICJBenVyZU1MLXNrbGVhcm4tMS4wLXVidW50dTIwLjA0LXB5MzgtY3B1OjMzIgogICAgICAgIGRpc3RyaWJ1dGlvbiA9IHsidHlwZSI6ICJQeXRvcmNoIiwgInByb2Nlc3NfY291bnRfcGVyX2luc3RhbmNlIjogMn0KICAgICAgICByZXNvdXJjZXMgPSB7Imluc3RhbmNlX2NvdW50IjogMn0KICAgICAgICBlbnZpcm9ubWVudF92YXJpYWJsZXMgPSB7ImVudmlyb24iOiAidmFsIn0KICAgICAgICBpbnB1dHMgPSB7CiAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IElucHV0KHR5cGU9InVyaV9mb2xkZXIiLCBwYXRoPSJodHRwczovL215LWJsb2IvcGF0aC90by9kYXRhIiwgbW9kZT0icm9fbW91bnQiKSwKICAgICAgICAgICAgImNvbXBvbmVudF9pbl9udW1iZXIiOiAwLjAxLAogICAgICAgIH0KICAgICAgICBvdXRwdXRzID0geyJjb21wb25lbnRfb3V0X3BhdGgiOiBPdXRwdXQodHlwZT0ibWxmbG93X21vZGVsIiwgbW9kZT0icndfbW91bnQiKX0KCiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgbmFtZT1yYW5kc3RyKCJwaXBlbGluZV9uYW1lIiksCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJUaGUgaGVsbG8gd29ybGQgcGlwZWxpbmUgam9iIiwKICAgICAgICAgICAgdGFncz17Im93bmVyIjogInNka3RlYW0iLCAidGFnIjogInRhZ3ZhbHVlIn0sCiAgICAgICAgICAgIGNvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICApCiAgICAgICAgZGVmIG1peGVkX3BpcGVsaW5lKGpvYl9pbl9udW1iZXIsIGpvYl9pbl9wYXRoKToKICAgICAgICAgICAgY29tbWFuZF9qb2IgPSBDb21tYW5kSm9iKAogICAgICAgICAgICAgICAgZGlzcGxheV9uYW1lPSJjb21tYW5kLWpvYiIsCiAgICAgICAgICAgICAgICBlbnZpcm9ubWVudD1lbnZpcm9ubWVudCwKICAgICAgICAgICAgICAgIGNvbW1hbmQ9J2VjaG8gImhlbGxvIHdvcmxkIicsCiAgICAgICAgICAgICAgICBkaXN0cmlidXRpb249ZGlzdHJpYnV0aW9uLAogICAgICAgICAgICAgICAgcmVzb3VyY2VzPXJlc291cmNlcywKICAgICAgICAgICAgICAgIGVudmlyb25tZW50X3ZhcmlhYmxlcz1lbnZpcm9ubWVudF92YXJpYWJsZXMsCiAgICAgICAgICAgICAgICBpbnB1dHM9aW5wdXRzLAogICAgICAgICAgICAgICAgb3V0cHV0cz1vdXRwdXRzLAogICAgICAgICAgICApCiAgICAgICAgICAgIGNvbW1hbmRfam9iX2Z1bmMgPSB0b19jb21wb25lbnQoam9iPWNvbW1hbmRfam9iKQoKICAgICAgICAgICAgIyBDb21tYW5kIGZyb20gY29tbWFuZCgpIGZ1bmN0aW9uCiAgICAgICAgICAgIGNvbW1hbmRfZnVuY3Rpb24gPSBjb21tYW5kKAogICAgICAgICAgICAgICAgZGlzcGxheV9uYW1lPSJjb21tYW5kLWZ1bmN0aW9uLWpvYiIsCiAgICAgICAgICAgICAgICBlbnZpcm9ubWVudD1lbnZpcm9ubWVudCwKICAgICAgICAgICAgICAgIGNvbW1hbmQ9J2VjaG8gImhlbGxvIHdvcmxkIicsCiAgICAgICAgICAgICAgICBkaXN0cmlidXRpb249ZGlzdHJpYnV0aW9uLAogICAgICAgICAgICAgICAgcmVzb3VyY2VzPXJlc291cmNlcywKICAgICAgICAgICAgICAgIGVudmlyb25tZW50X3ZhcmlhYmxlcz1lbnZpcm9ubWVudF92YXJpYWJsZXMsCiAgICAgICAgICAgICAgICBpbnB1dHM9aW5wdXRzLAogICAgICAgICAgICAgICAgb3V0cHV0cz1vdXRwdXRzLAogICAgICAgICAgICApCgogICAgICAgICAgICBub2RlMSA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudF9mdW5jKGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9am9iX2luX3BhdGgpCiAgICAgICAgICAgIG5vZGUyID0gY29tbWFuZF9qb2JfZnVuYygKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9wYXRoPW5vZGUxLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcj0yLAogICAgICAgICAgICApCiAgICAgICAgICAgIG5vZGUzID0gY29tbWFuZF9mdW5jdGlvbigKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9wYXRoPW5vZGUyLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcj0zLAogICAgICAgICAgICApCgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInBpcGVsaW5lX2pvYl9vdXQiOiBub2RlMy5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwKICAgICAgICAgICAgfQoKICAgICAgICBwaXBlbGluZSA9IG1peGVkX3BpcGVsaW5lKDE2LCBqb2JfaW5wdXQpCiAgICAgICAgIyBzdWJtaXQgam9iIHRvIHdvcmtzcGFjZQogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUoCiAgICAgICAgICAgIHBpcGVsaW5lLAogICAgICAgICAgICBleHBlcmltZW50X25hbWU9Im1peGVkX3BpcGVsaW5lIiwKICAgICAgICApCiAgICAgICAgYWN0dWFsX2pvYiA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkucHJvcGVydGllcy5hc19kaWN0KCksICpjb21tb25fb21pdF9maWVsZHMpCiAgICAgICAgZXhwZWN0ZWRfam9iID0gewogICAgICAgICAgICAidGFncyI6IHsib3duZXIiOiAic2RrdGVhbSIsICJ0YWciOiAidGFndmFsdWUifSwKICAgICAgICAgICAgImNvbXB1dGVfaWQiOiAiY3B1LWNsdXN0ZXIiLAogICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiVGhlIGhlbGxvIHdvcmxkIHBpcGVsaW5lIGpvYiIsCiAgICAgICAgICAgICJpc19hcmNoaXZlZCI6IEZhbHNlLAogICAgICAgICAgICAiam9iX3R5cGUiOiAiUGlwZWxpbmUiLAogICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgImpvYl9pbl9udW1iZXIiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMTYifSwKICAgICAgICAgICAgICAgICJqb2JfaW5fcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAibW9kZSI6ICJSZWFkT25seU1vdW50IiwKICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAidXJpX2ZpbGUiLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImpvYnMiOiB7CiAgICAgICAgICAgICAgICAibm9kZTEiOiB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9pbl9udW1iZXIiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5qb2JfaW5fbnVtYmVyfX0iLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX3BhdGgiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5qb2JfaW5fcGF0aH19In0sCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJub2RlMSIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm5vZGUyIjogewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImNvbW1hbmQiLAogICAgICAgICAgICAgICAgICAgICJkaXN0cmlidXRpb24iOiB7ImRpc3RyaWJ1dGlvbl90eXBlIjogIlB5VG9yY2giLCAicHJvY2Vzc19jb3VudF9wZXJfaW5zdGFuY2UiOiAyfSwKICAgICAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX251bWJlciI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIyIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuam9icy5ub2RlMS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH19IiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIm5vZGUyIiwKICAgICAgICAgICAgICAgICAgICAicmVzb3VyY2VzIjogeyJpbnN0YW5jZV9jb3VudCI6IDJ9LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJub2RlMyI6IHsKICAgICAgICAgICAgICAgICAgICAiZGlzcGxheV9uYW1lIjogImNvbW1hbmQtZnVuY3Rpb24tam9iIiwKICAgICAgICAgICAgICAgICAgICAiZGlzdHJpYnV0aW9uIjogeyJkaXN0cmlidXRpb25fdHlwZSI6ICJQeVRvcmNoIiwgInByb2Nlc3NfY291bnRfcGVyX2luc3RhbmNlIjogMn0sCiAgICAgICAgICAgICAgICAgICAgImVudmlyb25tZW50X3ZhcmlhYmxlcyI6IHsiZW52aXJvbiI6ICJ2YWwifSwKICAgICAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX251bWJlciI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIzIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuam9icy5ub2RlMi5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH19IiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIm5vZGUzIiwKICAgICAgICAgICAgICAgICAgICAib3V0cHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHsidHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5vdXRwdXRzLnBpcGVsaW5lX2pvYl9vdXR9fSJ9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAicmVzb3VyY2VzIjogeyJpbnN0YW5jZV9jb3VudCI6IDJ9LAogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImNvbW1hbmQiLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm91dHB1dHMiOiB7CiAgICAgICAgICAgICAgICAicGlwZWxpbmVfam9iX291dCI6IHsKICAgICAgICAgICAgICAgICAgICAibW9kZSI6ICJSZWFkV3JpdGVNb3VudCIsCiAgICAgICAgICAgICAgICAgICAgImpvYl9vdXRwdXRfdHlwZSI6ICJtbGZsb3dfbW9kZWwiLAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAic2V0dGluZ3MiOiB7fSwKICAgICAgICB9CiAgICAgICAgYXNzZXJ0IGV4cGVjdGVkX2pvYiA9PSBhY3R1YWxfam9iCgogICAgZGVmIHRlc3RfY29tbWFuZF93aXRoX29wdGlvbmFsX2lucHV0cyhzZWxmLCByYW5kc3RyOiBDYWxsYWJsZVtbc3RyXSwgc3RyXSwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X3lhbWwgPSBzdHIoY29tcG9uZW50c19kaXIgLyAiaGVsbG93b3JsZF9jb21wb25lbnRfd2l0aF9vcHRpb25hbF9pbnB1dHMueW1sIikKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1oZWxsb193b3JsZF9jb21wb25lbnRfeWFtbCkKICAgICAgICBjb21tYW5kX2Z1bmMgPSBjb21tYW5kKAogICAgICAgICAgICBuYW1lPWYidGVzdF9vcHRpb25hbF9pbnB1dF9jb21wb25lbnRfIiArIHJhbmRzdHIoImNvbXBvbmVudF9uYW1lIiksCiAgICAgICAgICAgIGRpc3BsYXlfbmFtZT0iY29tbWFuZF93aXRoX29wdGlvbmFsX2lucHV0cyIsCiAgICAgICAgICAgIGVudmlyb25tZW50PSJBenVyZU1MLXNrbGVhcm4tMS4wLXVidW50dTIwLjA0LXB5MzgtY3B1OjMzIiwKICAgICAgICAgICAgY29tbWFuZD0oCiAgICAgICAgICAgICAgICAnZWNobyAiaGVsbG8gd29ybGQiICcKICAgICAgICAgICAgICAgICImIGVjaG8gJFtbJHt7aW5wdXRzLmZsb2F0fX1dXSAiCiAgICAgICAgICAgICAgICAiJiBlY2hvICRbWyR7e2lucHV0cy5pbnRlZ2VyfX1dXSAiCiAgICAgICAgICAgICAgICAiJiBlY2hvICRbWyR7e2lucHV0cy5zdHJpbmd9fV1dICIKICAgICAgICAgICAgICAgICImIGVjaG8gJFtbJHt7aW5wdXRzLmJvb2xlYW59fV1dICIKICAgICAgICAgICAgICAgICImIGVjaG8gJHt7aW5wdXRzLnVyaV9mb2xkZXJ9fSAiCiAgICAgICAgICAgICAgICAiJiBlY2hvICRbWyR7e2lucHV0cy5vcHRpb25hbF8wfX1dXSAiCiAgICAgICAgICAgICAgICAiJiBlY2hvICRbWyR7e2lucHV0cy5vcHRpb25hbF8xfX1dXSIKICAgICAgICAgICAgICAgICImIGVjaG8gJFtbJHt7aW5wdXRzLm9wdGlvbmFsXzJ9fV1dIgogICAgICAgICAgICApLAogICAgICAgICAgICBkaXN0cmlidXRpb249eyJ0eXBlIjogIlB5dG9yY2giLCAicHJvY2Vzc19jb3VudF9wZXJfaW5zdGFuY2UiOiAyfSwKICAgICAgICAgICAgcmVzb3VyY2VzPXsiaW5zdGFuY2VfY291bnQiOiAyfSwKICAgICAgICAgICAgZW52aXJvbm1lbnRfdmFyaWFibGVzPXsiZW52aXJvbiI6ICJ2YWwifSwKICAgICAgICAgICAgaW5wdXRzPXsKICAgICAgICAgICAgICAgICJmbG9hdCI6IElucHV0KHR5cGU9Im51bWJlciIsIGRlZmF1bHQ9MS4xLCBtaW49MCwgbWF4PTUsIG9wdGlvbmFsPVRydWUpLAogICAgICAgICAgICAgICAgImludGVnZXIiOiBJbnB1dCh0eXBlPSJpbnRlZ2VyIiwgZGVmYXVsdD0yLCBtaW49LTEsIG1heD00LCBvcHRpb25hbD1UcnVlKSwKICAgICAgICAgICAgICAgICJzdHJpbmciOiBJbnB1dCh0eXBlPSJzdHJpbmciLCBkZWZhdWx0PSJkZWZhdWx0X3N0ciIsIG9wdGlvbmFsPVRydWUpLAogICAgICAgICAgICAgICAgImJvb2xlYW4iOiBJbnB1dCh0eXBlPSJib29sZWFuIiwgZGVmYXVsdD1GYWxzZSwgb3B0aW9uYWw9VHJ1ZSksCiAgICAgICAgICAgICAgICAidXJpX2ZvbGRlciI6IElucHV0KHR5cGU9InVyaV9mb2xkZXIiKSwKICAgICAgICAgICAgICAgICJvcHRpb25hbF8wIjogSW5wdXQodHlwZT0idXJpX2ZpbGUiLCBvcHRpb25hbD1UcnVlKSwKICAgICAgICAgICAgICAgICJvcHRpb25hbF8xIjogSW5wdXQodHlwZT0ibnVtYmVyIiwgb3B0aW9uYWw9VHJ1ZSksCiAgICAgICAgICAgICAgICAib3B0aW9uYWxfMiI6IElucHV0KHR5cGU9Im51bWJlciIsIG9wdGlvbmFsPVRydWUsIGRlZmF1bHQ9MS4yKSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3V0cHV0cz17ImNvbXBvbmVudF9vdXRfcGF0aCI6IE91dHB1dCh0eXBlPSJ1cmlfZm9sZGVyIil9LAogICAgICAgICkKCiAgICAgICAgY29tcG9uZW50ID0gY2xpZW50LmNvbXBvbmVudHMuY3JlYXRlX29yX3VwZGF0ZShjb21tYW5kX2Z1bmMuY29tcG9uZW50KQogICAgICAgIGFzc2VydCBjb21wb25lbnQgYW5kIGNvbXBvbmVudC52ZXJzaW9uID09ICIxIgoKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBuYW1lPWYidGVzdF9vcHRpb25hbF9pbnB1dF9jb21wb25lbnRfcGlwZWxpbmVfIiArIHJhbmRzdHIoInBpcGVsaW5lX25hbWUiKSwKICAgICAgICAgICAgZGVzY3JpcHRpb249IlRoZSBjb21tYW5kIG5vZGUgd2l0aCBvcHRpb25hbCBpbnB1dHMiLAogICAgICAgICAgICB0YWdzPXsib3duZXIiOiAic2RrdGVhbSIsICJ0YWciOiAidGFndmFsdWUifSwKICAgICAgICAgICAgY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICkKICAgICAgICBkZWYgc2FtcGxlX3BpcGVsaW5lKGpvYl9pbl9maWxlKToKICAgICAgICAgICAgbm9kZTEgPSBoZWxsb193b3JsZF9jb21wb25lbnRfZnVuYyhjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fZmlsZSkKICAgICAgICAgICAgbm9kZTIgPSBjb21tYW5kX2Z1bmModXJpX2ZvbGRlcj1ub2RlMS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCkKCiAgICAgICAgICAgIHJldHVybiB7InBpcGVsaW5lX291dHB1dCI6IG5vZGUyLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRofQoKICAgICAgICBwaXBlbGluZSA9IHNhbXBsZV9waXBlbGluZSgKICAgICAgICAgICAgSW5wdXQodHlwZT0idXJpX2ZpbGUiLCBwYXRoPSJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIpCiAgICAgICAgKQogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUpCgogICAgICAgIGFjdHVhbF9qb2IgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLnByb3BlcnRpZXMuYXNfZGljdCgpLCAqY29tbW9uX29taXRfZmllbGRzKQogICAgICAgIGV4cGVjdGVkX2pvYiA9IHsKICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogIlRoZSBjb21tYW5kIG5vZGUgd2l0aCBvcHRpb25hbCBpbnB1dHMiLAogICAgICAgICAgICAidGFncyI6IHsib3duZXIiOiAic2RrdGVhbSIsICJ0YWciOiAidGFndmFsdWUifSwKICAgICAgICAgICAgImNvbXB1dGVfaWQiOiAiY3B1LWNsdXN0ZXIiLAogICAgICAgICAgICAiaXNfYXJjaGl2ZWQiOiBGYWxzZSwKICAgICAgICAgICAgImpvYl90eXBlIjogIlBpcGVsaW5lIiwKICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICJqb2JfaW5fZmlsZSI6IHsKICAgICAgICAgICAgICAgICAgICAibW9kZSI6ICJSZWFkT25seU1vdW50IiwKICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAidXJpX2ZpbGUiLAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAiam9icyI6IHsKICAgICAgICAgICAgICAgICJub2RlMSI6IHsKICAgICAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX3BhdGgiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5qb2JfaW5fZmlsZX19In0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIm5vZGUxIiwKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibm9kZTIiOiB7CiAgICAgICAgICAgICAgICAgICAgImRpc3BsYXlfbmFtZSI6ICJjb21tYW5kX3dpdGhfb3B0aW9uYWxfaW5wdXRzIiwKICAgICAgICAgICAgICAgICAgICAiZGlzdHJpYnV0aW9uIjogeyJkaXN0cmlidXRpb25fdHlwZSI6ICJQeVRvcmNoIiwgInByb2Nlc3NfY291bnRfcGVyX2luc3RhbmNlIjogMn0sCiAgICAgICAgICAgICAgICAgICAgImVudmlyb25tZW50X3ZhcmlhYmxlcyI6IHsiZW52aXJvbiI6ICJ2YWwifSwKICAgICAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAidXJpX2ZvbGRlciI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuam9icy5ub2RlMS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH19IiwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAibm9kZTIiLAogICAgICAgICAgICAgICAgICAgICJvdXRwdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X291dF9wYXRoIjogeyJ0eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50Lm91dHB1dHMucGlwZWxpbmVfb3V0cHV0fX0ifQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgInJlc291cmNlcyI6IHsiaW5zdGFuY2VfY291bnQiOiAyfSwKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJvdXRwdXRzIjogeyJwaXBlbGluZV9vdXRwdXQiOiB7Im1vZGUiOiAiUmVhZFdyaXRlTW91bnQiLCAiam9iX291dHB1dF90eXBlIjogInVyaV9mb2xkZXIifX0sCiAgICAgICAgICAgICJzZXR0aW5ncyI6IHt9LAogICAgICAgIH0KICAgICAgICBhc3NlcnQgZXhwZWN0ZWRfam9iID09IGFjdHVhbF9qb2IKCiAgICBkZWYgdGVzdF9zcGFya193aXRoX29wdGlvbmFsX2lucHV0cyhzZWxmLCByYW5kc3RyOiBDYWxsYWJsZVtbc3RyXSwgc3RyXSwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgY29tcG9uZW50X3lhbWwgPSAiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvZHNsX3BpcGVsaW5lL3NwYXJrX2pvYl9pbl9waXBlbGluZS9jb21wb25lbnRfd2l0aF9vcHRpb25hbF9pbnB1dHMueW1sIgogICAgICAgIHNwYXJrX3dpdGhfb3B0aW9uYWxfaW5wdXRzX2NvbXBvbmVudF9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPWNvbXBvbmVudF95YW1sKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBuYW1lPWYidGVzdF9vcHRpb25hbF9pbnB1dF9jb21wb25lbnRfcGlwZWxpbmVfIiArIHJhbmRzdHIoInBpcGVsaW5lX25hbWUiKSwKICAgICAgICAgICAgZGVzY3JpcHRpb249IlRoZSBzcGFyayBub2RlIHdpdGggb3B0aW9uYWwgaW5wdXRzIiwKICAgICAgICAgICAgdGFncz17Im93bmVyIjogInNka3RlYW0iLCAidGFnIjogInRhZ3ZhbHVlIn0sCiAgICAgICAgKQogICAgICAgIGRlZiBzYW1wbGVfcGlwZWxpbmUoam9iX2luX2ZpbGUsIHNhbXBsZV9yYXRlKToKICAgICAgICAgICAgbm9kZTEgPSBzcGFya193aXRoX29wdGlvbmFsX2lucHV0c19jb21wb25lbnRfZnVuYyhpbnB1dDE9am9iX2luX2ZpbGUsIHNhbXBsZV9yYXRlPXNhbXBsZV9yYXRlKQogICAgICAgICAgICBub2RlMS5yZXNvdXJjZXMgPSB7Imluc3RhbmNlX3R5cGUiOiAic3RhbmRhcmRfZTRzX3YzIiwgInJ1bnRpbWVfdmVyc2lvbiI6ICIzLjIuMCJ9CiAgICAgICAgICAgIHJldHVybiB7InBpcGVsaW5lX291dHB1dCI6IG5vZGUxLm91dHB1dHMub3V0cHV0MX0KCiAgICAgICAgcGlwZWxpbmUgPSBzYW1wbGVfcGlwZWxpbmUoCiAgICAgICAgICAgIGpvYl9pbl9maWxlPUlucHV0KAogICAgICAgICAgICAgICAgcGF0aD0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvZHNsX3BpcGVsaW5lL3NwYXJrX2pvYl9pbl9waXBlbGluZS9kYXRhc2V0L3NoYWtlc3BlYXJlLnR4dCIsCiAgICAgICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuVVJJX0ZJTEUsCiAgICAgICAgICAgICAgICBtb2RlPUlucHV0T3V0cHV0TW9kZXMuRElSRUNULAogICAgICAgICAgICApLAogICAgICAgICAgICBzYW1wbGVfcmF0ZT0wLjAxLAogICAgICAgICkKICAgICAgICBwaXBlbGluZS5vdXRwdXRzLnBpcGVsaW5lX291dHB1dC5tb2RlID0gSW5wdXRPdXRwdXRNb2Rlcy5ESVJFQ1QKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lKQoKICAgICAgICBhY3R1YWxfam9iID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5wcm9wZXJ0aWVzLmFzX2RpY3QoKSwgKmNvbW1vbl9vbWl0X2ZpZWxkcykKICAgICAgICBleHBlY3RlZF9qb2IgPSB7CiAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJUaGUgc3Bhcmsgbm9kZSB3aXRoIG9wdGlvbmFsIGlucHV0cyIsCiAgICAgICAgICAgICJ0YWdzIjogeyJvd25lciI6ICJzZGt0ZWFtIiwgInRhZyI6ICJ0YWd2YWx1ZSJ9LAogICAgICAgICAgICAiaXNfYXJjaGl2ZWQiOiBGYWxzZSwKICAgICAgICAgICAgImpvYl90eXBlIjogIlBpcGVsaW5lIiwKICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICJqb2JfaW5fZmlsZSI6IHsiam9iX2lucHV0X3R5cGUiOiAidXJpX2ZpbGUiLCAibW9kZSI6ICJEaXJlY3QifSwKICAgICAgICAgICAgICAgICJzYW1wbGVfcmF0ZSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIwLjAxIn0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJqb2JzIjogewogICAgICAgICAgICAgICAgIm5vZGUxIjogewogICAgICAgICAgICAgICAgICAgICJhcmdzIjogIi0taW5wdXQxICR7e2lucHV0cy5pbnB1dDF9fSAtLW91dHB1dDIgIgogICAgICAgICAgICAgICAgICAgICIke3tvdXRwdXRzLm91dHB1dDF9fSAtLW15X3NhbXBsZV9yYXRlICIKICAgICAgICAgICAgICAgICAgICAiJHt7aW5wdXRzLnNhbXBsZV9yYXRlfX0gJFtbLS1pbnB1dF9vcHRpb25hbCAiCiAgICAgICAgICAgICAgICAgICAgIiR7e2lucHV0cy5pbnB1dF9vcHRpb25hbH19XV0iLAogICAgICAgICAgICAgICAgICAgICJjb25mIjogewogICAgICAgICAgICAgICAgICAgICAgICAic3BhcmsuZHJpdmVyLmNvcmVzIjogMSwKICAgICAgICAgICAgICAgICAgICAgICAgInNwYXJrLmRyaXZlci5tZW1vcnkiOiAiMmciLAogICAgICAgICAgICAgICAgICAgICAgICAic3BhcmsuZHluYW1pY0FsbG9jYXRpb24uZW5hYmxlZCI6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJzcGFyay5keW5hbWljQWxsb2NhdGlvbi5tYXhFeGVjdXRvcnMiOiA0LAogICAgICAgICAgICAgICAgICAgICAgICAic3BhcmsuZHluYW1pY0FsbG9jYXRpb24ubWluRXhlY3V0b3JzIjogMSwKICAgICAgICAgICAgICAgICAgICAgICAgInNwYXJrLmV4ZWN1dG9yLmNvcmVzIjogMiwKICAgICAgICAgICAgICAgICAgICAgICAgInNwYXJrLmV4ZWN1dG9yLmluc3RhbmNlcyI6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICJzcGFyay5leGVjdXRvci5tZW1vcnkiOiAiMmciLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgImVudHJ5IjogewogICAgICAgICAgICAgICAgICAgICAgICAiZmlsZSI6ICJzYW1wbGV3b3JkX3dpdGhfb3B0aW9uYWxfaW5wdXQucHkiLAogICAgICAgICAgICAgICAgICAgICAgICAic3Bhcmtfam9iX2VudHJ5X3R5cGUiOiAiU3BhcmtKb2JQeXRob25FbnRyeSIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiaWRlbnRpdHkiOiB7ImlkZW50aXR5X3R5cGUiOiAiVXNlcklkZW50aXR5In0sCiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImlucHV0MSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmpvYl9pbl9maWxlfX0ifSwKICAgICAgICAgICAgICAgICAgICAgICAgInNhbXBsZV9yYXRlIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuc2FtcGxlX3JhdGV9fSJ9LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAibm9kZTEiLAogICAgICAgICAgICAgICAgICAgICJvdXRwdXRzIjogeyJvdXRwdXQxIjogeyJ0eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50Lm91dHB1dHMucGlwZWxpbmVfb3V0cHV0fX0ifX0sCiAgICAgICAgICAgICAgICAgICAgInJlc291cmNlcyI6IHsiaW5zdGFuY2VfdHlwZSI6ICJzdGFuZGFyZF9lNHNfdjMiLCAicnVudGltZV92ZXJzaW9uIjogIjMuMi4wIn0sCiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAic3BhcmsiLAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAib3V0cHV0cyI6IHsicGlwZWxpbmVfb3V0cHV0IjogeyJtb2RlIjogIkRpcmVjdCIsICJqb2Jfb3V0cHV0X3R5cGUiOiAidXJpX2ZpbGUifX0sCiAgICAgICAgICAgICJzZXR0aW5ncyI6IHt9LAogICAgICAgIH0KICAgICAgICBhc3NlcnQgZXhwZWN0ZWRfam9iID09IGFjdHVhbF9qb2IKCiAgICBkZWYgdGVzdF9jb21tYW5kX2J5X3Bhc3Moc2VsZiwgcmFuZHN0cjogQ2FsbGFibGVbW3N0cl0sIHN0cl0sIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF95YW1sID0gc3RyKGNvbXBvbmVudHNfZGlyIC8gImhlbGxvd29ybGRfY29tcG9uZW50LnltbCIpCiAgICAgICAgY29tcG9uZW50X2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9aGVsbG9fd29ybGRfY29tcG9uZW50X3lhbWwpCiAgICAgICAgIyB1cGRhdGUgY29tcG9uZW50IGRpc3BsYXkgbmFtZSB0byB3b3JrIGFyb3VuZCBzYW1lIGNvbXBvbmVudCByZWdpc3RlciBtdWx0aXBsZSB0aW1lIGlzc3VlCiAgICAgICAgY29tcG9uZW50X2Z1bmMuZGlzcGxheV9uYW1lID0gInRlc3RfY29tbWFuZF9ieV9wYXNzIgoKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBuYW1lPXJhbmRzdHIoInBpcGVsaW5lX25hbWUiKSwKICAgICAgICAgICAgZGVzY3JpcHRpb249IlRoZSBoZWxsbyB3b3JsZCBwaXBlbGluZSBqb2IiLAogICAgICAgICAgICB0YWdzPXsib3duZXIiOiAic2RrdGVhbSIsICJ0YWciOiAidGFndmFsdWUifSwKICAgICAgICAgICAgZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgICAgIGV4cGVyaW1lbnRfbmFtZT1leHBlcmltZW50X25hbWUsCiAgICAgICAgICAgIGNvbnRpbnVlX29uX3N0ZXBfZmFpbHVyZT1UcnVlLAogICAgICAgICkKICAgICAgICBkZWYgcGlwZWxpbmUoam9iX2luX251bWJlciwgam9iX2luX290aGVyX251bWJlciwgam9iX2luX3BhdGgpOgogICAgICAgICAgICAjIGR5bmFtaWMgZmllbGRzIHdpbGwgcGFzcyB0aHJvdWdoIHRvIGJhY2tlbmQKICAgICAgICAgICAgbm9kZTEgPSBjb21wb25lbnRfZnVuYyhjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQogICAgICAgICAgICBub2RlMS5uZXdfZmllbGQgPSAidmFsIgogICAgICAgICAgICBub2RlMiA9IGNvbXBvbmVudF9mdW5jKGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX290aGVyX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9am9iX2luX3BhdGgpCiAgICAgICAgICAgIG5vZGUyLm5ld19maWVsZCA9IHt9CgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmUoMTAsIDIwLCBqb2JfaW5wdXQpCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZSgKICAgICAgICAgICAgcGlwZWxpbmUsCiAgICAgICAgICAgIGV4cGVyaW1lbnRfbmFtZT0iZHNsX2V4cCIsCiAgICAgICAgKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5mb3JjZV9yZXJ1biA9IEZhbHNlCiAgICAgICAgYWN0dWFsX2pvYiA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkucHJvcGVydGllcy5hc19kaWN0KCksICpjb21tb25fb21pdF9maWVsZHMpCiAgICAgICAgZXhwZWN0ZWRfam9iID0gewogICAgICAgICAgICAidGFncyI6IHsib3duZXIiOiAic2RrdGVhbSIsICJ0YWciOiAidGFndmFsdWUifSwKICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogIlRoZSBoZWxsbyB3b3JsZCBwaXBlbGluZSBqb2IiLAogICAgICAgICAgICAiaXNfYXJjaGl2ZWQiOiBGYWxzZSwKICAgICAgICAgICAgImpvYl90eXBlIjogIlBpcGVsaW5lIiwKICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICJqb2JfaW5fbnVtYmVyIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjEwIn0sCiAgICAgICAgICAgICAgICAiam9iX2luX290aGVyX251bWJlciI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIyMCJ9LAogICAgICAgICAgICAgICAgImpvYl9pbl9wYXRoIjogewogICAgICAgICAgICAgICAgICAgICJtb2RlIjogIlJlYWRPbmx5TW91bnQiLAogICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJ1cmlfZmlsZSIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICAiam9icyI6IHsKICAgICAgICAgICAgICAgICJub2RlMSI6IHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX251bWJlciI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmpvYl9pbl9udW1iZXJ9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmpvYl9pbl9wYXRofX0ifSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIm5vZGUxIiwKICAgICAgICAgICAgICAgICAgICAibmV3X2ZpZWxkIjogInZhbCIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm5vZGUyIjogewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImNvbW1hbmQiLAogICAgICAgICAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fbnVtYmVyIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuam9iX2luX290aGVyX251bWJlcn19IiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9pbl9wYXRoIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuam9iX2luX3BhdGh9fSJ9LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAibm9kZTIiLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm91dHB1dHMiOiB7fSwKICAgICAgICAgICAgInNldHRpbmdzIjogewogICAgICAgICAgICAgICAgImNvbnRpbnVlX29uX3N0ZXBfZmFpbHVyZSI6IFRydWUsCiAgICAgICAgICAgICAgICAiZm9yY2VfcmVydW4iOiBGYWxzZSwKICAgICAgICAgICAgICAgICJkZWZhdWx0X2NvbXB1dGUiOiAiY3B1LWNsdXN0ZXIiLAogICAgICAgICAgICB9LAogICAgICAgIH0KICAgICAgICBhc3NlcnQgZXhwZWN0ZWRfam9iID09IGFjdHVhbF9qb2IKCiAgICBkZWYgdGVzdF9waXBlbGluZV9wYXJhbWV0ZXJfd2l0aF9kZWZhdWx0X3ZhbHVlKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgaW5wdXRfdHlwZXNfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1zdHIoY29tcG9uZW50c19kaXIgLyAiaW5wdXRfdHlwZXNfY29tcG9uZW50LnltbCIpKQoKICAgICAgICAjIENvbnN0cnVjdCBwaXBlbGluZQogICAgICAgIEBkc2wucGlwZWxpbmUoCiAgICAgICAgICAgIGRlZmF1bHRfY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICAgICBkZXNjcmlwdGlvbj0iVGhpcyBpcyB0aGUgYmFzaWMgcGlwZWxpbmUgd2l0aCBzZXZlcmFsIGlucHV0IHR5cGVzIiwKICAgICAgICApCiAgICAgICAgZGVmIGlucHV0X3R5cGVzX3BpcGVsaW5lKAogICAgICAgICAgICBjb21wb25lbnRfaW5fc3RyaW5nPSJjb21wb25lbnRfaW5fc3RyaW5nIiwKICAgICAgICAgICAgY29tcG9uZW50X2luX3JhbmdlZF9pbnRlZ2VyPTEwLAogICAgICAgICAgICBjb21wb25lbnRfaW5fZW51bT0id29ybGQiLAogICAgICAgICAgICBjb21wb25lbnRfaW5fYm9vbGVhbj1UcnVlLAogICAgICAgICAgICBjb21wb25lbnRfaW5fcmFuZ2VkX251bWJlcj04LAogICAgICAgICk6CiAgICAgICAgICAgIGlucHV0X3R5cGVzX2Z1bmMoCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fc3RyaW5nPWNvbXBvbmVudF9pbl9zdHJpbmcsCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fcmFuZ2VkX2ludGVnZXI9Y29tcG9uZW50X2luX3JhbmdlZF9pbnRlZ2VyLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX2VudW09Y29tcG9uZW50X2luX2VudW0sCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fYm9vbGVhbj1jb21wb25lbnRfaW5fYm9vbGVhbiwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9yYW5nZWRfbnVtYmVyPWNvbXBvbmVudF9pbl9yYW5nZWRfbnVtYmVyLAogICAgICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gaW5wdXRfdHlwZXNfcGlwZWxpbmUoKSAgIyB1c2UgZGVmYXVsdCBwaXBlbGluZSBwYXJhbWV0ZXIKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lLCBleHBlcmltZW50X25hbWU9ImlucHV0X3R5cGVzX3BpcGVsaW5lIikKCiAgICAgICAgYXNzZXJ0IHBpcGVsaW5lX2pvYi5pbnB1dHMuY29tcG9uZW50X2luX3N0cmluZy5fZGF0YSA9PSAiY29tcG9uZW50X2luX3N0cmluZyIKICAgICAgICBhc3NlcnQgcGlwZWxpbmVfam9iLmlucHV0cy5jb21wb25lbnRfaW5fcmFuZ2VkX2ludGVnZXIuX2RhdGEgPT0gIjEwIgogICAgICAgIGFzc2VydCBwaXBlbGluZV9qb2IuaW5wdXRzLmNvbXBvbmVudF9pbl9lbnVtLl9kYXRhID09ICJ3b3JsZCIKICAgICAgICBhc3NlcnQgcGlwZWxpbmVfam9iLmlucHV0cy5jb21wb25lbnRfaW5fYm9vbGVhbi5fZGF0YSA9PSAiVHJ1ZSIKICAgICAgICBhc3NlcnQgcGlwZWxpbmVfam9iLmlucHV0cy5jb21wb25lbnRfaW5fcmFuZ2VkX251bWJlci5fZGF0YSA9PSAiOCIKCiAgICBkZWYgdGVzdF9jb21wb25lbnRfd2l0aF9kZWZhdWx0X29wdGlvbmFsX2lucHV0KHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPXN0cihjb21wb25lbnRzX2RpciAvICJkZWZhdWx0X29wdGlvbmFsX2NvbXBvbmVudC55bWwiKSkKCiAgICAgICAgIyBDb25zdHJ1Y3QgcGlwZWxpbmUKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBkZWZhdWx0X2NvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICAgICAgZGVzY3JpcHRpb249IlRoaXMgaXMgdGhlIGJhc2ljIHBpcGVsaW5lIHdpdGggc2V2ZXJhbCBpbnB1dCB0eXBlcyIsCiAgICAgICAgKQogICAgICAgIGRlZiBkZWZhdWx0X29wdGlvbmFsX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIGRlZmF1bHRfb3B0aW9uYWxfZnVuYygKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPSJkZWYiLAogICAgICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9SW5wdXQodHlwZT0idXJpX2ZpbGUiLCBwYXRoPSJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIpLAogICAgICAgICAgICApCiAgICAgICAgICAgIGRlZmF1bHRfb3B0aW9uYWxfZnVuYygKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPSJkZWYiLAogICAgICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9SW5wdXQodHlwZT0idXJpX2ZpbGUiLCBwYXRoPSJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIpLAogICAgICAgICAgICAgICAgb3B0aW9uYWxfaW5wdXQ9Tm9uZSwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdD1Ob25lLAogICAgICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW09Tm9uZSwKICAgICAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdD1Ob25lLAogICAgICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gZGVmYXVsdF9vcHRpb25hbF9waXBlbGluZSgpICAjIHVzZSBkZWZhdWx0IHBpcGVsaW5lIHBhcmFtZXRlcgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUsIGV4cGVyaW1lbnRfbmFtZT0iZGVmYXVsdF9vcHRpb25hbF9waXBlbGluZSIpCgogICAgICAgICMgb25seSB0aGUgdHdvIHJlcXVpcmVkIGlucHV0IGV4aXN0cwogICAgICAgIGFzc2VydCBsZW4ocGlwZWxpbmVfam9iLmpvYnNbImRlZmF1bHRfb3B0aW9uYWxfY29tcG9uZW50Il0uaW5wdXRzKSA9PSAyCiAgICAgICAgIyBUT0RPOiBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQgc2hvdWxkIGFsc28gZXhpc3RzCiAgICAgICAgYXNzZXJ0IGxlbihwaXBlbGluZV9qb2Iuam9ic1siZGVmYXVsdF9vcHRpb25hbF9jb21wb25lbnRfMSJdLmlucHV0cykgPT0gMgoKICAgIGRlZiB0ZXN0X3BpcGVsaW5lX3dpdGhfbm9uZV9wYXJhbWV0ZXJfaGFzX2RlZmF1bHRfb3B0aW9uYWxfZmFsc2Uoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9c3RyKGNvbXBvbmVudHNfZGlyIC8gImRlZmF1bHRfb3B0aW9uYWxfY29tcG9uZW50LnltbCIpKQoKICAgICAgICAjIE5vbmUgaW5wdXQgaXMgYmluZGluZyB0byBhIHJlcXVpcmVkIGlucHV0CiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgKQogICAgICAgIGRlZiBwaXBlbGluZV93aXRoX2RlZmF1bHRfb3B0aW9uYWxfcGFyYW1ldGVycygKICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgKToKICAgICAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jKAogICAgICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9cmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbT1yZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdD1yZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV93aXRoX2RlZmF1bHRfb3B0aW9uYWxfcGFyYW1ldGVycygKICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9SW5wdXQodHlwZT0idXJpX2ZpbGUiLCBwYXRoPSJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIpLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbT0iaGVsbG8iLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQ9Tm9uZSwKICAgICAgICApCiAgICAgICAgdmFsaWRhdGVfcmVzdWx0ID0gcGlwZWxpbmUuX3ZhbGlkYXRlKCkKICAgICAgICBhc3NlcnQgdmFsaWRhdGVfcmVzdWx0LmVycm9yX21lc3NhZ2VzID09IHsKICAgICAgICAgICAgImlucHV0cy5yZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQiOiAiUmVxdWlyZWQgaW5wdXQgJ3JlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCcgZm9yIHBpcGVsaW5lICdwaXBlbGluZV93aXRoX2RlZmF1bHRfb3B0aW9uYWxfcGFyYW1ldGVycycgbm90IHByb3ZpZGVkLiIKICAgICAgICB9CgogICAgICAgICMgTm9uZSBpbnB1dCBpcyBub3QgYmluZGluZyB0byBhIHJlcXVpcmVkIGlucHV0CiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgKQogICAgICAgIGRlZiBwaXBlbGluZV93aXRoX2RlZmF1bHRfb3B0aW9uYWxfcGFyYW1ldGVycygKICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtLAogICAgICAgICk6CiAgICAgICAgICAgIGRlZmF1bHRfb3B0aW9uYWxfZnVuYygKICAgICAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PXJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09cmVxdWlyZWRfcGFyYW0sCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQ9Tm9uZSwKICAgICAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX3dpdGhfZGVmYXVsdF9vcHRpb25hbF9wYXJhbWV0ZXJzKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1JbnB1dCh0eXBlPSJ1cmlfZmlsZSIsIHBhdGg9Imh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IiksCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPSJoZWxsbyIsCiAgICAgICAgKQogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUsIGV4cGVyaW1lbnRfbmFtZT0iZGVmYXVsdF9vcHRpb25hbF9waXBlbGluZSIpCgogICAgICAgICMgb25seSB0aGUgdHdvIHJlcXVpcmVkIGlucHV0cyBleGlzdHMKICAgICAgICBhc3NlcnQgbGVuKG5leHQocGlwZWxpbmVfam9iLmpvYnMudmFsdWVzKCkuX19pdGVyX18oKSkuaW5wdXRzKSA9PSAyCiAgICAgICAgdmFsaWRhdGVfcmVzdWx0ID0gcGlwZWxpbmUuX3ZhbGlkYXRlKCkKICAgICAgICBhc3NlcnQgdmFsaWRhdGVfcmVzdWx0LnBhc3NlZCBpcyBUcnVlCgogICAgICAgICMgTm90IHBhc3MgcmVxdWlyZWQgcGFyYW1ldGVyIHdpdGggZGVmYXVsdCB2YWx1ZQogICAgICAgIEBkc2wucGlwZWxpbmUoCiAgICAgICAgICAgIGRlZmF1bHRfY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICkKICAgICAgICBkZWYgcGlwZWxpbmVfd2l0aF9kZWZhdWx0X29wdGlvbmFsX3BhcmFtZXRlcnMoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbSwKICAgICAgICApOgogICAgICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMoCiAgICAgICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1yZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPXJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmVfd2l0aF9kZWZhdWx0X29wdGlvbmFsX3BhcmFtZXRlcnMoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PUlucHV0KHR5cGU9InVyaV9maWxlIiwgcGF0aD0iaHR0cHM6Ly9kcHJlcGRhdGEuYmxvYi5jb3JlLndpbmRvd3MubmV0L2RlbW8vVGl0YW5pYy5jc3YiKSwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09ImhlbGxvIiwKICAgICAgICApCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSwgZXhwZXJpbWVudF9uYW1lPSJkZWZhdWx0X29wdGlvbmFsX3BpcGVsaW5lIikKICAgICAgICAjIG9ubHkgdGhlIHR3byByZXF1aXJlZCBpbnB1dCBleGlzdHMKICAgICAgICBhc3NlcnQgbGVuKG5leHQocGlwZWxpbmVfam9iLmpvYnMudmFsdWVzKCkuX19pdGVyX18oKSkuaW5wdXRzKSA9PSAyCiAgICAgICAgdmFsaWRhdGVfcmVzdWx0ID0gcGlwZWxpbmUuX3ZhbGlkYXRlKCkKICAgICAgICBhc3NlcnQgdmFsaWRhdGVfcmVzdWx0LnBhc3NlZCBpcyBUcnVlCgogICAgZGVmIHRlc3RfcGlwZWxpbmVfd2l0aF9ub25lX3BhcmFtZXRlcl9ub19kZWZhdWx0X29wdGlvbmFsX3RydWUoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9c3RyKGNvbXBvbmVudHNfZGlyIC8gImRlZmF1bHRfb3B0aW9uYWxfY29tcG9uZW50LnltbCIpKQoKICAgICAgICAjIE5vbmUgaW5wdXQgaXMgYmluZGluZyB0byBhIG9wdGlvbmFsIGlucHV0CgogICAgICAgIEBkc2wucGlwZWxpbmUoCiAgICAgICAgICAgIGRlZmF1bHRfY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICkKICAgICAgICBkZWYgcGlwZWxpbmVfd2l0aF9kZWZhdWx0X29wdGlvbmFsX3BhcmFtZXRlcnMoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbSwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICk6CiAgICAgICAgICAgIGRlZmF1bHRfb3B0aW9uYWxfZnVuYygKICAgICAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PXJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09cmVxdWlyZWRfcGFyYW0sCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQ9cmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW09b3B0aW9uYWxfcGFyYW0sCiAgICAgICAgICAgICAgICBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQ9b3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmVfd2l0aF9kZWZhdWx0X29wdGlvbmFsX3BhcmFtZXRlcnMoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PUlucHV0KHR5cGU9InVyaV9maWxlIiwgcGF0aD0iaHR0cHM6Ly9kcHJlcGRhdGEuYmxvYi5jb3JlLndpbmRvd3MubmV0L2RlbW8vVGl0YW5pYy5jc3YiKSwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09ImhlbGxvIiwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0PSJyZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQiLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbT1Ob25lLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQ9Im9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCIsCiAgICAgICAgKQogICAgICAgICMgdG9kbzogdW5jb21tZW50IHRoaXMgd2hlbiBiYWNrZW5kIHJlbW92ZSBjb21wb25lbnQgam9iIG9wdGlvbmFsIGlucHV0IHdoaWNoIGlzIGJpbmRpbmcgdG8gYSBOb25lIHBpcGVsaW5lCiAgICAgICAgIyAgaW5wdXQKICAgICAgICAjIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUsIGV4cGVyaW1lbnRfbmFtZT0iZGVmYXVsdF9vcHRpb25hbF9waXBlbGluZSIpCiAgICAgICAgYXNzZXJ0ICJvcHRpb25hbF9wYXJhbSIgbm90IGluIHBpcGVsaW5lLmlucHV0cwoKICAgICAgICAjIGFzc2VydCAib3B0aW9uYWxfcGFyYW0iIG5vdCBpbiBwaXBlbGluZV9qb2IuaW5wdXRzCiAgICAgICAgIyBhc3NlcnQgIm9wdGlvbmFsX3BhcmFtIiBub3QgaW4gbmV4dChwaXBlbGluZV9qb2Iuam9icy52YWx1ZXMoKS5fX2l0ZXJfXygpKS5pbnB1dHMKCiAgICAgICAgIyBOb25lIGlucHV0IGlzIG5vdCBiaW5kaW5nIHRvIGEgb3B0aW9uYWwgaW5wdXQKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBkZWZhdWx0X2NvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICApCiAgICAgICAgZGVmIHBpcGVsaW5lX3dpdGhfZGVmYXVsdF9vcHRpb25hbF9wYXJhbWV0ZXJzKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW0sCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW0sCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICApOgogICAgICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMoCiAgICAgICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1yZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPXJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0PXJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtPU5vbmUsCiAgICAgICAgICAgICAgICBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQ9b3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmVfd2l0aF9kZWZhdWx0X29wdGlvbmFsX3BhcmFtZXRlcnMoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PUlucHV0KHR5cGU9InVyaV9maWxlIiwgcGF0aD0iaHR0cHM6Ly9kcHJlcGRhdGEuYmxvYi5jb3JlLndpbmRvd3MubmV0L2RlbW8vVGl0YW5pYy5jc3YiKSwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09ImhlbGxvIiwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0PSJyZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQiLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbT1Ob25lLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQ9Im9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCIsCiAgICAgICAgKQogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUsIGV4cGVyaW1lbnRfbmFtZT0iZGVmYXVsdF9vcHRpb25hbF9waXBlbGluZSIpCiAgICAgICAgYXNzZXJ0ICJvcHRpb25hbF9wYXJhbSIgbm90IGluIHBpcGVsaW5lLmlucHV0cwogICAgICAgIGFzc2VydCAib3B0aW9uYWxfcGFyYW0iIG5vdCBpbiBwaXBlbGluZV9qb2IuaW5wdXRzCgogICAgICAgICMgTm90IHBhc3MgcmVxdWlyZWQgcGFyYW1ldGVyIHdpdGggZGVmYXVsdCB2YWx1ZQogICAgICAgIEBkc2wucGlwZWxpbmUoCiAgICAgICAgICAgIGRlZmF1bHRfY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICkKICAgICAgICBkZWYgcGlwZWxpbmVfd2l0aF9kZWZhdWx0X29wdGlvbmFsX3BhcmFtZXRlcnMoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbSwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICk6CiAgICAgICAgICAgIGRlZmF1bHRfb3B0aW9uYWxfZnVuYygKICAgICAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PXJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09cmVxdWlyZWRfcGFyYW0sCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQ9cmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0PW9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX3dpdGhfZGVmYXVsdF9vcHRpb25hbF9wYXJhbWV0ZXJzKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1JbnB1dCh0eXBlPSJ1cmlfZmlsZSIsIHBhdGg9Imh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IiksCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPSJoZWxsbyIsCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdD0icmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0IiwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW09Tm9uZSwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0PSJvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQiLAogICAgICAgICkKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lLCBleHBlcmltZW50X25hbWU9ImRlZmF1bHRfb3B0aW9uYWxfcGlwZWxpbmUiKQogICAgICAgIGFzc2VydCAib3B0aW9uYWxfcGFyYW0iIG5vdCBpbiBwaXBlbGluZS5pbnB1dHMKICAgICAgICBhc3NlcnQgIm9wdGlvbmFsX3BhcmFtIiBub3QgaW4gcGlwZWxpbmVfam9iLmlucHV0cwoKICAgIGRlZiB0ZXN0X2NoZWNrX3BpcGVsaW5lX2NvbXBvbmVudF9wYXJhbWV0ZXIoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPXN0cihjb21wb25lbnRzX2RpciAvICJkZWZhdWx0X29wdGlvbmFsX2NvbXBvbmVudC55bWwiKSkKCiAgICAgICAgQGRzbC5waXBlbGluZSgpCiAgICAgICAgZGVmIHBpcGVsaW5lX21pc3NpbmdfdHlwZSgKICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgKToKICAgICAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jKAogICAgICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9cmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbT1yZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdD1yZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgICAgICBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQ9b3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICAgICApCgogICAgICAgIHdpdGggcHl0ZXN0LnJhaXNlcyhWYWxpZGF0aW9uRXhjZXB0aW9uKSBhcyBlOgogICAgICAgICAgICBjbGllbnQuY29tcG9uZW50cy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lX21pc3NpbmdfdHlwZSkKCiAgICAgICAgYXNzZXJ0ICgKICAgICAgICAgICAgIlVua25vd24gdHlwZSBvZiBwYXJhbWV0ZXIgWydyZXF1aXJlZF9pbnB1dCcsICdyZXF1aXJlZF9wYXJhbScsICdyZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQnLCAnb3B0aW9uYWxfcGFyYW0nLCAnb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0J10gaW4gcGlwZWxpbmUgZnVuYyAncGlwZWxpbmVfbWlzc2luZ190eXBlJyIKICAgICAgICAgICAgaW4gZS52YWx1ZS5tZXNzYWdlCiAgICAgICAgKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKG5vbl9waXBlbGluZV9pbnB1dHM9WyJwYXJhbSJdKQogICAgICAgIGRlZiBwaXBlbGluZV93aXRoX25vbl9waXBlbGluZV9pbnB1dHMoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0OiBJbnB1dCwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW06IHN0ciwKICAgICAgICAgICAgcGFyYW06IHN0ciwKICAgICAgICApOgogICAgICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMoCiAgICAgICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1yZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPXJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICApCgogICAgICAgIHdpdGggcHl0ZXN0LnJhaXNlcyhWYWxpZGF0aW9uRXhjZXB0aW9uKSBhcyBlOgogICAgICAgICAgICBjbGllbnQuY29tcG9uZW50cy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lX3dpdGhfbm9uX3BpcGVsaW5lX2lucHV0cykKICAgICAgICBhc3NlcnQgKAogICAgICAgICAgICAiQ2Fubm90IHJlZ2lzdGVyIHBpcGVsaW5lIGNvbXBvbmVudCAncGlwZWxpbmVfd2l0aF9ub25fcGlwZWxpbmVfaW5wdXRzJyB3aXRoIG5vbl9waXBlbGluZV9pbnB1dHMuIgogICAgICAgICAgICBpbiBlLnZhbHVlLm1lc3NhZ2UKICAgICAgICApCgogICAgICAgIEBkc2wucGlwZWxpbmUoKQogICAgICAgIGRlZiBwaXBlbGluZV93aXRoX3ZhcmlhYmxlX2lucHV0cyhyZXF1aXJlZF9pbnB1dDogSW5wdXQsIHJlcXVpcmVkX3BhcmFtOiBzdHIsICphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgICAgIGRlZmF1bHRfb3B0aW9uYWxfZnVuYygKICAgICAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PXJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09cmVxdWlyZWRfcGFyYW0sCiAgICAgICAgICAgICkKCiAgICAgICAgd2l0aCBweXRlc3QucmFpc2VzKFZhbGlkYXRpb25FeGNlcHRpb24pIGFzIGU6CiAgICAgICAgICAgIGNsaWVudC5jb21wb25lbnRzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmVfd2l0aF92YXJpYWJsZV9pbnB1dHMpCiAgICAgICAgYXNzZXJ0ICgKICAgICAgICAgICAgIkNhbm5vdCByZWdpc3RlciB0aGUgY29tcG9uZW50IHBpcGVsaW5lX3dpdGhfdmFyaWFibGVfaW5wdXRzIHdpdGggdmFyaWFibGUgaW5wdXRzIFsnYXJncycsICdrd2FyZ3MnXSIKICAgICAgICAgICAgaW4gZS52YWx1ZS5tZXNzYWdlCiAgICAgICAgKQoKICAgIGRlZiB0ZXN0X2NyZWF0ZV9waXBlbGluZV9jb21wb25lbnRfYnlfZHNsKHNlbGYsIGNhcGxvZywgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPXN0cihjb21wb25lbnRzX2RpciAvICJkZWZhdWx0X29wdGlvbmFsX2NvbXBvbmVudC55bWwiKSkKCiAgICAgICAgQGRzbC5waXBlbGluZShjb250aW51ZV9vbl9zdGVwX2ZhaWx1cmU9VHJ1ZSwgZm9yY2VfcmVydW49VHJ1ZSwgZGVmYXVsdF9kYXRhc3RvcmU9InRlc3QiKQogICAgICAgIGRlZiB2YWxpZF9waXBlbGluZV9mdW5jKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dDogSW5wdXQsCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtOiBzdHIsCiAgICAgICAgICAgIG5vZGVfY29tcHV0ZTogc3RyID0gImNwdS1jbHVzdGVyIiwKICAgICAgICApOgogICAgICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMoCiAgICAgICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1yZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPXJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICApCiAgICAgICAgICAgIG5vZGUyID0gZGVmYXVsdF9vcHRpb25hbF9mdW5jKAogICAgICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9cmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbT1yZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgKQogICAgICAgICAgICBub2RlMi5jb21wdXRlID0gbm9kZV9jb21wdXRlCgogICAgICAgIGNvbXBvbmVudCA9IHZhbGlkX3BpcGVsaW5lX2Z1bmMuX3BpcGVsaW5lX2J1aWxkZXIuYnVpbGQodXNlcl9wcm92aWRlZF9rd2FyZ3M9e30pCiAgICAgICAgYXNzZXJ0IGNvbXBvbmVudC5fYXV0b19pbmNyZW1lbnRfdmVyc2lvbiBpcyBUcnVlCiAgICAgICAgIyBTZXQgb3JpZ2luYWwgbW9kdWxlX2xvZ2dlciB3aXRoIHBrZyBuYW1lIHRvICdPcGVyYXRpb24nIHRvIGVuYWJsZSBjYXBsb2cgY2FwdHVyZSBsb2dzCiAgICAgICAgZnJvbSBhenVyZS5haS5tbC5vcGVyYXRpb25zIGltcG9ydCBfY29tcG9uZW50X29wZXJhdGlvbnMKCiAgICAgICAgX2NvbXBvbmVudF9vcGVyYXRpb25zLm1vZHVsZV9sb2dnZXIgPSBsb2dnaW5nLmdldExvZ2dlcigiT3BlcmF0aW9uIikKCiAgICAgICAgIyBBc3NlcnQgYmluZGluZyBvbiBjb21wdXRlIG5vdCBjaGFuZ2VkIGFmdGVyIHJlc29sdmUgZGVwZW5kZW5jaWVzCiAgICAgICAgY2xpZW50LmNvbXBvbmVudHMuX3Jlc29sdmVfZGVwZW5kZW5jaWVzX2Zvcl9waXBlbGluZV9jb21wb25lbnRfam9icygKICAgICAgICAgICAgY29tcG9uZW50LCByZXNvbHZlcj1jbGllbnQuY29tcG9uZW50cy5fb3JjaGVzdHJhdG9ycy5nZXRfYXNzZXRfYXJtX2lkLCByZXNvbHZlX2lucHV0cz1GYWxzZQogICAgICAgICkKICAgICAgICBhc3NlcnQgY29tcG9uZW50LmpvYnNbIm5vZGUyIl0uY29tcHV0ZSA9PSAiJHt7cGFyZW50LmlucHV0cy5ub2RlX2NvbXB1dGV9fSIKCiAgICAgICAgd2l0aCBjYXBsb2cuYXRfbGV2ZWwobG9nZ2luZy5XQVJOSU5HKToKICAgICAgICAgICAgY2xpZW50LmNvbXBvbmVudHMuY3JlYXRlX29yX3VwZGF0ZSh2YWxpZF9waXBlbGluZV9mdW5jKQogICAgICAgIGFzc2VydCAoCiAgICAgICAgICAgICJKb2Igc2V0dGluZ3MgeydkZWZhdWx0X2RhdGFzdG9yZSc6ICd0ZXN0JywgJ2NvbnRpbnVlX29uX3N0ZXBfZmFpbHVyZSc6IFRydWUsICdmb3JjZV9yZXJ1bic6IFRydWV9IG9uIHBpcGVsaW5lIGZ1bmN0aW9uICd2YWxpZF9waXBlbGluZV9mdW5jJyBhcmUgaWdub3JlZCB3aGVuIGNyZWF0aW5nIFBpcGVsaW5lQ29tcG9uZW50LiIKICAgICAgICAgICAgaW4gY2FwbG9nLm1lc3NhZ2VzCiAgICAgICAgKQoKICAgIGRlZiB0ZXN0X2NyZWF0ZV9waXBlbGluZV93aXRoX3BhcmFtZXRlcl9ncm91cChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGRlZmF1bHRfb3B0aW9uYWxfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1zdHIoY29tcG9uZW50c19kaXIgLyAiZGVmYXVsdF9vcHRpb25hbF9jb21wb25lbnQueW1sIikpCgogICAgICAgIEBncm91cAogICAgICAgIGNsYXNzIFN1Ykdyb3VwOgogICAgICAgICAgICByZXF1aXJlZF9wYXJhbTogc3RyCgogICAgICAgIEBncm91cAogICAgICAgIGNsYXNzIEdyb3VwOgogICAgICAgICAgICBzdWI6IFN1Ykdyb3VwCiAgICAgICAgICAgIG5vZGVfY29tcHV0ZTogc3RyID0gImNwdS1jbHVzdGVyIgoKICAgICAgICBAZHNsLnBpcGVsaW5lKCkKICAgICAgICBkZWYgc3ViX3BpcGVsaW5lX2Z1bmMoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0OiBJbnB1dCwKICAgICAgICAgICAgZ3JvdXA6IEdyb3VwLAogICAgICAgICAgICBzdWJfZ3JvdXA6IFN1Ykdyb3VwLAogICAgICAgICk6CiAgICAgICAgICAgIGRlZmF1bHRfb3B0aW9uYWxfZnVuYygKICAgICAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PXJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09Z3JvdXAuc3ViLnJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICApCiAgICAgICAgICAgIG5vZGUyID0gZGVmYXVsdF9vcHRpb25hbF9mdW5jKAogICAgICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9cmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbT1zdWJfZ3JvdXAucmVxdWlyZWRfcGFyYW0sCiAgICAgICAgICAgICkKICAgICAgICAgICAgbm9kZTIuY29tcHV0ZSA9IGdyb3VwLm5vZGVfY29tcHV0ZQoKICAgICAgICBAZHNsLnBpcGVsaW5lKGRlZmF1bHRfY29tcHV0ZT0iY3B1LWNsdXN0ZXIiKQogICAgICAgIGRlZiByb290X3BpcGVsaW5lX3dpdGhfZ3JvdXAoCiAgICAgICAgICAgIHJfcmVxdWlyZWRfaW5wdXQ6IElucHV0LAogICAgICAgICAgICByX2dyb3VwOiBHcm91cCwKICAgICAgICApOgogICAgICAgICAgICBzdWJfcGlwZWxpbmVfZnVuYyhyZXF1aXJlZF9pbnB1dD1yX3JlcXVpcmVkX2lucHV0LCBncm91cD1yX2dyb3VwLCBzdWJfZ3JvdXA9cl9ncm91cC5zdWIpCgogICAgICAgIGpvYiA9IHJvb3RfcGlwZWxpbmVfd2l0aF9ncm91cCgKICAgICAgICAgICAgcl9yZXF1aXJlZF9pbnB1dD1JbnB1dCh0eXBlPSJ1cmlfZmlsZSIsIHBhdGg9Imh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IiksCiAgICAgICAgICAgIHJfZ3JvdXA9R3JvdXAoc3ViPVN1Ykdyb3VwKHJlcXVpcmVkX3BhcmFtPSJoZWxsbyIpKSwKICAgICAgICApCiAgICAgICAgcmVzdF9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChqb2IsIGNsaWVudCkKICAgICAgICBhc3NlcnQgbGVuKHJlc3Rfam9iLmlucHV0cykgPT0gMgogICAgICAgIHJlc3Rfam9iX2RpY3QgPSByZXN0X2pvYi5fdG9fZGljdCgpCiAgICAgICAgYXNzZXJ0IHJlc3Rfam9iX2RpY3RbImlucHV0cyJdID09IHsKICAgICAgICAgICAgInJfcmVxdWlyZWRfaW5wdXQiOiB7CiAgICAgICAgICAgICAgICAibW9kZSI6ICJyb19tb3VudCIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJ1cmlfZmlsZSIsCiAgICAgICAgICAgICAgICAicGF0aCI6ICJhenVyZW1sOmh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInJfZ3JvdXAuc3ViLnJlcXVpcmVkX3BhcmFtIjogImhlbGxvIiwKICAgICAgICAgICAgInJfZ3JvdXAubm9kZV9jb21wdXRlIjogImNwdS1jbHVzdGVyIiwKICAgICAgICB9CiAgICAgICAgYXNzZXJ0IHJlc3Rfam9iX2RpY3RbImpvYnMiXVsic3ViX3BpcGVsaW5lX2Z1bmMiXVsiaW5wdXRzIl0gPT0gewogICAgICAgICAgICAicmVxdWlyZWRfaW5wdXQiOiB7InBhdGgiOiAiJHt7cGFyZW50LmlucHV0cy5yX3JlcXVpcmVkX2lucHV0fX0ifSwKICAgICAgICAgICAgImdyb3VwLnN1Yi5yZXF1aXJlZF9wYXJhbSI6IHsicGF0aCI6ICIke3twYXJlbnQuaW5wdXRzLnJfZ3JvdXAuc3ViLnJlcXVpcmVkX3BhcmFtfX0ifSwKICAgICAgICAgICAgImdyb3VwLm5vZGVfY29tcHV0ZSI6IHsicGF0aCI6ICIke3twYXJlbnQuaW5wdXRzLnJfZ3JvdXAubm9kZV9jb21wdXRlfX0ifSwKICAgICAgICAgICAgInN1Yl9ncm91cC5yZXF1aXJlZF9wYXJhbSI6IHsicGF0aCI6ICIke3twYXJlbnQuaW5wdXRzLnJfZ3JvdXAuc3ViLnJlcXVpcmVkX3BhcmFtfX0ifSwKICAgICAgICB9CgogICAgZGVmIHRlc3RfcGlwZWxpbmVfd2l0aF9ub25lX3BhcmFtZXRlcl9oYXNfZGVmYXVsdF9vcHRpb25hbF90cnVlKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPXN0cihjb21wb25lbnRzX2RpciAvICJkZWZhdWx0X29wdGlvbmFsX2NvbXBvbmVudC55bWwiKSkKCiAgICAgICAgIyBOb25lIGlucHV0IGlzIGJpbmRpbmcgdG8gYSBvcHRpb25hbCBpbnB1dAoKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBkZWZhdWx0X2NvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICApCiAgICAgICAgZGVmIHBpcGVsaW5lX3dpdGhfZGVmYXVsdF9vcHRpb25hbF9wYXJhbWV0ZXJzKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW0sCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW0sCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICApOgogICAgICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMoCiAgICAgICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1yZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPXJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0PXJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtPW9wdGlvbmFsX3BhcmFtLAogICAgICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0PW9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX3dpdGhfZGVmYXVsdF9vcHRpb25hbF9wYXJhbWV0ZXJzKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1JbnB1dCh0eXBlPSJ1cmlfZmlsZSIsIHBhdGg9Imh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IiksCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPSJoZWxsbyIsCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdD0icmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0IiwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW09Im9wdGlvbmFsX3BhcmFtIiwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0PU5vbmUsCiAgICAgICAgKQogICAgICAgICMgdG9kbzogdW5jb21tZW50IHRoaXMgd2hlbiBiYWNrZW5kIHJlbW92ZSBjb21wb25lbnQgam9iIG9wdGlvbmFsIGlucHV0IHdoaWNoIGlzIGJpbmRpbmcgdG8gYSBOb25lIHBpcGVsaW5lCiAgICAgICAgIyAgaW5wdXQKICAgICAgICAjIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUsIGV4cGVyaW1lbnRfbmFtZT0iZGVmYXVsdF9vcHRpb25hbF9waXBlbGluZSIpCiAgICAgICAgYXNzZXJ0ICJvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQiIG5vdCBpbiBwaXBlbGluZS5pbnB1dHMKCiAgICAgICAgIyBhc3NlcnQgIm9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCIgbm90IGluIHBpcGVsaW5lX2pvYi5pbnB1dHMKICAgICAgICAjIGFzc2VydCAib3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0IiBub3QgaW4gbmV4dChwaXBlbGluZV9qb2Iuam9icy52YWx1ZXMoKS5fX2l0ZXJfXygpKS5pbnB1dHMKCiAgICAgICAgIyBOb25lIGlucHV0IGlzIG5vdCBiaW5kaW5nIHRvIGEgb3B0aW9uYWwgaW5wdXQKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBkZWZhdWx0X2NvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICApCiAgICAgICAgZGVmIHBpcGVsaW5lX3dpdGhfZGVmYXVsdF9vcHRpb25hbF9wYXJhbWV0ZXJzKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW0sCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW0sCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICApOgogICAgICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMoCiAgICAgICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1yZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPXJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0PXJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtPW9wdGlvbmFsX3BhcmFtLAogICAgICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0PU5vbmUsCiAgICAgICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV93aXRoX2RlZmF1bHRfb3B0aW9uYWxfcGFyYW1ldGVycygKICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9SW5wdXQodHlwZT0idXJpX2ZpbGUiLCBwYXRoPSJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIpLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbT0iaGVsbG8iLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQ9InJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCIsCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtPSJvcHRpb25hbF9wYXJhbSIsCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdD1Ob25lLAogICAgICAgICkKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lLCBleHBlcmltZW50X25hbWU9ImRlZmF1bHRfb3B0aW9uYWxfcGlwZWxpbmUiKQogICAgICAgIGFzc2VydCAib3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0IiBub3QgaW4gcGlwZWxpbmUuaW5wdXRzCiAgICAgICAgYXNzZXJ0ICJvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQiIG5vdCBpbiBwaXBlbGluZV9qb2IuaW5wdXRzCgogICAgICAgICMgTm90IHBhc3MgcmVxdWlyZWQgcGFyYW1ldGVyIHdpdGggZGVmYXVsdCB2YWx1ZQogICAgICAgIEBkc2wucGlwZWxpbmUoCiAgICAgICAgICAgIGRlZmF1bHRfY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICkKICAgICAgICBkZWYgcGlwZWxpbmVfd2l0aF9kZWZhdWx0X29wdGlvbmFsX3BhcmFtZXRlcnMoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbSwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbSwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICk6CiAgICAgICAgICAgIGRlZmF1bHRfb3B0aW9uYWxfZnVuYygKICAgICAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PXJlcXVpcmVkX2lucHV0LAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09cmVxdWlyZWRfcGFyYW0sCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQ9cmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0LAogICAgICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW09b3B0aW9uYWxfcGFyYW0sCiAgICAgICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV93aXRoX2RlZmF1bHRfb3B0aW9uYWxfcGFyYW1ldGVycygKICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9SW5wdXQodHlwZT0idXJpX2ZpbGUiLCBwYXRoPSJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIpLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbT0iaGVsbG8iLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQ9InJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCIsCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtPSJvcHRpb25hbF9wYXJhbSIsCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdD1Ob25lLAogICAgICAgICkKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lLCBleHBlcmltZW50X25hbWU9ImRlZmF1bHRfb3B0aW9uYWxfcGlwZWxpbmUiKQogICAgICAgIGFzc2VydCAib3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0IiBub3QgaW4gcGlwZWxpbmUuaW5wdXRzCiAgICAgICAgYXNzZXJ0ICJvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQiIG5vdCBpbiBwaXBlbGluZV9qb2IuaW5wdXRzCgogICAgICAgICMgUGFzcyBub3Qtbm9uZSB2YWx1ZSB0byBjb21wb25lbnQgZnVuYyBkaXJlY3RseSBidXQgc2V0IG5vbmUgaW4gcGlwZWxpbmUgcGFyYW1ldGVyCiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgKQogICAgICAgIGRlZiBwaXBlbGluZV93aXRoX2RlZmF1bHRfb3B0aW9uYWxfcGFyYW1ldGVycygKICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQsCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgKToKICAgICAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jKAogICAgICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9SW5wdXQodHlwZT0idXJpX2ZpbGUiLCBwYXRoPSJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIpLAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW09cmVxdWlyZWRfcGFyYW0sCiAgICAgICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQ9InJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCIsCiAgICAgICAgICAgICAgICBvcHRpb25hbF9wYXJhbT0ib3B0aW9uYWxfcGFyYW0iLAogICAgICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0PSJvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQiLAogICAgICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmVfd2l0aF9kZWZhdWx0X29wdGlvbmFsX3BhcmFtZXRlcnMoCiAgICAgICAgICAgIHJlcXVpcmVkX2lucHV0PU5vbmUsCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPSJoZWxsbyIsCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdD1Ob25lLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbT1Ob25lLAogICAgICAgICAgICBvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQ9Tm9uZSwKICAgICAgICApCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSwgZXhwZXJpbWVudF9uYW1lPSJkZWZhdWx0X29wdGlvbmFsX3BpcGVsaW5lIikKICAgICAgICBhc3NlcnQgInJlcXVpcmVkX2lucHV0IiBub3QgaW4gcGlwZWxpbmUuaW5wdXRzCiAgICAgICAgYXNzZXJ0ICJyZXF1aXJlZF9pbnB1dCIgbm90IGluIHBpcGVsaW5lX2pvYi5pbnB1dHMKICAgICAgICBhc3NlcnQgInJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCIgbm90IGluIHBpcGVsaW5lLmlucHV0cwogICAgICAgIGFzc2VydCAicmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0IiBub3QgaW4gcGlwZWxpbmVfam9iLmlucHV0cwogICAgICAgIGFzc2VydCAib3B0aW9uYWxfcGFyYW0iIG5vdCBpbiBwaXBlbGluZS5pbnB1dHMKICAgICAgICBhc3NlcnQgIm9wdGlvbmFsX3BhcmFtIiBub3QgaW4gcGlwZWxpbmVfam9iLmlucHV0cwogICAgICAgIGFzc2VydCAib3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0IiBub3QgaW4gcGlwZWxpbmUuaW5wdXRzCiAgICAgICAgYXNzZXJ0ICJvcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQiIG5vdCBpbiBwaXBlbGluZV9qb2IuaW5wdXRzCgogICAgZGVmIHRlc3RfcGlwZWxpbmVfd2l0aF9ub25lX3BhcmFtZXRlcl9iaW5kaW5nX3RvX3R3b19jb21wb25lbnRfaW5wdXRzKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZGVmYXVsdF9vcHRpb25hbF9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPXN0cihjb21wb25lbnRzX2RpciAvICJkZWZhdWx0X29wdGlvbmFsX2NvbXBvbmVudC55bWwiKSkKCiAgICAgICAgIyBOb25lIHBpcGVsaW5lIHBhcmFtZXRlciBpcyBiaW5kaW5nIHRvIHR3byBvcHRpb25hbCBjb21wb25lbnQgaW5wdXQsIHJlbW92ZWQgTm9uZSBpbnB1dAoKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBkZWZhdWx0X2NvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICApCiAgICAgICAgZGVmIHBpcGVsaW5lX3dpdGhfZGVmYXVsdF9vcHRpb25hbF9wYXJhbWV0ZXJzKAogICAgICAgICAgICByZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW0sCiAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW0sCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICApOgogICAgICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMoCiAgICAgICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1yZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPXJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0PXJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtPW9wdGlvbmFsX3BhcmFtLAogICAgICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0PW9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgKQogICAgICAgICAgICBkZWZhdWx0X29wdGlvbmFsX2Z1bmMoCiAgICAgICAgICAgICAgICByZXF1aXJlZF9pbnB1dD1yZXF1aXJlZF9pbnB1dCwKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3BhcmFtPXJlcXVpcmVkX3BhcmFtLAogICAgICAgICAgICAgICAgcmVxdWlyZWRfcGFyYW1fd2l0aF9kZWZhdWx0PXJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtPW9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCwKICAgICAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdD1vcHRpb25hbF9wYXJhbV93aXRoX2RlZmF1bHQsCiAgICAgICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV93aXRoX2RlZmF1bHRfb3B0aW9uYWxfcGFyYW1ldGVycygKICAgICAgICAgICAgcmVxdWlyZWRfaW5wdXQ9SW5wdXQodHlwZT0idXJpX2ZpbGUiLCBwYXRoPSJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIpLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbT0iaGVsbG8iLAogICAgICAgICAgICByZXF1aXJlZF9wYXJhbV93aXRoX2RlZmF1bHQ9InJlcXVpcmVkX3BhcmFtX3dpdGhfZGVmYXVsdCIsCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtPSJvcHRpb25hbF9wYXJhbSIsCiAgICAgICAgICAgIG9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdD1Ob25lLAogICAgICAgICkKICAgICAgICAjIHRvZG86IHVuY29tbWVudCB0aGlzIHdoZW4gYmFja2VuZCByZW1vdmUgY29tcG9uZW50IGpvYiBvcHRpb25hbCBpbnB1dCB3aGljaCBpcyBiaW5kaW5nIHRvIGEgTm9uZSBwaXBlbGluZQogICAgICAgICMgIGlucHV0CiAgICAgICAgIyBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lLCBleHBlcmltZW50X25hbWU9ImRlZmF1bHRfb3B0aW9uYWxfcGlwZWxpbmUiKQogICAgICAgIGFzc2VydCAib3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0IiBub3QgaW4gcGlwZWxpbmUuaW5wdXRzCiAgICAgICAgIyBhc3NlcnQgIm9wdGlvbmFsX3BhcmFtX3dpdGhfZGVmYXVsdCIgbm90IGluIHBpcGVsaW5lX2pvYi5pbnB1dHMKICAgICAgICAjIGFzc2VydCAib3B0aW9uYWxfcGFyYW1fd2l0aF9kZWZhdWx0IiBub3QgaW4gbmV4dChwaXBlbGluZV9qb2Iuam9icy52YWx1ZXMoKS5fX2l0ZXJfXygpKS5pbnB1dHMKCiAgICBAcHl0ZXN0Lm1hcmsuZGlzYWJsZV9tb2NrX2NvZGVfaGFzaAogICAgQHB5dGVzdC5tYXJrLnNraXBpZihjb25kaXRpb249bm90IGlzX2xpdmUoKSwgcmVhc29uPSJyZXVzZSB0ZXN0LCB0YXJnZXQgdG8gdmVyaWZ5IHNlcnZpY2Utc2lkZSBiZWhhdmlvciIpCiAgICBkZWYgdGVzdF9jb21wb25lbnRfcmV1c2Uoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBwYXRoID0gIi4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnQueW1sIgogICAgICAgIGNvbXBvbmVudF9mdW5jMSA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1wYXRoKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKCkKICAgICAgICBkZWYgcGlwZWxpbmUoY29tcG9uZW50X2luX251bWJlciwgY29tcG9uZW50X2luX3BhdGgpOgogICAgICAgICAgICBub2RlMSA9IGNvbXBvbmVudF9mdW5jMShjb21wb25lbnRfaW5fbnVtYmVyPWNvbXBvbmVudF9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbl9wYXRoKQogICAgICAgICAgICBub2RlMiA9IGNvbXBvbmVudF9mdW5jMShjb21wb25lbnRfaW5fbnVtYmVyPWNvbXBvbmVudF9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbl9wYXRoKQoKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMyID0gbG9hZF9jb21wb25lbnQoc291cmNlPXBhdGgpCiAgICAgICAgICAgIG5vZGUzID0gY29tcG9uZW50X2Z1bmMyKGNvbXBvbmVudF9pbl9udW1iZXI9Y29tcG9uZW50X2luX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2luX3BhdGgpCgogICAgICAgICAgICBub2RlMS5jb21wdXRlID0gImNwdS1jbHVzdGVyIgogICAgICAgICAgICBub2RlMi5jb21wdXRlID0gImNwdS1jbHVzdGVyIgogICAgICAgICAgICBub2RlMy5jb21wdXRlID0gImNwdS1jbHVzdGVyIgoKICAgICAgICBwaXBlbGluZTEgPSBwaXBlbGluZSgxMCwgam9iX2lucHV0KQoKICAgICAgICBwaXBlbGluZTEgPSBjbGllbnQuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZTEpCgogICAgICAgIGNvbXBvbmVudF9pZHMgPSBzZXQoKQogICAgICAgIGZvciBfLCBqb2IgaW4gcGlwZWxpbmUxLmpvYnMuaXRlbXMoKToKICAgICAgICAgICAgY29tcG9uZW50X2lkID0gam9iLmNvbXBvbmVudAogICAgICAgICAgICBjb21wb25lbnRfaWRzLmFkZChjb21wb25lbnRfaWQpCgogICAgICAgIGFzc2VydCBsZW4oY29tcG9uZW50X2lkcykgPT0gMSwgZiJHb3QgbXVsdGlwbGUgY29tcG9uZW50IGlkOiB7Y29tcG9uZW50X2lkc30gZm9yIHNhbWUgYW5vbiBjb21wb25lbnQuIgoKICAgIEBweXRlc3QubWFyay5kaXNhYmxlX21vY2tfY29kZV9oYXNoCiAgICBAcHl0ZXN0Lm1hcmsuc2tpcGlmKGNvbmRpdGlvbj1ub3QgaXNfbGl2ZSgpLCByZWFzb249InJldXNlIHRlc3QsIHRhcmdldCB0byB2ZXJpZnkgc2VydmljZS1zaWRlIGJlaGF2aW9yIikKICAgIGRlZiB0ZXN0X3BpcGVsaW5lX3JldXNlKHNlbGYsIGNsaWVudDogTUxDbGllbnQsIHJhbmRzdHI6IENhbGxhYmxlW1tzdHJdLCBzdHJdLCByYW5kaW50OiBDYWxsYWJsZSkgLT4gTm9uZToKICAgICAgICBjb21wb25lbnRfeWFtbCA9IGNvbXBvbmVudHNfZGlyIC8gImhlbGxvd29ybGRfY29tcG9uZW50LnltbCIKICAgICAgICBjb21wb25lbnRfZnVuYzEgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Y29tcG9uZW50X3lhbWwsIHBhcmFtc19vdmVycmlkZT1beyJuYW1lIjogcmFuZHN0cigiY29tcG9uZW50X25hbWUiKX1dKQogICAgICAgIGNvbXBvbmVudF9mdW5jMiA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1jb21wb25lbnRfeWFtbCwgcGFyYW1zX292ZXJyaWRlPVt7Im5hbWUiOiByYW5kc3RyKCJjb21wb25lbnRfbmFtZSIpfV0pCgogICAgICAgIEBkc2wucGlwZWxpbmUoCiAgICAgICAgICAgIG5hbWU9cmFuZHN0cigicGlwZWxpbmVfbmFtZSIpLAogICAgICAgICAgICBkZXNjcmlwdGlvbj0iVGhlIGhlbGxvIHdvcmxkIHBpcGVsaW5lIGpvYiIsCiAgICAgICAgICAgIHRhZ3M9eyJvd25lciI6ICJzZGt0ZWFtIiwgInRhZyI6ICJ0YWd2YWx1ZSJ9LAogICAgICAgICAgICBjb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgICAgIGV4cGVyaW1lbnRfbmFtZT1leHBlcmltZW50X25hbWUsCiAgICAgICAgICAgIGNvbnRpbnVlX3J1bl9vbl9zdGVwX2ZhaWx1cmU9VHJ1ZSwKICAgICAgICApCiAgICAgICAgZGVmIHBpcGVsaW5lKGpvYl9pbl9udW1iZXIsIGpvYl9pbl9vdGhlcl9udW1iZXIsIGpvYl9pbl9wYXRoKToKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMxKGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9am9iX2luX3BhdGgpCiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMihjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9vdGhlcl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQoKICAgICAgICBpbnB1dF9udW1iZXIgPSByYW5kaW50KCkKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lKGlucHV0X251bWJlciwgaW5wdXRfbnVtYmVyLCBqb2JfaW5wdXQpCiAgICAgICAgam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSkKICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICBzbGVlcF9pZl9saXZlKDMwKQogICAgICAgICAgICBjaGlsZHJlbiA9IGNsaWVudC5qb2JzLmxpc3QocGFyZW50X2pvYl9uYW1lPWpvYi5uYW1lKQogICAgICAgICAgICBjaGlsZHJlbiA9IGxpc3QoY2hpbGRyZW4pCiAgICAgICAgICAgIGlmIGxlbihjaGlsZHJlbikgPT0gMjoKICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgIGFzc2VydCBsZW4oY2hpbGRyZW4pID09IDIKICAgICAgICBjaGlsZDAsIGNoaWxkMSA9IGNoaWxkcmVuCiAgICAgICAgIyBjaGlsZHJlbiBzZXF1ZW5jZSBpcyBub3QgZ3VhcmFudGVlZCwgc28gd2UgbmVlZCB0byBjaGVjayBib3RoCiAgICAgICAgaWYgUGlwZWxpbmVDb25zdGFudHMuUkVVU0VEX0ZMQUdfRklFTEQgaW4gY2hpbGQwLnByb3BlcnRpZXMua2V5cygpOgogICAgICAgICAgICBhc3NlcnQgY2hpbGQwLnByb3BlcnRpZXNbUGlwZWxpbmVDb25zdGFudHMuUkVVU0VEX0ZMQUdfRklFTERdID09IFBpcGVsaW5lQ29uc3RhbnRzLlJFVVNFRF9GTEFHX1RSVUUKICAgICAgICBlbGlmIFBpcGVsaW5lQ29uc3RhbnRzLlJFVVNFRF9GTEFHX0ZJRUxEIGluIGNoaWxkMS5wcm9wZXJ0aWVzLmtleXMoKToKICAgICAgICAgICAgYXNzZXJ0IGNoaWxkMS5wcm9wZXJ0aWVzW1BpcGVsaW5lQ29uc3RhbnRzLlJFVVNFRF9GTEFHX0ZJRUxEXSA9PSBQaXBlbGluZUNvbnN0YW50cy5SRVVTRURfRkxBR19UUlVFCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYXNzZXJ0IEZhbHNlLCAiTmVpdGhlciBjaGlsZCByZXVzZXMuIgoKICAgIGRlZiB0ZXN0X3BpcGVsaW5lX3dpdGhfY29tcG9uZW50X2lucHV0X25hbWVfY2FzZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9mdW5jID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgIHNvdXJjZT1zdHIoY29tcG9uZW50c19kaXIgLyAiaGVsbG93b3JsZF9jb21wb25lbnRfd2l0aF91cHBlcmNhc2VfaW5wdXQueW1sIikKICAgICAgICApCgogICAgICAgICMgaW5wdXQgbmFtZSBpcyB0aGUgc2FtZSB3aXRoIHlhbWwgZGVmaW5pdGlvbgogICAgICAgIEBkc2wucGlwZWxpbmUoZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIpCiAgICAgICAgZGVmIGhlbGxvX3dvcmxkX3BpcGVsaW5lKGNvbXBvbmVudF9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoKToKICAgICAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X2Z1bmMoY29tcG9uZW50X0luX251bWJlcj1jb21wb25lbnRfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5fcGF0aCkKCiAgICAgICAgcGlwZWxpbmUgPSBoZWxsb193b3JsZF9waXBlbGluZShjb21wb25lbnRfaW5fbnVtYmVyPTEwLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5wdXQpCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSwgZXhwZXJpbWVudF9uYW1lPWV4cGVyaW1lbnRfbmFtZSkKICAgICAgICBhc3NlcnQgImNvbXBvbmVudF9Jbl9udW1iZXIiIGluIG5leHQocGlwZWxpbmVfam9iLmpvYnMudmFsdWVzKCkuX19pdGVyX18oKSkuaW5wdXRzCgogICAgICAgICMgaW5wdXQgbmFtZSBpcyBsb3dlciBjYXNlCiAgICAgICAgQGRzbC5waXBlbGluZShkZWZhdWx0X2NvbXB1dGU9ImNwdS1jbHVzdGVyIikKICAgICAgICBkZWYgaGVsbG9fd29ybGRfcGlwZWxpbmUoY29tcG9uZW50X2luX251bWJlciwgY29tcG9uZW50X2luX3BhdGgpOgogICAgICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfZnVuYyhjb21wb25lbnRfaW5fbnVtYmVyPWNvbXBvbmVudF9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbl9wYXRoKQoKICAgICAgICBwaXBlbGluZSA9IGhlbGxvX3dvcmxkX3BpcGVsaW5lKGNvbXBvbmVudF9pbl9udW1iZXI9MTAsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbnB1dCkKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lLCBleHBlcmltZW50X25hbWU9ZXhwZXJpbWVudF9uYW1lKQogICAgICAgIGFzc2VydCAiY29tcG9uZW50X0luX251bWJlciIgaW4gbmV4dChwaXBlbGluZV9qb2Iuam9icy52YWx1ZXMoKS5fX2l0ZXJfXygpKS5pbnB1dHMKCiAgICAgICAgIyBpbnB1dCBuYW1lIGlzIGVxdWFsIHRvIHlhbWwgZGVmaW5pdGlvbiBpbnB1dCBpZiBib3RoIGNoYW5nZSB0byBsb3dlciBjYXNlCiAgICAgICAgQGRzbC5waXBlbGluZShkZWZhdWx0X2NvbXB1dGU9ImNwdS1jbHVzdGVyIikKICAgICAgICBkZWYgaGVsbG9fd29ybGRfcGlwZWxpbmUoY29tcG9uZW50X2luX251bWJlciwgY29tcG9uZW50X2luX3BhdGgpOgogICAgICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfZnVuYyhjb21wb25lbnRfSW5fTnVtYmVyPWNvbXBvbmVudF9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbl9wYXRoKQoKICAgICAgICBwaXBlbGluZSA9IGhlbGxvX3dvcmxkX3BpcGVsaW5lKGNvbXBvbmVudF9pbl9udW1iZXI9MTAsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbnB1dCkKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lLCBleHBlcmltZW50X25hbWU9ZXhwZXJpbWVudF9uYW1lKQogICAgICAgIGFzc2VydCAiY29tcG9uZW50X0luX251bWJlciIgaW4gbmV4dChwaXBlbGluZV9qb2Iuam9icy52YWx1ZXMoKS5fX2l0ZXJfXygpKS5pbnB1dHMKCiAgICAgICAgIyB0d28gaWRlbnRpY2FsIGlucHV0IGFyZSBnaXZlbiBpZiBpZ25vcmUgY2FzZQogICAgICAgIEBkc2wucGlwZWxpbmUoZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIpCiAgICAgICAgZGVmIGhlbGxvX3dvcmxkX3BpcGVsaW5lKGNvbXBvbmVudF9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoKToKICAgICAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X2Z1bmMoY29tcG9uZW50X0luX251bWJlcj1jb21wb25lbnRfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fbnVtYmVyPWNvbXBvbmVudF9pbl9wYXRoKQoKICAgICAgICB3aXRoIHB5dGVzdC5yYWlzZXMoVmFsaWRhdGlvbkV4Y2VwdGlvbikgYXMgZXg6CiAgICAgICAgICAgIGhlbGxvX3dvcmxkX3BpcGVsaW5lKGNvbXBvbmVudF9pbl9udW1iZXI9MTAsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbnB1dCkKICAgICAgICBhc3NlcnQgKAogICAgICAgICAgICAiSW52YWxpZCBjb21wb25lbnQgaW5wdXQgbmFtZXMgJ2NvbXBvbmVudF9pbl9udW1iZXInIGFuZCAnY29tcG9uZW50X0luX251bWJlcicsIHdoaWNoIGFyZSBlcXVhbCIKICAgICAgICAgICAgaW4gZXgudmFsdWUubWVzc2FnZQogICAgICAgICkKCiAgICBkZWYgdGVzdF9waXBlbGluZV9qb2JfaGVscF9mdW5jdGlvbihzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICB5YW1sX2ZpbGUgPSAiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiCgogICAgICAgIEBkc2wucGlwZWxpbmUoZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIpCiAgICAgICAgZGVmIHBpcGVsaW5lKG51bWJlciwgcGF0aCk6CiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPXlhbWxfZmlsZSkKICAgICAgICAgICAgbm9kZTEgPSBjb21wb25lbnRfZnVuYyhjb21wb25lbnRfaW5fbnVtYmVyPW51bWJlciwgY29tcG9uZW50X2luX3BhdGg9cGF0aCkKICAgICAgICAgICAgcmV0dXJuIHsicGlwZWxpbmVfb3V0cHV0Ijogbm9kZTEub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9CgogICAgICAgIHBpcGVsaW5lMSA9IHBpcGVsaW5lKDEwLCBqb2JfaW5wdXQpCiAgICAgICAgcGlwZWxpbmUxID0gY2xpZW50LmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUxKQogICAgICAgIHdpdGggcGF0Y2goInN5cy5zdGRvdXQiLCBuZXc9U3RyaW5nSU8oKSkgYXMgc3RkX291dDoKICAgICAgICAgICAgcHJpbnQocGlwZWxpbmUxKQogICAgICAgICAgICBhc3NlcnQgKAogICAgICAgICAgICAgICAgImRpc3BsYXlfbmFtZTogcGlwZWxpbmVcbnR5cGU6IHBpcGVsaW5lXG5pbnB1dHM6XG4gIG51bWJlcjogJzEwJ1xuICBwYXRoOlxuICAgIG1vZGU6IHJvX21vdW50XG4gICAgdHlwZTogdXJpX2ZpbGVcbiAgICBwYXRoOiIKICAgICAgICAgICAgICAgIGluIHN0ZF9vdXQuZ2V0dmFsdWUoKQogICAgICAgICAgICApCgogICAgZGVmIHRlc3Rfbm9kZV9wcm9wZXJ0eV9zZXR0aW5nX3ZhbGlkYXRpb24oc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBwYXRoID0gIi4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnQueW1sIgogICAgICAgIGNvbXBvbmVudF9mdW5jMSA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1wYXRoKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKCkKICAgICAgICBkZWYgcGlwZWxpbmUoY29tcG9uZW50X2luX251bWJlciwgY29tcG9uZW50X2luX3BhdGgpOgogICAgICAgICAgICBub2RlMSA9IGNvbXBvbmVudF9mdW5jMShjb21wb25lbnRfaW5fbnVtYmVyPWNvbXBvbmVudF9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbl9wYXRoKQogICAgICAgICAgICBub2RlMS5qZWZmX3NwZWNpYWxfb3B0aW9uLmZvbyA9ICJiYXIiCiAgICAgICAgICAgIG5vZGUxLmNvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCgogICAgICAgIGRzbF9waXBlbGluZTogUGlwZWxpbmVKb2IgPSBwaXBlbGluZSgxMCwgam9iX2lucHV0KQogICAgICAgIHdpdGggcGF0Y2goImF6dXJlLmFpLm1sLmVudGl0aWVzLl92YWxpZGF0aW9uLm1vZHVsZV9sb2dnZXIuaW5mbyIpIGFzIG1vY2tfbG9nZ2luZzoKICAgICAgICAgICAgXyA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUoZHNsX3BpcGVsaW5lKQogICAgICAgICAgICBtb2NrX2xvZ2dpbmcuYXNzZXJ0X2NhbGxlZF93aXRoKCJXYXJuaW5nczogW2pvYnMubm9kZTEuamVmZl9zcGVjaWFsX29wdGlvbjogVW5rbm93biBmaWVsZC5dIikKCiAgICBkZWYgdGVzdF9hbm9uX2NvbXBvbmVudF9pbl9waXBlbGluZSgKICAgICAgICBzZWxmLCBjbGllbnQ6IE1MQ2xpZW50LCByYW5kc3RyOiBDYWxsYWJsZVtbc3RyXSwgc3RyXSwgaGVsbG9fd29ybGRfY29tcG9uZW50OiBDb21wb25lbnQKICAgICkgLT4gTm9uZToKICAgICAgICBoZWxsb193b3JsZF9mdW5jID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgIGNsaWVudD1jbGllbnQsIG5hbWU9aGVsbG9fd29ybGRfY29tcG9uZW50Lm5hbWUsIHZlcnNpb249aGVsbG9fd29ybGRfY29tcG9uZW50LnZlcnNpb24KICAgICAgICApCiAgICAgICAgb3JpZ2luX2lkID0gaGVsbG9fd29ybGRfZnVuYy5pZAogICAgICAgIG1waV9mdW5jID0gbG9hZF9jb21wb25lbnQoc291cmNlPXN0cihjb21wb25lbnRzX2RpciAvICJoZWxsb3dvcmxkX2NvbXBvbmVudF9tcGkueW1sIikpCiAgICAgICAgYXNzZXJ0IG1waV9mdW5jLl92YWxpZGF0ZSgpLnBhc3NlZAoKICAgICAgICBpbnZhbGlkX2NvbXBvbmVudF9uYW1lID0gIl9pbnZhbGlkIgoKICAgICAgICAjIG5hbWUgb2YgYW5vbnltb3VzIGNvbXBvbmVudCBpbiBwaXBlbGluZSBqb2Igc2hvdWxkIGJlIG92ZXJ3cml0dGVuCiAgICAgICAgbXBpX2Z1bmMubmFtZSA9IGludmFsaWRfY29tcG9uZW50X25hbWUKICAgICAgICBhc3NlcnQgbm90IG1waV9mdW5jLl92YWxpZGF0ZSgpLnBhc3NlZAoKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBuYW1lPXJhbmRzdHIoInBpcGVsaW5lX25hbWUiKSwKICAgICAgICAgICAgZGVzY3JpcHRpb249IlRoZSBoZWxsbyB3b3JsZCBwaXBlbGluZSBqb2IiLAogICAgICAgICAgICB0YWdzPXsib3duZXIiOiAic2RrdGVhbSIsICJ0YWciOiAidGFndmFsdWUifSwKICAgICAgICAgICAgY29tcHV0ZT0iZ3B1LWNsdXN0ZXIiLAogICAgICAgICAgICBleHBlcmltZW50X25hbWU9ZXhwZXJpbWVudF9uYW1lLAogICAgICAgICAgICBjb250aW51ZV9vbl9zdGVwX2ZhaWx1cmU9RmFsc2UsCiAgICAgICAgKQogICAgICAgIGRlZiBwaXBlbGluZV9kaXN0cmlidXRpb25fY29tcG9uZW50cyhqb2JfaW5fbnVtYmVyLCBqb2JfaW5fcGF0aCk6CiAgICAgICAgICAgIGhlbGxvd29ybGRfY29tcG9uZW50ID0gaGVsbG9fd29ybGRfZnVuYyhjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQogICAgICAgICAgICBoZWxsb3dvcmxkX2NvbXBvbmVudC5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCA9IE91dHB1dChkYXRhc2V0PURhdGEobmFtZT0ibWxkZXNpZ25lcl9jb21wb25lbnRfb3V0cHV0IikpCiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9tcGkgPSBtcGlfZnVuYyhjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQogICAgICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfbXBpLmRpc3RyaWJ1dGlvbiA9IE1waURpc3RyaWJ1dGlvbigpCiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9tcGkuZGlzdHJpYnV0aW9uLnByb2Nlc3NfY291bnRfcGVyX2luc3RhbmNlID0gMgoKICAgICAgICBwaXBlbGluZTogUGlwZWxpbmVKb2IgPSBwaXBlbGluZV9kaXN0cmlidXRpb25fY29tcG9uZW50cygxMCwgam9iX2lucHV0KQogICAgICAgIGFzc2VydCBtcGlfZnVuYy5faXNfYW5vbnltb3VzIGlzIEZhbHNlCiAgICAgICAgYXNzZXJ0IHBpcGVsaW5lLnNldHRpbmdzLmNvbnRpbnVlX29uX3N0ZXBfZmFpbHVyZSBpcyBGYWxzZQogICAgICAgIGNyZWF0ZWRfam9iOiBQaXBlbGluZUpvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUoCiAgICAgICAgICAgIHBpcGVsaW5lLCBleHBlcmltZW50X25hbWU9ZXhwZXJpbWVudF9uYW1lLCBjb250aW51ZV9vbl9zdGVwX2ZhaWx1cmU9VHJ1ZQogICAgICAgICkKICAgICAgICAjIFRoZW9yZXRpY2FsbHksIHdlIHNob3VsZCBrZWVwIHRoZSBpbnZhbGlkIG5hbWUgaW4gcmVxdWVzdCBib2R5LAogICAgICAgICMgYXMgY29tcG9uZW50IG5hbWUgdmFsaWQgaW4gYXp1cmVtbC1jb21wb25lbnRzIG1heWJlIGludmFsaWQgaW4gYXp1cmUtYWktbWwuCiAgICAgICAgIyBTbyB3ZSBsZWF2ZSB0aGlzIHZhbGlkYXRpb24gdG8gc2VydmVyLXNpZGUgZm9yIG5vdy4KICAgICAgICBhc3NlcnQgbXBpX2Z1bmMuX3RvX3Jlc3Rfb2JqZWN0KCkucHJvcGVydGllcy5jb21wb25lbnRfc3BlY1sibmFtZSJdID09IGludmFsaWRfY29tcG9uZW50X25hbWUKCiAgICAgICAgIyBjb250aW51ZV9vbl9zdGVwX2ZhaWx1cmUgY2FuJ3QgYmUgc2V0IGluIGNyZWF0ZV9vcl91cGRhdGUKICAgICAgICBhc3NlcnQgY3JlYXRlZF9qb2Iuc2V0dGluZ3MuY29udGludWVfb25fc3RlcF9mYWlsdXJlIGlzIEZhbHNlCiAgICAgICAgYXNzZXJ0IGNyZWF0ZWRfam9iLmpvYnNbImhlbGxvX3dvcmxkX2NvbXBvbmVudF9tcGkiXS5jb21wb25lbnQuc3RhcnRzd2l0aChBTk9OWU1PVVNfQ09NUE9ORU5UX05BTUUpCiAgICAgICAgYXNzZXJ0IGNyZWF0ZWRfam9iLmpvYnNbImhlbGxvd29ybGRfY29tcG9uZW50Il0uY29tcG9uZW50ID09ICJtaWNyb3NvZnRzYW1wbGVzX2NvbW1hbmRfY29tcG9uZW50X2Jhc2ljOjAuMC4xIgogICAgICAgIGFzc2VydCBoZWxsb193b3JsZF9mdW5jLl9pc19hbm9ueW1vdXMgaXMgRmFsc2UKICAgICAgICBhc3NlcnQgb3JpZ2luX2lkID09IGhlbGxvX3dvcmxkX2Z1bmMuaWQKCiAgICBkZWYgdGVzdF9waXBlbGluZV9mb3JjZV9yZXJ1bihzZWxmLCBjbGllbnQ6IE1MQ2xpZW50LCByYW5kc3RyOiBDYWxsYWJsZVtbc3RyXSwgc3RyXSkgLT4gTm9uZToKICAgICAgICBjb21wb25lbnRfeWFtbCA9IGNvbXBvbmVudHNfZGlyIC8gImhlbGxvd29ybGRfY29tcG9uZW50LnltbCIKICAgICAgICBjb21wb25lbnRfZnVuYzEgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Y29tcG9uZW50X3lhbWwsIHBhcmFtc19vdmVycmlkZT1beyJuYW1lIjogcmFuZHN0cigiY29tcG9uZW50X25hbWUiKX1dKQogICAgICAgIGNvbXBvbmVudF9mdW5jMiA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1jb21wb25lbnRfeWFtbCwgcGFyYW1zX292ZXJyaWRlPVt7Im5hbWUiOiByYW5kc3RyKCJjb21wb25lbnRfbmFtZSIpfV0pCgogICAgICAgIEBkc2wucGlwZWxpbmUoCiAgICAgICAgICAgIG5hbWU9cmFuZHN0cigicGlwZWxpbmVfbmFtZSIpLAogICAgICAgICAgICBkZXNjcmlwdGlvbj0iVGhlIGhlbGxvIHdvcmxkIHBpcGVsaW5lIGpvYiIsCiAgICAgICAgICAgIHRhZ3M9eyJvd25lciI6ICJzZGt0ZWFtIiwgInRhZyI6ICJ0YWd2YWx1ZSJ9LAogICAgICAgICAgICBjb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgICAgIGV4cGVyaW1lbnRfbmFtZT1leHBlcmltZW50X25hbWUsCiAgICAgICAgICAgIGNvbnRpbnVlX29uX3N0ZXBfZmFpbHVyZT1UcnVlLAogICAgICAgICkKICAgICAgICBkZWYgcGlwZWxpbmUoam9iX2luX251bWJlciwgam9iX2luX290aGVyX251bWJlciwgam9iX2luX3BhdGgpOgogICAgICAgICAgICBjb21wb25lbnRfZnVuYzEoY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aCkKICAgICAgICAgICAgY29tcG9uZW50X2Z1bmMyKGNvbXBvbmVudF9pbl9udW1iZXI9am9iX2luX290aGVyX251bWJlciwgY29tcG9uZW50X2luX3BhdGg9am9iX2luX3BhdGgpCgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmUoMTAsIDE1LCBqb2JfaW5wdXQpCiAgICAgICAgam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSkKICAgICAgICBhc3NlcnQgam9iLnNldHRpbmdzLmZvcmNlX3JlcnVuIGlzIE5vbmUKCiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgbmFtZT1yYW5kc3RyKCJwaXBlbGluZV9uYW1lIiksCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJUaGUgaGVsbG8gd29ybGQgcGlwZWxpbmUgam9iIiwKICAgICAgICAgICAgdGFncz17Im93bmVyIjogInNka3RlYW0iLCAidGFnIjogInRhZ3ZhbHVlIn0sCiAgICAgICAgICAgIGNvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICAgICAgZXhwZXJpbWVudF9uYW1lPWV4cGVyaW1lbnRfbmFtZSwKICAgICAgICAgICAgY29udGludWVfb25fc3RlcF9mYWlsdXJlPVRydWUsCiAgICAgICAgICAgIGZvcmNlX3JlcnVuPVRydWUsCiAgICAgICAgKQogICAgICAgIGRlZiBwaXBlbGluZShqb2JfaW5fbnVtYmVyLCBqb2JfaW5fb3RoZXJfbnVtYmVyLCBqb2JfaW5fcGF0aCk6CiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMShjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQogICAgICAgICAgICBjb21wb25lbnRfZnVuYzIoY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fb3RoZXJfbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aCkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZSgxMCwgMTUsIGpvYl9pbnB1dCkKICAgICAgICBqb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lLCBmb3JjZV9yZXJ1bj1UcnVlKQogICAgICAgIGFzc2VydCBqb2Iuc2V0dGluZ3MuZm9yY2VfcmVydW4gaXMgVHJ1ZQoKICAgIEBweXRlc3QubWFyay5za2lwKCJUT0RPICgyMzcwMTI5KTogUmVjb3JkaW5nIGZhaWxzIGR1ZSB0byAnQ2Fubm90IGZpbmQgcGlwZWxpbmUgcnVuJyBlcnJvciIpCiAgICBkZWYgdGVzdF9wYXJhbGxlbF9jb21wb25lbnRzX3dpdGhfdGFidWxhcl9pbnB1dChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGNvbXBvbmVudHNfZGlyID0gdGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2RzbF9waXBlbGluZS9wYXJhbGxlbF9jb21wb25lbnRfd2l0aF90YWJ1bGFyX2lucHV0IgoKICAgICAgICBiYXRjaF9pbmZlcmVuY2UgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9c3RyKGNvbXBvbmVudHNfZGlyIC8gInRhYnVsYXJfaW5wdXRfZTJlLnltbCIpKQoKICAgICAgICAjIENvbnN0cnVjdCBwaXBlbGluZQogICAgICAgIEBkc2wucGlwZWxpbmUoZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIpCiAgICAgICAgZGVmIHBhcmFsbGVsX2luX3BpcGVsaW5lKGpvYl9kYXRhX3BhdGgsIHNjb3JlX21vZGVsKToKICAgICAgICAgICAgYmF0Y2hfaW5mZXJlbmNlX25vZGUgPSBiYXRjaF9pbmZlcmVuY2Uoam9iX2RhdGFfcGF0aD1qb2JfZGF0YV9wYXRoLCBzY29yZV9tb2RlbD1zY29yZV9tb2RlbCkKICAgICAgICAgICAgYmF0Y2hfaW5mZXJlbmNlX25vZGUubWluaV9iYXRjaF9zaXplID0gNQoKICAgICAgICBwaXBlbGluZSA9IHBhcmFsbGVsX2luX3BpcGVsaW5lKAogICAgICAgICAgICBqb2JfZGF0YV9wYXRoPUlucHV0KAogICAgICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgICAgICBwYXRoPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9kYXRhc2V0L25ldXJhbC1pcmlzLW1sdGFibGUiLAogICAgICAgICAgICAgICAgbW9kZT1JbnB1dE91dHB1dE1vZGVzLkRJUkVDVCwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgc2NvcmVfbW9kZWw9SW5wdXQoCiAgICAgICAgICAgICAgICBwYXRoPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9tb2RlbCIsIHR5cGU9QXNzZXRUeXBlcy5VUklfRk9MREVSLCBtb2RlPUlucHV0T3V0cHV0TW9kZXMuRE9XTkxPQUQKICAgICAgICAgICAgKSwKICAgICAgICApCiAgICAgICAgIyBzdWJtaXQgcGlwZWxpbmUgam9iCiAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCwgZXhwZXJpbWVudF9uYW1lPSJwYXJhbGxlbF9pbl9waXBlbGluZSIpCgogICAgICAgICMgY2hlY2sgcmVxdWlyZWQgZmllbGRzIGluIGpvYiBkaWN0CiAgICAgICAgam9iX2RpY3QgPSBwaXBlbGluZV9qb2IuX3RvX2RpY3QoKQogICAgICAgIGV4cGVjdGVkX2tleXMgPSBbInN0YXR1cyIsICJwcm9wZXJ0aWVzIiwgImNyZWF0aW9uX2NvbnRleHQiXQogICAgICAgIGZvciBrIGluIGV4cGVjdGVkX2tleXM6CiAgICAgICAgICAgIGFzc2VydCBrIGluIGpvYl9kaWN0LmtleXMoKSwgZiJmYWlsZWQgdG8gZ2V0IHtrfSBpbiB7am9iX2RpY3R9IgoKICAgICAgICAjIG9yaWdpbmFsIGpvYiBkaWQgbm90IGNoYW5nZQogICAgICAgIGFzc2VydF9qb2JfaW5wdXRfb3V0cHV0X3R5cGVzKHBpcGVsaW5lX2pvYikKICAgICAgICBhc3NlcnQgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9PSAiY3B1LWNsdXN0ZXIiCgogICAgQHB5dGVzdC5tYXJrLnNraXAoIlRPRE8gKDIzNzAxMjkpOiBSZWNvcmRpbmcgZmFpbHMgZHVlIHRvICdDYW5ub3QgZmluZCBwaXBlbGluZSBydW4nIGVycm9yIikKICAgIGRlZiB0ZXN0X3BhcmFsbGVsX2NvbXBvbmVudHNfd2l0aF90YWJ1bGFyX2lucHV0X2JpbmRfdG9fbGl0ZXJhbF9pbnB1dChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGNvbXBvbmVudHNfZGlyID0gdGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2RzbF9waXBlbGluZS9wYXJhbGxlbF9jb21wb25lbnRfd2l0aF90YWJ1bGFyX2lucHV0IgoKICAgICAgICBiYXRjaF9pbmZlcmVuY2UgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9c3RyKGNvbXBvbmVudHNfZGlyIC8gInRhYnVsYXJfaW5wdXRfZTJlLnltbCIpKQoKICAgICAgICAjIENvbnN0cnVjdCBwaXBlbGluZQogICAgICAgIEBkc2wucGlwZWxpbmUoZGVmYXVsdF9jb21wdXRlPSJjcHUtY2x1c3RlciIpCiAgICAgICAgZGVmIHBhcmFsbGVsX2luX3BpcGVsaW5lKGpvYl9kYXRhX3BhdGgsIHNjb3JlX21vZGVsLCBsaXRlcmFsX2lucHV0KToKICAgICAgICAgICAgYmF0Y2hfaW5mZXJlbmNlX25vZGUgPSBiYXRjaF9pbmZlcmVuY2Uoam9iX2RhdGFfcGF0aD1qb2JfZGF0YV9wYXRoLCBzY29yZV9tb2RlbD1zY29yZV9tb2RlbCkKICAgICAgICAgICAgYmF0Y2hfaW5mZXJlbmNlX25vZGUubWluaV9iYXRjaF9zaXplID0gNQogICAgICAgICAgICBiYXRjaF9pbmZlcmVuY2Vfbm9kZS5tYXhfY29uY3VycmVuY3lfcGVyX2luc3RhbmNlID0gbGl0ZXJhbF9pbnB1dAogICAgICAgICAgICBiYXRjaF9pbmZlcmVuY2Vfbm9kZS5lcnJvcl90aHJlc2hvbGQgPSBsaXRlcmFsX2lucHV0CiAgICAgICAgICAgIGJhdGNoX2luZmVyZW5jZV9ub2RlLm1pbmlfYmF0Y2hfZXJyb3JfdGhyZXNob2xkID0gbGl0ZXJhbF9pbnB1dAoKICAgICAgICBwaXBlbGluZSA9IHBhcmFsbGVsX2luX3BpcGVsaW5lKAogICAgICAgICAgICBqb2JfZGF0YV9wYXRoPUlucHV0KAogICAgICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgICAgICBwYXRoPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9kYXRhc2V0L25ldXJhbC1pcmlzLW1sdGFibGUiLAogICAgICAgICAgICAgICAgbW9kZT1JbnB1dE91dHB1dE1vZGVzLkRJUkVDVCwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgc2NvcmVfbW9kZWw9SW5wdXQoCiAgICAgICAgICAgICAgICBwYXRoPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9tb2RlbCIsIHR5cGU9QXNzZXRUeXBlcy5VUklfRk9MREVSLCBtb2RlPUlucHV0T3V0cHV0TW9kZXMuRE9XTkxPQUQKICAgICAgICAgICAgKSwKICAgICAgICAgICAgbGl0ZXJhbF9pbnB1dD0yLAogICAgICAgICkKICAgICAgICAjIHN1Ym1pdCBwaXBlbGluZSBqb2IKICAgICAgICBwaXBlbGluZV9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50LCBleHBlcmltZW50X25hbWU9InBhcmFsbGVsX2luX3BpcGVsaW5lIikKCiAgICAgICAgIyBjaGVjayByZXF1aXJlZCBmaWVsZHMgaW4gam9iIGRpY3QKICAgICAgICBqb2JfZGljdCA9IHBpcGVsaW5lX2pvYi5fdG9fZGljdCgpCiAgICAgICAgZXhwZWN0ZWRfa2V5cyA9IFsic3RhdHVzIiwgInByb3BlcnRpZXMiLCAiY3JlYXRpb25fY29udGV4dCJdCiAgICAgICAgZm9yIGsgaW4gZXhwZWN0ZWRfa2V5czoKICAgICAgICAgICAgYXNzZXJ0IGsgaW4gam9iX2RpY3Qua2V5cygpLCBmImZhaWxlZCB0byBnZXQge2t9IGluIHtqb2JfZGljdH0iCgogICAgICAgICMgb3JpZ2luYWwgam9iIGRpZCBub3QgY2hhbmdlCiAgICAgICAgYXNzZXJ0X2pvYl9pbnB1dF9vdXRwdXRfdHlwZXMocGlwZWxpbmVfam9iKQogICAgICAgIGFzc2VydCBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID09ICJjcHUtY2x1c3RlciIKCiAgICBAcHl0ZXN0Lm1hcmsuc2tpcCgiVE9ETyAoMjM3MDEyOSk6IFJlY29yZGluZyBmYWlscyBkdWUgdG8gJ0Nhbm5vdCBmaW5kIHBpcGVsaW5lIHJ1bicgZXJyb3IiKQogICAgZGVmIHRlc3RfcGFyYWxsZWxfY29tcG9uZW50c193aXRoX2ZpbGVfaW5wdXQoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBjb21wb25lbnRzX2RpciA9IHRlc3RzX3Jvb3RfZGlyIC8gInRlc3RfY29uZmlncy9kc2xfcGlwZWxpbmUvcGFyYWxsZWxfY29tcG9uZW50X3dpdGhfZmlsZV9pbnB1dCIKCiAgICAgICAgYmF0Y2hfaW5mZXJlbmNlID0gbG9hZF9jb21wb25lbnQoc291cmNlPXN0cihjb21wb25lbnRzX2RpciAvICJzY29yZS55bWwiKSkKCiAgICAgICAgIyBDb25zdHJ1Y3QgcGlwZWxpbmUKICAgICAgICBAZHNsLnBpcGVsaW5lKGRlZmF1bHRfY29tcHV0ZT0iY3B1LWNsdXN0ZXIiKQogICAgICAgIGRlZiBwYXJhbGxlbF9pbl9waXBlbGluZShqb2JfZGF0YV9wYXRoKToKICAgICAgICAgICAgYmF0Y2hfaW5mZXJlbmNlX25vZGUgPSBiYXRjaF9pbmZlcmVuY2Uoam9iX2RhdGFfcGF0aD1qb2JfZGF0YV9wYXRoKQogICAgICAgICAgICBiYXRjaF9pbmZlcmVuY2Vfbm9kZS5taW5pX2JhdGNoX3NpemUgPSA1CgogICAgICAgIHBpcGVsaW5lID0gcGFyYWxsZWxfaW5fcGlwZWxpbmUoCiAgICAgICAgICAgIGpvYl9kYXRhX3BhdGg9SW5wdXQoCiAgICAgICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgICAgIHBhdGg9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2RhdGFzZXQvbW5pc3QtZGF0YSIsCiAgICAgICAgICAgICAgICBtb2RlPUlucHV0T3V0cHV0TW9kZXMuRVZBTF9NT1VOVCwKICAgICAgICAgICAgKSwKICAgICAgICApCiAgICAgICAgIyBzdWJtaXQgcGlwZWxpbmUgam9iCiAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCwgZXhwZXJpbWVudF9uYW1lPSJwYXJhbGxlbF9pbl9waXBlbGluZSIpCiAgICAgICAgIyBjaGVjayByZXF1aXJlZCBmaWVsZHMgaW4gam9iIGRpY3QKICAgICAgICBqb2JfZGljdCA9IHBpcGVsaW5lX2pvYi5fdG9fZGljdCgpCiAgICAgICAgZXhwZWN0ZWRfa2V5cyA9IFsic3RhdHVzIiwgInByb3BlcnRpZXMiLCAiY3JlYXRpb25fY29udGV4dCJdCiAgICAgICAgZm9yIGsgaW4gZXhwZWN0ZWRfa2V5czoKICAgICAgICAgICAgYXNzZXJ0IGsgaW4gam9iX2RpY3Qua2V5cygpLCBmImZhaWxlZCB0byBnZXQge2t9IGluIHtqb2JfZGljdH0iCgogICAgICAgICMgb3JpZ2luYWwgam9iIGRpZCBub3QgY2hhbmdlCiAgICAgICAgYXNzZXJ0X2pvYl9pbnB1dF9vdXRwdXRfdHlwZXMocGlwZWxpbmVfam9iKQogICAgICAgIGFzc2VydCBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID09ICJjcHUtY2x1c3RlciIKCiAgICBAcHl0ZXN0Lm1hcmsuc2tpcCgiVE9ETyAoMjM3MDEyOSk6IFJlY29yZGluZyBmYWlscyBkdWUgdG8gJ0Nhbm5vdCBmaW5kIHBpcGVsaW5lIHJ1bicgZXJyb3IiKQogICAgZGVmIHRlc3RfcGFyYWxsZWxfcnVuX2Z1bmN0aW9uKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGRhdGEgPSBJbnB1dCgKICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgIHBhdGg9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2RhdGFzZXQvbW5pc3QtZGF0YSIsCiAgICAgICAgICAgIG1vZGU9SW5wdXRPdXRwdXRNb2Rlcy5FVkFMX01PVU5ULAogICAgICAgICkKICAgICAgICBwaXBlbGluZSA9IGJ1aWxkX3BpcGVsaW5lX3dpdGhfcGFyYWxsZWxfcnVuX2Z1bmN0aW9uKGRhdGEpCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lKSAgIyBzdWJtaXQgcGlwZWxpbmUgam9iCgogICAgICAgIGFjdHVhbF9qb2IgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLnByb3BlcnRpZXMuYXNfZGljdCgpLCAqY29tbW9uX29taXRfZmllbGRzKQogICAgICAgIGV4cGVjdGVkX2pvYiA9IHsKICAgICAgICAgICAgInRhZ3MiOiB7fSwKICAgICAgICAgICAgImlzX2FyY2hpdmVkIjogRmFsc2UsCiAgICAgICAgICAgICJqb2JfdHlwZSI6ICJQaXBlbGluZSIsCiAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAiam9iX2RhdGFfcGF0aCI6IHsiam9iX2lucHV0X3R5cGUiOiAibWx0YWJsZSIsICJtb2RlIjogIkV2YWxNb3VudCJ9LAogICAgICAgICAgICB9LAogICAgICAgICAgICAiam9icyI6IHsKICAgICAgICAgICAgICAgICJub2RlMSI6IHsKICAgICAgICAgICAgICAgICAgICAiaW5wdXRfZGF0YSI6ICIke3tpbnB1dHMuam9iX2RhdGFfcGF0aH19IiwKICAgICAgICAgICAgICAgICAgICAiZGlzcGxheV9uYW1lIjogIm15LWV2YWx1YXRlLWpvYiIsCiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9kYXRhX3BhdGgiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5qb2JfZGF0YV9wYXRofX0iLAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJub2RlMSIsCiAgICAgICAgICAgICAgICAgICAgIm1pbmlfYmF0Y2hfc2l6ZSI6IDUsCiAgICAgICAgICAgICAgICAgICAgImxvZ2dpbmdfbGV2ZWwiOiAiREVCVUciLAogICAgICAgICAgICAgICAgICAgICJtYXhfY29uY3VycmVuY3lfcGVyX2luc3RhbmNlIjogMSwKICAgICAgICAgICAgICAgICAgICAiZXJyb3JfdGhyZXNob2xkIjogMSwKICAgICAgICAgICAgICAgICAgICAibWluaV9iYXRjaF9lcnJvcl90aHJlc2hvbGQiOiAxLAogICAgICAgICAgICAgICAgICAgICJvdXRwdXRzIjogeyJqb2Jfb3V0cHV0X3BhdGgiOiB7InR5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy5waXBlbGluZV9vdXRwdXR9fSJ9fSwKICAgICAgICAgICAgICAgICAgICAicmVzb3VyY2VzIjogeyJpbnN0YW5jZV9jb3VudCI6IDJ9LAogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogInBhcmFsbGVsIiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJvdXRwdXRzIjogewogICAgICAgICAgICAgICAgInBpcGVsaW5lX291dHB1dCI6IHsKICAgICAgICAgICAgICAgICAgICAibW9kZSI6ICJSZWFkV3JpdGVNb3VudCIsCiAgICAgICAgICAgICAgICAgICAgImpvYl9vdXRwdXRfdHlwZSI6ICJ1cmlfZm9sZGVyIiwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgInNldHRpbmdzIjogeyJkZWZhdWx0X2NvbXB1dGUiOiAiY3B1LWNsdXN0ZXIifSwKICAgICAgICB9CiAgICAgICAgYXNzZXJ0IGV4cGVjdGVkX2pvYiA9PSBhY3R1YWxfam9iCgogICAgICAgICMgY2hlY2sgcmVxdWlyZWQgZmllbGRzIGluIGpvYiBkaWN0CiAgICAgICAgam9iX2RpY3QgPSBwaXBlbGluZV9qb2IuX3RvX2RpY3QoKQogICAgICAgIGV4cGVjdGVkX2tleXMgPSBbInN0YXR1cyIsICJwcm9wZXJ0aWVzIiwgImNyZWF0aW9uX2NvbnRleHQiXQogICAgICAgIGZvciBrIGluIGV4cGVjdGVkX2tleXM6CiAgICAgICAgICAgIGFzc2VydCBrIGluIGpvYl9kaWN0LmtleXMoKSwgZiJmYWlsZWQgdG8gZ2V0IHtrfSBpbiB7am9iX2RpY3R9IgoKICAgICAgICAjIG9yaWdpbmFsIGpvYiBkaWQgbm90IGNoYW5nZQogICAgICAgIGFzc2VydF9qb2JfaW5wdXRfb3V0cHV0X3R5cGVzKHBpcGVsaW5lX2pvYikKICAgICAgICBhc3NlcnQgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9PSAiY3B1LWNsdXN0ZXIiCgogICAgQHB5dGVzdC5tYXJrLnNraXAoIlRPRE8gKDIzNzAxMjkpOiBSZWNvcmRpbmcgZmFpbHMgZHVlIHRvICdDYW5ub3QgZmluZCBwaXBlbGluZSBydW4nIGVycm9yIikKICAgIGRlZiB0ZXN0X3BhcmFsbGVsX3J1bl9mdW5jdGlvbl9ydW5fc2V0dGluZ3NfYmluZF90b19saXRlcmFsX2lucHV0KHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGRhdGEgPSBJbnB1dCgKICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgIHBhdGg9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2RhdGFzZXQvbW5pc3QtZGF0YSIsCiAgICAgICAgICAgIG1vZGU9SW5wdXRPdXRwdXRNb2Rlcy5FVkFMX01PVU5ULAogICAgICAgICkKICAgICAgICBwaXBlbGluZSA9IGJ1aWxkX3BpcGVsaW5lX3dpdGhfcGFyYWxsZWxfcnVuX2Z1bmN0aW9uKGRhdGEsIDIpCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lKSAgIyBzdWJtaXQgcGlwZWxpbmUgam9iCgogICAgICAgIGFjdHVhbF9qb2IgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLnByb3BlcnRpZXMuYXNfZGljdCgpLCAqY29tbW9uX29taXRfZmllbGRzKQogICAgICAgIGV4cGVjdGVkX2pvYiA9IHsKICAgICAgICAgICAgInRhZ3MiOiB7fSwKICAgICAgICAgICAgImlzX2FyY2hpdmVkIjogRmFsc2UsCiAgICAgICAgICAgICJqb2JfdHlwZSI6ICJQaXBlbGluZSIsCiAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAiam9iX2RhdGFfcGF0aCI6IHsiam9iX2lucHV0X3R5cGUiOiAibWx0YWJsZSIsICJtb2RlIjogIkV2YWxNb3VudCJ9LAogICAgICAgICAgICAgICAgImxpdGVyYWxfaW5wdXQiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMiJ9LAogICAgICAgICAgICB9LAogICAgICAgICAgICAiam9icyI6IHsKICAgICAgICAgICAgICAgICJub2RlMSI6IHsKICAgICAgICAgICAgICAgICAgICAiaW5wdXRfZGF0YSI6ICIke3tpbnB1dHMuam9iX2RhdGFfcGF0aH19IiwKICAgICAgICAgICAgICAgICAgICAiZGlzcGxheV9uYW1lIjogIm15LWV2YWx1YXRlLWpvYiIsCiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9kYXRhX3BhdGgiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5qb2JfZGF0YV9wYXRofX0iLAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJub2RlMSIsCiAgICAgICAgICAgICAgICAgICAgIm1pbmlfYmF0Y2hfc2l6ZSI6IDUsCiAgICAgICAgICAgICAgICAgICAgImxvZ2dpbmdfbGV2ZWwiOiAiREVCVUciLAogICAgICAgICAgICAgICAgICAgICJtYXhfY29uY3VycmVuY3lfcGVyX2luc3RhbmNlIjogIiR7e3BhcmVudC5pbnB1dHMubGl0ZXJhbF9pbnB1dH19IiwKICAgICAgICAgICAgICAgICAgICAiZXJyb3JfdGhyZXNob2xkIjogIiR7e3BhcmVudC5pbnB1dHMubGl0ZXJhbF9pbnB1dH19IiwKICAgICAgICAgICAgICAgICAgICAibWluaV9iYXRjaF9lcnJvcl90aHJlc2hvbGQiOiAiJHt7cGFyZW50LmlucHV0cy5saXRlcmFsX2lucHV0fX0iLAogICAgICAgICAgICAgICAgICAgICJvdXRwdXRzIjogeyJqb2Jfb3V0cHV0X3BhdGgiOiB7InR5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy5waXBlbGluZV9vdXRwdXR9fSJ9fSwKICAgICAgICAgICAgICAgICAgICAicmVzb3VyY2VzIjogeyJpbnN0YW5jZV9jb3VudCI6ICIke3twYXJlbnQuaW5wdXRzLmxpdGVyYWxfaW5wdXR9fSJ9LAogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogInBhcmFsbGVsIiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJvdXRwdXRzIjogewogICAgICAgICAgICAgICAgInBpcGVsaW5lX291dHB1dCI6IHsKICAgICAgICAgICAgICAgICAgICAibW9kZSI6ICJSZWFkV3JpdGVNb3VudCIsCiAgICAgICAgICAgICAgICAgICAgImpvYl9vdXRwdXRfdHlwZSI6ICJ1cmlfZm9sZGVyIiwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgInNldHRpbmdzIjogeyJkZWZhdWx0X2NvbXB1dGUiOiAiY3B1LWNsdXN0ZXIifSwKICAgICAgICB9CiAgICAgICAgYXNzZXJ0IGV4cGVjdGVkX2pvYiA9PSBhY3R1YWxfam9iCiAgICAgICAgIyBjaGVjayByZXF1aXJlZCBmaWVsZHMgaW4gam9iIGRpY3QKICAgICAgICBqb2JfZGljdCA9IHBpcGVsaW5lX2pvYi5fdG9fZGljdCgpCiAgICAgICAgZXhwZWN0ZWRfa2V5cyA9IFsic3RhdHVzIiwgInByb3BlcnRpZXMiLCAiY3JlYXRpb25fY29udGV4dCJdCiAgICAgICAgZm9yIGsgaW4gZXhwZWN0ZWRfa2V5czoKICAgICAgICAgICAgYXNzZXJ0IGsgaW4gam9iX2RpY3Qua2V5cygpLCBmImZhaWxlZCB0byBnZXQge2t9IGluIHtqb2JfZGljdH0iCgogICAgICAgICMgb3JpZ2luYWwgam9iIGRpZCBub3QgY2hhbmdlCiAgICAgICAgYXNzZXJ0X2pvYl9pbnB1dF9vdXRwdXRfdHlwZXMocGlwZWxpbmVfam9iKQogICAgICAgIGFzc2VydCBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID09ICJjcHUtY2x1c3RlciIKCiAgICBkZWYgdGVzdF9wYXJhbGxlbF9qb2Ioc2VsZiwgcmFuZHN0cjogQ2FsbGFibGVbW3N0cl0sIHN0cl0sIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGVudmlyb25tZW50ID0gIkF6dXJlTUwtc2tsZWFybi0xLjAtdWJ1bnR1MjAuMDQtcHkzOC1jcHU6MzMiCiAgICAgICAgaW5wdXRzID0gewogICAgICAgICAgICAiam9iX2RhdGFfcGF0aCI6IElucHV0KAogICAgICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgICAgICBwYXRoPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9kYXRhc2V0L21uaXN0LWRhdGEiLAogICAgICAgICAgICAgICAgbW9kZT1JbnB1dE91dHB1dE1vZGVzLkVWQUxfTU9VTlQsCiAgICAgICAgICAgICksCiAgICAgICAgfQogICAgICAgIGlucHV0X2RhdGEgPSAiJHt7aW5wdXRzLmpvYl9kYXRhX3BhdGh9fSIKICAgICAgICBvdXRwdXRzID0geyJqb2Jfb3V0cHV0X3BhdGgiOiBPdXRwdXQodHlwZT1Bc3NldFR5cGVzLlVSSV9GT0xERVIsIG1vZGU9InJ3X21vdW50Iil9CiAgICAgICAgcmVzb3VyY2VzID0geyJpbnN0YW5jZV9jb3VudCI6IDJ9CiAgICAgICAgdGFzayA9IFJ1bkZ1bmN0aW9uKAogICAgICAgICAgICBjb2RlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9kc2xfcGlwZWxpbmUvcGFyYWxsZWxfY29tcG9uZW50X3dpdGhfZmlsZV9pbnB1dC9zcmMvIiwKICAgICAgICAgICAgZW50cnlfc2NyaXB0PSJzY29yZS5weSIsCiAgICAgICAgICAgIHByb2dyYW1fYXJndW1lbnRzPSItLWpvYl9vdXRwdXRfcGF0aCAke3tvdXRwdXRzLmpvYl9vdXRwdXRfcGF0aH19IiwKICAgICAgICAgICAgZW52aXJvbm1lbnQ9ZW52aXJvbm1lbnQsCiAgICAgICAgKQogICAgICAgIGxvZ2dpbmdfbGV2ZWwgPSAiREVCVUciCiAgICAgICAgbWF4X2NvbmN1cnJlbmN5X3Blcl9pbnN0YW5jZSA9IDEKICAgICAgICBlcnJvcl90aHJlc2hvbGQgPSAxCiAgICAgICAgbWluaV9iYXRjaF9lcnJvcl90aHJlc2hvbGQgPSAxCiAgICAgICAgbWluaV9iYXRjaF9zaXplID0gIjUiCiAgICAgICAgZW52aXJvbm1lbnRfdmFyaWFibGVzID0geyJlbnZpcm9ubWVudCI6ICJ2YWwifQoKICAgICAgICBAZHNsLnBpcGVsaW5lKAogICAgICAgICAgICBuYW1lPXJhbmRzdHIoInBpcGVsaW5lX25hbWUiKSwKICAgICAgICAgICAgZGVzY3JpcHRpb249IlRoZSBwaXBlbGluZSBqb2Igd2l0aCBwYXJhbGxlbCBmdW5jdGlvbiIsCiAgICAgICAgICAgIHRhZ3M9eyJvd25lciI6ICJzZGt0ZWFtIiwgInRhZyI6ICJ0YWd2YWx1ZSJ9LAogICAgICAgICkKICAgICAgICBkZWYgcGFyYWxsZWxfaW5fcGlwZWxpbmUoam9iX2RhdGFfcGF0aCk6CiAgICAgICAgICAgIHBhcmFsbGVsX2pvYiA9IFBhcmFsbGVsSm9iKAogICAgICAgICAgICAgICAgZGlzcGxheV9uYW1lPSJteS1ldmFsdWF0ZS1qb2IiLAogICAgICAgICAgICAgICAgcmVzb3VyY2VzPXJlc291cmNlcywKICAgICAgICAgICAgICAgIG1pbmlfYmF0Y2hfc2l6ZT1taW5pX2JhdGNoX3NpemUsCiAgICAgICAgICAgICAgICB0YXNrPXRhc2ssCiAgICAgICAgICAgICAgICBpbnB1dF9kYXRhPWlucHV0X2RhdGEsCiAgICAgICAgICAgICAgICBsb2dnaW5nX2xldmVsPWxvZ2dpbmdfbGV2ZWwsCiAgICAgICAgICAgICAgICBtYXhfY29uY3VycmVuY3lfcGVyX2luc3RhbmNlPW1heF9jb25jdXJyZW5jeV9wZXJfaW5zdGFuY2UsCiAgICAgICAgICAgICAgICBlcnJvcl90aHJlc2hvbGQ9ZXJyb3JfdGhyZXNob2xkLAogICAgICAgICAgICAgICAgbWluaV9iYXRjaF9lcnJvcl90aHJlc2hvbGQ9bWluaV9iYXRjaF9lcnJvcl90aHJlc2hvbGQsCiAgICAgICAgICAgICAgICBlbnZpcm9ubWVudF92YXJpYWJsZXM9ZW52aXJvbm1lbnRfdmFyaWFibGVzLAogICAgICAgICAgICAgICAgaW5wdXRzPWlucHV0cywKICAgICAgICAgICAgICAgIG91dHB1dHM9b3V0cHV0cywKICAgICAgICAgICAgKQogICAgICAgICAgICBwYXJhbGxlbF9qb2JfZnVuYyA9IHRvX2NvbXBvbmVudChqb2I9cGFyYWxsZWxfam9iKQogICAgICAgICAgICBwYXJhbGxlbF9ub2RlID0gcGFyYWxsZWxfam9iX2Z1bmMoam9iX2RhdGFfcGF0aD1qb2JfZGF0YV9wYXRoKQoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJwaXBlbGluZV9qb2Jfb3V0IjogcGFyYWxsZWxfbm9kZS5vdXRwdXRzLmpvYl9vdXRwdXRfcGF0aCwKICAgICAgICAgICAgfQoKICAgICAgICBwaXBlbGluZSA9IHBhcmFsbGVsX2luX3BpcGVsaW5lKAogICAgICAgICAgICBJbnB1dCgKICAgICAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5NTFRBQkxFLAogICAgICAgICAgICAgICAgcGF0aD0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvZGF0YXNldC9tbmlzdC1kYXRhIiwKICAgICAgICAgICAgICAgIG1vZGU9SW5wdXRPdXRwdXRNb2Rlcy5FVkFMX01PVU5ULAogICAgICAgICAgICApLAogICAgICAgICkKICAgICAgICBwaXBlbGluZS5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCiAgICAgICAgIyBzdWJtaXQgam9iIHRvIHdvcmtzcGFjZQogICAgICAgIHBpcGVsaW5lX2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQsIGV4cGVyaW1lbnRfbmFtZT0icGFyYWxsZWxfaW5fcGlwZWxpbmUiKQogICAgICAgIG9taXRfZmllbGRzID0gWwogICAgICAgICAgICAiam9icy5wYXJhbGxlbF9ub2RlLnRhc2suY29kZSIsCiAgICAgICAgICAgICJqb2JzLnBhcmFsbGVsX25vZGUudGFzay5lbnZpcm9ubWVudCIsCiAgICAgICAgXSArIGNvbW1vbl9vbWl0X2ZpZWxkcwogICAgICAgIGFjdHVhbF9qb2IgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLnByb3BlcnRpZXMuYXNfZGljdCgpLCAqb21pdF9maWVsZHMpCiAgICAgICAgZXhwZWN0ZWRfam9iID0gewogICAgICAgICAgICAidGFncyI6IHsib3duZXIiOiAic2RrdGVhbSIsICJ0YWciOiAidGFndmFsdWUifSwKICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogIlRoZSBwaXBlbGluZSBqb2Igd2l0aCBwYXJhbGxlbCBmdW5jdGlvbiIsCiAgICAgICAgICAgICJpc19hcmNoaXZlZCI6IEZhbHNlLAogICAgICAgICAgICAiam9iX3R5cGUiOiAiUGlwZWxpbmUiLAogICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgImpvYl9kYXRhX3BhdGgiOiB7ImpvYl9pbnB1dF90eXBlIjogIm1sdGFibGUiLCAibW9kZSI6ICJFdmFsTW91bnQifSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImpvYnMiOiB7CiAgICAgICAgICAgICAgICAicGFyYWxsZWxfbm9kZSI6IHsKICAgICAgICAgICAgICAgICAgICAiaW5wdXRfZGF0YSI6ICIke3tpbnB1dHMuam9iX2RhdGFfcGF0aH19IiwKICAgICAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAiam9iX2RhdGFfcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmpvYl9kYXRhX3BhdGh9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJtaW5pX2JhdGNoX3NpemUiOiA1LAogICAgICAgICAgICAgICAgICAgICJtYXhfY29uY3VycmVuY3lfcGVyX2luc3RhbmNlIjogMSwKICAgICAgICAgICAgICAgICAgICAibWluaV9iYXRjaF9lcnJvcl90aHJlc2hvbGQiOiAxLAogICAgICAgICAgICAgICAgICAgICJuYW1lIjogInBhcmFsbGVsX25vZGUiLAogICAgICAgICAgICAgICAgICAgICJvdXRwdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAiam9iX291dHB1dF9wYXRoIjogeyJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy5waXBlbGluZV9qb2Jfb3V0fX0iLCAidHlwZSI6ICJsaXRlcmFsIn0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJyZXNvdXJjZXMiOiB7Imluc3RhbmNlX2NvdW50IjogMn0sCiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAicGFyYWxsZWwiLAogICAgICAgICAgICAgICAgICAgICJ0YXNrIjogewogICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJydW5fZnVuY3Rpb24iLAogICAgICAgICAgICAgICAgICAgICAgICAiZW50cnlfc2NyaXB0IjogInNjb3JlLnB5IiwKICAgICAgICAgICAgICAgICAgICAgICAgInByb2dyYW1fYXJndW1lbnRzIjogIi0tam9iX291dHB1dF9wYXRoICR7e291dHB1dHMuam9iX291dHB1dF9wYXRofX0iLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICAib3V0cHV0cyI6IHsKICAgICAgICAgICAgICAgICJwaXBlbGluZV9qb2Jfb3V0IjogewogICAgICAgICAgICAgICAgICAgICJtb2RlIjogIlJlYWRXcml0ZU1vdW50IiwKICAgICAgICAgICAgICAgICAgICAiam9iX291dHB1dF90eXBlIjogInVyaV9mb2xkZXIiLAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAic2V0dGluZ3MiOiB7ImRlZmF1bHRfY29tcHV0ZSI6ICJjcHUtY2x1c3RlciJ9LAogICAgICAgIH0KICAgICAgICBhc3NlcnQgZXhwZWN0ZWRfam9iID09IGFjdHVhbF9qb2IKCiAgICBkZWYgdGVzdF9tdWx0aV9wYXJhbGxlbF9jb21wb25lbnRzX3dpdGhfZmlsZV9pbnB1dF9waXBlbGluZV9vdXRwdXQoCiAgICAgICAgc2VsZiwgY2xpZW50OiBNTENsaWVudCwgcmFuZHN0cjogQ2FsbGFibGVbW3N0cl0sIHN0cl0KICAgICkgLT4gTm9uZToKICAgICAgICBjb21wb25lbnRzX2RpciA9IHRlc3RzX3Jvb3RfZGlyIC8gInRlc3RfY29uZmlncy9kc2xfcGlwZWxpbmUvcGFyYWxsZWxfY29tcG9uZW50X3dpdGhfZmlsZV9pbnB1dCIKICAgICAgICBiYXRjaF9pbmZlcmVuY2UxID0gbG9hZF9jb21wb25lbnQoc291cmNlPXN0cihjb21wb25lbnRzX2RpciAvICJzY29yZS55bWwiKSkKICAgICAgICBiYXRjaF9pbmZlcmVuY2UyID0gbG9hZF9jb21wb25lbnQoc291cmNlPXN0cihjb21wb25lbnRzX2RpciAvICJzY29yZS55bWwiKSkKICAgICAgICBjb252ZXJ0X2RhdGEgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9c3RyKGNvbXBvbmVudHNfZGlyIC8gImNvbnZlcnRfZGF0YS55bWwiKSkKCiAgICAgICAgIyBDb25zdHJ1Y3QgcGlwZWxpbmUKICAgICAgICBAZHNsLnBpcGVsaW5lKGRlZmF1bHRfY29tcHV0ZT0iY3B1LWNsdXN0ZXIiKQogICAgICAgIGRlZiBwYXJhbGxlbF9pbl9waXBlbGluZShqb2JfZGF0YV9wYXRoKToKICAgICAgICAgICAgYmF0Y2hfaW5mZXJlbmNlX25vZGUxID0gYmF0Y2hfaW5mZXJlbmNlMShqb2JfZGF0YV9wYXRoPWpvYl9kYXRhX3BhdGgpCiAgICAgICAgICAgIGNvbnZlcnRfZGF0YV9ub2RlID0gY29udmVydF9kYXRhKGlucHV0X2RhdGE9YmF0Y2hfaW5mZXJlbmNlX25vZGUxLm91dHB1dHMuam9iX291dHB1dF9wYXRoKQogICAgICAgICAgICBjb252ZXJ0X2RhdGFfbm9kZS5vdXRwdXRzLmZpbGVfb3V0cHV0X2RhdGEudHlwZSA9IEFzc2V0VHlwZXMuTUxUQUJMRQogICAgICAgICAgICBiYXRjaF9pbmZlcmVuY2Vfbm9kZTIgPSBiYXRjaF9pbmZlcmVuY2UyKGpvYl9kYXRhX3BhdGg9Y29udmVydF9kYXRhX25vZGUub3V0cHV0cy5maWxlX291dHB1dF9kYXRhKQogICAgICAgICAgICBiYXRjaF9pbmZlcmVuY2Vfbm9kZTIuaW5wdXRzLmpvYl9kYXRhX3BhdGgubW9kZSA9IElucHV0T3V0cHV0TW9kZXMuRVZBTF9NT1VOVAoKICAgICAgICAgICAgcmV0dXJuIHsiam9iX291dF9kYXRhIjogYmF0Y2hfaW5mZXJlbmNlX25vZGUyLm91dHB1dHMuam9iX291dHB1dF9wYXRofQoKICAgICAgICBwaXBlbGluZSA9IHBhcmFsbGVsX2luX3BpcGVsaW5lKAogICAgICAgICAgICBqb2JfZGF0YV9wYXRoPUlucHV0KAogICAgICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgICAgICBwYXRoPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9kYXRhc2V0L21uaXN0LWRhdGEvIiwKICAgICAgICAgICAgICAgIG1vZGU9SW5wdXRPdXRwdXRNb2Rlcy5FVkFMX01PVU5ULAogICAgICAgICAgICApLAogICAgICAgICkKICAgICAgICBwaXBlbGluZS5vdXRwdXRzLmpvYl9vdXRfZGF0YS5tb2RlID0gInVwbG9hZCIKCiAgICAgICAgIyBzdWJtaXQgcGlwZWxpbmUgam9iCiAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCwgZXhwZXJpbWVudF9uYW1lPSJwYXJhbGxlbF9pbl9waXBlbGluZSIpCgogICAgICAgIG9taXRfZmllbGRzID0gWwogICAgICAgICAgICAiam9icy4qLnRhc2suY29kZSIsCiAgICAgICAgICAgICJqb2JzLioudGFzay5lbnZpcm9ubWVudCIsCiAgICAgICAgXSArIGNvbW1vbl9vbWl0X2ZpZWxkcwogICAgICAgIGFjdHVhbF9qb2IgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLnByb3BlcnRpZXMuYXNfZGljdCgpLCAqb21pdF9maWVsZHMpCiAgICAgICAgZXhwZWN0ZWRfam9iID0gewogICAgICAgICAgICAidGFncyI6IHt9LAogICAgICAgICAgICAiaXNfYXJjaGl2ZWQiOiBGYWxzZSwKICAgICAgICAgICAgImpvYl90eXBlIjogIlBpcGVsaW5lIiwKICAgICAgICAgICAgImlucHV0cyI6IHsiam9iX2RhdGFfcGF0aCI6IHsibW9kZSI6ICJFdmFsTW91bnQiLCAiam9iX2lucHV0X3R5cGUiOiAibWx0YWJsZSJ9fSwKICAgICAgICAgICAgImpvYnMiOiB7CiAgICAgICAgICAgICAgICAiYmF0Y2hfaW5mZXJlbmNlX25vZGUxIjogewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogInBhcmFsbGVsIiwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJiYXRjaF9pbmZlcmVuY2Vfbm9kZTEiLAogICAgICAgICAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfZGF0YV9wYXRoIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuam9iX2RhdGFfcGF0aH19In0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJtaW5pX2JhdGNoX3NpemUiOiAxLAogICAgICAgICAgICAgICAgICAgICJ0YXNrIjogewogICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJydW5fZnVuY3Rpb24iLAogICAgICAgICAgICAgICAgICAgICAgICAiZW50cnlfc2NyaXB0IjogInNjb3JlLnB5IiwKICAgICAgICAgICAgICAgICAgICAgICAgInByb2dyYW1fYXJndW1lbnRzIjogIi0tam9iX291dHB1dF9wYXRoICR7e291dHB1dHMuam9iX291dHB1dF9wYXRofX0iLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgImlucHV0X2RhdGEiOiAiJHt7aW5wdXRzLmpvYl9kYXRhX3BhdGh9fSIsCiAgICAgICAgICAgICAgICAgICAgInJlc291cmNlcyI6IHsiaW5zdGFuY2VfY291bnQiOiAyfSwKICAgICAgICAgICAgICAgICAgICAibWF4X2NvbmN1cnJlbmN5X3Blcl9pbnN0YW5jZSI6IDEsCiAgICAgICAgICAgICAgICAgICAgIm1pbmlfYmF0Y2hfZXJyb3JfdGhyZXNob2xkIjogMSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAiY29udmVydF9kYXRhX25vZGUiOiB7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiY29udmVydF9kYXRhX25vZGUiLAogICAgICAgICAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJpbnB1dF9kYXRhIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5qb2JzLmJhdGNoX2luZmVyZW5jZV9ub2RlMS5vdXRwdXRzLmpvYl9vdXRwdXRfcGF0aH19IiwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIm91dHB1dHMiOiB7ImZpbGVfb3V0cHV0X2RhdGEiOiB7ImpvYl9vdXRwdXRfdHlwZSI6ICJtbHRhYmxlIn19LAogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImNvbW1hbmQiLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJiYXRjaF9pbmZlcmVuY2Vfbm9kZTIiOiB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAicGFyYWxsZWwiLAogICAgICAgICAgICAgICAgICAgICJuYW1lIjogImJhdGNoX2luZmVyZW5jZV9ub2RlMiIsCiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9kYXRhX3BhdGgiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmpvYnMuY29udmVydF9kYXRhX25vZGUub3V0cHV0cy5maWxlX291dHB1dF9kYXRhfX0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIm1vZGUiOiAiRXZhbE1vdW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIm91dHB1dHMiOiB7ImpvYl9vdXRwdXRfcGF0aCI6IHsidmFsdWUiOiAiJHt7cGFyZW50Lm91dHB1dHMuam9iX291dF9kYXRhfX0iLCAidHlwZSI6ICJsaXRlcmFsIn19LAogICAgICAgICAgICAgICAgICAgICJtaW5pX2JhdGNoX3NpemUiOiAxLAogICAgICAgICAgICAgICAgICAgICJ0YXNrIjogewogICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJydW5fZnVuY3Rpb24iLAogICAgICAgICAgICAgICAgICAgICAgICAiZW50cnlfc2NyaXB0IjogInNjb3JlLnB5IiwKICAgICAgICAgICAgICAgICAgICAgICAgInByb2dyYW1fYXJndW1lbnRzIjogIi0tam9iX291dHB1dF9wYXRoICR7e291dHB1dHMuam9iX291dHB1dF9wYXRofX0iLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgImlucHV0X2RhdGEiOiAiJHt7aW5wdXRzLmpvYl9kYXRhX3BhdGh9fSIsCiAgICAgICAgICAgICAgICAgICAgInJlc291cmNlcyI6IHsiaW5zdGFuY2VfY291bnQiOiAyfSwKICAgICAgICAgICAgICAgICAgICAibWF4X2NvbmN1cnJlbmN5X3Blcl9pbnN0YW5jZSI6IDEsCiAgICAgICAgICAgICAgICAgICAgIm1pbmlfYmF0Y2hfZXJyb3JfdGhyZXNob2xkIjogMSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJvdXRwdXRzIjogeyJqb2Jfb3V0X2RhdGEiOiB7Im1vZGUiOiAiVXBsb2FkIiwgImpvYl9vdXRwdXRfdHlwZSI6ICJ1cmlfZm9sZGVyIn19LAogICAgICAgICAgICAic2V0dGluZ3MiOiB7ImRlZmF1bHRfY29tcHV0ZSI6ICJjcHUtY2x1c3RlciJ9LAogICAgICAgIH0KICAgICAgICBhc3NlcnQgZXhwZWN0ZWRfam9iID09IGFjdHVhbF9qb2IKCiAgICBkZWYgdGVzdF9nZXRfY2hpbGRfam9iKHNlbGYsIGNsaWVudDogTUxDbGllbnQsIHJhbmRzdHI6IENhbGxhYmxlW1tzdHJdLCBzdHJdKSAtPiBOb25lOgogICAgICAgIGNvbXBvbmVudF95YW1sID0gY29tcG9uZW50c19kaXIgLyAiaGVsbG93b3JsZF9jb21wb25lbnQueW1sIgogICAgICAgIGNvbXBvbmVudF9mdW5jMSA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1jb21wb25lbnRfeWFtbCwgcGFyYW1zX292ZXJyaWRlPVt7Im5hbWUiOiByYW5kc3RyKCJjb21wb25lbnRfbmFtZSIpfV0pCiAgICAgICAgY29tcG9uZW50X2Z1bmMyID0gbG9hZF9jb21wb25lbnQoc291cmNlPWNvbXBvbmVudF95YW1sLCBwYXJhbXNfb3ZlcnJpZGU9W3sibmFtZSI6IHJhbmRzdHIoImNvbXBvbmVudF9uYW1lIil9XSkKCiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgbmFtZT1yYW5kc3RyKCJwaXBlbGluZV9uYW1lIiksCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJUaGUgaGVsbG8gd29ybGQgcGlwZWxpbmUgam9iIiwKICAgICAgICAgICAgdGFncz17Im93bmVyIjogInNka3RlYW0iLCAidGFnIjogInRhZ3ZhbHVlIn0sCiAgICAgICAgICAgIGNvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICAgICAgZXhwZXJpbWVudF9uYW1lPWV4cGVyaW1lbnRfbmFtZSwKICAgICAgICAgICAgY29udGludWVfb25fc3RlcF9mYWlsdXJlPVRydWUsCiAgICAgICAgKQogICAgICAgIGRlZiBwaXBlbGluZShqb2JfaW5fbnVtYmVyLCBqb2JfaW5fb3RoZXJfbnVtYmVyLCBqb2JfaW5fcGF0aCk6CiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMShjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQogICAgICAgICAgICBjb21wb25lbnRfZnVuYzIoY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fb3RoZXJfbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aCkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZSgxMCwgMTUsIGpvYl9pbnB1dCkKICAgICAgICBqb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lKQogICAgICAgIGNsaWVudC5qb2JzLmdldChqb2IubmFtZSkKICAgICAgICBjbGllbnQuam9icy5nZXQoam9iLm5hbWUpLl9yZXByX2h0bWxfKCkgICMgdG8gdGVzdCBjbGllbnQuam9icy5nZXQoKSB3b3JrcyBpbiBub3RlYm9vawoKICAgICAgICBjaGlsZHJlbiA9IGxpc3QoY2xpZW50LmpvYnMubGlzdChwYXJlbnRfam9iX25hbWU9am9iLm5hbWUpKQogICAgICAgIGZvciBjaGlsZCBpbiBjaGlsZHJlbjoKICAgICAgICAgICAgY2xpZW50LmpvYnMuZ2V0KGNoaWxkLm5hbWUpCiAgICAgICAgICAgIGNsaWVudC5qb2JzLmdldChjaGlsZC5uYW1lKS5fcmVwcl9odG1sXygpCgogICAgZGVmIHRlc3RfZHNsX3BpcGVsaW5lX3dpdGhvdXRfc2V0dGluZ19iaW5kaW5nX25vZGUoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUucGlwZWxpbmVfd2l0aF9zZXRfYmluZGluZ19vdXRwdXRfaW5wdXQucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgcGlwZWxpbmVfd2l0aG91dF9zZXR0aW5nX2JpbmRpbmdfbm9kZSwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmVfd2l0aG91dF9zZXR0aW5nX2JpbmRpbmdfbm9kZSgpCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSkKCiAgICAgICAgYWN0dWFsX2pvYiA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkucHJvcGVydGllcy5hc19kaWN0KCksICpjb21tb25fb21pdF9maWVsZHMpCiAgICAgICAgZXhwZWN0ZWRfam9iID0gewogICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiRTJFIGR1bW15IHBpcGVsaW5lIHdpdGggY29tcG9uZW50cyBkZWZpbmVkIHZpYSB5YW1sLiIsCiAgICAgICAgICAgICJ0YWdzIjoge30sCiAgICAgICAgICAgICJjb21wdXRlX2lkIjogImNwdS1jbHVzdGVyIiwKICAgICAgICAgICAgImlzX2FyY2hpdmVkIjogRmFsc2UsCiAgICAgICAgICAgICJqb2JfdHlwZSI6ICJQaXBlbGluZSIsCiAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAidHJhaW5pbmdfaW5wdXQiOiB7Im1vZGUiOiAiUmVhZE9ubHlNb3VudCIsICJqb2JfaW5wdXRfdHlwZSI6ICJ1cmlfZm9sZGVyIn0sCiAgICAgICAgICAgICAgICAidHJhaW5pbmdfbWF4X2Vwb2NocyI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIyMCJ9LAogICAgICAgICAgICAgICAgInRyYWluaW5nX2xlYXJuaW5nX3JhdGUiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMS44In0sCiAgICAgICAgICAgICAgICAibGVhcm5pbmdfcmF0ZV9zY2hlZHVsZSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICJ0aW1lLWJhc2VkIn0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJqb2JzIjogewogICAgICAgICAgICAgICAgInRyYWluX3dpdGhfc2FtcGxlX2RhdGEiOiB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAidHJhaW5fd2l0aF9zYW1wbGVfZGF0YSIsCiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgInRyYWluaW5nX2RhdGEiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy50cmFpbmluZ19pbnB1dH19In0sCiAgICAgICAgICAgICAgICAgICAgICAgICJtYXhfZXBvY2hzIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMudHJhaW5pbmdfbWF4X2Vwb2Noc319In0sCiAgICAgICAgICAgICAgICAgICAgICAgICJsZWFybmluZ19yYXRlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMudHJhaW5pbmdfbGVhcm5pbmdfcmF0ZX19IiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgImxlYXJuaW5nX3JhdGVfc2NoZWR1bGUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5sZWFybmluZ19yYXRlX3NjaGVkdWxlfX0iLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIm91dHB1dHMiOiB7Im1vZGVsX291dHB1dCI6IHsidmFsdWUiOiAiJHt7cGFyZW50Lm91dHB1dHMudHJhaW5lZF9tb2RlbH19IiwgInR5cGUiOiAibGl0ZXJhbCJ9fSwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm91dHB1dHMiOiB7InRyYWluZWRfbW9kZWwiOiB7Im1vZGUiOiAiUmVhZFdyaXRlTW91bnQiLCAiam9iX291dHB1dF90eXBlIjogInVyaV9mb2xkZXIifX0sCiAgICAgICAgICAgICJzZXR0aW5ncyI6IHt9LAogICAgICAgIH0KICAgICAgICBhc3NlcnQgZXhwZWN0ZWRfam9iID09IGFjdHVhbF9qb2IKCiAgICBkZWYgdGVzdF9kc2xfcGlwZWxpbmVfd2l0aF9vbmx5X3NldHRpbmdfcGlwZWxpbmVfbGV2ZWwoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLnBpcGVsaW5lX3dpdGhfc2V0X2JpbmRpbmdfb3V0cHV0X2lucHV0LnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIHBpcGVsaW5lX3dpdGhfb25seV9zZXR0aW5nX3BpcGVsaW5lX2xldmVsLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV93aXRoX29ubHlfc2V0dGluZ19waXBlbGluZV9sZXZlbCgpCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSkKCiAgICAgICAgYWN0dWFsX2pvYiA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkucHJvcGVydGllcy5hc19kaWN0KCksICpjb21tb25fb21pdF9maWVsZHMpCiAgICAgICAgZXhwZWN0ZWRfam9iID0gewogICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiRTJFIGR1bW15IHBpcGVsaW5lIHdpdGggY29tcG9uZW50cyBkZWZpbmVkIHZpYSB5YW1sLiIsCiAgICAgICAgICAgICJ0YWdzIjoge30sCiAgICAgICAgICAgICJjb21wdXRlX2lkIjogImNwdS1jbHVzdGVyIiwKICAgICAgICAgICAgImlzX2FyY2hpdmVkIjogRmFsc2UsCiAgICAgICAgICAgICJqb2JfdHlwZSI6ICJQaXBlbGluZSIsCiAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAidHJhaW5pbmdfaW5wdXQiOiB7Im1vZGUiOiAiUmVhZE9ubHlNb3VudCIsICJqb2JfaW5wdXRfdHlwZSI6ICJ1cmlfZm9sZGVyIn0sCiAgICAgICAgICAgICAgICAidHJhaW5pbmdfbWF4X2Vwb2NocyI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIyMCJ9LAogICAgICAgICAgICAgICAgInRyYWluaW5nX2xlYXJuaW5nX3JhdGUiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMS44In0sCiAgICAgICAgICAgICAgICAibGVhcm5pbmdfcmF0ZV9zY2hlZHVsZSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICJ0aW1lLWJhc2VkIn0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJqb2JzIjogewogICAgICAgICAgICAgICAgInRyYWluX3dpdGhfc2FtcGxlX2RhdGEiOiB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAidHJhaW5fd2l0aF9zYW1wbGVfZGF0YSIsCiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgInRyYWluaW5nX2RhdGEiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy50cmFpbmluZ19pbnB1dH19In0sCiAgICAgICAgICAgICAgICAgICAgICAgICJtYXhfZXBvY2hzIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMudHJhaW5pbmdfbWF4X2Vwb2Noc319In0sCiAgICAgICAgICAgICAgICAgICAgICAgICJsZWFybmluZ19yYXRlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMudHJhaW5pbmdfbGVhcm5pbmdfcmF0ZX19IiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgImxlYXJuaW5nX3JhdGVfc2NoZWR1bGUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5sZWFybmluZ19yYXRlX3NjaGVkdWxlfX0iLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIm91dHB1dHMiOiB7Im1vZGVsX291dHB1dCI6IHsidmFsdWUiOiAiJHt7cGFyZW50Lm91dHB1dHMudHJhaW5lZF9tb2RlbH19IiwgInR5cGUiOiAibGl0ZXJhbCJ9fSwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm91dHB1dHMiOiB7InRyYWluZWRfbW9kZWwiOiB7Im1vZGUiOiAiVXBsb2FkIiwgImpvYl9vdXRwdXRfdHlwZSI6ICJ1cmlfZm9sZGVyIn19LAogICAgICAgICAgICAic2V0dGluZ3MiOiB7fSwKICAgICAgICB9CiAgICAgICAgYXNzZXJ0IGV4cGVjdGVkX2pvYiA9PSBhY3R1YWxfam9iCgogICAgQHB5dGVzdC5tYXJrLnNraXBpZihjb25kaXRpb249bm90IGlzX2xpdmUoKSwgcmVhc29uPSJUT0RPKDIxNzczNTMpOiBpbnZlc3RpZ2F0ZSB3aHkgdGhpcyB0ZXN0IGZhaWxzLiIpCiAgICBkZWYgdGVzdF9kc2xfcGlwZWxpbmVfd2l0aF9vbmx5X3NldHRpbmdfYmluZGluZ19ub2RlKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgICMgVG9kbzogY2hlY2tvdXQgcnVuIHByaW9yaXR5IHdoZW4gYmFja2VuZCBpcyByZWFkeQogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5waXBlbGluZV93aXRoX3NldF9iaW5kaW5nX291dHB1dF9pbnB1dC5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBwaXBlbGluZV93aXRoX29ubHlfc2V0dGluZ19iaW5kaW5nX25vZGUsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX3dpdGhfb25seV9zZXR0aW5nX2JpbmRpbmdfbm9kZSgpCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSkKCiAgICAgICAgYWN0dWFsX2pvYiA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkucHJvcGVydGllcy5hc19kaWN0KCksICpjb21tb25fb21pdF9maWVsZHMpCiAgICAgICAgZXhwZWN0ZWRfam9iID0gewogICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiRTJFIGR1bW15IHBpcGVsaW5lIHdpdGggY29tcG9uZW50cyBkZWZpbmVkIHZpYSB5YW1sLiIsCiAgICAgICAgICAgICJ0YWdzIjoge30sCiAgICAgICAgICAgICJjb21wdXRlX2lkIjogImNwdS1jbHVzdGVyIiwKICAgICAgICAgICAgImlzX2FyY2hpdmVkIjogRmFsc2UsCiAgICAgICAgICAgICJqb2JfdHlwZSI6ICJQaXBlbGluZSIsCiAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAidHJhaW5pbmdfaW5wdXQiOiB7Im1vZGUiOiAiUmVhZE9ubHlNb3VudCIsICJqb2JfaW5wdXRfdHlwZSI6ICJ1cmlfZm9sZGVyIn0sCiAgICAgICAgICAgICAgICAidHJhaW5pbmdfbWF4X2Vwb2NocyI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIyMCJ9LAogICAgICAgICAgICAgICAgInRyYWluaW5nX2xlYXJuaW5nX3JhdGUiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMS44In0sCiAgICAgICAgICAgICAgICAibGVhcm5pbmdfcmF0ZV9zY2hlZHVsZSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICJ0aW1lLWJhc2VkIn0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJqb2JzIjogewogICAgICAgICAgICAgICAgInRyYWluX3dpdGhfc2FtcGxlX2RhdGEiOiB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAidHJhaW5fd2l0aF9zYW1wbGVfZGF0YSIsCiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgInRyYWluaW5nX2RhdGEiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibW9kZSI6ICJSZWFkT25seU1vdW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLnRyYWluaW5nX2lucHV0fX0iLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAibWF4X2Vwb2NocyI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLnRyYWluaW5nX21heF9lcG9jaHN9fSJ9LAogICAgICAgICAgICAgICAgICAgICAgICAibGVhcm5pbmdfcmF0ZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLnRyYWluaW5nX2xlYXJuaW5nX3JhdGV9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJsZWFybmluZ19yYXRlX3NjaGVkdWxlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMubGVhcm5pbmdfcmF0ZV9zY2hlZHVsZX19IiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJvdXRwdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAibW9kZWxfb3V0cHV0IjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIm1vZGUiOiAiVXBsb2FkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy50cmFpbmVkX21vZGVsfX0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAjIG1vZGUgd2lsbCBiZSBjb3BpZWQgdG8gcGlwZWxpbmUgbGV2ZWwKICAgICAgICAgICAgIm91dHB1dHMiOiB7InRyYWluZWRfbW9kZWwiOiB7Im1vZGUiOiAiVXBsb2FkIiwgImpvYl9vdXRwdXRfdHlwZSI6ICJ1cmlfZm9sZGVyIn19LAogICAgICAgICAgICAic2V0dGluZ3MiOiB7fSwKICAgICAgICB9CiAgICAgICAgYXNzZXJ0IGV4cGVjdGVkX2pvYiA9PSBhY3R1YWxfam9iCgogICAgQHB5dGVzdC5tYXJrLnNraXBpZihjb25kaXRpb249bm90IGlzX2xpdmUoKSwgcmVhc29uPSJUT0RPKDIxNzczNTMpOiBpbnZlc3RpZ2F0ZSB3aHkgdGhpcyB0ZXN0IGZhaWxzLiIpCiAgICBkZWYgdGVzdF9kc2xfcGlwZWxpbmVfd2l0aF9zZXR0aW5nX2JpbmRpbmdfbm9kZV9hbmRfcGlwZWxpbmVfbGV2ZWwoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUucGlwZWxpbmVfd2l0aF9zZXRfYmluZGluZ19vdXRwdXRfaW5wdXQucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgcGlwZWxpbmVfd2l0aF9zZXR0aW5nX2JpbmRpbmdfbm9kZV9hbmRfcGlwZWxpbmVfbGV2ZWwsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX3dpdGhfc2V0dGluZ19iaW5kaW5nX25vZGVfYW5kX3BpcGVsaW5lX2xldmVsKCkKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lKQoKICAgICAgICBhY3R1YWxfam9iID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5wcm9wZXJ0aWVzLmFzX2RpY3QoKSwgKmNvbW1vbl9vbWl0X2ZpZWxkcykKICAgICAgICBleHBlY3RlZF9qb2IgPSB7CiAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJFMkUgZHVtbXkgcGlwZWxpbmUgd2l0aCBjb21wb25lbnRzIGRlZmluZWQgdmlhIHlhbWwuIiwKICAgICAgICAgICAgInRhZ3MiOiB7fSwKICAgICAgICAgICAgImNvbXB1dGVfaWQiOiAiY3B1LWNsdXN0ZXIiLAogICAgICAgICAgICAiaXNfYXJjaGl2ZWQiOiBGYWxzZSwKICAgICAgICAgICAgImpvYl90eXBlIjogIlBpcGVsaW5lIiwKICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICJ0cmFpbmluZ19pbnB1dCI6IHsibW9kZSI6ICJEb3dubG9hZCIsICJqb2JfaW5wdXRfdHlwZSI6ICJ1cmlfZm9sZGVyIn0sCiAgICAgICAgICAgICAgICAidHJhaW5pbmdfbWF4X2Vwb2NocyI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIyMCJ9LAogICAgICAgICAgICAgICAgInRyYWluaW5nX2xlYXJuaW5nX3JhdGUiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMS44In0sCiAgICAgICAgICAgICAgICAibGVhcm5pbmdfcmF0ZV9zY2hlZHVsZSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICJ0aW1lLWJhc2VkIn0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJqb2JzIjogewogICAgICAgICAgICAgICAgInRyYWluX3dpdGhfc2FtcGxlX2RhdGEiOiB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAidHJhaW5fd2l0aF9zYW1wbGVfZGF0YSIsCiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgInRyYWluaW5nX2RhdGEiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibW9kZSI6ICJSZWFkT25seU1vdW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLnRyYWluaW5nX2lucHV0fX0iLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAibWF4X2Vwb2NocyI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLnRyYWluaW5nX21heF9lcG9jaHN9fSJ9LAogICAgICAgICAgICAgICAgICAgICAgICAibGVhcm5pbmdfcmF0ZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLnRyYWluaW5nX2xlYXJuaW5nX3JhdGV9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJsZWFybmluZ19yYXRlX3NjaGVkdWxlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMubGVhcm5pbmdfcmF0ZV9zY2hlZHVsZX19IiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJvdXRwdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAibW9kZWxfb3V0cHV0IjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIm1vZGUiOiAiVXBsb2FkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy50cmFpbmVkX21vZGVsfX0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAjIHBpcGVsaW5lIGxldmVsIG91dHB1dCBzZXR0aW5nIHRha2luZyBlZmZlY3QKICAgICAgICAgICAgIm91dHB1dHMiOiB7InRyYWluZWRfbW9kZWwiOiB7Im1vZGUiOiAiUmVhZFdyaXRlTW91bnQiLCAiam9iX291dHB1dF90eXBlIjogInVyaV9mb2xkZXIifX0sCiAgICAgICAgICAgICJzZXR0aW5ncyI6IHt9LAogICAgICAgIH0KICAgICAgICBhc3NlcnQgZXhwZWN0ZWRfam9iID09IGFjdHVhbF9qb2IKCiAgICBkZWYgdGVzdF9kc2xfcGlwZWxpbmVfd2l0aF9jb21tYW5kX2J1aWxkZXJfc2V0dGluZ19iaW5kaW5nX25vZGVfYW5kX3BpcGVsaW5lX2xldmVsKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLnBpcGVsaW5lX3dpdGhfc2V0X2JpbmRpbmdfb3V0cHV0X2lucHV0LnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIHBpcGVsaW5lX3dpdGhfY29tbWFuZF9idWlsZGVyX3NldHRpbmdfYmluZGluZ19ub2RlX2FuZF9waXBlbGluZV9sZXZlbCwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmVfd2l0aF9jb21tYW5kX2J1aWxkZXJfc2V0dGluZ19iaW5kaW5nX25vZGVfYW5kX3BpcGVsaW5lX2xldmVsKCkKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lKQoKICAgICAgICBhY3R1YWxfam9iID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5wcm9wZXJ0aWVzLmFzX2RpY3QoKSwgKmNvbW1vbl9vbWl0X2ZpZWxkcykKCiAgICAgICAgZXhwZWN0ZWRfam9iID0gewogICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiRTJFIGR1bW15IHBpcGVsaW5lIHdpdGggY29tcG9uZW50cyBkZWZpbmVkIHZpYSB5YW1sLiIsCiAgICAgICAgICAgICJ0YWdzIjoge30sCiAgICAgICAgICAgICJjb21wdXRlX2lkIjogImNwdS1jbHVzdGVyIiwKICAgICAgICAgICAgImlzX2FyY2hpdmVkIjogRmFsc2UsCiAgICAgICAgICAgICJqb2JfdHlwZSI6ICJQaXBlbGluZSIsCiAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAidHJhaW5pbmdfaW5wdXQiOiB7Im1vZGUiOiAiRG93bmxvYWQiLCAiam9iX2lucHV0X3R5cGUiOiAidXJpX2ZvbGRlciJ9LAogICAgICAgICAgICAgICAgInRyYWluaW5nX21heF9lcG9jaHMiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMjAifSwKICAgICAgICAgICAgICAgICJ0cmFpbmluZ19sZWFybmluZ19yYXRlIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjEuOCJ9LAogICAgICAgICAgICAgICAgImxlYXJuaW5nX3JhdGVfc2NoZWR1bGUiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAidGltZS1iYXNlZCJ9LAogICAgICAgICAgICB9LAogICAgICAgICAgICAiam9icyI6IHsKICAgICAgICAgICAgICAgICJ0cmFpbl93aXRoX3NhbXBsZV9kYXRhIjogewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImNvbW1hbmQiLAogICAgICAgICAgICAgICAgICAgICJkaXN0cmlidXRpb24iOiB7ImRpc3RyaWJ1dGlvbl90eXBlIjogIlB5VG9yY2giLCAicHJvY2Vzc19jb3VudF9wZXJfaW5zdGFuY2UiOiAyfSwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJ0cmFpbl93aXRoX3NhbXBsZV9kYXRhIiwKICAgICAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAidHJhaW5pbmdfZGF0YSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJtb2RlIjogIlJlYWRPbmx5TW91bnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMudHJhaW5pbmdfaW5wdXR9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJtYXhfZXBvY2hzIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMudHJhaW5pbmdfbWF4X2Vwb2Noc319In0sCiAgICAgICAgICAgICAgICAgICAgICAgICJsZWFybmluZ19yYXRlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMudHJhaW5pbmdfbGVhcm5pbmdfcmF0ZX19IiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgImxlYXJuaW5nX3JhdGVfc2NoZWR1bGUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5sZWFybmluZ19yYXRlX3NjaGVkdWxlfX0iLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIm91dHB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtb2RlbF9vdXRwdXQiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibW9kZSI6ICJVcGxvYWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5vdXRwdXRzLnRyYWluZWRfbW9kZWx9fSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJvdXRwdXRzIjogeyJ0cmFpbmVkX21vZGVsIjogeyJtb2RlIjogIlJlYWRXcml0ZU1vdW50IiwgImpvYl9vdXRwdXRfdHlwZSI6ICJ1cmlfZm9sZGVyIn19LAogICAgICAgICAgICAic2V0dGluZ3MiOiB7fSwKICAgICAgICB9CiAgICAgICAgYXNzZXJ0IGV4cGVjdGVkX2pvYiA9PSBhY3R1YWxfam9iCgogICAgQHB5dGVzdC5tYXJrLnNraXAoIlRPRE8gKDIzNzUwODYpOiBKb2IgZmFpbGluZyB3aXRoICdVc2VyIGZhaWxlZCB0byBjYWxsIFNhdmVVc2VyVG9rZW4gYmVmb3JlIEdldFVzZXJUb2tlbiciKQogICAgZGVmIHRlc3Rfc3BhcmtfY29tcG9uZW50cyhzZWxmLCBjbGllbnQ6IE1MQ2xpZW50LCByYW5kc3RyOiBDYWxsYWJsZVtbc3RyXSwgc3RyXSkgLT4gTm9uZToKICAgICAgICBjb21wb25lbnRzX2RpciA9IHRlc3RzX3Jvb3RfZGlyIC8gInRlc3RfY29uZmlncy9kc2xfcGlwZWxpbmUvc3Bhcmtfam9iX2luX3BpcGVsaW5lIgogICAgICAgIGFkZF9ncmVldGluZ19jb2x1bW4gPSBsb2FkX2NvbXBvbmVudChzdHIoY29tcG9uZW50c19kaXIgLyAiYWRkX2dyZWV0aW5nX2NvbHVtbl9jb21wb25lbnQueW1sIikpCiAgICAgICAgY291bnRfYnlfcm93ID0gbG9hZF9jb21wb25lbnQoc3RyKGNvbXBvbmVudHNfZGlyIC8gImNvdW50X2J5X3Jvd19jb21wb25lbnQueW1sIikpCgogICAgICAgICMgQ29uc3RydWN0IHBpcGVsaW5lCiAgICAgICAgQGRzbC5waXBlbGluZSgpCiAgICAgICAgZGVmIHNwYXJrX3BpcGVsaW5lX2Zyb21feWFtbChpcmlzX2RhdGEpOgogICAgICAgICAgICBhZGRfZ3JlZXRpbmdfY29sdW1uX25vZGUgPSBhZGRfZ3JlZXRpbmdfY29sdW1uKGZpbGVfaW5wdXQ9aXJpc19kYXRhKQogICAgICAgICAgICBhZGRfZ3JlZXRpbmdfY29sdW1uX25vZGUucmVzb3VyY2VzID0geyJpbnN0YW5jZV90eXBlIjogInN0YW5kYXJkX2U0c192MyIsICJydW50aW1lX3ZlcnNpb24iOiAiMy4yLjAifQogICAgICAgICAgICBjb3VudF9ieV9yb3dfbm9kZSA9IGNvdW50X2J5X3JvdyhmaWxlX2lucHV0PWlyaXNfZGF0YSkKICAgICAgICAgICAgY291bnRfYnlfcm93X25vZGUucmVzb3VyY2VzID0geyJpbnN0YW5jZV90eXBlIjogInN0YW5kYXJkX2U0c192MyIsICJydW50aW1lX3ZlcnNpb24iOiAiMy4yLjAifQogICAgICAgICAgICByZXR1cm4geyJvdXRwdXQiOiBjb3VudF9ieV9yb3dfbm9kZS5vdXRwdXRzLm91dHB1dH0KCiAgICAgICAgcGlwZWxpbmUgPSBzcGFya19waXBlbGluZV9mcm9tX3lhbWwoCiAgICAgICAgICAgIGlyaXNfZGF0YT1JbnB1dCgKICAgICAgICAgICAgICAgIHBhdGg9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2RzbF9waXBlbGluZS9zcGFya19qb2JfaW5fcGlwZWxpbmUvZGF0YXNldC9pcmlzLmNzdiIsCiAgICAgICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuVVJJX0ZJTEUsCiAgICAgICAgICAgICAgICBtb2RlPUlucHV0T3V0cHV0TW9kZXMuRElSRUNULAogICAgICAgICAgICApLAogICAgICAgICkKICAgICAgICBwaXBlbGluZS5vdXRwdXRzLm91dHB1dC5tb2RlID0gIkRpcmVjdCIKICAgICAgICBwaXBlbGluZS5vdXRwdXRzLm91dHB1dC50eXBlID0gInVyaV9maWxlIgoKICAgICAgICAjIHN1Ym1pdCBwaXBlbGluZSBqb2IKICAgICAgICBwaXBlbGluZV9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50LCBleHBlcmltZW50X25hbWU9InNwYXJrX2luX3BpcGVsaW5lIikKICAgICAgICAjIGNoZWNrIHJlcXVpcmVkIGZpZWxkcyBpbiBqb2IgZGljdAogICAgICAgIGpvYl9kaWN0ID0gcGlwZWxpbmVfam9iLl90b19kaWN0KCkKICAgICAgICBleHBlY3RlZF9rZXlzID0gWyJzdGF0dXMiLCAicHJvcGVydGllcyIsICJjcmVhdGlvbl9jb250ZXh0Il0KICAgICAgICBmb3IgayBpbiBleHBlY3RlZF9rZXlzOgogICAgICAgICAgICBhc3NlcnQgayBpbiBqb2JfZGljdC5rZXlzKCksIGYiZmFpbGVkIHRvIGdldCB7a30gaW4ge2pvYl9kaWN0fSIKCiAgICAgICAgIyBvcmlnaW5hbCBqb2IgZGlkIG5vdCBjaGFuZ2UKICAgICAgICBhc3NlcnRfam9iX2lucHV0X291dHB1dF90eXBlcyhwaXBlbGluZV9qb2IpCgogICAgZGVmIHRlc3RfcGlwZWxpbmVfd2l0aF9ncm91cChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBmcm9tIGVudW0gaW1wb3J0IEVudW0KCiAgICAgICAgY2xhc3MgRW51bU9wcyhFbnVtKToKICAgICAgICAgICAgT3B0aW9uMSA9ICJoZWxsbyIKICAgICAgICAgICAgT3B0aW9uMiA9ICJ3b3JsZCIKCiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X3lhbWwgPSAiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9pbnB1dF90eXBlc19jb21wb25lbnQueW1sIgogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9mdW5jID0gbG9hZF9jb21wb25lbnQoaGVsbG9fd29ybGRfY29tcG9uZW50X3lhbWwpCiAgICAgICAgZnJvbSBhenVyZS5haS5tbC5kc2wuX2dyb3VwX2RlY29yYXRvciBpbXBvcnQgZ3JvdXAKCiAgICAgICAgQGdyb3VwCiAgICAgICAgY2xhc3MgUGFyYW1DbGFzczoKICAgICAgICAgICAgaW50X3BhcmFtOiBJbnB1dChtaW49MS4wLCBtYXg9NS4wLCB0eXBlPSJpbnRlZ2VyIikKICAgICAgICAgICAgZW51bV9wYXJhbTogRW51bU9wcwogICAgICAgICAgICBzdHJfcGFyYW06IHN0ciA9ICJ0ZXN0IgogICAgICAgICAgICBib29sX3BhcmFtOiBib29sID0gVHJ1ZQogICAgICAgICAgICBudW1iZXJfcGFyYW0gPSA0LjAKCiAgICAgICAgZGVmYXVsdF9wYXJhbSA9IFBhcmFtQ2xhc3MoaW50X3BhcmFtPTIsIGVudW1fcGFyYW09RW51bU9wcy5PcHRpb24xLCBib29sX3BhcmFtPUZhbHNlKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKGRlZmF1bHRfY29tcHV0ZV90YXJnZXQ9ImNwdS1jbHVzdGVyIikKICAgICAgICBkZWYgcGlwZWxpbmVfd2l0aF9ncm91cChncm91cDogUGFyYW1DbGFzcyk6CiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9mdW5jKAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3N0cmluZz1ncm91cC5zdHJfcGFyYW0sCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fcmFuZ2VkX251bWJlcj1ncm91cC5udW1iZXJfcGFyYW0sCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fZW51bT1ncm91cC5lbnVtX3BhcmFtLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX2Jvb2xlYW49Z3JvdXAuYm9vbF9wYXJhbSwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9yYW5nZWRfaW50ZWdlcj1ncm91cC5pbnRfcGFyYW0sCiAgICAgICAgICAgICkKCiAgICAgICAgcGlwZWxpbmVfam9iID0gcGlwZWxpbmVfd2l0aF9ncm91cChkZWZhdWx0X3BhcmFtKQogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmVfam9iKQoKICAgICAgICBhY3R1YWxfam9iID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5wcm9wZXJ0aWVzLmFzX2RpY3QoKSwgKmNvbW1vbl9vbWl0X2ZpZWxkcykKICAgICAgICBleHBlY3RlZF9qb2JfaW5wdXRzID0gewogICAgICAgICAgICAiZ3JvdXAuaW50X3BhcmFtIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjIifSwKICAgICAgICAgICAgImdyb3VwLmVudW1fcGFyYW0iOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiaGVsbG8ifSwKICAgICAgICAgICAgImdyb3VwLnN0cl9wYXJhbSI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICJ0ZXN0In0sCiAgICAgICAgICAgICJncm91cC5ib29sX3BhcmFtIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIkZhbHNlIn0sCiAgICAgICAgICAgICJncm91cC5udW1iZXJfcGFyYW0iOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiNC4wIn0sCiAgICAgICAgfQogICAgICAgIGV4cGVjdGVkX25vZGVfaW5wdXRzID0gewogICAgICAgICAgICAiY29tcG9uZW50X2luX3N0cmluZyI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmdyb3VwLnN0cl9wYXJhbX19In0sCiAgICAgICAgICAgICJjb21wb25lbnRfaW5fcmFuZ2VkX2ludGVnZXIiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5ncm91cC5pbnRfcGFyYW19fSJ9LAogICAgICAgICAgICAiY29tcG9uZW50X2luX2VudW0iOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5ncm91cC5lbnVtX3BhcmFtfX0ifSwKICAgICAgICAgICAgImNvbXBvbmVudF9pbl9ib29sZWFuIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuZ3JvdXAuYm9vbF9wYXJhbX19In0sCiAgICAgICAgICAgICJjb21wb25lbnRfaW5fcmFuZ2VkX251bWJlciI6IHsKICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuaW5wdXRzLmdyb3VwLm51bWJlcl9wYXJhbX19IiwKICAgICAgICAgICAgfSwKICAgICAgICB9CiAgICAgICAgYXNzZXJ0IGFjdHVhbF9qb2JbImlucHV0cyJdID09IGV4cGVjdGVkX2pvYl9pbnB1dHMKICAgICAgICBhc3NlcnQgYWN0dWFsX2pvYlsiam9icyJdWyJtaWNyb3NvZnRfc2FtcGxlc19jb21tYW5kX2NvbXBvbmVudF9iYXNpY19pbnB1dHMiXVsiaW5wdXRzIl0gPT0gZXhwZWN0ZWRfbm9kZV9pbnB1dHMKCiAgICBkZWYgdGVzdF9yZWdpc3RlcmVkX3BpcGVsaW5lX3dpdGhfZ3JvdXAoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X3lhbWwgPSAiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9pbnB1dF90eXBlc19jb21wb25lbnQueW1sIgogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9mdW5jID0gbG9hZF9jb21wb25lbnQoaGVsbG9fd29ybGRfY29tcG9uZW50X3lhbWwpCiAgICAgICAgZnJvbSBhenVyZS5haS5tbC5kc2wuX2dyb3VwX2RlY29yYXRvciBpbXBvcnQgZ3JvdXAKCiAgICAgICAgQGdyb3VwCiAgICAgICAgY2xhc3MgU3ViUGFyYW1DbGFzczoKICAgICAgICAgICAgaW50X3BhcmFtOiBJbnB1dChtaW49MS4wLCBtYXg9NS4wLCB0eXBlPSJpbnRlZ2VyIikKCiAgICAgICAgQGdyb3VwCiAgICAgICAgY2xhc3MgUGFyYW1DbGFzczoKICAgICAgICAgICAgc3ViOiBTdWJQYXJhbUNsYXNzCiAgICAgICAgICAgIHN0cl9wYXJhbTogc3RyID0gInRlc3QiCiAgICAgICAgICAgIGJvb2xfcGFyYW06IGJvb2wgPSBUcnVlCiAgICAgICAgICAgIG51bWJlcl9wYXJhbSA9IDQuMAoKICAgICAgICBAZHNsLnBpcGVsaW5lKCkKICAgICAgICBkZWYgcGlwZWxpbmVfd2l0aF9ncm91cChncm91cDogUGFyYW1DbGFzcyk6CiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9mdW5jKAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3N0cmluZz1ncm91cC5zdHJfcGFyYW0sCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fcmFuZ2VkX251bWJlcj1ncm91cC5udW1iZXJfcGFyYW0sCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fYm9vbGVhbj1ncm91cC5ib29sX3BhcmFtLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3JhbmdlZF9pbnRlZ2VyPWdyb3VwLnN1Yi5pbnRfcGFyYW0sCiAgICAgICAgICAgICkKCiAgICAgICAgY29tcG9uZW50ID0gY2xpZW50LmNvbXBvbmVudHMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZV93aXRoX2dyb3VwKQogICAgICAgICMgQXNzZXJ0IGtleSBub3QgZXhpc3RzCiAgICAgICAgbWF0Y2ggPSAoCiAgICAgICAgICAgICIoLiopdW5leHBlY3RlZCBrZXl3b3JkIGFyZ3VtZW50ICdncm91cC5ub3RfZXhpc3QnKC4qKXZhbGlkIGtleXdvcmRzOiAiCiAgICAgICAgICAgICInZ3JvdXAnLCAnZ3JvdXAuc3ViLmludF9wYXJhbScsICdncm91cC5zdHJfcGFyYW0nLCAnZ3JvdXAuYm9vbF9wYXJhbScsICdncm91cC5udW1iZXJfcGFyYW0nIgogICAgICAgICkKICAgICAgICB3aXRoIHB5dGVzdC5yYWlzZXMoVW5leHBlY3RlZEtleXdvcmRFcnJvciwgbWF0Y2g9bWF0Y2gpOgogICAgICAgICAgICBjb21wb25lbnQoCiAgICAgICAgICAgICAgICAqKnsKICAgICAgICAgICAgICAgICAgICAiZ3JvdXAubnVtYmVyX3BhcmFtIjogNC4wLAogICAgICAgICAgICAgICAgICAgICJncm91cC5zdHJfcGFyYW0iOiAidGVzdGluZyIsCiAgICAgICAgICAgICAgICAgICAgImdyb3VwLnN1Yi5pbnRfcGFyYW0iOiA0LAogICAgICAgICAgICAgICAgICAgICJncm91cC5ub3RfZXhpc3QiOiA0LAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgIyBBc3NlcnQgY29uZmxpY3QgYXNzaWdubWVudAogICAgICAgIHdpdGggcHl0ZXN0LnJhaXNlcyhFeGNlcHRpb24sIG1hdGNoPSJDb25mbGljdCBwYXJhbWV0ZXIga2V5ICdncm91cCcgYW5kICdncm91cC5udW1iZXJfcGFyYW0nIik6CiAgICAgICAgICAgIHBpcGVsaW5lID0gY29tcG9uZW50KAogICAgICAgICAgICAgICAgKip7CiAgICAgICAgICAgICAgICAgICAgImdyb3VwLm51bWJlcl9wYXJhbSI6IDQuMCwKICAgICAgICAgICAgICAgICAgICAiZ3JvdXAuc3RyX3BhcmFtIjogInRlc3RpbmciLAogICAgICAgICAgICAgICAgICAgICJncm91cC5zdWIuaW50X3BhcmFtIjogNCwKICAgICAgICAgICAgICAgICAgICAiZ3JvdXAiOiBQYXJhbUNsYXNzKHN1Yj1TdWJQYXJhbUNsYXNzKGludF9wYXJhbT0xKSksCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkKICAgICAgICAgICAgcGlwZWxpbmUuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImNwdS1jbHVzdGVyIgogICAgICAgICAgICBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lKQogICAgICAgICMgQXNzZXJ0IGhhcHB5IHBhdGgKICAgICAgICBpbnB1dHMgPSB7Imdyb3VwLm51bWJlcl9wYXJhbSI6IDQuMCwgImdyb3VwLnN0cl9wYXJhbSI6ICJ0ZXN0aW5nIiwgImdyb3VwLnN1Yi5pbnRfcGFyYW0iOiA0fQogICAgICAgIHBpcGVsaW5lID0gY29tcG9uZW50KCoqaW5wdXRzKQogICAgICAgIHBpcGVsaW5lLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKICAgICAgICByZXN0X3BpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmUpCiAgICAgICAgYXNzZXJ0IHJlc3RfcGlwZWxpbmVfam9iLl90b19kaWN0KClbImlucHV0cyJdID09IHtrZXk6IHN0cih2YWwpIGZvciBrZXksIHZhbCBpbiBpbnB1dHMuaXRlbXMoKX0KCiAgICBkZWYgdGVzdF9kc2xfcGlwZWxpbmVfd2l0aF9kZWZhdWx0X2NvbXBvbmVudCgKICAgICAgICBzZWxmLAogICAgICAgIGNsaWVudDogTUxDbGllbnQsCiAgICAgICAgcmFuZHN0cjogQ2FsbGFibGVbW3N0cl0sIHN0cl0sCiAgICApIC0\u002BIE5vbmU6CiAgICAgICAgeWFtbF9wYXRoOiBzdHIgPSAiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiCiAgICAgICAgY29tcG9uZW50X25hbWUgPSByYW5kc3RyKCJjb21wb25lbnRfbmFtZSIpCiAgICAgICAgY29tcG9uZW50OiBDb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9eWFtbF9wYXRoLCBwYXJhbXNfb3ZlcnJpZGU9W3sibmFtZSI6IGNvbXBvbmVudF9uYW1lfV0pCiAgICAgICAgY2xpZW50LmNvbXBvbmVudHMuY3JlYXRlX29yX3VwZGF0ZShjb21wb25lbnQpCgogICAgICAgIGRlZmF1bHRfY29tcG9uZW50X2Z1bmMgPSBjbGllbnQuY29tcG9uZW50cy5nZXQoY29tcG9uZW50X25hbWUpCgogICAgICAgIEBkc2wucGlwZWxpbmUoKQogICAgICAgIGRlZiBwaXBlbGluZV93aXRoX2RlZmF1bHRfY29tcG9uZW50KCk6CiAgICAgICAgICAgIG5vZGUxID0gZGVmYXVsdF9jb21wb25lbnRfZnVuYyhjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5wdXQpCiAgICAgICAgICAgIG5vZGUxLmNvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCgogICAgICAgICMgY29tcG9uZW50IGZyb20gY2xpZW50LmNvbXBvbmVudHMuZ2V0CiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZV93aXRoX2RlZmF1bHRfY29tcG9uZW50KCkpCiAgICAgICAgY3JlYXRlZF9waXBlbGluZV9qb2I6IFBpcGVsaW5lSm9iID0gY2xpZW50LmpvYnMuZ2V0KHBpcGVsaW5lX2pvYi5uYW1lKQogICAgICAgIGFzc2VydCBjcmVhdGVkX3BpcGVsaW5lX2pvYi5qb2JzWyJub2RlMSJdLmNvbXBvbmVudCA9PSBmIntjb21wb25lbnRfbmFtZX1AZGVmYXVsdCIKCiAgICBkZWYgdGVzdF9waXBlbGluZV9ub2RlX2lkZW50aXR5X3dpdGhfY29tcG9uZW50KHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIHBhdGggPSAiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiCiAgICAgICAgY29tcG9uZW50X2Z1bmMgPSBsb2FkX2NvbXBvbmVudChwYXRoKQoKICAgICAgICBAZHNsLnBpcGVsaW5lCiAgICAgICAgZGVmIHBpcGVsaW5lX2Z1bmMoY29tcG9uZW50X2luX3BhdGgpOgogICAgICAgICAgICBub2RlMSA9IGNvbXBvbmVudF9mdW5jKGNvbXBvbmVudF9pbl9udW1iZXI9MSwgY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2luX3BhdGgpCiAgICAgICAgICAgIG5vZGUxLmlkZW50aXR5ID0gQW1sVG9rZW5Db25maWd1cmF0aW9uKCkKCiAgICAgICAgICAgIG5vZGUyID0gY29tcG9uZW50X2Z1bmMoY29tcG9uZW50X2luX251bWJlcj0xLCBjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5fcGF0aCkKICAgICAgICAgICAgbm9kZTIuaWRlbnRpdHkgPSBVc2VySWRlbnRpdHlDb25maWd1cmF0aW9uKCkKCiAgICAgICAgICAgIG5vZGUzID0gY29tcG9uZW50X2Z1bmMoY29tcG9uZW50X2luX251bWJlcj0xLCBjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5fcGF0aCkKICAgICAgICAgICAgbm9kZTMuaWRlbnRpdHkgPSBNYW5hZ2VkSWRlbnRpdHlDb25maWd1cmF0aW9uKCkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV9mdW5jKGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbnB1dCkKICAgICAgICBwaXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lLCBjb21wdXRlPSJjcHUtY2x1c3RlciIpCiAgICAgICAgb21pdF9maWVsZHMgPSBbImpvYnMuKi5jb21wb25lbnRJZCIsICJqb2JzLiouX3NvdXJjZSJdCiAgICAgICAgYWN0dWFsX2RpY3QgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKVsicHJvcGVydGllcyJdLCAqb21pdF9maWVsZHMpCiAgICAgICAgYXNzZXJ0IGFjdHVhbF9kaWN0WyJqb2JzIl0gPT0gewogICAgICAgICAgICAibm9kZTEiOiB7CiAgICAgICAgICAgICAgICAiaWRlbnRpdHkiOiB7InR5cGUiOiAiYW1sX3Rva2VuIn0sCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fbnVtYmVyIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjEifSwKICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX3BhdGgiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5jb21wb25lbnRfaW5fcGF0aH19In0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm5hbWUiOiAibm9kZTEiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJub2RlMiI6IHsKICAgICAgICAgICAgICAgICJpZGVudGl0eSI6IHsidHlwZSI6ICJ1c2VyX2lkZW50aXR5In0sCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fbnVtYmVyIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjEifSwKICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX3BhdGgiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5jb21wb25lbnRfaW5fcGF0aH19In0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm5hbWUiOiAibm9kZTIiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJub2RlMyI6IHsKICAgICAgICAgICAgICAgICJpZGVudGl0eSI6IHsidHlwZSI6ICJtYW5hZ2VkX2lkZW50aXR5In0sCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fbnVtYmVyIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjEifSwKICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX3BhdGgiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5jb21wb25lbnRfaW5fcGF0aH19In0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm5hbWUiOiAibm9kZTMiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgfQoKICAgIGRlZiB0ZXN0X2RlZmF1bHRfcGlwZWxpbmVfam9iX3NlcnZpY2VzKHNlbGYsIGNsaWVudDogTUxDbGllbnQsIHJhbmRzdHI6IENhbGxhYmxlW1tzdHJdLCBzdHJdKSAtPiBOb25lOgogICAgICAgIGNvbXBvbmVudF95YW1sID0gY29tcG9uZW50c19kaXIgLyAiaGVsbG93b3JsZF9jb21wb25lbnQueW1sIgogICAgICAgIGNvbXBvbmVudF9mdW5jMSA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1jb21wb25lbnRfeWFtbCwgcGFyYW1zX292ZXJyaWRlPVt7Im5hbWUiOiByYW5kc3RyKCJjb21wb25lbnRfbmFtZSIpfV0pCiAgICAgICAgY29tcG9uZW50X2Z1bmMyID0gbG9hZF9jb21wb25lbnQoc291cmNlPWNvbXBvbmVudF95YW1sLCBwYXJhbXNfb3ZlcnJpZGU9W3sibmFtZSI6IHJhbmRzdHIoImNvbXBvbmVudF9uYW1lIil9XSkKCiAgICAgICAgQGRzbC5waXBlbGluZSgKICAgICAgICAgICAgbmFtZT1yYW5kc3RyKCJwaXBlbGluZV9uYW1lIiksCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJUaGUgaGVsbG8gd29ybGQgcGlwZWxpbmUgam9iIiwKICAgICAgICAgICAgdGFncz17Im93bmVyIjogInNka3RlYW0iLCAidGFnIjogInRhZ3ZhbHVlIn0sCiAgICAgICAgICAgIGNvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICAgICAgZXhwZXJpbWVudF9uYW1lPWV4cGVyaW1lbnRfbmFtZSwKICAgICAgICAgICAgY29udGludWVfb25fc3RlcF9mYWlsdXJlPVRydWUsCiAgICAgICAgKQogICAgICAgIGRlZiBwaXBlbGluZShqb2JfaW5fbnVtYmVyLCBqb2JfaW5fb3RoZXJfbnVtYmVyLCBqb2JfaW5fcGF0aCk6CiAgICAgICAgICAgIGNvbXBvbmVudF9mdW5jMShjb21wb25lbnRfaW5fbnVtYmVyPWpvYl9pbl9udW1iZXIsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbl9wYXRoKQogICAgICAgICAgICBjb21wb25lbnRfZnVuYzIoY29tcG9uZW50X2luX251bWJlcj1qb2JfaW5fb3RoZXJfbnVtYmVyLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5fcGF0aCkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZSgxMCwgMTUsIGpvYl9pbnB1dCkKICAgICAgICBqb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lKQogICAgICAgICMgY2hlY2sgcmVxdWlyZWQgZmllbGRzIGluIGpvYiBkaWN0CiAgICAgICAgZGVmYXVsdF9zZXJ2aWNlcyA9IGpvYi5fdG9fZGljdCgpWyJzZXJ2aWNlcyJdCiAgICAgICAgYXNzZXJ0ICJTdHVkaW8iIGluIGRlZmF1bHRfc2VydmljZXMKICAgICAgICBhc3NlcnQgIlRyYWNraW5nIiBpbiBkZWZhdWx0X3NlcnZpY2VzCiAgICAgICAgYXNzZXJ0IGRlZmF1bHRfc2VydmljZXNbIlN0dWRpbyJdWyJlbmRwb2ludCJdLnN0YXJ0c3dpdGgoImh0dHBzOi8vbWwuYXp1cmUuY29tL3J1bnMvIikKICAgICAgICBhc3NlcnQgZGVmYXVsdF9zZXJ2aWNlc1siU3R1ZGlvIl1bInR5cGUiXSA9PSAiU3R1ZGlvIgogICAgICAgIGFzc2VydCBkZWZhdWx0X3NlcnZpY2VzWyJUcmFja2luZyJdWyJlbmRwb2ludCJdLnN0YXJ0c3dpdGgoImF6dXJlbWw6Ly8iKQogICAgICAgIGFzc2VydCBkZWZhdWx0X3NlcnZpY2VzWyJUcmFja2luZyJdWyJ0eXBlIl0gPT0gIlRyYWNraW5nIgoKICAgIGRlZiB0ZXN0X2dyb3VwX291dHB1dHNfZGVzY3JpcHRpb25fb3ZlcndyaXRlKHNlbGYsIGNsaWVudCk6CiAgICAgICAgIyB0ZXN0IGdyb3VwIG91dHB1dHMgZGVzY3JpcHRpb24gb3ZlcndyaXRlCiAgICAgICAgQGdyb3VwCiAgICAgICAgY2xhc3MgT3V0cHV0czoKICAgICAgICAgICAgb3V0cHV0MTogT3V0cHV0KHR5cGU9InVyaV9mb2xkZXIiLCBkZXNjcmlwdGlvbj0ibmV3IGRlc2NyaXB0aW9uIikKCiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X3lhbWwgPSAiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiCiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9aGVsbG9fd29ybGRfY29tcG9uZW50X3lhbWwpCgogICAgICAgIEBkc2wucGlwZWxpbmUoZGVmYXVsdF9jb21wdXRlX3RhcmdldD0iY3B1LWNsdXN0ZXIiKQogICAgICAgIGRlZiBteV9waXBlbGluZSgpIC0\u002BIE91dHB1dHM6CiAgICAgICAgICAgIG5vZGUxID0gaGVsbG9fd29ybGRfY29tcG9uZW50X2Z1bmMoY29tcG9uZW50X2luX251bWJlcj0xLCBjb21wb25lbnRfaW5fcGF0aD1qb2JfaW5wdXQpCiAgICAgICAgICAgIHJldHVybiBPdXRwdXRzKAogICAgICAgICAgICAgICAgb3V0cHV0MT1ub2RlMS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwKICAgICAgICAgICAgKQoKICAgICAgICBwaXBlbGluZV9qb2IgPSBteV9waXBlbGluZSgpCiAgICAgICAgIyBvdmVyd3JpdGUgZ3JvdXAgb3V0cHV0cyBtb2RlIHdpbGwgYXBwZWFyIGluIHBpcGVsaW5lIGpvYiZjb21wb25lbnQgbGV2ZWwKICAgICAgICBleHBlY3RlZF9vdXRwdXRzID0geyJvdXRwdXQxIjogeyJkZXNjcmlwdGlvbiI6ICJuZXcgZGVzY3JpcHRpb24iLCAidHlwZSI6ICJ1cmlfZm9sZGVyIn19CiAgICAgICAgZXhwZWN0ZWRfam9iX291dHB1dHMgPSB7Im91dHB1dDEiOiB7ImRlc2NyaXB0aW9uIjogIm5ldyBkZXNjcmlwdGlvbiIsICJqb2Jfb3V0cHV0X3R5cGUiOiAidXJpX2ZvbGRlciJ9fQogICAgICAgIHJlc3Rfam9iX2RpY3QgPSBwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpCgogICAgICAgICMgYXNzZXJ0IHBpcGVsaW5lIGpvYiBsZXZlbCBtb2RlIG92ZXJ3cml0ZQogICAgICAgIGFzc2VydCByZXN0X2pvYl9kaWN0WyJwcm9wZXJ0aWVzIl1bIm91dHB1dHMiXSA9PSBleHBlY3RlZF9qb2Jfb3V0cHV0cwogICAgICAgICMgYXNzZXJ0IHBpcGVsaW5lIGNvbXBvbmVudCBsZXZlbCBtb2RlIG92ZXJ3cml0ZQogICAgICAgIGFzc2VydCBwaXBlbGluZV9qb2IuY29tcG9uZW50Ll90b19kaWN0KClbIm91dHB1dHMiXSA9PSBleHBlY3RlZF9vdXRwdXRzCgogICAgICAgIHJlc3Rfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCiAgICAgICAgcmVzdF9qb2JfZGljdCA9IHJlc3Rfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKQogICAgICAgIGFzc2VydCByZXN0X2pvYl9kaWN0WyJwcm9wZXJ0aWVzIl1bIm91dHB1dHMiXVsib3V0cHV0MSJdWyJkZXNjcmlwdGlvbiJdID09ICJuZXcgZGVzY3JpcHRpb24iCgogICAgICAgIGNvbXBvbmVudCA9IGNsaWVudC5jb21wb25lbnRzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmVfam9iLmNvbXBvbmVudCwgX2lzX2Fub255bW91cz1UcnVlKQogICAgICAgIGFzc2VydCBjb21wb25lbnQuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpWyJwcm9wZXJ0aWVzIl1bImNvbXBvbmVudF9zcGVjIl1bIm91dHB1dHMiXSA9PSBleHBlY3RlZF9vdXRwdXRzCgogICAgZGVmIHRlc3RfZ3JvdXBfb3V0cHV0c19tb2RlX292ZXJ3cml0ZShzZWxmLCBjbGllbnQpOgogICAgICAgICMgdGVzdCBncm91cCBvdXRwdXRzIG1vZGUgb3ZlcndyaXRlCiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X3lhbWwgPSAiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiCiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9aGVsbG9fd29ybGRfY29tcG9uZW50X3lhbWwpCgogICAgICAgIEBncm91cAogICAgICAgIGNsYXNzIE91dHB1dHM6CiAgICAgICAgICAgIG91dHB1dDE6IE91dHB1dCh0eXBlPSJ1cmlfZm9sZGVyIiwgbW9kZT0idXBsb2FkIikKCiAgICAgICAgQGRzbC5waXBlbGluZShkZWZhdWx0X2NvbXB1dGVfdGFyZ2V0PSJjcHUtY2x1c3RlciIpCiAgICAgICAgZGVmIG15X3BpcGVsaW5lKCkgLT4gT3V0cHV0czoKICAgICAgICAgICAgbm9kZTEgPSBoZWxsb193b3JsZF9jb21wb25lbnRfZnVuYyhjb21wb25lbnRfaW5fbnVtYmVyPTEsIGNvbXBvbmVudF9pbl9wYXRoPWpvYl9pbnB1dCkKICAgICAgICAgICAgcmV0dXJuIE91dHB1dHMoCiAgICAgICAgICAgICAgICBvdXRwdXQxPW5vZGUxLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLAogICAgICAgICAgICApCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IG15X3BpcGVsaW5lKCkKICAgICAgICAjIG92ZXJ3cml0ZSBncm91cCBvdXRwdXRzIG1vZGUgd2lsbCBhcHBlYXIgaW4gcGlwZWxpbmUgam9iJmNvbXBvbmVudCBsZXZlbAogICAgICAgIGV4cGVjdGVkX2pvYl9vdXRwdXRzID0geyJvdXRwdXQxIjogeyJtb2RlIjogIlVwbG9hZCIsICJqb2Jfb3V0cHV0X3R5cGUiOiAidXJpX2ZvbGRlciJ9fQogICAgICAgIGV4cGVjdGVkX291dHB1dHMgPSB7Im91dHB1dDEiOiB7Im1vZGUiOiAidXBsb2FkIiwgInR5cGUiOiAidXJpX2ZvbGRlciJ9fQogICAgICAgIHJlc3Rfam9iX2RpY3QgPSBwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpCiAgICAgICAgIyBhc3NlcnQgcGlwZWxpbmUgam9iIGxldmVsIG1vZGUgb3ZlcndyaXRlCiAgICAgICAgYXNzZXJ0IHJlc3Rfam9iX2RpY3RbInByb3BlcnRpZXMiXVsib3V0cHV0cyJdID09IGV4cGVjdGVkX2pvYl9vdXRwdXRzCiAgICAgICAgIyBhc3NlcnQgcGlwZWxpbmUgY29tcG9uZW50IGxldmVsIG1vZGUgb3ZlcndyaXRlCiAgICAgICAgYXNzZXJ0IHBpcGVsaW5lX2pvYi5jb21wb25lbnQuX3RvX2RpY3QoKVsib3V0cHV0cyJdID09IGV4cGVjdGVkX291dHB1dHMKCiAgICAgICAgcmVzdF9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZV9qb2IsIGNsaWVudCkKICAgICAgICByZXN0X2pvYl9kaWN0ID0gcmVzdF9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpCiAgICAgICAgYXNzZXJ0IHJlc3Rfam9iX2RpY3RbInByb3BlcnRpZXMiXVsib3V0cHV0cyJdID09IGV4cGVjdGVkX2pvYl9vdXRwdXRzCgogICAgICAgIGNvbXBvbmVudCA9IGNsaWVudC5jb21wb25lbnRzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmVfam9iLmNvbXBvbmVudCwgX2lzX2Fub255bW91cz1UcnVlKQogICAgICAgICMgcGlwZWxpbmUgY29tcG9uZW50IG91dHB1dCBtb2RlIGlzIHVuZGVmaW5lZCBiZWhhdmlvciBzbyB3ZSBza2lwIGFzc2VydCBpdAogICAgICAgICMgYXNzZXJ0IGNvbXBvbmVudC5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KClbInByb3BlcnRpZXMiXVsiY29tcG9uZW50X3NwZWMiXVsib3V0cHV0cyJdID09IGV4cGVjdGVkX291dHB1dHMKCiAgICBkZWYgdGVzdF9sb2NhbF9kYXRhX2FzX25vZGVfaW5wdXQoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X3lhbWwgPSAiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiCiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9aGVsbG9fd29ybGRfY29tcG9uZW50X3lhbWwpCiAgICAgICAgbG9jYWxfZGF0YV9pbnB1dCA9IElucHV0KHR5cGU9InVyaV9mb2xkZXIiLCBwYXRoPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9kYXRhIikKCiAgICAgICAgQGRzbC5waXBlbGluZQogICAgICAgIGRlZiBteV9waXBlbGluZSgpOgogICAgICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfZnVuYyhjb21wb25lbnRfaW5fbnVtYmVyPTEsIGNvbXBvbmVudF9pbl9wYXRoPWxvY2FsX2RhdGFfaW5wdXQpCgogICAgICAgIHBpcGVsaW5lX2pvYjogUGlwZWxpbmVKb2IgPSBteV9waXBlbGluZSgpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZV9qb2IsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZGlzYWJsZV9tb2NrX2NvZGVfaGFzaAogICAgZGVmIHRlc3RfcmVnaXN0ZXJfb3V0cHV0X3NkayhzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBmcm9tIGF6dXJlLmFpLm1sLnN3ZWVwIGltcG9ydCAoCiAgICAgICAgICAgIEJhbmRpdFBvbGljeSwKICAgICAgICAgICAgQ2hvaWNlLAogICAgICAgICAgICBMb2dOb3JtYWwsCiAgICAgICAgICAgIExvZ1VuaWZvcm0sCiAgICAgICAgICAgIE5vcm1hbCwKICAgICAgICAgICAgUUxvZ05vcm1hbCwKICAgICAgICAgICAgUUxvZ1VuaWZvcm0sCiAgICAgICAgICAgIFFOb3JtYWwsCiAgICAgICAgICAgIFFVbmlmb3JtLAogICAgICAgICAgICBSYW5kaW50LAogICAgICAgICAgICBVbmlmb3JtLAogICAgICAgICkKCiAgICAgICAgY29tcG9uZW50ID0gbG9hZF9jb21wb25lbnQoc291cmNlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50LnltbCIpCiAgICAgICAgY29tcG9uZW50X2lucHV0ID0gSW5wdXQodHlwZT0idXJpX2ZpbGUiLCBwYXRoPSJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIpCiAgICAgICAgc3BhcmtfY29tcG9uZW50ID0gbG9hZF9jb21wb25lbnQoc291cmNlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9zcGFya19jb21wb25lbnQvY29tcG9uZW50LnltbCIpCiAgICAgICAgcGFyYWxsZWxfY29tcG9uZW50ID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgIHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9wYXJhbGxlbF9jb21wb25lbnRfd2l0aF9maWxlX2lucHV0LnltbCIKICAgICAgICApCiAgICAgICAgc3dlZXBfY29tcG9uZW50ID0gbG9hZF9jb21wb25lbnQoc291cmNlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50X2Zvcl9zd2VlcC55bWwiKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKCkKICAgICAgICBkZWYgcmVnaXN0ZXJfbm9kZV9vdXRwdXQoKToKICAgICAgICAgICAgbm9kZSA9IGNvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5wdXQpCiAgICAgICAgICAgIG5vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgubmFtZSA9ICJhX291dHB1dCIKICAgICAgICAgICAgbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aC52ZXJzaW9uID0gIjEiCgogICAgICAgICAgICBzcGFya19ub2RlID0gc3BhcmtfY29tcG9uZW50KGZpbGVfaW5wdXQ9Y29tcG9uZW50X2lucHV0KQogICAgICAgICAgICBzcGFya19ub2RlLmNvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCiAgICAgICAgICAgIHNwYXJrX25vZGUub3V0cHV0cy5vdXRwdXQubmFtZSA9ICJzcGFya19vdXRwdXQiCiAgICAgICAgICAgIHNwYXJrX25vZGUub3V0cHV0cy5vdXRwdXQudmVyc2lvbiA9ICIxIgoKICAgICAgICAgICAgcGFyYWxsZWxfbm9kZSA9IHBhcmFsbGVsX2NvbXBvbmVudCgKICAgICAgICAgICAgICAgIGpvYl9kYXRhX3BhdGg9SW5wdXQodHlwZT0ibWx0YWJsZSIsIHBhdGg9Imh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IikKICAgICAgICAgICAgKQogICAgICAgICAgICBwYXJhbGxlbF9ub2RlLm91dHB1dHMuam9iX291dHB1dF9wYXRoLm5hbWUgPSAicGFyYWxsZWxfb3V0cHV0IgogICAgICAgICAgICBwYXJhbGxlbF9ub2RlLm91dHB1dHMuam9iX291dHB1dF9wYXRoLnZlcnNpb24gPSAiMTIzX3BhcmFsbGVsIgoKICAgICAgICAgICAgY21kX25vZGUxID0gc3dlZXBfY29tcG9uZW50KAogICAgICAgICAgICAgICAgYmF0Y2hfc2l6ZT1DaG9pY2UoWzI1LCAzNV0pLAogICAgICAgICAgICAgICAgZmlyc3RfbGF5ZXJfbmV1cm9ucz1SYW5kaW50KHVwcGVyPTUwKSwKICAgICAgICAgICAgICAgIHNlY29uZF9sYXllcl9uZXVyb25zPVFVbmlmb3JtKG1pbl92YWx1ZT0xMCwgbWF4X3ZhbHVlPTUwLCBxPTUpLAogICAgICAgICAgICAgICAgdGhpcmRfbGF5ZXJfbmV1cm9ucz1RTG9nTm9ybWFsKG11PTUsIHNpZ21hPTEsIHE9NSksCiAgICAgICAgICAgICAgICBlcG9jaHM9UUxvZ1VuaWZvcm0obWluX3ZhbHVlPTEsIG1heF92YWx1ZT01LCBxPTUpLAogICAgICAgICAgICAgICAgbW9tZW50dW09UU5vcm1hbChtdT0xMCwgc2lnbWE9NSwgcT0yKSwKICAgICAgICAgICAgICAgIHdlaWdodF9kZWNheT1Mb2dOb3JtYWwobXU9MCwgc2lnbWE9MSksCiAgICAgICAgICAgICAgICBsZWFybmluZ19yYXRlPUxvZ1VuaWZvcm0obWluX3ZhbHVlPS02LCBtYXhfdmFsdWU9LTEpLAogICAgICAgICAgICAgICAgZjE9Tm9ybWFsKG11PTAsIHNpZ21hPTEpLAogICAgICAgICAgICAgICAgZjI9VW5pZm9ybShtaW5fdmFsdWU9MTAsIG1heF92YWx1ZT0yMCksCiAgICAgICAgICAgICAgICBkYXRhX2ZvbGRlcj1JbnB1dCgKICAgICAgICAgICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgICAgICAgICBwYXRoPSJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby8iLAogICAgICAgICAgICAgICAgICAgIG1vZGU9SW5wdXRPdXRwdXRNb2Rlcy5ST19NT1VOVCwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICkKICAgICAgICAgICAgc3dlZXBfbm9kZSA9IGNtZF9ub2RlMS5zd2VlcCgKICAgICAgICAgICAgICAgIHByaW1hcnlfbWV0cmljPSJ2YWxpZGF0aW9uX2FjYyIsCiAgICAgICAgICAgICAgICBnb2FsPSJtYXhpbWl6ZSIsCiAgICAgICAgICAgICAgICBzYW1wbGluZ19hbGdvcml0aG09InJhbmRvbSIsCiAgICAgICAgICAgICkKICAgICAgICAgICAgc3dlZXBfbm9kZS5jb21wdXRlID0gImNwdS1jbHVzdGVyIgogICAgICAgICAgICBzd2VlcF9ub2RlLnNldF9saW1pdHMobWF4X3RvdGFsX3RyaWFscz0yLCBtYXhfY29uY3VycmVudF90cmlhbHM9MywgdGltZW91dD02MDApCiAgICAgICAgICAgIHN3ZWVwX25vZGUuZWFybHlfdGVybWluYXRpb24gPSBCYW5kaXRQb2xpY3koZXZhbHVhdGlvbl9pbnRlcnZhbD0yLCBzbGFja19mYWN0b3I9MC4xLCBkZWxheV9ldmFsdWF0aW9uPTEpCiAgICAgICAgICAgIHN3ZWVwX25vZGUub3V0cHV0cy50cmFpbmVkX21vZGVsX2Rpci5uYW1lID0gInN3ZWVwX291dHB1dCIKICAgICAgICAgICAgc3dlZXBfbm9kZS5vdXRwdXRzLnRyYWluZWRfbW9kZWxfZGlyLnZlcnNpb24gPSAic3dlZXBfMiIKCiAgICAgICAgcGlwZWxpbmUgPSByZWdpc3Rlcl9ub2RlX291dHB1dCgpCiAgICAgICAgcGlwZWxpbmUuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImF6dXJlbWw6Y3B1LWNsdXN0ZXIiCiAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKICAgICAgICBvdXRwdXQgPSBwaXBlbGluZV9qb2Iuam9ic1sibm9kZSJdLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoCiAgICAgICAgYXNzZXJ0IG91dHB1dC5uYW1lID09ICJhX291dHB1dCIKICAgICAgICBhc3NlcnQgb3V0cHV0LnZlcnNpb24gPT0gIjEiCiAgICAgICAgb3V0cHV0ID0gcGlwZWxpbmVfam9iLmpvYnNbInNwYXJrX25vZGUiXS5vdXRwdXRzLm91dHB1dAogICAgICAgIGFzc2VydCBvdXRwdXQubmFtZSA9PSAic3Bhcmtfb3V0cHV0IgogICAgICAgIGFzc2VydCBvdXRwdXQudmVyc2lvbiA9PSAiMSIKICAgICAgICBvdXRwdXQgPSBwaXBlbGluZV9qb2Iuam9ic1sicGFyYWxsZWxfbm9kZSJdLm91dHB1dHMuam9iX291dHB1dF9wYXRoCiAgICAgICAgYXNzZXJ0IG91dHB1dC5uYW1lID09ICJwYXJhbGxlbF9vdXRwdXQiCiAgICAgICAgYXNzZXJ0IG91dHB1dC52ZXJzaW9uID09ICIxMjNfcGFyYWxsZWwiCiAgICAgICAgb3V0cHV0ID0gcGlwZWxpbmVfam9iLmpvYnNbInN3ZWVwX25vZGUiXS5vdXRwdXRzLnRyYWluZWRfbW9kZWxfZGlyCiAgICAgICAgYXNzZXJ0IG91dHB1dC5uYW1lID09ICJzd2VlcF9vdXRwdXQiCiAgICAgICAgYXNzZXJ0IG91dHB1dC52ZXJzaW9uID09ICJzd2VlcF8yIgoKICAgICAgICBAZHNsLnBpcGVsaW5lKCkKICAgICAgICBkZWYgcmVnaXN0ZXJfcGlwZWxpbmVfb3V0cHV0KCk6CiAgICAgICAgICAgIG5vZGUgPSBjb21wb25lbnQoY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2lucHV0KQogICAgICAgICAgICByZXR1cm4geyJwaXBlaW5lX2Ffb3V0cHV0Ijogbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH0KCiAgICAgICAgcGlwZWxpbmUgPSByZWdpc3Rlcl9waXBlbGluZV9vdXRwdXQoKQogICAgICAgIHBpcGVsaW5lLm91dHB1dHMucGlwZWluZV9hX291dHB1dC5uYW1lID0gImFfb3V0cHV0IgogICAgICAgIHBpcGVsaW5lLm91dHB1dHMucGlwZWluZV9hX291dHB1dC52ZXJzaW9uID0gIjEiCiAgICAgICAgcGlwZWxpbmUuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImF6dXJlbWw6Y3B1LWNsdXN0ZXIiCiAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKICAgICAgICBvdXRwdXQgPSBwaXBlbGluZV9qb2Iub3V0cHV0cy5waXBlaW5lX2Ffb3V0cHV0CiAgICAgICAgYXNzZXJ0IG91dHB1dC5uYW1lID09ICJhX291dHB1dCIKICAgICAgICBhc3NlcnQgb3V0cHV0LnZlcnNpb24gPT0gIjEiCgogICAgICAgIEBkc2wucGlwZWxpbmUoKQogICAgICAgIGRlZiByZWdpc3Rlcl9ib3RoX291dHB1dCgpOgogICAgICAgICAgICBub2RlID0gY29tcG9uZW50KGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbnB1dCkKICAgICAgICAgICAgbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aC5uYW1lID0gImFfb3V0cHV0IgogICAgICAgICAgICBub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLnZlcnNpb24gPSAiMSIKICAgICAgICAgICAgcmV0dXJuIHsicGlwZWluZV9hX291dHB1dCI6IG5vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9CgogICAgICAgIHBpcGVsaW5lID0gcmVnaXN0ZXJfYm90aF9vdXRwdXQoKQogICAgICAgIHBpcGVsaW5lLm91dHB1dHMucGlwZWluZV9hX291dHB1dC5uYW1lID0gImJfb3V0cHV0IgogICAgICAgIHBpcGVsaW5lLm91dHB1dHMucGlwZWluZV9hX291dHB1dC52ZXJzaW9uID0gIjIiCiAgICAgICAgcGlwZWxpbmUuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImF6dXJlbWw6Y3B1LWNsdXN0ZXIiCiAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICAgICAgcGlwZWxpbmVfb3V0cHV0ID0gcGlwZWxpbmVfam9iLm91dHB1dHMucGlwZWluZV9hX291dHB1dAogICAgICAgIGFzc2VydCBwaXBlbGluZV9vdXRwdXQubmFtZSA9PSAiYl9vdXRwdXQiCiAgICAgICAgYXNzZXJ0IHBpcGVsaW5lX291dHB1dC52ZXJzaW9uID09ICIyIgogICAgICAgIG5vZGVfb3V0cHV0ID0gcGlwZWxpbmVfam9iLmpvYnNbIm5vZGUiXS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aAogICAgICAgIGFzc2VydCBub2RlX291dHB1dC5uYW1lID09IE5vbmUKICAgICAgICBhc3NlcnQgbm9kZV9vdXRwdXQudmVyc2lvbiA9PSBOb25lCgogICAgZGVmIHRlc3RfZHNsX3BpcGVsaW5lX3dpdGhfZGF0YV90cmFuc2Zlcl9jb3B5XzJ1cmlmb2xkZXIoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUuY29weV9kYXRhLnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIGdlbmVyYXRlX2RzbF9waXBlbGluZV9mcm9tX3lhbWwgYXMgZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IGRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lKCkKCiAgICAgICAgcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSkKCiAgICAgICAgYWN0dWFsX2pvYiA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkucHJvcGVydGllcy5hc19kaWN0KCksICpjb21tb25fb21pdF9maWVsZHMpCgogICAgICAgIGV4cGVjdGVkX2pvYiA9IHsKICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogInN1Ym1pdCBhIHBpcGVsaW5lIHdpdGggZGF0YSB0cmFuc2ZlciBjb3B5IGpvYiIsCiAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAiY29zbW9zX2ZvbGRlciI6IHsiam9iX2lucHV0X3R5cGUiOiAidXJpX2ZvbGRlciIsICJtb2RlIjogIlJlYWRPbmx5TW91bnQifSwKICAgICAgICAgICAgICAgICJjb3Ntb3NfZm9sZGVyX2R1cCI6IHsiam9iX2lucHV0X3R5cGUiOiAidXJpX2ZvbGRlciIsICJtb2RlIjogIlJlYWRPbmx5TW91bnQifSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImlzX2FyY2hpdmVkIjogRmFsc2UsCiAgICAgICAgICAgICJqb2JfdHlwZSI6ICJQaXBlbGluZSIsCiAgICAgICAgICAgICJqb2JzIjogewogICAgICAgICAgICAgICAgIm1lcmdlX2ZpbGVzIjogewogICAgICAgICAgICAgICAgICAgICJkYXRhX2NvcHlfbW9kZSI6ICJtZXJnZV93aXRoX292ZXJ3cml0ZSIsCiAgICAgICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImZvbGRlcjEiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5jb3Ntb3NfZm9sZGVyfX0ifSwKICAgICAgICAgICAgICAgICAgICAgICAgImZvbGRlcjIiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5jb3Ntb3NfZm9sZGVyX2R1cH19In0sCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJtZXJnZV9maWxlcyIsCiAgICAgICAgICAgICAgICAgICAgIm91dHB1dHMiOiB7Im91dHB1dF9mb2xkZXIiOiB7InR5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy5tZXJnZWRfYmxvYn19In19LAogICAgICAgICAgICAgICAgICAgICJ0YXNrIjogImNvcHlfZGF0YSIsCiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiZGF0YV90cmFuc2ZlciIsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJvdXRwdXRzIjogeyJtZXJnZWRfYmxvYiI6IHsiam9iX291dHB1dF90eXBlIjogInVyaV9mb2xkZXIiLCAibW9kZSI6ICJSZWFkV3JpdGVNb3VudCJ9fSwKICAgICAgICAgICAgInNldHRpbmdzIjogeyJkZWZhdWx0X2NvbXB1dGUiOiAic2VydmVybGVzcyJ9LAogICAgICAgICAgICAidGFncyI6IHt9LAogICAgICAgIH0KICAgICAgICBhc3NlcnQgZXhwZWN0ZWRfam9iID09IGFjdHVhbF9qb2IKCiAgICBkZWYgdGVzdF9vdXRwdXRfc2V0dGluZ19wYXRoKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgY29tcG9uZW50X3lhbWwgPSBjb21wb25lbnRzX2RpciAvICJoZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiCiAgICAgICAgY29tcG9uZW50X2Z1bmMxID0gbG9hZF9jb21wb25lbnQoc291cmNlPWNvbXBvbmVudF95YW1sKQoKICAgICAgICAjIGNhc2UgMTogb25seSBub2RlIGxldmVsIGhhcyBzZXR0aW5nCiAgICAgICAgQGRzbC5waXBlbGluZSgpCiAgICAgICAgZGVmIHBpcGVsaW5lKCk6CiAgICAgICAgICAgIG5vZGUxID0gY29tcG9uZW50X2Z1bmMxKGNvbXBvbmVudF9pbl9udW1iZXI9MSwgY29tcG9uZW50X2luX3BhdGg9am9iX2lucHV0KQogICAgICAgICAgICBub2RlMS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aC5wYXRoID0gImF6dXJlbWw6Ly9kYXRhc3RvcmVzL3dvcmtzcGFjZWJsb2JzdG9yZS9wYXRocy9vdXRwdXRzLzEiCiAgICAgICAgICAgIHJldHVybiBub2RlMS5vdXRwdXRzCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBpcGVsaW5lKCkKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImNwdS1jbHVzdGVyIgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQogICAgICAgIGpvYl9kaWN0ID0gcGlwZWxpbmVfam9iLl90b19kaWN0KCkKICAgICAgICBleHBlY3RlZF9ub2RlX291dHB1dF9kaWN0ID0gewogICAgICAgICAgICAiY29tcG9uZW50X291dF9wYXRoIjogIiR7e3BhcmVudC5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH19IiwKICAgICAgICB9CiAgICAgICAgZXhwZWN0ZWRfcGlwZWxpbmVfb3V0cHV0X2RpY3QgPSB7CiAgICAgICAgICAgICJjb21wb25lbnRfb3V0X3BhdGgiOiB7CiAgICAgICAgICAgICAgICAjIGRlZmF1bHQgbW9kZSBhZGRlZCBieSBtdCwgZGVmYXVsdCB0eXBlIGFkZGVkIGJ5IFNESwogICAgICAgICAgICAgICAgIm1vZGUiOiAicndfbW91bnQiLAogICAgICAgICAgICAgICAgInR5cGUiOiAidXJpX2ZvbGRlciIsCiAgICAgICAgICAgICAgICAjIG5vZGUgbGV2ZWwgY29uZmlnIHdpbGwgYmUgY29waWVkIHRvIHBpcGVsaW5lIGxldmVsCiAgICAgICAgICAgICAgICAicGF0aCI6ICJhenVyZW1sOi8vZGF0YXN0b3Jlcy93b3Jrc3BhY2VibG9ic3RvcmUvcGF0aHMvb3V0cHV0cy8xIiwKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBhc3NlcnQgam9iX2RpY3RbImpvYnMiXVsibm9kZTEiXVsib3V0cHV0cyJdID09IGV4cGVjdGVkX25vZGVfb3V0cHV0X2RpY3QKICAgICAgICBhc3NlcnQgam9iX2RpY3RbIm91dHB1dHMiXSA9PSBleHBlY3RlZF9waXBlbGluZV9vdXRwdXRfZGljdAoKICAgIGRlZiB0ZXN0X3BpcGVsaW5lX2NvbXBvbmVudF9vdXRwdXRfc2V0dGluZyhzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGNvbXBvbmVudF95YW1sID0gY29tcG9uZW50c19kaXIgLyAiaGVsbG93b3JsZF9jb21wb25lbnQueW1sIgogICAgICAgIGNvbXBvbmVudF9mdW5jMSA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1jb21wb25lbnRfeWFtbCkKCiAgICAgICAgQGRzbC5waXBlbGluZSgpCiAgICAgICAgZGVmIGlubmVyX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIG5vZGUxID0gY29tcG9uZW50X2Z1bmMxKGNvbXBvbmVudF9pbl9udW1iZXI9MSwgY29tcG9uZW50X2luX3BhdGg9am9iX2lucHV0KQogICAgICAgICAgICBub2RlMS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aC5wYXRoID0gImF6dXJlbWw6Ly9kYXRhc3RvcmVzL3dvcmtzcGFjZWJsb2JzdG9yZS9wYXRocy9vdXRwdXRzLzEiCiAgICAgICAgICAgICMgbm9kZTEncyBvdXRwdXQgc2V0dGluZyB3aWxsIGJlIGNvcGllZCB0byBwaXBlbGluZSdzIHNldHRpbmcKICAgICAgICAgICAgcmV0dXJuIG5vZGUxLm91dHB1dHMKCiAgICAgICAgQGRzbC5waXBlbGluZSgpCiAgICAgICAgZGVmIG91dGVyX3BpcGVsaW5lKCk6CiAgICAgICAgICAgICMgaW5uZXJfcGlwZWxpbmUncyBvdXRwdXQgc2V0dGluZyB3aWxsIGJlIGNvcGllZCB0byBub2RlMSdzIHNldHRpbmcKICAgICAgICAgICAgbm9kZTEgPSBpbm5lcl9waXBlbGluZSgpCiAgICAgICAgICAgICMgbm9kZTEncyBvdXRwdXQgc2V0dGluZyB3aWxsIGJlIGNvcGllZCB0byBwaXBlbGluZSdzIHNldHRpbmcKICAgICAgICAgICAgcmV0dXJuIG5vZGUxLm91dHB1dHMKCiAgICAgICAgcGlwZWxpbmVfam9iID0gb3V0ZXJfcGlwZWxpbmUoKQogICAgICAgIHBpcGVsaW5lX2pvYl9kaWN0ID0gcGlwZWxpbmVfam9iLl90b19kaWN0KCkKICAgICAgICBhc3NlcnQgcGlwZWxpbmVfam9iX2RpY3RbIm91dHB1dHMiXSA9PSB7CiAgICAgICAgICAgICJjb21wb25lbnRfb3V0X3BhdGgiOiB7CiAgICAgICAgICAgICAgICAicGF0aCI6ICJhenVyZW1sOi8vZGF0YXN0b3Jlcy93b3Jrc3BhY2VibG9ic3RvcmUvcGF0aHMvb3V0cHV0cy8xIiwKICAgICAgICAgICAgICAgICJ0eXBlIjogInVyaV9mb2xkZXIiLAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHBpcGVsaW5lX2NvbXBvbmVudCA9IHBpcGVsaW5lX2pvYi5qb2JzWyJub2RlMSJdLmNvbXBvbmVudAogICAgICAgIHBpcGVsaW5lX2NvbXBvbmVudF9kaWN0ID0gcGlwZWxpbmVfY29tcG9uZW50Ll90b19kaWN0KCkKICAgICAgICBhc3NlcnQgcGlwZWxpbmVfY29tcG9uZW50X2RpY3RbIm91dHB1dHMiXSA9PSB7ImNvbXBvbmVudF9vdXRfcGF0aCI6IHsidHlwZSI6ICJ1cmlfZm9sZGVyIn19CiAgICAgICAgYXNzZXJ0IHBpcGVsaW5lX2NvbXBvbmVudF9kaWN0WyJqb2JzIl1bIm5vZGUxIl1bIm91dHB1dHMiXSA9PSB7CiAgICAgICAgICAgICJjb21wb25lbnRfb3V0X3BhdGgiOiAiJHt7cGFyZW50Lm91dHB1dHMuY29tcG9uZW50X291dF9wYXRofX0iCiAgICAgICAgfQoKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImNwdS1jbHVzdGVyIgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmVfam9iKQogICAgICAgIGNsaWVudC5qb2JzLmJlZ2luX2NhbmNlbChwaXBlbGluZV9qb2IubmFtZSkKICAgICAgICBqb2JfZGljdCA9IHBpcGVsaW5lX2pvYi5fdG9fZGljdCgpCiAgICAgICAgIyBvdXRlciBwaXBlbGluZSdzIG5vZGUxIHNob3VsZCBoYXZlIHRoZSBvdXRwdXQgc2V0dGluZwogICAgICAgIGFzc2VydCBqb2JfZGljdFsiam9icyJdWyJub2RlMSJdWyJvdXRwdXRzIl0gPT0geyJjb21wb25lbnRfb3V0X3BhdGgiOiAiJHt7cGFyZW50Lm91dHB1dHMuY29tcG9uZW50X291dF9wYXRofX0ifQogICAgICAgIGFzc2VydCBqb2JfZGljdFsib3V0cHV0cyJdID09IHsKICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHsKICAgICAgICAgICAgICAgICJtb2RlIjogInJ3X21vdW50IiwKICAgICAgICAgICAgICAgICJ0eXBlIjogInVyaV9mb2xkZXIiLAogICAgICAgICAgICAgICAgIyBub2RlIGxldmVsIGNvbmZpZyB3aWxsIGJlIGNvcGllZCB0byBwaXBlbGluZSBsZXZlbAogICAgICAgICAgICAgICAgInBhdGgiOiAiYXp1cmVtbDovL2RhdGFzdG9yZXMvd29ya3NwYWNlYmxvYnN0b3JlL3BhdGhzL291dHB1dHMvMSIsCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgQHB5dGVzdC5tYXJrLmRpc2FibGVfbW9ja19jb2RlX2hhc2gKICAgIGRlZiB0ZXN0X3JlZ2lzdGVyX291dHB1dF9zZGtfc3VjY2VlZChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBjb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnQueW1sIikKICAgICAgICBjb21wb25lbnRfaW5wdXQgPSBJbnB1dCh0eXBlPSJ1cmlfZmlsZSIsIHBhdGg9Imh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IikKCiAgICAgICAgQGRzbC5waXBlbGluZSgpCiAgICAgICAgZGVmIHN1Yl9waXBlbGluZSgpOgogICAgICAgICAgICBub2RlID0gY29tcG9uZW50KGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbnB1dCkKICAgICAgICAgICAgbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aC5uYW1lID0gInN1Yl9waXBlbGluZV9vdXRwdXQiCiAgICAgICAgICAgIG5vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgudmVyc2lvbiA9ICJ2MSIKICAgICAgICAgICAgcmV0dXJuIHsic3ViX3BpcGVpbmVfYV9vdXRwdXQiOiBub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRofQoKICAgICAgICBAZHNsLnBpcGVsaW5lKCkKICAgICAgICBkZWYgcmVnaXN0ZXJfYm90aF9vdXRwdXQoKToKICAgICAgICAgICAgIyByZWdpc3RlciBOb2RlT3V0cHV0IHdoaWNoIGlzIGJpbmRpbmcgdG8gUGlwZWxpbmVPdXRwdXQKICAgICAgICAgICAgbm9kZSA9IGNvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5wdXQpCiAgICAgICAgICAgIG5vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgubmFtZSA9ICJuMV9vdXRwdXQiCiAgICAgICAgICAgIG5vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgudmVyc2lvbiA9ICJ2MSIKCiAgICAgICAgICAgICMgcmVnaXN0ZXIgTm9kZU91dHB1dCB3aGljaCBpc24ndCBiaW5kaW5nIHRvIFBpcGVsaW5lT3V0cHV0CiAgICAgICAgICAgIG5vZGVfMiA9IGNvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5wdXQpCiAgICAgICAgICAgIG5vZGVfMi5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aC5uYW1lID0gIm4yX291dHB1dCIKICAgICAgICAgICAgbm9kZV8yLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLnZlcnNpb24gPSAidjEiCgogICAgICAgICAgICAjIHJlZ2lzdGVyIE5vZGVPdXRwdXQgd2l0aG91dCB2ZXJzaW9uLCBpbiB0aGlzIGNhc2UgdGhlIHJ1biByZXN1bHQgY2FuIGJlIHJldXNlZAogICAgICAgICAgICBub2RlXzMgPSBjb21wb25lbnQoY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2lucHV0KQogICAgICAgICAgICBub2RlXzMub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgubmFtZSA9ICJuM19vdXRwdXQiCgogICAgICAgICAgICAjIHJlZ2lzdGVyIE5vZGVPdXRwdXQgb2Ygc3ViZ3JhcGgKICAgICAgICAgICAgc3ViX25vZGUgPSBzdWJfcGlwZWxpbmUoKQogICAgICAgICAgICBzdWJfbm9kZS5vdXRwdXRzLnN1Yl9waXBlaW5lX2Ffb3V0cHV0Lm5hbWUgPSAic3ViX3BpcGVsaW5lIgogICAgICAgICAgICBzdWJfbm9kZS5vdXRwdXRzLnN1Yl9waXBlaW5lX2Ffb3V0cHV0LnZlcnNpb24gPSAidjEiCgogICAgICAgICAgICByZXR1cm4geyJwaXBlaW5lX2Ffb3V0cHV0Ijogbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH0KCiAgICAgICAgcGlwZWxpbmUgPSByZWdpc3Rlcl9ib3RoX291dHB1dCgpCiAgICAgICAgcGlwZWxpbmUub3V0cHV0cy5waXBlaW5lX2Ffb3V0cHV0Lm5hbWUgPSAicDFfb3V0cHV0IgogICAgICAgIHBpcGVsaW5lLm91dHB1dHMucGlwZWluZV9hX291dHB1dC52ZXJzaW9uID0gInYxIgogICAgICAgIHBpcGVsaW5lLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKICAgICAgICBwaXBlbGluZV9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgICAgICBjaGVja19uYW1lX2FuZF92ZXJzaW9uKHBpcGVsaW5lX2pvYi5vdXRwdXRzLnBpcGVpbmVfYV9vdXRwdXQsICJwMV9vdXRwdXQiLCAidjEiKQogICAgICAgIGNoZWNrX25hbWVfYW5kX3ZlcnNpb24ocGlwZWxpbmVfam9iLmpvYnNbIm5vZGVfMiJdLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLCAibjJfb3V0cHV0IiwgInYxIikKICAgICAgICBhc3NlcnQgcGlwZWxpbmVfam9iLmpvYnNbIm5vZGVfMyJdLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLm5hbWUgPT0gIm4zX291dHB1dCIKICAgICAgICBjaGVja19uYW1lX2FuZF92ZXJzaW9uKHBpcGVsaW5lX2pvYi5qb2JzWyJzdWJfbm9kZSJdLm91dHB1dHMuc3ViX3BpcGVpbmVfYV9vdXRwdXQsICJzdWJfcGlwZWxpbmUiLCAidjEiKQoKICAgIEBweXRlc3QubWFyay5za2lwKHJlYXNvbj0iS2V5RXJyb3I6ICdub2RlXzInIikKICAgIEBweXRlc3QubWFyay5kaXNhYmxlX21vY2tfY29kZV9oYXNoCiAgICBkZWYgdGVzdF9yZWdpc3Rlcl9vdXRwdXRfZm9yX3BpcGVsaW5lX2NvbXBvbmVudChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBjb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnQueW1sIikKICAgICAgICBjb21wb25lbnRfaW5wdXQgPSBJbnB1dCh0eXBlPSJ1cmlfZmlsZSIsIHBhdGg9Imh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IikKCiAgICAgICAgQGRzbC5waXBlbGluZSgpCiAgICAgICAgZGVmIHN1Yl9waXBlbGluZSgpOgogICAgICAgICAgICBub2RlXzEgPSBjb21wb25lbnQoY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2lucHV0KSAgIyB0ZXN0IHVzZSBPdXRwdXQgdG8gaW5pdGlhbGl6ZSBzdWJncmFwaC5qb2JzLm91dHB1dAogICAgICAgICAgICBub2RlXzEub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGggPSBPdXRwdXQobmFtZT0ic3ViX3BpcGVsaW5lXzFfb3V0cHV0IiwgdmVyc2lvbj0idjEiKQoKICAgICAgICAgICAgbm9kZV8yID0gY29tcG9uZW50KGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbnB1dCkgICMgdGVzdCB3ZSBjYW4gcGFzcyBOb2RlT3V0cHV0IGluIFBpcGVsaW5lQ29tcG9uZW50CiAgICAgICAgICAgIG5vZGVfMi5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aC5uYW1lID0gInN1Yl9waXBlbGluZV8yX291dHB1dCIKICAgICAgICAgICAgbm9kZV8yLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLnZlcnNpb24gPSAidjIiCgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInN1Yl9ub2RlXzEiOiBub2RlXzEub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgsCiAgICAgICAgICAgIH0KCiAgICAgICAgQGRzbC5waXBlbGluZSgpCiAgICAgICAgZGVmIHJlZ2lzdGVyX2JvdGhfb3V0cHV0KCk6CiAgICAgICAgICAgIHN1YmdyYXBoID0gc3ViX3BpcGVsaW5lKCkKCiAgICAgICAgcGlwZWxpbmUgPSByZWdpc3Rlcl9ib3RoX291dHB1dCgpCiAgICAgICAgcGlwZWxpbmUuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImNwdS1jbHVzdGVyIgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgICAgIGNoZWNrX25hbWVfYW5kX3ZlcnNpb24ocGlwZWxpbmVfam9iLmpvYnNbInN1YmdyYXBoIl0ub3V0cHV0c1sic3ViX25vZGVfMSJdLCAic3ViX3BpcGVsaW5lXzFfb3V0cHV0IiwgInYxIikKCiAgICAgICAgc3ViZ3JhcGhfaWQgPSBwaXBlbGluZV9qb2Iuam9ic1sic3ViZ3JhcGgiXS5jb21wb25lbnQKICAgICAgICBzdWJncmFwaF9pZCA9IHN1YmdyYXBoX2lkLnNwbGl0KCI6IikKICAgICAgICBzdWJncmFwaCA9IGNsaWVudC5jb21wb25lbnRzLmdldChuYW1lPXN1YmdyYXBoX2lkWzBdLCB2ZXJzaW9uPXN1YmdyYXBoX2lkWzFdKQogICAgICAgICMgVE9ETzogZW5hYmxlIHRoaXMgY2hlY2sgaW4gcGxheWJhY2sgbW9kZSBhZnRlciBwaXBlbGluZV9jb21wb25lbnQuam9icyBpcyBvcGVuZWQgaW4gYWxsIHN1YnNjcmlwdGlvbnMKICAgICAgICBpZiBpc19saXZlKCk6CiAgICAgICAgICAgIGNoZWNrX25hbWVfYW5kX3ZlcnNpb24oc3ViZ3JhcGguam9ic1sibm9kZV8yIl0ub3V0cHV0c1siY29tcG9uZW50X291dF9wYXRoIl0sICJzdWJfcGlwZWxpbmVfMl9vdXRwdXQiLCAidjIiKQoKICAgIEBweXRlc3QubWFyay5kaXNhYmxlX21vY2tfY29kZV9oYXNoCiAgICAjIHdpdGhvdXQgdGhpcyBtYXJrLCB0aGUgY29kZSB3b3VsZCBiZSBwYXNzZWQgd2l0aCBkaWZmZXJlbnQgaWQgZXZlbiB3aGVuIHdlIHVwbG9hZCB0aGUgc2FtZSBjb21wb25lbnQsCiAgICAjIGFkZCB0aGlzIG1hcmsgdG8gcmV1c2Ugbm9kZSBhbmQgZnVydGhlciByZXVzZSBwaXBlbGluZQogICAgZGVmIHRlc3RfcmVnaXN0ZXJfd2l0aF9vdXRwdXRfZm9ybWF0KHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGNvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiKQogICAgICAgIGNvbXBvbmVudF9pbnB1dCA9IElucHV0KHR5cGU9InVyaV9maWxlIiwgcGF0aD0iaHR0cHM6Ly9kcHJlcGRhdGEuYmxvYi5jb3JlLndpbmRvd3MubmV0L2RlbW8vVGl0YW5pYy5jc3YiKQoKICAgICAgICBAZHNsLnBpcGVsaW5lKCkKICAgICAgICBkZWYgc3ViX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIG5vZGUgPSBjb21wb25lbnQoY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2lucHV0KQogICAgICAgICAgICBub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoID0gT3V0cHV0KG5hbWU9InN1Yl9waXBlbGluZV9vX291dHB1dCIsIHZlcnNpb249InYxIikKICAgICAgICAgICAgcmV0dXJuIHsic3ViX3BpcGVpbmVfYV9vdXRwdXQiOiBub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRofQoKICAgICAgICBAZHNsLnBpcGVsaW5lKCkKICAgICAgICBkZWYgcmVnaXN0ZXJfYm90aF9vdXRwdXQoKToKICAgICAgICAgICAgIyByZWdpc3RlciBOb2RlT3V0cHV0IHdoaWNoIGlzIGJpbmRpbmcgdG8gUGlwZWxpbmVPdXRwdXQKICAgICAgICAgICAgbm9kZSA9IGNvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5wdXQpICAjIGJpbmRpbmcgYW5kIHJlLWRlZmluZSBuYW1lIGFuZCB2ZXJzaW9uCiAgICAgICAgICAgIG5vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGggPSBPdXRwdXQobmFtZT0ibjFfb19vdXRwdXQiLCB2ZXJzaW9uPSIxIikKCiAgICAgICAgICAgIG5vZGVfMiA9IGNvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD1jb21wb25lbnRfaW5wdXQpICAjIGJpbmRpbmcKICAgICAgICAgICAgbm9kZV8yLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoID0gT3V0cHV0KG5hbWU9Im4yX29fb3V0cHV0IiwgdmVyc2lvbj0iMiIpCgogICAgICAgICAgICBub2RlXzMgPSBjb21wb25lbnQoY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2lucHV0KSAgIyBpc24ndCBiaW5kaW5nCiAgICAgICAgICAgIG5vZGVfMy5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCA9IE91dHB1dChuYW1lPSJuM19vX291dHB1dCIsIHZlcnNpb249IjQiKQoKICAgICAgICAgICAgc3ViX25vZGUgPSBzdWJfcGlwZWxpbmUoKSAgIyB0ZXN0IHNldCBPdXRwdXQgZm9yIFBpcGVsaW5lQ29tcG9uZW50CiAgICAgICAgICAgIHN1Yl9ub2RlLm91dHB1dHMuc3ViX3BpcGVpbmVfYV9vdXRwdXQgPSBPdXRwdXQobmFtZT0ic3ViZ3JhcGhfb19vdXRwdXQiLCB2ZXJzaW9uPSIxIikKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJwaXBlaW5lX2Ffb3V0cHV0Ijogbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwKICAgICAgICAgICAgICAgICJwaXBlaW5lX2Jfb3V0cHV0Ijogbm9kZV8yLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLAogICAgICAgICAgICB9CgogICAgICAgIHBpcGVsaW5lID0gcmVnaXN0ZXJfYm90aF9vdXRwdXQoKQogICAgICAgIHBpcGVsaW5lLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKICAgICAgICBwaXBlbGluZS5vdXRwdXRzLnBpcGVpbmVfYV9vdXRwdXQubmFtZSA9ICJucF9vdXRwdXQiCiAgICAgICAgcGlwZWxpbmUub3V0cHV0cy5waXBlaW5lX2Ffb3V0cHV0LnZlcnNpb24gPSAiMSIKICAgICAgICBwaXBlbGluZV9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgICAgICBjaGVja19uYW1lX2FuZF92ZXJzaW9uKHBpcGVsaW5lX2pvYi5vdXRwdXRzLnBpcGVpbmVfYV9vdXRwdXQsICJucF9vdXRwdXQiLCAiMSIpCiAgICAgICAgY2hlY2tfbmFtZV9hbmRfdmVyc2lvbihwaXBlbGluZV9qb2Iub3V0cHV0cy5waXBlaW5lX2Jfb3V0cHV0LCAibjJfb19vdXRwdXQiLCAiMiIpCiAgICAgICAgY2hlY2tfbmFtZV9hbmRfdmVyc2lvbihwaXBlbGluZV9qb2Iuam9ic1sibm9kZV8zIl0ub3V0cHV0c1siY29tcG9uZW50X291dF9wYXRoIl0sICJuM19vX291dHB1dCIsICI0IikKICAgICAgICBjaGVja19uYW1lX2FuZF92ZXJzaW9uKHBpcGVsaW5lX2pvYi5qb2JzWyJzdWJfbm9kZSJdLm91dHB1dHNbInN1Yl9waXBlaW5lX2Ffb3V0cHV0Il0sICJzdWJncmFwaF9vX291dHB1dCIsICIxIikKCiAgICBkZWYgdGVzdF9waXBlbGluZV9pbnB1dF9iaW5kaW5nX2xpbWl0c190aW1lb3V0KHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGNvbXBvbmVudF95YW1sID0gciIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50X25vX3BhdGhzLnltbCIKICAgICAgICBjb21wb25lbnRfZnVuYyA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT1jb21wb25lbnRfeWFtbCkKCiAgICAgICAgQGRzbC5waXBlbGluZQogICAgICAgIGRlZiBteV9waXBlbGluZSh0aW1lb3V0KSAtPiBQaXBlbGluZUpvYjoKICAgICAgICAgICAgIyBjYXNlIDE6IGlmIHRpbWVvdXQgaXMgUGlwZWxpbmVJbnB1dCwgZ2V0IGJpbmRpbmcgZnJvbSByZXNwb25zZQogICAgICAgICAgICBub2RlXzAgPSBjb21wb25lbnRfZnVuYyhjb21wb25lbnRfaW5fbnVtYmVyPTEpCiAgICAgICAgICAgIG5vZGVfMC5zZXRfbGltaXRzKHRpbWVvdXQ9dGltZW91dCkKICAgICAgICAgICAgIyBjYXNlIDI6IGlmIHRpbWVvdXQgaXMgbm90IFBpcGVsaW5lSW5wdXQsIHJlc3BvbnNlIHRpbWVvdXQgd2lsbCBiZSBwYXJzZWQgdG8gaW50CiAgICAgICAgICAgIG5vZGVfMSA9IGNvbXBvbmVudF9mdW5jKGNvbXBvbmVudF9pbl9udW1iZXI9MSkKICAgICAgICAgICAgbm9kZV8xLnNldF9saW1pdHModGltZW91dD0xKQoKICAgICAgICBwaXBlbGluZSA9IG15X3BpcGVsaW5lKDIpCiAgICAgICAgcGlwZWxpbmUuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImNwdS1jbHVzdGVyIgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCiAgICAgICAgYXNzZXJ0IHBpcGVsaW5lX2pvYi5qb2JzWyJub2RlXzAiXS5saW1pdHMudGltZW91dCA9PSAiJHt7cGFyZW50LmlucHV0cy50aW1lb3V0fX0iCiAgICAgICAgYXNzZXJ0IHBpcGVsaW5lX2pvYi5qb2JzWyJub2RlXzEiXS5saW1pdHMudGltZW91dCA9PSAxCgogICAgZGVmIHRlc3RfcGlwZWxpbmVfY29tcG9uZW50X3ByaW1pdGl2ZV90eXBlX2NvbnN1bXB0aW9uKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGJhaXNjX2NvbXBvbmVudF9mdW5jID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgICIuL3Rlc3RzL3Rlc3RfY29uZmlncy9kc2xfcGlwZWxpbmUvcHJpbWl0aXZlX3R5cGVfY29tcG9uZW50cy9iYXNpY19jb21wb25lbnQueW1sIgogICAgICAgICkKICAgICAgICBib29sZWFuX2Z1bmMgPSBsb2FkX2NvbXBvbmVudCgiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvZHNsX3BpcGVsaW5lL3ByaW1pdGl2ZV90eXBlX2NvbXBvbmVudHMvYm9vbGVhbi55bWwiKQogICAgICAgIGludGVnZXJfZnVuYyA9IGxvYWRfY29tcG9uZW50KCIuL3Rlc3RzL3Rlc3RfY29uZmlncy9kc2xfcGlwZWxpbmUvcHJpbWl0aXZlX3R5cGVfY29tcG9uZW50cy9pbnRlZ2VyLnltbCIpCiAgICAgICAgbnVtYmVyX2Z1bmMgPSBsb2FkX2NvbXBvbmVudCgiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvZHNsX3BpcGVsaW5lL3ByaW1pdGl2ZV90eXBlX2NvbXBvbmVudHMvbnVtYmVyLnltbCIpCiAgICAgICAgc3RyaW5nX2Z1bmMgPSBsb2FkX2NvbXBvbmVudCgiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvZHNsX3BpcGVsaW5lL3ByaW1pdGl2ZV90eXBlX2NvbXBvbmVudHMvc3RyaW5nLnltbCIpCgogICAgICAgIEBkc2wucGlwZWxpbmUKICAgICAgICBkZWYgcGlwZWxpbmVfY29tcG9uZW50X2Z1bmMoYm9vbF9wYXJhbTogYm9vbCwgaW50X3BhcmFtOiBpbnQsIGZsb2F0X3BhcmFtOiBmbG9hdCwgc3RyX3BhcmFtOiBzdHIpOgogICAgICAgICAgICBiYWlzY19jb21wb25lbnRfZnVuYygKICAgICAgICAgICAgICAgIGJvb2xfcGFyYW09Ym9vbF9wYXJhbSwKICAgICAgICAgICAgICAgIGludF9wYXJhbT1pbnRfcGFyYW0sCiAgICAgICAgICAgICAgICBmbG9hdF9wYXJhbT1mbG9hdF9wYXJhbSwKICAgICAgICAgICAgICAgIHN0cl9wYXJhbT1zdHJfcGFyYW0sCiAgICAgICAgICAgICkKCiAgICAgICAgQGRzbC5waXBlbGluZQogICAgICAgIGRlZiBwaXBlbGluZV9mdW5jKCk6CiAgICAgICAgICAgICMgY29tcG9uZW50cyByZXR1cm4gcHJpbWl0aXZlIHR5cGUgb3V0cHV0cwogICAgICAgICAgICBib29sX25vZGUgPSBib29sZWFuX2Z1bmMoKQogICAgICAgICAgICBpbnRfbm9kZSA9IGludGVnZXJfZnVuYygpCiAgICAgICAgICAgIGZsb2F0X25vZGUgPSBudW1iZXJfZnVuYygpCiAgICAgICAgICAgIHN0cl9ub2RlID0gc3RyaW5nX2Z1bmMoKQogICAgICAgICAgICAjIHBpcGVsaW5lIGNvbXBvbmVudCBjb25zdW1lIGFib3ZlIHByaW1pdGl2ZSB0eXBlIG91dHB1dHMKICAgICAgICAgICAgcGlwZWxpbmVfbm9kZSA9IHBpcGVsaW5lX2NvbXBvbmVudF9mdW5jKCAgIyBub3FhOiBGODQxCiAgICAgICAgICAgICAgICBib29sX3BhcmFtPWJvb2xfbm9kZS5vdXRwdXRzLm91dHB1dCwKICAgICAgICAgICAgICAgIGludF9wYXJhbT1pbnRfbm9kZS5vdXRwdXRzLm91dHB1dCwKICAgICAgICAgICAgICAgIGZsb2F0X3BhcmFtPWZsb2F0X25vZGUub3V0cHV0cy5vdXRwdXQsCiAgICAgICAgICAgICAgICBzdHJfcGFyYW09c3RyX25vZGUub3V0cHV0cy5vdXRwdXQsCiAgICAgICAgICAgICkKCiAgICAgICAgcGlwZWxpbmVfam9iID0gcGlwZWxpbmVfZnVuYygpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCgogICAgZGVmIHRlc3RfcGlwZWxpbmVfdmFyaWFibGVfbmFtZV91cHBlcmNhc2Uoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgY29tcG9uZW50X3lhbWwgPSAiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiCiAgICAgICAgY29tcG9uZW50X2Z1bmMgPSBsb2FkX2NvbXBvbmVudCgKICAgICAgICAgICAgc291cmNlPWNvbXBvbmVudF95YW1sLAogICAgICAgICkKCiAgICAgICAgQGRzbC5waXBlbGluZShuYW1lPSJwaXBlbGluZV93aXRoX3VwcGVyY2FzZV9ub2RlX25hbWVzIikKICAgICAgICBkZWYgcGlwZWxpbmVfd2l0aF91c2VyX2RlZmluZWRfbm9kZXNfMSgpOgogICAgICAgICAgICBmb3IgaSBpbiByYW5nZSgyKToKICAgICAgICAgICAgICAgIG5vZGUxID0gY29tcG9uZW50X2Z1bmMoY29tcG9uZW50X2luX3BhdGg9am9iX2lucHV0KQogICAgICAgICAgICAgICAgIyBjaGFuZ2Ugbm9kZSBuYW1lIHRvIGxvd2VyIHdoZW4gc2V0dGluZyBpdCB0byBhdm9pZCB1cHBlciBjYXNlIGluIG54dF9pbnB1dCdzIGJpbmRpbmcKICAgICAgICAgICAgICAgIG5vZGUxLm5hbWUgPSBmIkR1bW15X3tpfSIKICAgICAgICAgICAgICAgIG54dF9pbnB1dCA9IElucHV0KAogICAgICAgICAgICAgICAgICAgIHBhdGg9bm9kZTEub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgsCiAgICAgICAgICAgICAgICAgICAgbW9kZT1JbnB1dE91dHB1dE1vZGVzLkRJUkVDVCwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIG5vZGUyID0gY29tcG9uZW50X2Z1bmMoY29tcG9uZW50X2luX3BhdGg9bnh0X2lucHV0KQogICAgICAgICAgICAgICAgbm9kZTIubmFtZSA9IGYiQW5vdGhlcl97aX0iCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBpcGVsaW5lX3dpdGhfdXNlcl9kZWZpbmVkX25vZGVzXzEoKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCiAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCiAgICAgICAgYWN0dWFsX2pvYiA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkucHJvcGVydGllcy5hc19kaWN0KCksICpjb21tb25fb21pdF9maWVsZHMpCiAgICAgICAgYXNzZXJ0IGFjdHVhbF9qb2JbImpvYnMiXSA9PSB7CiAgICAgICAgICAgICJhbm90aGVyXzAiOiB7CiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAibW9kZSI6ICJEaXJlY3QiLAogICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmpvYnMuZHVtbXlfMC5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH19IiwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm5hbWUiOiAiYW5vdGhlcl8wIiwKICAgICAgICAgICAgICAgICJ0eXBlIjogImNvbW1hbmQiLAogICAgICAgICAgICB9LAogICAgICAgICAgICAiYW5vdGhlcl8xIjogewogICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX3BhdGgiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgIm1vZGUiOiAiRGlyZWN0IiwKICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5qb2JzLmR1bW15XzEub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9fSIsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJuYW1lIjogImFub3RoZXJfMSIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImR1bW15XzAiOiB7CiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogInVyaV9maWxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgInVyaSI6ICJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJuYW1lIjogImR1bW15XzAiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJkdW1teV8xIjogewogICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX3BhdGgiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJ1cmlfZmlsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ1cmkiOiAiaHR0cHM6Ly9kcHJlcGRhdGEuYmxvYi5jb3JlLndpbmRvd3MubmV0L2RlbW8vVGl0YW5pYy5jc3YiLAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibmFtZSI6ICJkdW1teV8xIiwKICAgICAgICAgICAgICAgICJ0eXBlIjogImNvbW1hbmQiLAogICAgICAgICAgICB9LAogICAgICAgIH0KCiAgICBkZWYgdGVzdF9waXBlbGluZV9zaW5ndWxhcml0eV9zdHJvbmdfdHlwZV9zdWJtaXNzaW9uKHNlbGYsIGNsaWVudDogTUxDbGllbnQsIG1vY2tfc2luZ3VsYXJpdHlfYXJtX2lkOiBzdHIpOgogICAgICAgIGNvbXBvbmVudF95YW1sID0gIi4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnRfc2luZ3VsYXJpdHkueW1sIgogICAgICAgIGNvbXBvbmVudF9mdW5jID0gbG9hZF9jb21wb25lbnQoY29tcG9uZW50X3lhbWwpCgogICAgICAgIGluc3RhbmNlX3R5cGUgPSAiU2luZ3VsYXJpdHkuTkQ0MHJzX3YyIgoKICAgICAgICBAZHNsLnBpcGVsaW5lCiAgICAgICAgZGVmIHBpcGVsaW5lX2Z1bmMoKToKICAgICAgICAgICAgIyBiYXNpYyBqb2JfdGllciArIExvdyBwcmlvcml0eQogICAgICAgICAgICBiYXNpY19sb3dfbm9kZSA9IGNvbXBvbmVudF9mdW5jKCkKICAgICAgICAgICAgYmFzaWNfbG93X25vZGUucmVzb3VyY2VzID0gSm9iUmVzb3VyY2VDb25maWd1cmF0aW9uKGluc3RhbmNlX2NvdW50PTIsIGluc3RhbmNlX3R5cGU9aW5zdGFuY2VfdHlwZSkKICAgICAgICAgICAgYmFzaWNfbG93X25vZGUucXVldWVfc2V0dGluZ3MgPSBRdWV1ZVNldHRpbmdzKGpvYl90aWVyPSJiYXNpYyIsIHByaW9yaXR5PSJsb3ciKQogICAgICAgICAgICAjIHN0YW5kYXJkIGpvYl90aWVyICsgTWVkaXVtIHByaW9yaXR5CiAgICAgICAgICAgIHN0YW5kYXJkX21lZGl1bV9ub2RlID0gY29tcG9uZW50X2Z1bmMoKQogICAgICAgICAgICBzdGFuZGFyZF9tZWRpdW1fbm9kZS5yZXNvdXJjZXMgPSBKb2JSZXNvdXJjZUNvbmZpZ3VyYXRpb24oaW5zdGFuY2VfY291bnQ9MiwgaW5zdGFuY2VfdHlwZT1pbnN0YW5jZV90eXBlKQogICAgICAgICAgICBzdGFuZGFyZF9tZWRpdW1fbm9kZS5xdWV1ZV9zZXR0aW5ncyA9IFF1ZXVlU2V0dGluZ3Moam9iX3RpZXI9InN0YW5kYXJkIiwgcHJpb3JpdHk9Im1lZGl1bSIpCiAgICAgICAgICAgICMgcHJlbWl1bSBqb2JfdGllciArIEhpZ2ggcHJpb3JpdHkKICAgICAgICAgICAgcHJlbWl1bV9oaWdoX25vZGUgPSBjb21wb25lbnRfZnVuYygpCiAgICAgICAgICAgIHByZW1pdW1faGlnaF9ub2RlLnJlc291cmNlcyA9IEpvYlJlc291cmNlQ29uZmlndXJhdGlvbihpbnN0YW5jZV9jb3VudD0yLCBpbnN0YW5jZV90eXBlPWluc3RhbmNlX3R5cGUpCiAgICAgICAgICAgIHByZW1pdW1faGlnaF9ub2RlLnF1ZXVlX3NldHRpbmdzID0gUXVldWVTZXR0aW5ncyhqb2JfdGllcj0icHJlbWl1bSIsIHByaW9yaXR5PSJoaWdoIikKICAgICAgICAgICAgIyBwcm9wZXJ0aWVzCiAgICAgICAgICAgIG5vZGVfd2l0aF9wcm9wZXJ0aWVzID0gY29tcG9uZW50X2Z1bmMoKQogICAgICAgICAgICBwcm9wZXJ0aWVzID0geyJTaW5ndWxhcml0eSI6IHsiaW1hZ2VWZXJzaW9uIjogIiIsICJpbnRlcmFjdGl2ZSI6IEZhbHNlfX0KICAgICAgICAgICAgbm9kZV93aXRoX3Byb3BlcnRpZXMucmVzb3VyY2VzID0gSm9iUmVzb3VyY2VDb25maWd1cmF0aW9uKAogICAgICAgICAgICAgICAgaW5zdGFuY2VfY291bnQ9MiwgaW5zdGFuY2VfdHlwZT1pbnN0YW5jZV90eXBlLCBwcm9wZXJ0aWVzPXByb3BlcnRpZXMKICAgICAgICAgICAgKQoKICAgICAgICBwaXBlbGluZV9qb2IgPSBwaXBlbGluZV9mdW5jKCkKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gbW9ja19zaW5ndWxhcml0eV9hcm1faWQKICAgICAgICAjIHRoaXMgcGlwZWxpbmUgam9iIGlzIGV4cGVjdGVkIHRvIGZhaWwgYXMgU2luZ3VsYXJpdHkgaXMgbW9ja2VkLCBmb2N1cyBvbiBSRVNUIG9iamVjdCBhc3NlcnRpb24KICAgICAgICBjcmVhdGVkX3BpcGVsaW5lX2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQogICAgICAgIHJlc3Rfb2JqID0gY3JlYXRlZF9waXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkKICAgICAgICBhc3NlcnQgcmVzdF9vYmoucHJvcGVydGllcy5zZXR0aW5nc1siZGVmYXVsdF9jb21wdXRlIl0gPT0gbW9ja19zaW5ndWxhcml0eV9hcm1faWQKICAgICAgICAjIGJhc2ljIGpvYl90aWVyICsgTG93IHByaW9yaXR5CiAgICAgICAgYmFzaWNfbG93X25vZGVfZGljdCA9IHJlc3Rfb2JqLnByb3BlcnRpZXMuam9ic1siYmFzaWNfbG93X25vZGUiXQogICAgICAgIGFzc2VydCBiYXNpY19sb3dfbm9kZV9kaWN0WyJxdWV1ZV9zZXR0aW5ncyJdID09IHsiam9iX3RpZXIiOiAiQmFzaWMiLCAicHJpb3JpdHkiOiAxfQogICAgICAgIGFzc2VydCBiYXNpY19sb3dfbm9kZV9kaWN0WyJyZXNvdXJjZXMiXSA9PSB7Imluc3RhbmNlX2NvdW50IjogMiwgImluc3RhbmNlX3R5cGUiOiBpbnN0YW5jZV90eXBlfQogICAgICAgICMgc3RhbmRhcmQgam9iX3RpZXIgKyBNZWRpdW0gcHJpb3JpdHkKICAgICAgICBzdGFuZGFyZF9tZWRpdW1fbm9kZV9kaWN0ID0gcmVzdF9vYmoucHJvcGVydGllcy5qb2JzWyJzdGFuZGFyZF9tZWRpdW1fbm9kZSJdCiAgICAgICAgYXNzZXJ0IHN0YW5kYXJkX21lZGl1bV9ub2RlX2RpY3RbInF1ZXVlX3NldHRpbmdzIl0gPT0geyJqb2JfdGllciI6ICJTdGFuZGFyZCIsICJwcmlvcml0eSI6IDJ9CiAgICAgICAgYXNzZXJ0IHN0YW5kYXJkX21lZGl1bV9ub2RlX2RpY3RbInJlc291cmNlcyJdID09IHsiaW5zdGFuY2VfY291bnQiOiAyLCAiaW5zdGFuY2VfdHlwZSI6IGluc3RhbmNlX3R5cGV9CiAgICAgICAgIyBwcmVtaXVtIGpvYl90aWVyICsgSGlnaCBwcmlvcml0eQogICAgICAgIHByZW1pdW1faGlnaF9ub2RlX2RpY3QgPSByZXN0X29iai5wcm9wZXJ0aWVzLmpvYnNbInByZW1pdW1faGlnaF9ub2RlIl0KICAgICAgICBhc3NlcnQgcHJlbWl1bV9oaWdoX25vZGVfZGljdFsicXVldWVfc2V0dGluZ3MiXSA9PSB7ImpvYl90aWVyIjogIlByZW1pdW0iLCAicHJpb3JpdHkiOiAzfQogICAgICAgIGFzc2VydCBwcmVtaXVtX2hpZ2hfbm9kZV9kaWN0WyJyZXNvdXJjZXMiXSA9PSB7Imluc3RhbmNlX2NvdW50IjogMiwgImluc3RhbmNlX3R5cGUiOiBpbnN0YW5jZV90eXBlfQogICAgICAgICMgcHJvcGVydGllcwogICAgICAgIG5vZGVfd2l0aF9wcm9wZXJ0aWVzX2RpY3QgPSByZXN0X29iai5wcm9wZXJ0aWVzLmpvYnNbIm5vZGVfd2l0aF9wcm9wZXJ0aWVzIl0KICAgICAgICBhc3NlcnQgbm9kZV93aXRoX3Byb3BlcnRpZXNfZGljdFsicmVzb3VyY2VzIl0gPT0gewogICAgICAgICAgICAiaW5zdGFuY2VfY291bnQiOiAyLAogICAgICAgICAgICAiaW5zdGFuY2VfdHlwZSI6IGluc3RhbmNlX3R5cGUsCiAgICAgICAgICAgICMgdGhlIG1hcHBpbmcgU2luZ3VsYXJpdHkgPT4gQUlTdXBlckNvbXB1dGVyIGlzIGV4cGVjdGVkCiAgICAgICAgICAgICJwcm9wZXJ0aWVzIjogeyJBSVN1cGVyQ29tcHV0ZXIiOiB7ImltYWdlVmVyc2lvbiI6ICIiLCAiaW50ZXJhY3RpdmUiOiBGYWxzZX19LAogICAgICAgIH0KCiAgICBkZWYgdGVzdF9waXBlbGluZV9zaW5ndWxhcml0eV9wcm9wZXJ0eV9iYWdfc3VibWlzc2lvbihzZWxmLCBjbGllbnQ6IE1MQ2xpZW50LCBtb2NrX3Npbmd1bGFyaXR5X2FybV9pZDogc3RyKToKICAgICAgICBjb21wb25lbnRfeWFtbCA9ICIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50X3Npbmd1bGFyaXR5LnltbCIKICAgICAgICBjb21wb25lbnRfZnVuYyA9IGxvYWRfY29tcG9uZW50KGNvbXBvbmVudF95YW1sKQoKICAgICAgICAjIHByb3BlcnR5IGJhZyBpcyBzdXBwb3J0ZWQsIHdpdGggbG93ZXIgcHJpb3JpdHkgdGhhbiBzdHJvbmcgdHlwZQogICAgICAgIHZjX2NvbmZpZyA9IHsKICAgICAgICAgICAgImluc3RhbmNlX3R5cGUiOiAiU2luZ3VsYXJpdHkuTkQ0MHJzX3YyIiwKICAgICAgICAgICAgImluc3RhbmNlX2NvdW50IjogMiwKICAgICAgICAgICAgInByb3BlcnRpZXMiOiB7CiAgICAgICAgICAgICAgICAiQUlTdXBlckNvbXB1dGVyIjogewogICAgICAgICAgICAgICAgICAgICJpbnRlcmFjdGl2ZSI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICJpbWFnZVZlcnNpb24iOiAicHl0b3JjaCIsCiAgICAgICAgICAgICAgICAgICAgInNsYVRpZXIiOiAiUHJlbWl1bSIsCiAgICAgICAgICAgICAgICAgICAgInRlbnNvcmJvYXJkTG9nRGlyZWN0b3J5IjogIi9zY3JhdGNoL3RlbnNvcmJvYXJkX2xvZ3MiLAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgIH0KCiAgICAgICAgQGRzbC5waXBlbGluZQogICAgICAgIGRlZiBwaXBlbGluZV9mdW5jKCk6CiAgICAgICAgICAgIG5vZGUgPSBjb21wb25lbnRfZnVuYygpCiAgICAgICAgICAgIG5vZGUucmVzb3VyY2VzID0gdmNfY29uZmlnCiAgICAgICAgICAgIG5vZGUuY29tcHV0ZSA9IG1vY2tfc2luZ3VsYXJpdHlfYXJtX2lkCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBpcGVsaW5lX2Z1bmMoKQogICAgICAgICMgYXMgU2luZ3VsYXJpdHkgaXMgbW9ja2VkIGFuZCBleHBlY3RlZCB0byBmYWlsIHZhbGlkYXRpb24sIHNraXAgaXQgZm9yIHN1Ym1pc3Npb247CiAgICAgICAgIyB0aGVuIG1hbnVhbGx5IGNhbmNlbCBpdCBhcyBvdGhlciB0ZXN0cy4KICAgICAgICBjcmVhdGVkX3BpcGVsaW5lX2pvYiA9IGNsaWVudC5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lX2pvYiwgc2tpcF92YWxpZGF0aW9uPVRydWUpCiAgICAgICAgY2xpZW50LmpvYnMuYmVnaW5fY2FuY2VsKGNyZWF0ZWRfcGlwZWxpbmVfam9iLm5hbWUpLnJlc3VsdCgpCiAgICAgICAgcmVzdF9vYmogPSBjcmVhdGVkX3BpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKQogICAgICAgIGFzc2VydCByZXN0X29iai5wcm9wZXJ0aWVzLmpvYnNbIm5vZGUiXVsiY29tcHV0ZUlkIl0gPT0gbW9ja19zaW5ndWxhcml0eV9hcm1faWQKICAgICAgICBhc3NlcnQgcmVzdF9vYmoucHJvcGVydGllcy5qb2JzWyJub2RlIl1bInJlc291cmNlcyJdID09IHZjX2NvbmZpZwoKICAgIEBweXRlc3QubWFyay5za2lwaWYoY29uZGl0aW9uPW5vdCBpc19saXZlKCksIHJlYXNvbj0icmVjb3JkaW5nIHdpbGwgZXhwb3NlIFNpbmd1bGFyaXR5IGluZm9ybWF0aW9uIikKICAgIGRlZiB0ZXN0X3BpcGVsaW5lX3Npbmd1bGFyaXR5X2xpdmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCwgc2luZ3VsYXJpdHlfdmMpOgogICAgICAgICMgZnVsbCBuYW1lIGFuZCBzaG9ydCBuYW1lIGFyZSBzeW50YXggc3VnYXIsIFNESyB3aWxsIHJlc29sdmUgaXQgdG8gU2luZ3VsYXJpdHkgQVJNIGlkIGJlZm9yZSByZXF1ZXN0LAogICAgICAgICMgdGhpcyBuZWVkcyBjbGllbnQgdG8gZ2V0ICYgc2VhcmNoIGF2YWlsYWJsZSBWQ3MgLSB0aGF0J3Mgd2h5IHdlIHBsYWNlIHRoaXMgdGVzdCBpbiBlbmQtdG8tZW5kIHRlc3QgLQogICAgICAgICMgYW5kIGNvbXB1dGUgdmFsdWVzIGluIHJldHVybmVkIFJFU1Qgb2JqZWN0IHNob3VsZCBhbGwgYmUgQVJNIGlkLgogICAgICAgIGNvbXBvbmVudF95YW1sID0gIi4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnRfc2luZ3VsYXJpdHkueW1sIgogICAgICAgIGNvbXBvbmVudF9mdW5jID0gbG9hZF9jb21wb25lbnQoY29tcG9uZW50X3lhbWwpCgogICAgICAgICMgZ2VuZXJhdGUgU2luZ3VsYXJpdHkgQVJNIGlkLCBmdWxsIG5hbWUgYW5kIHNob3J0IG5hbWUgZnJvbSBWQwogICAgICAgIGFybV9pZCA9IFNJTkdVTEFSSVRZX0lEX0ZPUk1BVC5mb3JtYXQoCiAgICAgICAgICAgIHNpbmd1bGFyaXR5X3ZjLnN1YnNjcmlwdGlvbl9pZCwgc2luZ3VsYXJpdHlfdmMucmVzb3VyY2VfZ3JvdXBfbmFtZSwgc2luZ3VsYXJpdHlfdmMubmFtZQogICAgICAgICkKICAgICAgICBmdWxsX25hbWUgPSAiYXp1cmVtbDovL3N1YnNjcmlwdGlvbnMve30vcmVzb3VyY2VHcm91cHMve30vdmlydHVhbGNsdXN0ZXJzL3t9Ii5mb3JtYXQoCiAgICAgICAgICAgIHNpbmd1bGFyaXR5X3ZjLnN1YnNjcmlwdGlvbl9pZCwgc2luZ3VsYXJpdHlfdmMucmVzb3VyY2VfZ3JvdXBfbmFtZSwgc2luZ3VsYXJpdHlfdmMubmFtZQogICAgICAgICkKICAgICAgICBzaG9ydF9uYW1lID0gZiJhenVyZW1sOi8vdmlydHVhbGNsdXN0ZXJzL3tzaW5ndWxhcml0eV92Yy5uYW1lfSIKCiAgICAgICAgQGRzbC5waXBlbGluZQogICAgICAgIGRlZiBwaXBlbGluZV9mdW5jKCk6CiAgICAgICAgICAgIG5vZGVfd2l0aF9pZCA9IGNvbXBvbmVudF9mdW5jKCkKICAgICAgICAgICAgbm9kZV93aXRoX2lkLmNvbXB1dGUgPSBhcm1faWQKICAgICAgICAgICAgbm9kZV93aXRoX2Z1bGxfbmFtZSA9IGNvbXBvbmVudF9mdW5jKCkKICAgICAgICAgICAgbm9kZV93aXRoX2Z1bGxfbmFtZS5jb21wdXRlID0gZnVsbF9uYW1lCiAgICAgICAgICAgIG5vZGVfd2l0aF9zaG9ydF9uYW1lID0gY29tcG9uZW50X2Z1bmMoKQogICAgICAgICAgICBub2RlX3dpdGhfc2hvcnRfbmFtZS5jb21wdXRlID0gc2hvcnRfbmFtZQoKICAgICAgICBwaXBlbGluZV9qb2IgPSBwaXBlbGluZV9mdW5jKCkKICAgICAgICBjcmVhdGVkX3BpcGVsaW5lX2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQogICAgICAgIHJlc3Rfb2JqID0gY3JlYXRlZF9waXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkKCiAgICAgICAgZm9yIG5vZGVfbmFtZSBpbiBbIm5vZGVfd2l0aF9pZCIsICJub2RlX3dpdGhfZnVsbF9uYW1lIiwgIm5vZGVfd2l0aF9zaG9ydF9uYW1lIl06CiAgICAgICAgICAgIG5vZGVfY29tcHV0ZSA9IHJlc3Rfb2JqLnByb3BlcnRpZXMuam9ic1tub2RlX25hbWVdWyJjb21wdXRlSWQiXQogICAgICAgICAgICBhc3NlcnQgaXNfc2luZ3VsYXJpdHlfaWRfZm9yX3Jlc291cmNlKG5vZGVfY29tcHV0ZSkKICAgICAgICAgICAgYXNzZXJ0IG5vZGVfY29tcHV0ZS5lbmRzd2l0aChzaW5ndWxhcml0eV92Yy5uYW1lKQoKICAgIGRlZiB0ZXN0X2Fzc2lnbl92YWx1ZV90b191bmtub3duX2ZpbGVkKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIHBhdGggPSAiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiCiAgICAgICAgY29tcG9uZW50X2Z1bmMgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9cGF0aCkKICAgICAgICAjIER1ZSB0byBpdCB3aWxsIGJsb2NrIGNpIHdpdGggdGhlIHRhZ3Mgb2YgeWFtbCB3aGVuIGdlbmVyYXRpbmcgcmVjb3JkcywgcmVtb3ZlIHRoZSB0YWdzIGhlcmUuCiAgICAgICAgY29tcG9uZW50X2Z1bmMudGFncyA9IHt9CgogICAgICAgIEBkc2wucGlwZWxpbmUoKQogICAgICAgIGRlZiBwaXBlbGluZV9mdW5jKGlucHV0KToKICAgICAgICAgICAgbm9kZSA9IGNvbXBvbmVudF9mdW5jKGNvbXBvbmVudF9pbl9wYXRoPWlucHV0KQogICAgICAgICAgICBub2RlLnVua25vd25fZmllbGQgPSBpbnB1dAoKICAgICAgICBwaXBlbGluZV9qb2I6IFBpcGVsaW5lSm9iID0gcGlwZWxpbmVfZnVuYyhpbnB1dD1JbnB1dChwYXRoPXBhdGgpKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCiAgICAgICAgam9iX3JlcyA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUoam9iPXBpcGVsaW5lX2pvYiwgZXhwZXJpbWVudF9uYW1lPSJ0ZXN0X3Vua25vd25fZmllbGQiKQogICAgICAgIGFzc2VydCBqb2JfcmVzLmpvYnNbIm5vZGUiXS51bmtub3duX2ZpZWxkID09ICIke3twYXJlbnQuaW5wdXRzLmlucHV0fX0iCg==",
      "StatusCode": 201,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Content-MD5": "vjglRb3ueWA43cCojSpZxA==",
        "Date": "Tue, 30 May 2023 07:29:01 GMT",
        "ETag": "\u00220x8DB60DF8AE0713E\u0022",
        "Last-Modified": "Tue, 30 May 2023 07:29:02 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-content-crc64": "snwz3P4SwJY=",
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://amltest5899420437.blob.core.windows.net/azureml-blobstore-0bdd51b6-cd9c-4978-b870-99997b393b81/LocalUpload/00000000000000000000000000000000/e2etests/test_dsl_fl.py",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "10442",
        "Content-MD5": "Bf2zKM/VFLU1K2yMYkGmbw==",
        "Content-Type": "application/octet-stream",
        "If-None-Match": "*",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)",
        "x-ms-blob-type": "BlockBlob",
        "x-ms-date": "Tue, 30 May 2023 07:28:59 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": "aW1wb3J0IHB5dGVzdApmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKZnJvbSBkZXZ0b29sc190ZXN0dXRpbHMgaW1wb3J0IEF6dXJlUmVjb3JkZWRUZXN0Q2FzZSwgaXNfbGl2ZQpmcm9tIGF6dXJlLmNvcmUuZXhjZXB0aW9ucyBpbXBvcnQgUmVzb3VyY2VOb3RGb3VuZEVycm9yCmZyb20gLi5fdXRpbCBpbXBvcnQgX0RTTF9USU1FT1VUX1NFQ09ORApmcm9tIHRlc3RfdXRpbGl0aWVzLnV0aWxzIGltcG9ydCBfUFlURVNUX1RJTUVPVVRfTUVUSE9ECmZyb20gYXp1cmUuYWkubWwgaW1wb3J0IElucHV0LCBsb2FkX2NvbXBvbmVudApmcm9tIHR5cGluZyBpbXBvcnQgQ2FsbGFibGUKZnJvbSBhenVyZS5haS5tbC5kc2wuX2ZsX3NjYXR0ZXJfZ2F0aGVyX25vZGUgaW1wb3J0IGZsX3NjYXR0ZXJfZ2F0aGVyCmZyb20gYXp1cmUuYWkubWwuZW50aXRpZXMuX2Fzc2V0cy5mZWRlcmF0ZWRfbGVhcm5pbmdfc2lsbyBpbXBvcnQgRmVkZXJhdGVkTGVhcm5pbmdTaWxvCmZyb20gYXp1cmUuYWkubWwuY29uc3RhbnRzIGltcG9ydCBBc3NldFR5cGVzCmZyb20gYXp1cmUuYWkubWwuZW50aXRpZXMuX2NyZWRlbnRpYWxzIGltcG9ydCAoCiAgICBJZGVudGl0eUNvbmZpZ3VyYXRpb24sCiAgICBJZGVudGl0eUNvbmZpZ3VyYXRpb25UeXBlLAogICAgTWFuYWdlZElkZW50aXR5Q29uZmlndXJhdGlvbiwKKQpmcm9tIGF6dXJlLmFpLm1sLmRzbCBpbXBvcnQgcGlwZWxpbmUKaW1wb3J0IG9zCmZyb20gYXp1cmUuYWkubWwgaW1wb3J0ICgKICAgIE1MQ2xpZW50LAopCgoKIyBSRVNPVVJDRSBOT1RFUyAtIEFzIGFuIGUyZSB0ZXN0IGZpbGUsIHRoaXMgZmlsZSBtYWtlcyBhbmQgcmVmZXJlbmNlcyByZWFsIEFNTCByZXNvdXJjZXMuCiMgQWxsIHJlc291cmNlcyByZWZlcmVuY2VzIGJ5IHRoaXMgZmlsZSBhcmUgY29udGFpbmVkIHdpdGhpbiB0aGUgZm9sbG93aW5nOgojIHN1YnNjcmlwdGlvbjogZGF0YSBzY2llbmNlIFZNIFRlYW0gKERTVk0pCiMgcmVzb3VyY2UgZ3JvdXA6IGZsLWUyZS10ZXN0aW5nLXJnCiMgd29ya3NwYWNlOiBmbC1lMmUtdGVzdGluZy13cwojIElmIHlvdSdyZSBydW5uaW5nIHRoaXMgdGVzdCBsb2NhbGx5IGluIGxpdmUgbW9kZSwgbWFrZSBzdXJlIHlvdSd2ZSBzZXQgdGhlIGFib3ZlIHZhbHVlcyBpbgojIHlvdXIgLmVudiBmaWxlLgojIHJlc291cmNlcyBvZiBub3RlOgojIC0gbXVsdGlwbGUgc3RvcmFnZSBjb250YWluZXJzCiMgLSBtdWx0aXBsZSBjb21wdXRlcyB3aXRoIHZhcnlpbmcgbWFuYWdlZCBpZGVudGl0aWVzIHRvIGFsbG93IGFjY2VzcyB0byBkaWZmZXJlbnQgc3RvcmFnZSBjb250YWluZXJzCkBweXRlc3QubWFyay50aW1lb3V0KHRpbWVvdXQ9X0RTTF9USU1FT1VUX1NFQ09ORCwgbWV0aG9kPV9QWVRFU1RfVElNRU9VVF9NRVRIT0QpCkBweXRlc3QubWFyay5lMmV0ZXN0CkBweXRlc3QubWFyay5jb3JlX3Nka190ZXN0CmNsYXNzIFRlc3REU0xQaXBlbGluZShBenVyZVJlY29yZGVkVGVzdENhc2UpOgogICAgIyBERVYgTk9URTogVGhpcyB0ZXN0IGV4cGVjdHMgYSBsb3Qgb2YgcmVzb3VyY2VzIHRvIGFscmVhZHkgZXhpc3QgaW4gQU1MLiBUaGUgaW5pdGlhbCBpbXBsZW1lbnRhdGlvbgogICAgIyBvZiB0aGlzIHRlc3QgaW1wbGVtZW50ZWQgYWxsIG9mIHRoZXNlIHRoaWducyB1bmRlciB0aGUgJ2ZsLWUyZS10ZXN0aW5nLXJnJyByZXNvdXJjZSBncm91cCBhbmQKICAgICMgdGhlICdmbC1lMmUtdGVzdGluZy13cycgd29ya3NwYWNlIGluc2lkZSB0aGF0IFJHLgogICAgIyBUaGUgbmVlZGVkIHJlc291cmNlcyBhcmU6CiAgICAjIC0gSW4gdGhlIHdvcmtzcGFjZSdzIHN0b3JhZ2UgYWNjb3VudCwgMyBjb250YWluZXJzIG5hbWVkICdzaWxvLWNvbnRhaW5lcjEnLCAnc2lsby1jb250YWluZXIyMycsCiAgICAjICAgICAgIGFuZCAnYWdnLWNvbnRhaW5lcicuIEVhY2ggY29udGFpbmVyIG5lZWRzIHRvIGhhdmUgYXNzaWduZWQgdGhlIGJsb2Igb3duZXIgcGVybWlzc2lvbgogICAgIyAgICAgICB0byB0aGUgJ3Rlc3QtbXNpLWlkJyBtYW5hZ2VkIGlkZW50aXR5CiAgICAjIC0gNCBjb21wdXRlIGNsdXN0ZXJzIGluIHRoZSB3b3Jrc3BhY2UgbmFtZWQgc2lsb0NvbXB1dGUxLzIvMyBhbmQgYWdnQ29tcHV0ZS4gRWFjaCBvZiB3aGljaAogICAgIyAgICAgICBoYXMgYmVlbiBhc3NpZ25lZCB0aGUgJ3Rlc3QtbXNpLWlkJyBJRAogICAgIyAtIDQgZGF0YXN0b3JlcyBjb25uZWN0ZWQgdG8gdGhlIGFmb3JlbWVudGlvbmVkIHN0b3JhZ2UgY29udGFpbmVycyBuYW1lZCBzaWxvX2RhdGFzdG9yZTEvMi8zIGFuZAogICAgIyAgICAgICBhZ2dfZGF0YXN0b3JlLgogICAgQHB5dGVzdC5tYXJrLnNraXBpZigKICAgICAgICBjb25kaXRpb249bm90IGlzX2xpdmUoKSwKICAgICAgICByZWFzb249KAogICAgICAgICAgICAiVE9ETyAoMjIzNTAzNCkgVGhlIGNyaXRpY2FsIGNhbGwgdG8gYGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGVgIHNlZW1zIHRvIG1ha2UgZGlmZmVyZW50IgogICAgICAgICAgICArICJBUEkgY2FsbHMgaW4gcGxheWJhY2sgbW9kZSBjb21wYXJlZCB0byByZWNvcmRpbmcgbW9kZSIKICAgICAgICApLAogICAgKQogICAgZGVmIHRlc3RfZmxfcGlwZWxpbmUoCiAgICAgICAgc2VsZiwKICAgICAgICBjbGllbnQ6IE1MQ2xpZW50LAogICAgICAgIGZlZGVyYXRlZF9sZWFybmluZ19jb21wb25lbnRzX2ZvbGRlcjogUGF0aCwKICAgICAgICBmZWRlcmF0ZWRfbGVhcm5pbmdfbG9jYWxfZGF0YV9mb2xkZXI6IFBhdGgsCiAgICApIC0\u002BIE5vbmU6CiAgICAgICAgaWQgPSBJZGVudGl0eUNvbmZpZ3VyYXRpb24oCiAgICAgICAgICAgIHR5cGU9SWRlbnRpdHlDb25maWd1cmF0aW9uVHlwZS5NQU5BR0VELAogICAgICAgICAgICB1c2VyX2Fzc2lnbmVkX2lkZW50aXRpZXM9W01hbmFnZWRJZGVudGl0eUNvbmZpZ3VyYXRpb24oY2xpZW50X2lkPSIzYWRmZjc0Mi0wMTQyLTQ1YTYtODE0Mi0zZDk0Zjk0NGNhZmIiKV0sCiAgICAgICAgKQoKICAgICAgICAjIFRvIHN1cHBvcnQgZHNsIHBpcGVsaW5lIGt3YXJncwogICAgICAgIG9zLmVudmlyb25bIkFaVVJFX01MX0NMSV9QUklWQVRFX0ZFQVRVUkVTX0VOQUJMRUQiXSA9ICJUcnVlIgogICAgICAgIGNvbXB1dGVfbmFtZXMgPSBbCiAgICAgICAgICAgICJzaWxvQ29tcHV0ZTEiLAogICAgICAgICAgICAic2lsb0NvbXB1dGUyIiwKICAgICAgICAgICAgInNpbG9Db21wdXRlMyIsCiAgICAgICAgICAgICJhZ2dDb21wdXRlIiwKICAgICAgICBdCiAgICAgICAgY29tcHV0ZXMgPSBbXQogICAgICAgIGZvciBuYW1lIGluIGNvbXB1dGVfbmFtZXM6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGV4dGFudF9jb21wdXRlID0gY2xpZW50LmNvbXB1dGUuZ2V0KG5hbWUpCiAgICAgICAgICAgICAgICBwcmludChmIkZvdW5kIGV4aXN0aW5nIGNvbXB1dGUgJ3tuYW1lfScsIHVzaW5nIHRoYXQgaW5zdGVhZCBvZiBjcmVhdGluZyBpdC4iKQogICAgICAgICAgICAgICAgY29tcHV0ZXMuYXBwZW5kKGV4dGFudF9jb21wdXRlKQogICAgICAgICAgICBleGNlcHQgUmVzb3VyY2VOb3RGb3VuZEVycm9yIGFzIGU6CiAgICAgICAgICAgICAgICByYWlzZSAoZSkKCiAgICAgICAgZGF0YXN0b3JlX25hbWVzID0gWwogICAgICAgICAgICAic2lsb19kYXRhc3RvcmUxIiwKICAgICAgICAgICAgInNpbG9fZGF0YXN0b3JlMiIsCiAgICAgICAgICAgICJzaWxvX2RhdGFzdG9yZTMiLAogICAgICAgICAgICAiYWdnX2RhdGFzdG9yZSIsCiAgICAgICAgXQoKICAgICAgICBkYXRhc3RvcmVzID0gW10KICAgICAgICBmb3IgZGF0YXN0b3JlX25hbWUgaW4gZGF0YXN0b3JlX25hbWVzOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBleHRhbnRfZHMgPSBjbGllbnQuZGF0YXN0b3Jlcy5nZXQoZGF0YXN0b3JlX25hbWUpCiAgICAgICAgICAgICAgICBwcmludChmIkZvdW5kIGV4aXN0aW5nIGRhdGFzdG9yZSAne2RhdGFzdG9yZV9uYW1lfScsIHVzaW5nIHRoYXQgaW5zdGVhZCBvZiBjcmVhdGluZyBpdC4iKQogICAgICAgICAgICAgICAgZGF0YXN0b3Jlcy5hcHBlbmQoZXh0YW50X2RzKQogICAgICAgICAgICBleGNlcHQgUmVzb3VyY2VOb3RGb3VuZEVycm9yIGFzIGU6CiAgICAgICAgICAgICAgICByYWlzZSAoZSkKCiAgICAgICAgIyBMb2FkIGNvbXBvbmVudHMgZnJvbSBsb2NhbCBjb25maWdzCiAgICAgICAgcHJlcHJvY2Vzc2luZ19jb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudCgKICAgICAgICAgICAgc291cmNlPW9zLnBhdGguam9pbihmZWRlcmF0ZWRfbGVhcm5pbmdfY29tcG9uZW50c19mb2xkZXIsICJwcmVwcm9jZXNzaW5nIiwgInNwZWMueWFtbCIpCiAgICAgICAgKQoKICAgICAgICB0cmFpbmluZ19jb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudCgKICAgICAgICAgICAgc291cmNlPW9zLnBhdGguam9pbihmZWRlcmF0ZWRfbGVhcm5pbmdfY29tcG9uZW50c19mb2xkZXIsICJ0cmFpbmluZyIsICJzcGVjLnlhbWwiKQogICAgICAgICkKCiAgICAgICAgYWdncmVnYXRlX2NvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICBzb3VyY2U9b3MucGF0aC5qb2luKGZlZGVyYXRlZF9sZWFybmluZ19jb21wb25lbnRzX2ZvbGRlciwgImFnZ3JlZ2F0ZSIsICJzcGVjLnlhbWwiKQogICAgICAgICkKCiAgICAgICAgIyBVc2UgYSBuZXN0ZWQgcGlwZWxpbmUgZm9yIHRoZSBzaWxvIHN0ZXAKICAgICAgICBAcGlwZWxpbmUKICAgICAgICBkZWYgc2lsb19zdGVwX2Z1bmMoCiAgICAgICAgICAgIHJhd190cmFpbl9kYXRhOiBJbnB1dCwKICAgICAgICAgICAgcmF3X3Rlc3RfZGF0YTogSW5wdXQsCiAgICAgICAgICAgIGNoZWNrcG9pbnQ6IElucHV0KG9wdGlvbmFsPVRydWUpLAogICAgICAgICAgICBscjogZmxvYXQgPSAwLjAxLAogICAgICAgICAgICBiYXRjaF9zaXplOiBpbnQgPSA2NCwKICAgICAgICAgICAgaXRlcmF0aW9uX251bTogaW50ID0gMCwKICAgICAgICAgICAgZXBvY2hzOiBpbnQgPSAzLAogICAgICAgICk6CiAgICAgICAgICAgICMgUHJlcHJvY2VzcyBkYXRhCiAgICAgICAgICAgIHNpbG9fcHJlX3Byb2Nlc3Npbmdfc3RlcCA9IHByZXByb2Nlc3NpbmdfY29tcG9uZW50KAogICAgICAgICAgICAgICAgcmF3X3RyYWluaW5nX2RhdGE9cmF3X3RyYWluX2RhdGEsCiAgICAgICAgICAgICAgICByYXdfdGVzdGluZ19kYXRhPXJhd190ZXN0X2RhdGEsCiAgICAgICAgICAgICAgICAjIHJhd19ldmFsdWF0aW9uX2RhdGE9cmF3X2V2YWxfZGF0YSwKICAgICAgICAgICAgICAgICMgaGVyZSB3ZSdyZSB1c2luZyB0aGUgbmFtZSBvZiB0aGUgc2lsbyBjb21wdXRlIGFzIGEgbWV0cmljcyBwcmVmaXgKICAgICAgICAgICAgICAgIG1ldHJpY3NfcHJlZml4PSIiLAogICAgICAgICAgICApCgogICAgICAgICAgICAjIFJ1biB0cmFpbmluZwogICAgICAgICAgICBzaWxvX3RyYWluaW5nX3N0ZXAgPSB0cmFpbmluZ19jb21wb25lbnQoCiAgICAgICAgICAgICAgICB0cmFpbl9kYXRhPXNpbG9fcHJlX3Byb2Nlc3Npbmdfc3RlcC5vdXRwdXRzLnByb2Nlc3NlZF90cmFpbl9kYXRhLAogICAgICAgICAgICAgICAgdGVzdF9kYXRhPXNpbG9fcHJlX3Byb2Nlc3Npbmdfc3RlcC5vdXRwdXRzLnByb2Nlc3NlZF90ZXN0X2RhdGEsCiAgICAgICAgICAgICAgICBjaGVja3BvaW50PWNoZWNrcG9pbnQsCiAgICAgICAgICAgICAgICBscj1sciwKICAgICAgICAgICAgICAgIGVwb2Nocz1lcG9jaHMsCiAgICAgICAgICAgICAgICBiYXRjaF9zaXplPWJhdGNoX3NpemUsCiAgICAgICAgICAgICAgICBtZXRyaWNzX3ByZWZpeD0iIiwKICAgICAgICAgICAgICAgIGl0ZXJhdGlvbl9udW09aXRlcmF0aW9uX251bSwKICAgICAgICAgICAgKQogICAgICAgICAgICAjIHJldHVybiB0cmFpbmluZyByZXN1bHRzCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAibW9kZWwiOiBzaWxvX3RyYWluaW5nX3N0ZXAub3V0cHV0cy5tb2RlbCwKICAgICAgICAgICAgfQoKICAgICAgICAjIFVzZSBhIGNvbXBvbmVudCBkaXJlY3RseSBmb3IgdGhlIGFnZyBzdGVwCiAgICAgICAgYWdncmVnYXRpb25fc3RlcCA9IGFnZ3JlZ2F0ZV9jb21wb25lbnQKCiAgICAgICAgc2lsb19jb25maWdzID0gWwogICAgICAgICAgICBGZWRlcmF0ZWRMZWFybmluZ1NpbG8oCiAgICAgICAgICAgICAgICBjb21wdXRlPWNvbXB1dGVzWzBdLm5hbWUsCiAgICAgICAgICAgICAgICBkYXRhc3RvcmU9ZGF0YXN0b3Jlc1swXS5uYW1lLAogICAgICAgICAgICAgICAgaW5wdXRzPXsKICAgICAgICAgICAgICAgICAgICAicmF3X3RyYWluX2RhdGEiOiBJbnB1dCgKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLlVSSV9GSUxFLAogICAgICAgICAgICAgICAgICAgICAgICBtb2RlPSJkaXJlY3QiLAogICAgICAgICAgICAgICAgICAgICAgICBwYXRoPW9zLnBhdGguam9pbihmZWRlcmF0ZWRfbGVhcm5pbmdfbG9jYWxfZGF0YV9mb2xkZXIsICJzaWxvMV9pbnB1dDEudHh0IiksCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzdG9yZT1kYXRhc3RvcmVzWzBdLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAicmF3X3Rlc3RfZGF0YSI6IElucHV0KAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuVVJJX0ZJTEUsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU9ImRpcmVjdCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg9b3MucGF0aC5qb2luKGZlZGVyYXRlZF9sZWFybmluZ19sb2NhbF9kYXRhX2ZvbGRlciwgInNpbG8xX2lucHV0Mi50eHQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXN0b3JlPWRhdGFzdG9yZXNbMF0ubmFtZSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgRmVkZXJhdGVkTGVhcm5pbmdTaWxvKAogICAgICAgICAgICAgICAgY29tcHV0ZT1jb21wdXRlc1sxXS5uYW1lLAogICAgICAgICAgICAgICAgZGF0YXN0b3JlPWRhdGFzdG9yZXNbMV0ubmFtZSwKICAgICAgICAgICAgICAgIGlucHV0cz17CiAgICAgICAgICAgICAgICAgICAgInJhd190cmFpbl9kYXRhIjogSW5wdXQoCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5VUklfRklMRSwKICAgICAgICAgICAgICAgICAgICAgICAgbW9kZT0ibW91bnQiLAogICAgICAgICAgICAgICAgICAgICAgICBwYXRoPW9zLnBhdGguam9pbihmZWRlcmF0ZWRfbGVhcm5pbmdfbG9jYWxfZGF0YV9mb2xkZXIsICJzaWxvMl9pbnB1dDEudHh0IiksCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzdG9yZT1kYXRhc3RvcmVzWzFdLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAicmF3X3Rlc3RfZGF0YSI6IElucHV0KAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuVVJJX0ZJTEUsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU9ImRpcmVjdCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg9b3MucGF0aC5qb2luKGZlZGVyYXRlZF9sZWFybmluZ19sb2NhbF9kYXRhX2ZvbGRlciwgInNpbG8yX2lucHV0Mi50eHQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXN0b3JlPWRhdGFzdG9yZXNbMV0ubmFtZSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgRmVkZXJhdGVkTGVhcm5pbmdTaWxvKAogICAgICAgICAgICAgICAgY29tcHV0ZT1jb21wdXRlc1syXS5uYW1lLAogICAgICAgICAgICAgICAgZGF0YXN0b3JlPWRhdGFzdG9yZXNbMl0ubmFtZSwKICAgICAgICAgICAgICAgIGlucHV0cz17CiAgICAgICAgICAgICAgICAgICAgInJhd190cmFpbl9kYXRhIjogSW5wdXQoCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5VUklfRklMRSwKICAgICAgICAgICAgICAgICAgICAgICAgbW9kZT0ibW91bnQiLAogICAgICAgICAgICAgICAgICAgICAgICBwYXRoPW9zLnBhdGguam9pbihmZWRlcmF0ZWRfbGVhcm5pbmdfbG9jYWxfZGF0YV9mb2xkZXIsICJzaWxvM19pbnB1dDEudHh0IiksCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzdG9yZT1kYXRhc3RvcmVzWzJdLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAicmF3X3Rlc3RfZGF0YSI6IElucHV0KAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuVVJJX0ZJTEUsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU9Im1vdW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aD1vcy5wYXRoLmpvaW4oZmVkZXJhdGVkX2xlYXJuaW5nX2xvY2FsX2RhdGFfZm9sZGVyLCAic2lsbzNfaW5wdXQyLnR4dCIpLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhc3RvcmU9ZGF0YXN0b3Jlc1syXS5uYW1lLAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApLAogICAgICAgIF0KCiAgICAgICAgc2lsb190b19hZ2dyZWdhdGlvbl9hcmd1bWVudF9tYXAgPSB7Im1vZGVsIjogInNpbG9faW5wdXRzIn0KICAgICAgICBhZ2dyZWdhdGlvbl90b19zaWxvX2FyZ3VtZW50X21hcCA9IHsiYWdncmVnYXRlZF9vdXRwdXQiOiAiY2hlY2twb2ludCJ9CgogICAgICAgICMgT3RoZXIgYXJncwogICAgICAgIGl0ZXJhdGlvbnMgPSAzCiAgICAgICAgc2lsb19rd2FyZ3MgPSB7fQogICAgICAgIGFnZ19rd2FyZ3MgPSB7fQogICAgICAgIGFnZ3JlZ2F0aW9uX2NvbXB1dGUgPSBjb21wdXRlc1szXS5uYW1lCiAgICAgICAgYWdncmVnYXRpb25fZGF0YXN0b3JlID0gZGF0YXN0b3Jlc1szXS5uYW1lCgogICAgICAgICMgRGVmaW5lIHRoZSBmbCBwaXBlbGluZQogICAgICAgIGZsX25vZGUgPSBmbF9zY2F0dGVyX2dhdGhlcigKICAgICAgICAgICAgc2lsb19jb25maWdzPXNpbG9fY29uZmlncywKICAgICAgICAgICAgc2lsb19jb21wb25lbnQ9c2lsb19zdGVwX2Z1bmMsCiAgICAgICAgICAgIGFnZ3JlZ2F0aW9uX2NvbXBvbmVudD1hZ2dyZWdhdGlvbl9zdGVwLAogICAgICAgICAgICBhZ2dyZWdhdGlvbl9jb21wdXRlPWFnZ3JlZ2F0aW9uX2NvbXB1dGUsCiAgICAgICAgICAgIGFnZ3JlZ2F0aW9uX2RhdGFzdG9yZT1hZ2dyZWdhdGlvbl9kYXRhc3RvcmUsCiAgICAgICAgICAgIHNoYXJlZF9zaWxvX2t3YXJncz1zaWxvX2t3YXJncywKICAgICAgICAgICAgYWdncmVnYXRpb25fa3dhcmdzPWFnZ19rd2FyZ3MsCiAgICAgICAgICAgIHNpbG9fdG9fYWdncmVnYXRpb25fYXJndW1lbnRfbWFwPXNpbG9fdG9fYWdncmVnYXRpb25fYXJndW1lbnRfbWFwLAogICAgICAgICAgICBhZ2dyZWdhdGlvbl90b19zaWxvX2FyZ3VtZW50X21hcD1hZ2dyZWdhdGlvbl90b19zaWxvX2FyZ3VtZW50X21hcCwKICAgICAgICAgICAgbWF4X2l0ZXJhdGlvbnM9aXRlcmF0aW9ucywKICAgICAgICApCgogICAgICAgICMgY3JlYXRlIGFuZCBzdWJtaXQgdGhlIHBpcGVsaW5lIGpvYgogICAgICAgIHN1Ym1pdHRlZF9waXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKAogICAgICAgICAgICBmbF9ub2RlLnNjYXR0ZXJfZ2F0aGVyX2dyYXBoLCBleHBlcmltZW50X25hbWU9ImV4YW1wbGVfZmxfcGlwZWxpbmUiCiAgICAgICAgKQogICAgICAgIHByaW50KCJTdWJtaXR0ZWQgcGlwZWxpbmUgam9iOiB7fSIuZm9ybWF0KHN1Ym1pdHRlZF9waXBlbGluZV9qb2IuaWQpKQogICAgICAgIHN1YmdyYXBoID0gc3VibWl0dGVkX3BpcGVsaW5lX2pvYi5jb21wb25lbnQuam9icwoKICAgICAgICAjIFVuZm9ydHVuYXRlbHkgZXhlY3V0ZWQgcGlwZWxpbmVzIGRvbid0IHJldHVybiBpbnRlcmlvciB2YWx1ZXMgb2Ygc3ViLXBpcGVsaW5lcywKICAgICAgICAjIHNvIHdlIGNhbid0IGluc3BlY3QgaW50ZXJuYWwgZGF0YXN0b3JlcyBvciBjb21wdXRlcyBpbiBzaWxvIHN0ZXBzCiAgICAgICAgYXNzZXJ0ICJzY2F0dGVyX2dhdGhlcl9ib2R5IiBpbiBzdWJncmFwaAogICAgICAgIHNjYXR0ZXJfZ2F0aGVyX2JvZHkgPSBzdWJncmFwaFsic2NhdHRlcl9nYXRoZXJfYm9keSJdCiAgICAgICAgYXNzZXJ0IHNjYXR0ZXJfZ2F0aGVyX2JvZHkudHlwZSA9PSAicGlwZWxpbmUiCiAgICAgICAgYXNzZXJ0IGFsbChzaWxvX2lucHV0IGluIHNjYXR0ZXJfZ2F0aGVyX2JvZHkuaW5wdXRzIGZvciBzaWxvX2lucHV0IGluIHNpbG9fa3dhcmdzKQogICAgICAgIGFzc2VydCBhbGwoc2lsb19pbnB1dCBpbiBzY2F0dGVyX2dhdGhlcl9ib2R5LmlucHV0cyBmb3Igc2lsb19pbnB1dCBpbiBhZ2dyZWdhdGlvbl90b19zaWxvX2FyZ3VtZW50X21hcC52YWx1ZXMoKSkKICAgICAgICBhc3NlcnQgYWxsKGFnZ19vdXRwdXQgaW4gc2NhdHRlcl9nYXRoZXJfYm9keS5vdXRwdXRzIGZvciBhZ2dfb3V0cHV0IGluIGFnZ3JlZ2F0aW9uX3RvX3NpbG9fYXJndW1lbnRfbWFwKQo=",
      "StatusCode": 201,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Content-MD5": "Bf2zKM/VFLU1K2yMYkGmbw==",
        "Date": "Tue, 30 May 2023 07:29:02 GMT",
        "ETag": "\u00220x8DB60DF8AF3A83D\u0022",
        "Last-Modified": "Tue, 30 May 2023 07:29:02 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-content-crc64": "nvRzTOL/DNw=",
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://amltest5899420437.blob.core.windows.net/azureml-blobstore-0bdd51b6-cd9c-4978-b870-99997b393b81/LocalUpload/00000000000000000000000000000000/e2etests/__init__.py",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "0",
        "Content-Type": "application/octet-stream",
        "If-None-Match": "*",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)",
        "x-ms-blob-type": "BlockBlob",
        "x-ms-date": "Tue, 30 May 2023 07:28:59 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": null,
      "StatusCode": 201,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Content-MD5": "1B2M2Y8AsgTpgAmY7PhCfg==",
        "Date": "Tue, 30 May 2023 07:29:02 GMT",
        "ETag": "\u00220x8DB60DF8AF3A83D\u0022",
        "Last-Modified": "Tue, 30 May 2023 07:29:02 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-content-crc64": "AAAAAAAAAAA=",
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://amltest5899420437.blob.core.windows.net/azureml-blobstore-0bdd51b6-cd9c-4978-b870-99997b393b81/LocalUpload/00000000000000000000000000000000/e2etests/test_dsl_pipeline_on_registry.py",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "4441",
        "Content-MD5": "w4/WwgQjAnQ92uQlPcU6MQ==",
        "Content-Type": "application/octet-stream",
        "If-None-Match": "*",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)",
        "x-ms-blob-type": "BlockBlob",
        "x-ms-date": "Tue, 30 May 2023 07:28:59 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": "ZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCgppbXBvcnQgcHl0ZXN0CmZyb20gYXp1cmUuY29yZS5leGNlcHRpb25zIGltcG9ydCBSZXNvdXJjZU5vdEZvdW5kRXJyb3IKCmZyb20gYXp1cmUuYWkubWwgaW1wb3J0IElucHV0LCBNTENsaWVudCwgbG9hZF9jb21wb25lbnQsIGxvYWRfbW9kZWwKZnJvbSBhenVyZS5haS5tbC5jb25zdGFudHMgaW1wb3J0IEFzc2V0VHlwZXMKZnJvbSBhenVyZS5haS5tbC5kc2wgaW1wb3J0IHBpcGVsaW5lCmZyb20gZGV2dG9vbHNfdGVzdHV0aWxzIGltcG9ydCBBenVyZVJlY29yZGVkVGVzdENhc2UsIGlzX2xpdmUKZnJvbSB0ZXN0X3V0aWxpdGllcy51dGlscyBpbXBvcnQgX1BZVEVTVF9USU1FT1VUX01FVEhPRCwgYXNzZXJ0X2pvYl9jYW5jZWwKZnJvbSAuLl91dGlsIGltcG9ydCBfRFNMX1RJTUVPVVRfU0VDT05ECgoKZGVmIGFzc2VydF9waXBlbGluZV9qb2JfY2FuY2VsKGNsaWVudDogTUxDbGllbnQsIHNjb3JlX2Z1bmMsIHBpcGVsaW5lX21vZGVsX2lucHV0LCBwaXBlbGluZV90ZXN0X2RhdGEpOgogICAgQHBpcGVsaW5lCiAgICBkZWYgc2NvcmVfcGlwZWxpbmUobW9kZWxfaW5wdXQsIHRlc3RfZGF0YSk6CiAgICAgICAgc2NvcmUgPSBzY29yZV9mdW5jKG1vZGVsX2lucHV0PW1vZGVsX2lucHV0LCB0ZXN0X2RhdGE9dGVzdF9kYXRhKSAgIyBub3FhOiBGODQxCiAgICAgICAgc2NvcmVfZHVwbGljYXRlID0gc2NvcmVfZnVuYyhtb2RlbF9pbnB1dD1tb2RlbF9pbnB1dCwgdGVzdF9kYXRhPXRlc3RfZGF0YSkgICMgbm9xYTogRjg0MQoKICAgIHBpcGVsaW5lX2pvYiA9IHNjb3JlX3BpcGVsaW5lKG1vZGVsX2lucHV0PXBpcGVsaW5lX21vZGVsX2lucHV0LCB0ZXN0X2RhdGE9cGlwZWxpbmVfdGVzdF9kYXRhKQogICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQoKCkBweXRlc3QubWFyay5za2lwaWYoY29uZGl0aW9uPW5vdCBpc19saXZlKCksIHJlYXNvbj0icmVnaXN0cnkgdGVzdCwgbWF5IGZhaWwgaW4gcGxheWJhY2sgbW9kZSIpCkBweXRlc3QubWFyay51c2VmaXh0dXJlcygiZW5hYmxlX3BpcGVsaW5lX3ByaXZhdGVfcHJldmlld19mZWF0dXJlcyIsICJyZWNvcmRlZF90ZXN0IikKQHB5dGVzdC5tYXJrLnRpbWVvdXQodGltZW91dD1fRFNMX1RJTUVPVVRfU0VDT05ELCBtZXRob2Q9X1BZVEVTVF9USU1FT1VUX01FVEhPRCkKQHB5dGVzdC5tYXJrLmUyZXRlc3QKQHB5dGVzdC5tYXJrLnBpcGVsaW5lX3Rlc3QKY2xhc3MgVGVzdERTTFBpcGVsaW5lT25SZWdpc3RyeShBenVyZVJlY29yZGVkVGVzdENhc2UpOgogICAgdGVzdF9kYXRhID0gSW5wdXQoCiAgICAgICAgdHlwZT1Bc3NldFR5cGVzLlVSSV9GSUxFLAogICAgICAgIHBhdGg9Ii4vdGVzdHMvdGVzdF9jb25maWdzL3BpcGVsaW5lX2pvYnMvam9iX3dpdGhfcmVnaXN0cnlfbW9kZWxfYXNfaW5wdXQvZGF0YS9zYW1wbGUxLmNzdiIsCiAgICApCgogICAgZGVmIHRlc3RfcGlwZWxpbmVfam9iX2NyZWF0ZV93aXRoX3JlZ2lzdGVyZWRfY29tcG9uZW50X29uX3JlZ2lzdHJ5KHNlbGYsIHBpcGVsaW5lc19yZWdpc3RyeV9jbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBsb2NhbF9jb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudCgiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9iYXNpY19jb21wb25lbnRfY29kZV9sb2NhbF9wYXRoLnltbCIpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjcmVhdGVkX2NvbXBvbmVudCA9IHBpcGVsaW5lc19yZWdpc3RyeV9jbGllbnQuY29tcG9uZW50cy5nZXQoCiAgICAgICAgICAgICAgICBsb2NhbF9jb21wb25lbnQubmFtZSwgdmVyc2lvbj1sb2NhbF9jb21wb25lbnQudmVyc2lvbgogICAgICAgICAgICApCiAgICAgICAgZXhjZXB0IFJlc291cmNlTm90Rm91bmRFcnJvcjoKICAgICAgICAgICAgY3JlYXRlZF9jb21wb25lbnQgPSBwaXBlbGluZXNfcmVnaXN0cnlfY2xpZW50LmNvbXBvbmVudHMuY3JlYXRlX29yX3VwZGF0ZShsb2NhbF9jb21wb25lbnQpCgogICAgICAgIEBwaXBlbGluZQogICAgICAgIGRlZiBzYW1wbGVfcGlwZWxpbmUoKToKICAgICAgICAgICAgY3JlYXRlZF9jb21wb25lbnQoKQoKICAgICAgICBwaXBlbGluZV9qb2IgPSBzYW1wbGVfcGlwZWxpbmUoKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCiAgICAgICAgYXNzZXJ0IHBpcGVsaW5lc19yZWdpc3RyeV9jbGllbnQuam9icy52YWxpZGF0ZShwaXBlbGluZV9qb2IpLnBhc3NlZAoKICAgICMgdGhpcyB0ZXN0IHdpbGwgYnJlYWsgaW4gcGxheWJhY2sgbW9kZSwgc28gaW5jbHVkZSBpdCBpbiBsaXZlIHRlc3Qgb25seQogICAgZGVmIHRlc3RfcGlwZWxpbmVfd2l0aF9sb2NhbF9jb21wb25lbnRfYW5kX3JlZ2lzdHJ5X21vZGVsX2FzX2lucHV0KHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgICMgbG9hZF9jb21wb25lbnQKICAgICAgICBzY29yZV9mdW5jID0gbG9hZF9jb21wb25lbnQoIi4vdGVzdHMvdGVzdF9jb25maWdzL3BpcGVsaW5lX2pvYnMvam9iX3dpdGhfcmVnaXN0cnlfbW9kZWxfYXNfaW5wdXQvc2NvcmUueW1sIikKCiAgICAgICAgcGlwZWxpbmVfc2NvcmVfbW9kZWwgPSBJbnB1dCgKICAgICAgICAgICAgdHlwZT0iY3VzdG9tX21vZGVsIiwgcGF0aD0iYXp1cmVtbDovL3JlZ2lzdHJpZXMvc2RrLXRlc3QvbW9kZWxzL2lyaXNfbW9kZWwvdmVyc2lvbnMvMSIKICAgICAgICApCgogICAgICAgIGFzc2VydF9waXBlbGluZV9qb2JfY2FuY2VsKGNsaWVudCwgc2NvcmVfZnVuYywgcGlwZWxpbmVfc2NvcmVfbW9kZWwsIHNlbGYudGVzdF9kYXRhKQoKICAgIGRlZiB0ZXN0X3BpcGVsaW5lX3dpdGhfbG9jYWxfY29tcG9uZW50X2FuZF9yZWdpc3RyeV9tb2RlbF9hc19pbnB1dF93aXRoX21vZGVsX2lucHV0KAogICAgICAgIHNlbGYsIGNsaWVudDogTUxDbGllbnQsIHBpcGVsaW5lc19yZWdpc3RyeV9jbGllbnQ6IE1MQ2xpZW50CiAgICApOgogICAgICAgICMgbG9hZF9jb21wb25lbnQKICAgICAgICBzY29yZV9mdW5jID0gbG9hZF9jb21wb25lbnQoIi4vdGVzdHMvdGVzdF9jb25maWdzL3BpcGVsaW5lX2pvYnMvam9iX3dpdGhfcmVnaXN0cnlfbW9kZWxfYXNfaW5wdXQvc2NvcmUueW1sIikKCiAgICAgICAgbW9kZWxfcGF0aCA9IFBhdGgoIi4vdGVzdHMvdGVzdF9jb25maWdzL21vZGVsL21vZGVsX2lyaXMueW1sIikKICAgICAgICBtb2RlbF9lbnRpdHkgPSBsb2FkX21vZGVsKG1vZGVsX3BhdGgpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwaXBlbGluZV9zY29yZV9tb2RlbCA9IHBpcGVsaW5lc19yZWdpc3RyeV9jbGllbnQubW9kZWxzLmdldCgKICAgICAgICAgICAgICAgIG5hbWU9bW9kZWxfZW50aXR5Lm5hbWUsIHZlcnNpb249bW9kZWxfZW50aXR5LnZlcnNpb24KICAgICAgICAgICAgKQogICAgICAgIGV4Y2VwdCBSZXNvdXJjZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgICAgIG1vZGVsX2VudGl0eSA9IHBpcGVsaW5lc19yZWdpc3RyeV9jbGllbnQubW9kZWxzLmNyZWF0ZV9vcl91cGRhdGUobW9kZWxfZW50aXR5KQogICAgICAgICAgICBwaXBlbGluZV9zY29yZV9tb2RlbCA9IHBpcGVsaW5lc19yZWdpc3RyeV9jbGllbnQubW9kZWxzLmdldCgKICAgICAgICAgICAgICAgIG5hbWU9bW9kZWxfZW50aXR5Lm5hbWUsIHZlcnNpb249bW9kZWxfZW50aXR5LnZlcnNpb24KICAgICAgICAgICAgKQoKICAgICAgICBhc3NlcnRfcGlwZWxpbmVfam9iX2NhbmNlbChjbGllbnQsIHNjb3JlX2Z1bmMsIHBpcGVsaW5lX3Njb3JlX21vZGVsLCBzZWxmLnRlc3RfZGF0YSkKCiAgICBkZWYgdGVzdF9waXBlbGluZV93aXRoX3JlZ2lzdHJ5X2NvbXBvbmVudF9hbmRfbW9kZWxfYXNfaW5wdXQoCiAgICAgICAgc2VsZiwgY2xpZW50OiBNTENsaWVudCwgcGlwZWxpbmVzX3JlZ2lzdHJ5X2NsaWVudDogTUxDbGllbnQKICAgICk6CiAgICAgICAgIyBsb2FkX2NvbXBvbmVudAogICAgICAgIHNjb3JlX2NvbXBvbmVudF9uYW1lLCBjb21wb25lbnRfdmVyc2lvbiA9ICJzY29yZV9jb21wb25lbnQiLCAiMiIKICAgICAgICBzY29yZV9mdW5jID0gcGlwZWxpbmVzX3JlZ2lzdHJ5X2NsaWVudC5jb21wb25lbnRzLmdldChuYW1lPXNjb3JlX2NvbXBvbmVudF9uYW1lLCB2ZXJzaW9uPWNvbXBvbmVudF92ZXJzaW9uKQoKICAgICAgICBwaXBlbGluZV9zY29yZV9tb2RlbCA9IElucHV0KAogICAgICAgICAgICB0eXBlPSJtbGZsb3dfbW9kZWwiLCBwYXRoPSJhenVyZW1sOi8vcmVnaXN0cmllcy9zZGstdGVzdC9tb2RlbHMvaXJpc19tb2RlbC92ZXJzaW9ucy8xIgogICAgICAgICkKCiAgICAgICAgYXNzZXJ0X3BpcGVsaW5lX2pvYl9jYW5jZWwoY2xpZW50LCBzY29yZV9mdW5jLCBwaXBlbGluZV9zY29yZV9tb2RlbCwgc2VsZi50ZXN0X2RhdGEpCg==",
      "StatusCode": 201,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Content-MD5": "w4/WwgQjAnQ92uQlPcU6MQ==",
        "Date": "Tue, 30 May 2023 07:29:02 GMT",
        "ETag": "\u00220x8DB60DF8AF41D5C\u0022",
        "Last-Modified": "Tue, 30 May 2023 07:29:02 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-content-crc64": "5gxaAnUt0/8=",
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://amltest5899420437.blob.core.windows.net/azureml-blobstore-0bdd51b6-cd9c-4978-b870-99997b393b81/LocalUpload/00000000000000000000000000000000/e2etests/test_dsl_pipeline_samples.py",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "19621",
        "Content-MD5": "hmticOSCNGEfz3uj9VsbFA==",
        "Content-Type": "application/octet-stream",
        "If-None-Match": "*",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)",
        "x-ms-blob-type": "BlockBlob",
        "x-ms-date": "Tue, 30 May 2023 07:28:59 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": "IiIiClRoaXMgZmlsZSBjb3ZlcnMgYWxsIHNhbXBsZSBwaXBlbGluZSBpbiBodHRwczovL2dpdGh1Yi5jb20vQXp1cmUvYXp1cmVtbC1wcmV2aWV3cy90cmVlL21haW4vcHJldmlld3MvcGlwZWxpbmVzL3NhbXBsZXMKaW4gZHNsLnBpcGVsaW5lLgpUaGUgc2FtcGxlcyBhcmUgY29waWVkIHRvIHRlc3RfY29uZmlncy9kc2xfcGlwZWxpbmVfc2FtcGxlcwoiIiIKaW1wb3J0IGpzb24KaW1wb3J0IHN5cwpmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKCmltcG9ydCBweWRhc2gKaW1wb3J0IHB5dGVzdApmcm9tIGRldnRvb2xzX3Rlc3R1dGlscyBpbXBvcnQgQXp1cmVSZWNvcmRlZFRlc3RDYXNlLCBpc19saXZlCmZyb20gdGVzdF91dGlsaXRpZXMudXRpbHMgaW1wb3J0IF9QWVRFU1RfVElNRU9VVF9NRVRIT0QsIGFzc2VydF9qb2JfY2FuY2VsCgpmcm9tIGF6dXJlLmFpLm1sIGltcG9ydCBNTENsaWVudCwgbG9hZF9qb2IKZnJvbSBhenVyZS5haS5tbC5lbnRpdGllcyBpbXBvcnQgQ29tcG9uZW50IGFzIENvbXBvbmVudEVudGl0eQpmcm9tIGF6dXJlLmFpLm1sLmVudGl0aWVzIGltcG9ydCBQaXBlbGluZUpvYgpmcm9tIGF6dXJlLmFpLm1sLm9wZXJhdGlvbnMuX3J1bl9oaXN0b3J5X2NvbnN0YW50cyBpbXBvcnQgSm9iU3RhdHVzCgpmcm9tIC4uX3V0aWwgaW1wb3J0IF9EU0xfVElNRU9VVF9TRUNPTkQKCnRlc3RzX3Jvb3RfZGlyID0gUGF0aChfX2ZpbGVfXykucGFyZW50LnBhcmVudC5wYXJlbnQKc3lzLnBhdGguaW5zZXJ0KDAsIHN0cih0ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MiKSkKc2FtcGxlc19kaXIgPSB0ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvZHNsX3BpcGVsaW5lLyIKCgpkZWYgYXNzZXJ0X2pvYl9jb21wbGV0ZWQocGlwZWxpbmUsIGNsaWVudDogTUxDbGllbnQpOgogICAgam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSkKICAgIGNsaWVudC5qb2JzLnN0cmVhbShqb2IubmFtZSkKICAgIGFzc2VydCBjbGllbnQuam9icy5nZXQoam9iLm5hbWUpLnN0YXR1cyA9PSBKb2JTdGF0dXMuQ09NUExFVEVECgoKZGVmIGFzc2VydF9kc2xfY3VyYXRlZChwaXBlbGluZTogUGlwZWxpbmVKb2IsIGpvYl95YW1sLCBvbWl0X2ZpZWxkcyk6CiAgICBkc2xfcGlwZWxpbmVfam9iX2RpY3QgPSBwaXBlbGluZS5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCkKICAgIHBpcGVsaW5lX2pvYl9kaWN0ID0gbG9hZF9qb2Ioc291cmNlPWpvYl95YW1sKS5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCkKCiAgICBkc2xfcGlwZWxpbmVfam9iX2RpY3QgPSBweWRhc2gub21pdChkc2xfcGlwZWxpbmVfam9iX2RpY3QsIG9taXRfZmllbGRzKQogICAgcGlwZWxpbmVfam9iX2RpY3QgPSBweWRhc2gub21pdChwaXBlbGluZV9qb2JfZGljdCwgb21pdF9maWVsZHMpCiAgICBwcmludChqc29uLmR1bXBzKGRzbF9waXBlbGluZV9qb2JfZGljdCwgaW5kZW50PTIpKQogICAgcHJpbnQoanNvbi5kdW1wcyhwaXBlbGluZV9qb2JfZGljdCwgaW5kZW50PTIpKQogICAgYXNzZXJ0IGRzbF9waXBlbGluZV9qb2JfZGljdCA9PSBwaXBlbGluZV9qb2JfZGljdAoKCkBweXRlc3QubWFyay51c2VmaXh0dXJlcygKICAgICJlbmFibGVfZW52aXJvbm1lbnRfaWRfYXJtX2V4cGFuc2lvbiIsCiAgICAiZW5hYmxlX3BpcGVsaW5lX3ByaXZhdGVfcHJldmlld19mZWF0dXJlcyIsCiAgICAibW9ja19jb2RlX2hhc2giLAogICAgIm1vY2tfY29tcG9uZW50X2hhc2giLAogICAgIm1vY2tfc2V0X2hlYWRlcnNfd2l0aF91c2VyX2FtbF90b2tlbiIsCiAgICAicmVjb3JkZWRfdGVzdCIsCiAgICAibW9ja19hc3NldF9uYW1lIiwKICAgICJtb2NrX2Fub25fY29tcG9uZW50X3ZlcnNpb24iLAopCkBweXRlc3QubWFyay50aW1lb3V0KHRpbWVvdXQ9X0RTTF9USU1FT1VUX1NFQ09ORCwgbWV0aG9kPV9QWVRFU1RfVElNRU9VVF9NRVRIT0QpCkBweXRlc3QubWFyay5lMmV0ZXN0CkBweXRlc3QubWFyay5waXBlbGluZV90ZXN0CmNsYXNzIFRlc3REU0xQaXBlbGluZVNhbXBsZXMoQXp1cmVSZWNvcmRlZFRlc3RDYXNlKToKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9lMmVfbG9jYWxfY29tcG9uZW50cyhzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5lMmVfbG9jYWxfY29tcG9uZW50cy5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgZTJlX2xvY2FsX2NvbXBvbmVudHMsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IGUyZV9sb2NhbF9jb21wb25lbnRzKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9lMmVfcmVnaXN0ZXJlZF9jb21wb25lbnRzKAogICAgICAgIHNlbGYsCiAgICAgICAgY2xpZW50OiBNTENsaWVudCwKICAgICAgICBwaXBlbGluZV9zYW1wbGVzX2UyZV9yZWdpc3RlcmVkX3RyYWluX2NvbXBvbmVudHM6IENvbXBvbmVudEVudGl0eSwKICAgICAgICBwaXBlbGluZV9zYW1wbGVzX2UyZV9yZWdpc3RlcmVkX3Njb3JlX2NvbXBvbmVudHM6IENvbXBvbmVudEVudGl0eSwKICAgICAgICBwaXBlbGluZV9zYW1wbGVzX2UyZV9yZWdpc3RlcmVkX2V2YWxfY29tcG9uZW50czogQ29tcG9uZW50RW50aXR5LAogICAgKSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5lMmVfcmVnaXN0ZXJlZF9jb21wb25lbnRzLnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIGdlbmVyYXRlX2RzbF9waXBlbGluZSBhcyBlMmVfcmVnaXN0ZXJlZF9jb21wb25lbnRzLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBlMmVfcmVnaXN0ZXJlZF9jb21wb25lbnRzKAogICAgICAgICAgICBjbGllbnQ9Y2xpZW50LAogICAgICAgICAgICBwaXBlbGluZV9zYW1wbGVzX2UyZV9yZWdpc3RlcmVkX3RyYWluX2NvbXBvbmVudHM9cGlwZWxpbmVfc2FtcGxlc19lMmVfcmVnaXN0ZXJlZF90cmFpbl9jb21wb25lbnRzLAogICAgICAgICAgICBwaXBlbGluZV9zYW1wbGVzX2UyZV9yZWdpc3RlcmVkX3Njb3JlX2NvbXBvbmVudHM9cGlwZWxpbmVfc2FtcGxlc19lMmVfcmVnaXN0ZXJlZF9zY29yZV9jb21wb25lbnRzLAogICAgICAgICAgICBwaXBlbGluZV9zYW1wbGVzX2UyZV9yZWdpc3RlcmVkX2V2YWxfY29tcG9uZW50cz1waXBlbGluZV9zYW1wbGVzX2UyZV9yZWdpc3RlcmVkX2V2YWxfY29tcG9uZW50cywKICAgICAgICApCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKICAgICAgICAjIG1vdmUgdW5pdCB0ZXN0IGhlcmUgZHVlIHRvIHBlcm1pc3Npb24gcHJvYmxlbQogICAgICAgIGpvYl95YW1sID0gc3RyKHNhbXBsZXNfZGlyIC8gImUyZV9yZWdpc3RlcmVkX2NvbXBvbmVudHMvcGlwZWxpbmUueW1sIikKICAgICAgICBvbWl0X2ZpZWxkcyA9IFsKICAgICAgICAgICAgInByb3BlcnRpZXMuZXhwZXJpbWVudF9uYW1lIiwKICAgICAgICAgICAgIm5hbWUiLAogICAgICAgICAgICAicHJvcGVydGllcy5qb2JzLnRyYWluX2pvYi5jb21wb25lbnRJZCIsCiAgICAgICAgICAgICJwcm9wZXJ0aWVzLmpvYnMuc2NvcmVfam9iLmNvbXBvbmVudElkIiwKICAgICAgICAgICAgInByb3BlcnRpZXMuam9icy5ldmFsdWF0ZV9qb2IuY29tcG9uZW50SWQiLAogICAgICAgICAgICAicHJvcGVydGllcy5qb2JzLnRyYWluX2pvYi5yZXNvdXJjZXMiLCAgIyBqb2IgeWFtbCB3b24ndCBoYXZlIHJlc291cmNlcyBidXQgd2Ugd2lsbCBwYXNzIHRoZW0KICAgICAgICAgICAgInByb3BlcnRpZXMuam9icy5zY29yZV9qb2IucmVzb3VyY2VzIiwKICAgICAgICAgICAgInByb3BlcnRpZXMuam9icy5ldmFsdWF0ZV9qb2IucmVzb3VyY2VzIiwKICAgICAgICAgICAgInByb3BlcnRpZXMuaW5wdXRzLnBpcGVsaW5lX2pvYl90cmFpbmluZ19pbnB1dC51cmkiLAogICAgICAgICAgICAicHJvcGVydGllcy5pbnB1dHMucGlwZWxpbmVfam9iX3Rlc3RfaW5wdXQudXJpIiwKICAgICAgICAgICAgInByb3BlcnRpZXMucHJvcGVydGllcyIsCiAgICAgICAgICAgICJwcm9wZXJ0aWVzLmNvbXB1dGVfaWQiLAogICAgICAgICAgICAicHJvcGVydGllcy5zZXR0aW5ncyIsCiAgICAgICAgXQogICAgICAgIGFzc2VydF9kc2xfY3VyYXRlZChwaXBlbGluZSwgam9iX3lhbWwsIG9taXRfZmllbGRzKQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9iYXNpY19jb21wb25lbnQoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuYmFzaWNfY29tcG9uZW50LnBpcGVsaW5lIGltcG9ydCBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgYmFzaWNfY29tcG9uZW50CgogICAgICAgIHBpcGVsaW5lID0gYmFzaWNfY29tcG9uZW50KCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9jb21wb25lbnRfd2l0aF9pbnB1dF9vdXRwdXQoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuY29tcG9uZW50X3dpdGhfaW5wdXRfb3V0cHV0LnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIGdlbmVyYXRlX2RzbF9waXBlbGluZSBhcyBjb21wb25lbnRfd2l0aF9pbnB1dF9vdXRwdXQsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IGNvbXBvbmVudF93aXRoX2lucHV0X291dHB1dCgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfYmFzaWNfcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuYmFzaWNfcGlwZWxpbmUucGlwZWxpbmUgaW1wb3J0IGdlbmVyYXRlX2RzbF9waXBlbGluZSBhcyBiYXNpY19waXBlbGluZQoKICAgICAgICBwaXBlbGluZSA9IGJhc2ljX3BpcGVsaW5lKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9waXBlbGluZV93aXRoX2RhdGEoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUucGlwbGluZV93aXRoX2RhdGEucGlwZWxpbmUgaW1wb3J0IGdlbmVyYXRlX2RzbF9waXBlbGluZSBhcyBwaXBsaW5lX3dpdGhfZGF0YQoKICAgICAgICBwaXBlbGluZSA9IHBpcGxpbmVfd2l0aF9kYXRhKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9sb2NhbF9kYXRhX2lucHV0KHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLmxvY2FsX2RhdGFfaW5wdXQucGlwZWxpbmUgaW1wb3J0IGdlbmVyYXRlX2RzbF9waXBlbGluZSBhcyBsb2NhbF9kYXRhX2lucHV0CgogICAgICAgIHBpcGVsaW5lID0gbG9jYWxfZGF0YV9pbnB1dCgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfZGF0YXN0b3JlX2RhdGFwYXRoX3VyaV9mb2xkZXIoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuZGF0YXN0b3JlX2RhdGFwYXRoX3VyaV9mb2xkZXIucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIGRhdGFzdG9yZV9kYXRhcGF0aF91cmlfZm9sZGVyLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBkYXRhc3RvcmVfZGF0YXBhdGhfdXJpX2ZvbGRlcigpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfZGF0YXN0b3JlX2RhdGFwYXRoX3VyaV9maWxlKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLmRhdGFzdG9yZV9kYXRhcGF0aF91cmlfZmlsZS5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgZGF0YXN0b3JlX2RhdGFwYXRoX3VyaV9maWxlLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBkYXRhc3RvcmVfZGF0YXBhdGhfdXJpX2ZpbGUoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X2RhdGFzZXRfaW5wdXQoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuZGF0YXNldF9pbnB1dC5waXBlbGluZSBpbXBvcnQgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIGRhdGFzZXRfaW5wdXQKCiAgICAgICAgcGlwZWxpbmUgPSBkYXRhc2V0X2lucHV0KGNsaWVudCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF93ZWJfdXJsX2lucHV0KHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLndlYl91cmxfaW5wdXQucGlwZWxpbmUgaW1wb3J0IGdlbmVyYXRlX2RzbF9waXBlbGluZSBhcyB3ZWJfdXJsX2lucHV0CgogICAgICAgIHBpcGVsaW5lID0gd2ViX3VybF9pbnB1dCgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfZW52X3B1YmxpY19kb2NrZXJfaW1hZ2Uoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuZW52X3B1YmxpY19kb2NrZXJfaW1hZ2UucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIGVudl9wdWJsaWNfZG9ja2VyX2ltYWdlLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBlbnZfcHVibGljX2RvY2tlcl9pbWFnZSgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfZW52X3JlZ2lzdGVyZWQoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuZW52X3JlZ2lzdGVyZWQucGlwZWxpbmUgaW1wb3J0IGdlbmVyYXRlX2RzbF9waXBlbGluZSBhcyBlbnZfcmVnaXN0ZXJlZAoKICAgICAgICBwaXBlbGluZSA9IGVudl9yZWdpc3RlcmVkKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9lbnZfY29uZGFfZmlsZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5lbnZfY29uZGFfZmlsZS5waXBlbGluZSBpbXBvcnQgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIGVudl9jb25kYV9maWxlCgogICAgICAgIHBpcGVsaW5lID0gZW52X2NvbmRhX2ZpbGUoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X3RmX2hlbGxvX3dvcmxkKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLnRmX2hlbGxvX3dvcmxkLnBpcGVsaW5lIGltcG9ydCBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgdGZfaGVsbG9fd29ybGQKCiAgICAgICAgcGlwZWxpbmUgPSB0Zl9oZWxsb193b3JsZCgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfbXBpX2hlbGxvX3dvcmxkKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLm1waV9oZWxsb193b3JsZC5waXBlbGluZSBpbXBvcnQgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIG1waV9oZWxsb193b3JsZAoKICAgICAgICBwaXBlbGluZSA9IG1waV9oZWxsb193b3JsZCgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfcHl0b3JjaF9oZWxsb193b3JsZChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5weXRvcmNoX2hlbGxvX3dvcmxkLnBpcGVsaW5lIGltcG9ydCBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgcHl0b3JjaF9oZWxsb193b3JsZAoKICAgICAgICBwaXBlbGluZSA9IHB5dG9yY2hfaGVsbG9fd29ybGQoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X255Y190YXhpX2RhdGFfcmVncmVzc2lvbihzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5ueWNfdGF4aV9kYXRhX3JlZ3Jlc3Npb24ucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIG55Y190YXhpX2RhdGFfcmVncmVzc2lvbiwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gbnljX3RheGlfZGF0YV9yZWdyZXNzaW9uKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF90Zl9tbmlzdChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS50Zl9tbmlzdC5waXBlbGluZSBpbXBvcnQgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIHRmX21uaXN0CgogICAgICAgIHBpcGVsaW5lID0gdGZfbW5pc3QoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X2UyZV9pbmxpbmVfY29tcG9uZW50cyhzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5lMmVfaW5saW5lX2NvbXBvbmVudHMucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIGUyZV9pbmxpbmVfY29tcG9uZW50cywKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gZTJlX2lubGluZV9jb21wb25lbnRzKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay51c2VmaXh0dXJlcygibW9ja19hc3NldF9uYW1lIikKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9jb21tYW5kX2pvYl9pbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5jb21tYW5kX2pvYl9pbl9waXBlbGluZS5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgY29tbWFuZF9qb2JfaW5fcGlwZWxpbmUsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IGNvbW1hbmRfam9iX2luX3BpcGVsaW5lKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9tdWx0aV9wYXJhbGxlbF9jb21wb25lbnRzX3dpdGhfZmlsZV9pbnB1dF9waXBlbGluZV9vdXRwdXQoCiAgICAgICAgc2VsZiwKICAgICAgICBjbGllbnQ6IE1MQ2xpZW50LAogICAgKSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5wYXJhbGxlbF9jb21wb25lbnRfd2l0aF9maWxlX2lucHV0LnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIGdlbmVyYXRlX2RzbF9waXBlbGluZSBhcyBwaXBlbGluZV93aXRoX3BhcmFsbGVsX2NvbXBvbmVudHMsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX3dpdGhfcGFyYWxsZWxfY29tcG9uZW50cygpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfcGFyYWxsZWxfY29tcG9uZW50c193aXRoX3RhYnVsYXJfaW5wdXRfcGlwZWxpbmVfb3V0cHV0KHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLnBhcmFsbGVsX2NvbXBvbmVudF93aXRoX3RhYnVsYXJfaW5wdXQucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIHBpcGVsaW5lX3dpdGhfcGFyYWxsZWxfY29tcG9uZW50cywKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gcGlwZWxpbmVfd2l0aF9wYXJhbGxlbF9jb21wb25lbnRzKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9wYXJhbGxlbF9jb21wb25lbnRzKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLnBhcmFsbGVsX2NvbXBvbmVudC5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgcGlwZWxpbmVfd2l0aF9wYXJhbGxlbF9jb21wb25lbnRzLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV93aXRoX3BhcmFsbGVsX2NvbXBvbmVudHMoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X2F1dG9tbF9qb2JfaW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuYXV0b21sX2pvYl9pbl9waXBlbGluZS5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgYXV0b21sX2pvYl9pbl9waXBlbGluZSwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gYXV0b21sX2pvYl9pbl9waXBlbGluZSgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfcGlwZWxpbmVfd2l0aF9waXBlbGluZV9jb21wb25lbnQoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUucGlwZWxpbmVfd2l0aF9waXBlbGluZV9jb21wb25lbnQucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lIGFzIHBpcGVsaW5lX3dpdGhfcGlwZWxpbmVfY29tcG9uZW50LAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBwaXBlbGluZV93aXRoX3BpcGVsaW5lX2NvbXBvbmVudCgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfcGlwZWxpbmVfd2l0aF9kYXRhX2FzX2lucHV0c19mb3JfcGlwZWxpbmVfY29tcG9uZW50KHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLnBpcGVsaW5lX3dpdGhfcGlwZWxpbmVfY29tcG9uZW50LnBpcGVsaW5lX3dpdGhfZGF0YV9hc19pbnB1dCBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmUgYXMgcGlwZWxpbmVfd2l0aF9waXBlbGluZV9jb21wb25lbnQsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHBpcGVsaW5lX3dpdGhfcGlwZWxpbmVfY29tcG9uZW50KGNsaWVudCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9zcGFya19qb2JfaW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuc3Bhcmtfam9iX2luX3BpcGVsaW5lLnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIGdlbmVyYXRlX2RzbF9waXBlbGluZV9mcm9tX3lhbWwgYXMgc3Bhcmtfam9iX2luX3BpcGVsaW5lLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBzcGFya19qb2JfaW5fcGlwZWxpbmUoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X3NwYXJrX2pvYl93aXRoX2J1aWxkZXJfaW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuc3Bhcmtfam9iX2luX3BpcGVsaW5lLnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIGdlbmVyYXRlX2RzbF9waXBlbGluZV9mcm9tX2J1aWxkZXIgYXMgc3Bhcmtfam9iX2luX3BpcGVsaW5lLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBzcGFya19qb2JfaW5fcGlwZWxpbmUoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X3NwYXJrX2pvYl93aXRoX211bHRpcGxlX25vZGVfaW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuc3Bhcmtfam9iX2luX3BpcGVsaW5lLmttZWFuc19zYW1wbGUucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lX2Zyb21feWFtbCBhcyBzcGFya19qb2JfaW5fcGlwZWxpbmUsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHNwYXJrX2pvYl9pbl9waXBlbGluZSgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3Rfc3Bhcmtfam9iX3dpdGhfYnVpbGRlcl9pbl9waXBlbGluZV93aXRob3V0X2VudHJ5KAogICAgICAgIHNlbGYsCiAgICAgICAgY2xpZW50OiBNTENsaWVudCwKICAgICkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuc3Bhcmtfam9iX2luX3BpcGVsaW5lLmludmFsaWRfcGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lX2Zyb21fYnVpbGRlcl93aXRob3V0X2VudHJ5IGFzIHNwYXJrX2pvYl9pbl9waXBlbGluZSwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gc3Bhcmtfam9iX2luX3BpcGVsaW5lKCkKICAgICAgICB3aXRoIHB5dGVzdC5yYWlzZXMoRXhjZXB0aW9uKSBhcyBleDoKICAgICAgICAgICAgY3JlYXRlZF9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lKQoKICAgICAgICBhc3NlcnQgKAogICAgICAgICAgICAne1xuICAicmVzdWx0IjogIkZhaWxlZCIsXG4gICJlcnJvcnMiOiBbXG4gICAge1xuICAgICAgIm1lc3NhZ2UiOiAiTWlzc2luZyBkYXRhIGZvciByZXF1aXJlZCBmaWVsZC4iLCcKICAgICAgICAgICAgJ1xuICAgICAgInBhdGgiOiAiam9icy5hZGRfZ3JlZXRpbmdfY29sdW1uLmNvbXBvbmVudC5lbnRyeSIsXG4gICAgICAidmFsdWUiOiBudWxsXG4gICAgfVxuICBdXG59JwogICAgICAgICAgICA9PSBzdHIoZXgudmFsdWUpCiAgICAgICAgKQoKICAgICAgICB2YWxpZGF0aW9uX3Jlc3VsdCA9IGNsaWVudC5qb2JzLnZhbGlkYXRlKHBpcGVsaW5lKQogICAgICAgIGFzc2VydCB2YWxpZGF0aW9uX3Jlc3VsdC5wYXNzZWQgaXMgRmFsc2UKICAgICAgICBhc3NlcnQgdmFsaWRhdGlvbl9yZXN1bHQuZXJyb3JfbWVzc2FnZXMgPT0gewogICAgICAgICAgICAiam9icy5hZGRfZ3JlZXRpbmdfY29sdW1uLmNvbXBvbmVudC5lbnRyeSI6ICJNaXNzaW5nIGRhdGEgZm9yIHJlcXVpcmVkIGZpZWxkLiIsCiAgICAgICAgfQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9zcGFya19qb2Jfd2l0aF9idWlsZGVyX2luX3BpcGVsaW5lX3dpdGhfZHluYW1pY19hbGxvY2F0aW9uX2Rpc2FibGVkKAogICAgICAgIHNlbGYsCiAgICAgICAgY2xpZW50OiBNTENsaWVudCwKICAgICkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuc3Bhcmtfam9iX2luX3BpcGVsaW5lLmludmFsaWRfcGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lX2Zyb21fYnVpbGRlcl93aXRoX2R5bmFtaWNfYWxsb2NhdGlvbl9kaXNhYmxlZCBhcyBzcGFya19qb2JfaW5fcGlwZWxpbmUsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IHNwYXJrX2pvYl9pbl9waXBlbGluZSgpCiAgICAgICAgd2l0aCBweXRlc3QucmFpc2VzKEV4Y2VwdGlvbikgYXMgZXg6CiAgICAgICAgICAgIGNyZWF0ZWRfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZSkKCiAgICAgICAgYXNzZXJ0ICgKICAgICAgICAgICAgJ3tcbiAgInJlc3VsdCI6ICJGYWlsZWQiLFxuICAiZXJyb3JzIjogW1xuICAgIHtcbiAgICAgICJtZXNzYWdlIjogIlNob3VsZCBub3Qgc3BlY2lmeSBtaW4gb3IgbWF4ICcKICAgICAgICAgICAgJ2V4ZWN1dG9ycyB3aGVuIGR5bmFtaWMgYWxsb2NhdGlvbiBpcyBkaXNhYmxlZC4iLFxuJyBpbiBzdHIoZXgudmFsdWUpCiAgICAgICAgKQoKICAgICAgICB2YWxpZGF0aW9uX3Jlc3VsdCA9IGNsaWVudC5qb2JzLnZhbGlkYXRlKHBpcGVsaW5lKQogICAgICAgIGFzc2VydCB2YWxpZGF0aW9uX3Jlc3VsdC5wYXNzZWQgaXMgRmFsc2UKICAgICAgICBhc3NlcnQgdmFsaWRhdGlvbl9yZXN1bHQuZXJyb3JfbWVzc2FnZXMgPT0gewogICAgICAgICAgICAiam9icy5hZGRfZ3JlZXRpbmdfY29sdW1uLmNvbmYiOiAiU2hvdWxkIG5vdCBzcGVjaWZ5IG1pbiBvciBtYXggZXhlY3V0b3JzICIKICAgICAgICAgICAgIndoZW4gZHluYW1pYyBhbGxvY2F0aW9uIGlzIGRpc2FibGVkLiIsCiAgICAgICAgfQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9kYXRhX3RyYW5zZmVyX2NvcHlfMnVyaWZvbGRlcl9qb2JfaW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCkgLT4gTm9uZToKICAgICAgICBmcm9tIHRlc3RfY29uZmlncy5kc2xfcGlwZWxpbmUuZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUuY29weV9kYXRhLnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIGdlbmVyYXRlX2RzbF9waXBlbGluZV9mcm9tX3lhbWwgYXMgZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IGRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50LCBza2lwX2NhbmNlbD1UcnVlKQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9kYXRhX3RyYW5zZmVyX2NvcHlfMnVyaWZvbGRlcl9qb2Jfd2l0aF9idWlsZGVyX2luX3BpcGVsaW5lKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLmRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lLmNvcHlfZGF0YS5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmVfZnJvbV9idWlsZGVyIGFzIGRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBkYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZSgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfZGF0YV90cmFuc2Zlcl9jb3B5X21peHR5cGVfam9iX2luX3BpcGVsaW5lKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLmRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lLmNvcHlfZGF0YS5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmVfY29weV9taXh0eXBlX2Zyb21feWFtbCBhcyBkYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZSwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X2RhdGFfdHJhbnNmZXJfY29weV91cmlmaWxlX2pvYl9pbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5kYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZS5jb3B5X2RhdGEucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lX2NvcHlfdXJpZmlsZV9mcm9tX3lhbWwgYXMgZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IGRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9kYXRhX3RyYW5zZmVyX2NvcHlfdXJpZm9sZGVyX2pvYl9pbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5kYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZS5jb3B5X2RhdGEucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lX2NvcHlfdXJpZm9sZGVyX2Zyb21feWFtbCBhcyBkYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZSwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X2RhdGFfdHJhbnNmZXJfaW1wb3J0X2ZpbGVzeXN0ZW1fam9iX2luX3BpcGVsaW5lKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLmRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lLmltcG9ydF9maWxlX3N5c3RlbS5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmVfZnJvbV9idWlsZGVyIGFzIGRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBkYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZSgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfZGF0YV90cmFuc2Zlcl9pbXBvcnRfc3FsX2RhdGFiYXNlX2pvYl9pbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5kYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZS5pbXBvcnRfZGF0YWJhc2UucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lX2Zyb21fYnVpbGRlcl9zcWwgYXMgZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZSA9IGRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lKCkKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZSwgY2xpZW50KQoKICAgIEBweXRlc3QubWFyay5lMmV0ZXN0CiAgICBkZWYgdGVzdF9kYXRhX3RyYW5zZmVyX2ltcG9ydF9zbm93Zmxha2VfZGF0YWJhc2Vfam9iX2luX3BpcGVsaW5lKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLmRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lLmltcG9ydF9kYXRhYmFzZS5waXBlbGluZSBpbXBvcnQgKAogICAgICAgICAgICBnZW5lcmF0ZV9kc2xfcGlwZWxpbmVfZnJvbV9idWlsZGVyIGFzIGRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmUgPSBkYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZSgpCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmUsIGNsaWVudCkKCiAgICBAcHl0ZXN0Lm1hcmsuZTJldGVzdAogICAgZGVmIHRlc3RfZGF0YV90cmFuc2Zlcl9leHBvcnRfc3FsX2RhdGFiYXNlX2pvYl9pbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KSAtPiBOb25lOgogICAgICAgIGZyb20gdGVzdF9jb25maWdzLmRzbF9waXBlbGluZS5kYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZS5leHBvcnRfZGF0YWJhc2UucGlwZWxpbmUgaW1wb3J0ICgKICAgICAgICAgICAgZ2VuZXJhdGVfZHNsX3BpcGVsaW5lX2Zyb21fYnVpbGRlciBhcyBkYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZSwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCgogICAgQHB5dGVzdC5tYXJrLmUyZXRlc3QKICAgIGRlZiB0ZXN0X2RhdGFfdHJhbnNmZXJfbXVsdGlfam9iX2luX3BpcGVsaW5lKHNlbGYsIGNsaWVudDogTUxDbGllbnQpIC0\u002BIE5vbmU6CiAgICAgICAgZnJvbSB0ZXN0X2NvbmZpZ3MuZHNsX3BpcGVsaW5lLmRhdGFfdHJhbnNmZXJfam9iX2luX3BpcGVsaW5lLnBpcGVsaW5lIGltcG9ydCAoCiAgICAgICAgICAgIGdlbmVyYXRlX2RzbF9waXBlbGluZSBhcyBkYXRhX3RyYW5zZmVyX2pvYl9pbl9waXBlbGluZSwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lID0gZGF0YV90cmFuc2Zlcl9qb2JfaW5fcGlwZWxpbmUoKQogICAgICAgIGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lLCBjbGllbnQpCg==",
      "StatusCode": 201,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Content-MD5": "hmticOSCNGEfz3uj9VsbFA==",
        "Date": "Tue, 30 May 2023 07:29:02 GMT",
        "ETag": "\u00220x8DB60DF8B144AC8\u0022",
        "Last-Modified": "Tue, 30 May 2023 07:29:03 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-content-crc64": "GikCCb2TKDY=",
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://amltest5899420437.blob.core.windows.net/azureml-blobstore-0bdd51b6-cd9c-4978-b870-99997b393b81/LocalUpload/00000000000000000000000000000000/e2etests/test_automl_dsl_pipeline.py",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "34209",
        "Content-MD5": "7KSIc2nEWBWtt/xkdXjRWw==",
        "Content-Type": "application/octet-stream",
        "If-None-Match": "*",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)",
        "x-ms-blob-type": "BlockBlob",
        "x-ms-date": "Tue, 30 May 2023 07:28:59 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": "ZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCgppbXBvcnQgcHlkYXNoCmltcG9ydCBweXRlc3QKZnJvbSBkZXZ0b29sc190ZXN0dXRpbHMgaW1wb3J0IEF6dXJlUmVjb3JkZWRUZXN0Q2FzZQpmcm9tIHRlc3RfdXRpbGl0aWVzLnV0aWxzIGltcG9ydCBjYW5jZWxfam9iCgpmcm9tIGF6dXJlLmFpLm1sIGltcG9ydCBJbnB1dCwgTUxDbGllbnQsIGF1dG9tbCwgZHNsLCBPdXRwdXQKZnJvbSBhenVyZS5haS5tbC5hdXRvbWwgaW1wb3J0ICgKICAgIGNsYXNzaWZpY2F0aW9uLAogICAgZm9yZWNhc3RpbmcsCiAgICByZWdyZXNzaW9uLAogICAgdGV4dF9jbGFzc2lmaWNhdGlvbiwKICAgIHRleHRfY2xhc3NpZmljYXRpb25fbXVsdGlsYWJlbCwKICAgIHRleHRfbmVyLAopCmZyb20gYXp1cmUuYWkubWwuY29uc3RhbnRzLl9jb21tb24gaW1wb3J0IEFzc2V0VHlwZXMKZnJvbSBhenVyZS5haS5tbC5lbnRpdGllcyBpbXBvcnQgUGlwZWxpbmVKb2IKZnJvbSBhenVyZS5haS5tbC5lbnRpdGllcy5fam9iLmF1dG9tbCBpbXBvcnQgU2VhcmNoU3BhY2UKZnJvbSBhenVyZS5haS5tbC5lbnRpdGllcy5fam9iLmF1dG9tbC5ubHAgaW1wb3J0IE5scEZlYXR1cml6YXRpb25TZXR0aW5ncwpmcm9tIGF6dXJlLmFpLm1sLmVudGl0aWVzLl9qb2IuYXV0b21sLnRhYnVsYXIgaW1wb3J0IFRhYnVsYXJGZWF0dXJpemF0aW9uU2V0dGluZ3MKZnJvbSBhenVyZS5haS5tbC5lbnRpdGllcy5fam9iLmF1dG9tbC50YWJ1bGFyLmZvcmVjYXN0aW5nX3NldHRpbmdzIGltcG9ydCBGb3JlY2FzdGluZ1NldHRpbmdzCmZyb20gYXp1cmUuYWkubWwuc3dlZXAgaW1wb3J0IEJhbmRpdFBvbGljeSwgQ2hvaWNlLCBVbmlmb3JtCgp0ZXN0c19yb290X2RpciA9IFBhdGgoX19maWxlX18pLnBhcmVudC5wYXJlbnQucGFyZW50CgojIGRlY2xhcmUgdmFyaWFibGVzIGZvciBjb21wdXRlLCBzbyB0aGF0IHdlIGNhbiBlYXNpbHkgY2hhbmdlIHRoZW0gbGF0ZXIKQ1BVX0NMVVNURVIgPSAiY3B1LWNsdXN0ZXIiCkdQVV9DTFVTVEVSID0gImdwdS1jbHVzdGVyIgoKCkBweXRlc3QubWFyay51c2VmaXh0dXJlcygKICAgICJlbmFibGVfZW52aXJvbm1lbnRfaWRfYXJtX2V4cGFuc2lvbiIsCiAgICAiZW5hYmxlX3BpcGVsaW5lX3ByaXZhdGVfcHJldmlld19mZWF0dXJlcyIsCiAgICAibW9ja19jb2RlX2hhc2giLAogICAgIm1vY2tfY29tcG9uZW50X2hhc2giLAogICAgIm1vY2tfc2V0X2hlYWRlcnNfd2l0aF91c2VyX2FtbF90b2tlbiIsCiAgICAicmVjb3JkZWRfdGVzdCIsCikKQHB5dGVzdC5tYXJrLmF1dG9tbGUyZXRlc3QKQHB5dGVzdC5tYXJrLnBpcGVsaW5lX3Rlc3QKY2xhc3MgVGVzdEF1dG9tbERTTFBpcGVsaW5lKEF6dXJlUmVjb3JkZWRUZXN0Q2FzZSk6CiAgICBkZWYgdGVzdF9hdXRvbWxfY2xhc3NpZmljYXRpb25faW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgQGRzbC5waXBlbGluZShuYW1lPSJ0cmFpbl9hdXRvbWxfY2xhc3NpZmljYXRpb25faW5fcGlwZWxpbmUiKQogICAgICAgIGRlZiB0cmFpbl9hdXRvbWxfY2xhc3NpZmljYXRpb25faW5fcGlwZWxpbmUoCiAgICAgICAgICAgIGNsYXNzX3RyYWluX2RhdGEsCiAgICAgICAgICAgIGNsYXNzX3ZhbGlkX2RhdGEsCiAgICAgICAgKToKICAgICAgICAgICAgY2xhc3NpZmljYXRpb25fbm9kZSA9IGNsYXNzaWZpY2F0aW9uKAogICAgICAgICAgICAgICAgdHJhaW5pbmdfZGF0YT1jbGFzc190cmFpbl9kYXRhLAogICAgICAgICAgICAgICAgdmFsaWRhdGlvbl9kYXRhPWNsYXNzX3ZhbGlkX2RhdGEsCiAgICAgICAgICAgICAgICB0ZXN0X2RhdGE9Y2xhc3NfdmFsaWRfZGF0YSwKICAgICAgICAgICAgICAgIHRhcmdldF9jb2x1bW5fbmFtZT0ieSIsCiAgICAgICAgICAgICAgICBwcmltYXJ5X21ldHJpYz0iYWNjdXJhY3kiLAogICAgICAgICAgICAgICAgZmVhdHVyaXphdGlvbj1UYWJ1bGFyRmVhdHVyaXphdGlvblNldHRpbmdzKG1vZGU9IkF1dG8iKSwKICAgICAgICAgICAgKQogICAgICAgICAgICBjbGFzc2lmaWNhdGlvbl9ub2RlLnNldF9saW1pdHMobWF4X3RyaWFscz0xKQogICAgICAgICAgICBjbGFzc2lmaWNhdGlvbl9ub2RlLnNldF90cmFpbmluZyhlbmFibGVfc3RhY2tfZW5zZW1ibGU9RmFsc2UsIGVuYWJsZV92b3RlX2Vuc2VtYmxlPUZhbHNlKQoKICAgICAgICBjbGFzc190cmFpbiA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL2JhbmtfbWFya2V0aW5nL3RyYWluIiwKICAgICAgICApCiAgICAgICAgY2xhc3NfdmFsaWQgPSBJbnB1dCgKICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgIHBhdGg9dGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2F1dG9tbF9qb2IvdGVzdF9kYXRhc2V0cy9iYW5rX21hcmtldGluZy92YWxpZCIsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZV9qb2I6IFBpcGVsaW5lSm9iID0gdHJhaW5fYXV0b21sX2NsYXNzaWZpY2F0aW9uX2luX3BpcGVsaW5lKGNsYXNzX3RyYWluLCBjbGFzc192YWxpZCkKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gQ1BVX0NMVVNURVIKCiAgICAgICAgZnJvbV9yZXN0X3BpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmVfam9iKQogICAgICAgIGNhbmNlbF9qb2IoY2xpZW50LCBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iKQoKICAgICAgICBhY3R1YWxfZGljdCA9IGZyb21fcmVzdF9waXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpCiAgICAgICAgZmllbGRzX3RvX29taXQgPSBbIm5hbWUiLCAiZGlzcGxheV9uYW1lIiwgImV4cGVyaW1lbnRfbmFtZSIsICJwcm9wZXJ0aWVzIl0KCiAgICAgICAgY2xhc3NpZmljYXRpb25fZGljdCA9IHB5ZGFzaC5vbWl0KGFjdHVhbF9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXVsiY2xhc3NpZmljYXRpb25fbm9kZSJdLCBmaWVsZHNfdG9fb21pdCkKICAgICAgICBhc3NlcnQgY2xhc3NpZmljYXRpb25fZGljdCA9PSB7CiAgICAgICAgICAgICJ0ZXN0X2RhdGEiOiAiJHt7cGFyZW50LmlucHV0cy5jbGFzc192YWxpZF9kYXRhfX0iLAogICAgICAgICAgICAidmFsaWRhdGlvbl9kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMuY2xhc3NfdmFsaWRfZGF0YX19IiwKICAgICAgICAgICAgInRyYWluaW5nX2RhdGEiOiAiJHt7cGFyZW50LmlucHV0cy5jbGFzc190cmFpbl9kYXRhfX0iLAogICAgICAgICAgICAidGFyZ2V0X2NvbHVtbl9uYW1lIjogInkiLAogICAgICAgICAgICAidGFncyI6IHt9LAogICAgICAgICAgICAidHlwZSI6ICJhdXRvbWwiLAogICAgICAgICAgICAib3V0cHV0cyI6IHt9LAogICAgICAgICAgICAibG9nX3ZlcmJvc2l0eSI6ICJpbmZvIiwKICAgICAgICAgICAgImxpbWl0cyI6IHsibWF4X3RyaWFscyI6IDF9LAogICAgICAgICAgICAiZmVhdHVyaXphdGlvbiI6IHsibW9kZSI6ICJhdXRvIn0sCiAgICAgICAgICAgICJ0cmFpbmluZyI6IHsiZW5hYmxlX3N0YWNrX2Vuc2VtYmxlIjogRmFsc2UsICJlbmFibGVfdm90ZV9lbnNlbWJsZSI6IEZhbHNlfSwKICAgICAgICAgICAgInRhc2siOiAiY2xhc3NpZmljYXRpb24iLAogICAgICAgICAgICAicHJpbWFyeV9tZXRyaWMiOiAiYWNjdXJhY3kiLAogICAgICAgIH0KCiAgICBkZWYgdGVzdF9yZWdpc3Rlcl9vdXRwdXRfZm9yX2F1dG9tbF9jbGFzc2lmaWNhdGlvbihzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBAZHNsLnBpcGVsaW5lKG5hbWU9InRyYWluX2F1dG9tbF9jbGFzc2lmaWNhdGlvbl9pbl9waXBlbGluZSIpCiAgICAgICAgZGVmIHRyYWluX2F1dG9tbF9jbGFzc2lmaWNhdGlvbl9pbl9waXBlbGluZSgKICAgICAgICAgICAgY2xhc3NfdHJhaW5fZGF0YSwKICAgICAgICAgICAgY2xhc3NfdmFsaWRfZGF0YSwKICAgICAgICApOgogICAgICAgICAgICBjbGFzc2lmaWNhdGlvbl9ub2RlID0gY2xhc3NpZmljYXRpb24oCiAgICAgICAgICAgICAgICB0cmFpbmluZ19kYXRhPWNsYXNzX3RyYWluX2RhdGEsCiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uX2RhdGE9Y2xhc3NfdmFsaWRfZGF0YSwKICAgICAgICAgICAgICAgIHRlc3RfZGF0YT1jbGFzc192YWxpZF9kYXRhLAogICAgICAgICAgICAgICAgdGFyZ2V0X2NvbHVtbl9uYW1lPSJ5IiwKICAgICAgICAgICAgICAgIHByaW1hcnlfbWV0cmljPSJhY2N1cmFjeSIsCiAgICAgICAgICAgICAgICBmZWF0dXJpemF0aW9uPVRhYnVsYXJGZWF0dXJpemF0aW9uU2V0dGluZ3MobW9kZT0iQXV0byIpLAogICAgICAgICAgICAgICAgb3V0cHV0cz17ImJlc3RfbW9kZWwiOiBPdXRwdXQodHlwZT0ibWxmbG93X21vZGVsIil9LAogICAgICAgICAgICApCiAgICAgICAgICAgIGNsYXNzaWZpY2F0aW9uX25vZGUuc2V0X2xpbWl0cyhtYXhfdHJpYWxzPTEpCiAgICAgICAgICAgIGNsYXNzaWZpY2F0aW9uX25vZGUuc2V0X3RyYWluaW5nKGVuYWJsZV9zdGFja19lbnNlbWJsZT1GYWxzZSwgZW5hYmxlX3ZvdGVfZW5zZW1ibGU9RmFsc2UpCiAgICAgICAgICAgIGNsYXNzaWZpY2F0aW9uX25vZGUub3V0cHV0c1siYmVzdF9tb2RlbCJdLm5hbWUgPSAiY2xhc3NpZmljYXRpb25fb3V0cHV0X25hbWUiCiAgICAgICAgICAgIGNsYXNzaWZpY2F0aW9uX25vZGUub3V0cHV0c1siYmVzdF9tb2RlbCJdLnZlcnNpb24gPSAiMSIKCiAgICAgICAgICAgIGNsYXNzaWZpY2F0aW9uX25vZGVfMiA9IGNsYXNzaWZpY2F0aW9uKCAgIyBiaW5kaW5nIHRvIHBpcGVsaW5lIG91dHB1dAogICAgICAgICAgICAgICAgdHJhaW5pbmdfZGF0YT1jbGFzc190cmFpbl9kYXRhLAogICAgICAgICAgICAgICAgdmFsaWRhdGlvbl9kYXRhPWNsYXNzX3ZhbGlkX2RhdGEsCiAgICAgICAgICAgICAgICB0ZXN0X2RhdGE9Y2xhc3NfdmFsaWRfZGF0YSwKICAgICAgICAgICAgICAgIHRhcmdldF9jb2x1bW5fbmFtZT0ieSIsCiAgICAgICAgICAgICAgICBwcmltYXJ5X21ldHJpYz0iYWNjdXJhY3kiLAogICAgICAgICAgICAgICAgZmVhdHVyaXphdGlvbj1UYWJ1bGFyRmVhdHVyaXphdGlvblNldHRpbmdzKG1vZGU9IkF1dG8iKSwKICAgICAgICAgICAgICAgIG91dHB1dHM9eyJiZXN0X21vZGVsIjogT3V0cHV0KHR5cGU9Im1sZmxvd19tb2RlbCIpfSwKICAgICAgICAgICAgKQogICAgICAgICAgICBjbGFzc2lmaWNhdGlvbl9ub2RlXzIuc2V0X2xpbWl0cyhtYXhfdHJpYWxzPTEpCiAgICAgICAgICAgIGNsYXNzaWZpY2F0aW9uX25vZGVfMi5zZXRfdHJhaW5pbmcoZW5hYmxlX3N0YWNrX2Vuc2VtYmxlPUZhbHNlLCBlbmFibGVfdm90ZV9lbnNlbWJsZT1GYWxzZSkKICAgICAgICAgICAgY2xhc3NpZmljYXRpb25fbm9kZV8yLm91dHB1dHNbImJlc3RfbW9kZWwiXS5uYW1lID0gImNsYXNzaWZpY2F0aW9uX291dHB1dF9uYW1lIgogICAgICAgICAgICBjbGFzc2lmaWNhdGlvbl9ub2RlXzIub3V0cHV0c1siYmVzdF9tb2RlbCJdLnZlcnNpb24gPSAiMiIKCiAgICAgICAgICAgIHJldHVybiB7ImNsYXNzaWZpY2F0aW9uXzJfb3V0cHV0IjogY2xhc3NpZmljYXRpb25fbm9kZV8yLm91dHB1dHMuYmVzdF9tb2RlbH0KCiAgICAgICAgY2xhc3NfdHJhaW4gPSBJbnB1dCgKICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgIHBhdGg9dGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2F1dG9tbF9qb2IvdGVzdF9kYXRhc2V0cy9iYW5rX21hcmtldGluZy90cmFpbiIsCiAgICAgICAgKQogICAgICAgIGNsYXNzX3ZhbGlkID0gSW5wdXQoCiAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5NTFRBQkxFLAogICAgICAgICAgICBwYXRoPXRlc3RzX3Jvb3RfZGlyIC8gInRlc3RfY29uZmlncy9hdXRvbWxfam9iL3Rlc3RfZGF0YXNldHMvYmFua19tYXJrZXRpbmcvdmFsaWQiLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmVfam9iOiBQaXBlbGluZUpvYiA9IHRyYWluX2F1dG9tbF9jbGFzc2lmaWNhdGlvbl9pbl9waXBlbGluZShjbGFzc190cmFpbiwgY2xhc3NfdmFsaWQpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9IENQVV9DTFVTVEVSCgogICAgICAgIGZyb21fcmVzdF9waXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lX2pvYikKICAgICAgICBjYW5jZWxfam9iKGNsaWVudCwgZnJvbV9yZXN0X3BpcGVsaW5lX2pvYikKCiAgICAgICAgYWN0dWFsX2RpY3QgPSBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKQogICAgICAgIGZpZWxkc190b19vbWl0ID0gWyJuYW1lIiwgImRpc3BsYXlfbmFtZSIsICJleHBlcmltZW50X25hbWUiLCAicHJvcGVydGllcyJdCgogICAgICAgIGNsYXNzaWZpY2F0aW9uX2RpY3QgPSBweWRhc2gub21pdChhY3R1YWxfZGljdFsicHJvcGVydGllcyJdWyJqb2JzIl1bImNsYXNzaWZpY2F0aW9uX25vZGUiXSwgZmllbGRzX3RvX29taXQpCiAgICAgICAgYXNzZXJ0IGNsYXNzaWZpY2F0aW9uX2RpY3QgPT0gewogICAgICAgICAgICAidGVzdF9kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMuY2xhc3NfdmFsaWRfZGF0YX19IiwKICAgICAgICAgICAgInZhbGlkYXRpb25fZGF0YSI6ICIke3twYXJlbnQuaW5wdXRzLmNsYXNzX3ZhbGlkX2RhdGF9fSIsCiAgICAgICAgICAgICJ0cmFpbmluZ19kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMuY2xhc3NfdHJhaW5fZGF0YX19IiwKICAgICAgICAgICAgInRhcmdldF9jb2x1bW5fbmFtZSI6ICJ5IiwKICAgICAgICAgICAgInRhZ3MiOiB7fSwKICAgICAgICAgICAgInR5cGUiOiAiYXV0b21sIiwKICAgICAgICAgICAgIm91dHB1dHMiOiB7CiAgICAgICAgICAgICAgICAiYmVzdF9tb2RlbCI6IHsiam9iX291dHB1dF90eXBlIjogIm1sZmxvd19tb2RlbCIsICJuYW1lIjogImNsYXNzaWZpY2F0aW9uX291dHB1dF9uYW1lIiwgInZlcnNpb24iOiAiMSJ9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJsb2dfdmVyYm9zaXR5IjogImluZm8iLAogICAgICAgICAgICAibGltaXRzIjogeyJtYXhfdHJpYWxzIjogMX0sCiAgICAgICAgICAgICJmZWF0dXJpemF0aW9uIjogeyJtb2RlIjogImF1dG8ifSwKICAgICAgICAgICAgInRyYWluaW5nIjogeyJlbmFibGVfc3RhY2tfZW5zZW1ibGUiOiBGYWxzZSwgImVuYWJsZV92b3RlX2Vuc2VtYmxlIjogRmFsc2V9LAogICAgICAgICAgICAidGFzayI6ICJjbGFzc2lmaWNhdGlvbiIsCiAgICAgICAgICAgICJwcmltYXJ5X21ldHJpYyI6ICJhY2N1cmFjeSIsCiAgICAgICAgfQoKICAgICAgICBjbGFzc2lmaWNhdGlvbl9kaWN0ID0gcHlkYXNoLm9taXQoCiAgICAgICAgICAgIGFjdHVhbF9kaWN0WyJwcm9wZXJ0aWVzIl1bIm91dHB1dHMiXVsiY2xhc3NpZmljYXRpb25fMl9vdXRwdXQiXSwgZmllbGRzX3RvX29taXQKICAgICAgICApCiAgICAgICAgYXNzZXJ0IGNsYXNzaWZpY2F0aW9uX2RpY3QgPT0gewogICAgICAgICAgICAiYXNzZXRfbmFtZSI6ICJjbGFzc2lmaWNhdGlvbl9vdXRwdXRfbmFtZSIsCiAgICAgICAgICAgICJhc3NldF92ZXJzaW9uIjogIjIiLAogICAgICAgICAgICAiam9iX291dHB1dF90eXBlIjogIm1sZmxvd19tb2RlbCIsCiAgICAgICAgICAgICJtb2RlIjogIlJlYWRXcml0ZU1vdW50IiwKICAgICAgICB9CgogICAgZGVmIHRlc3RfYXV0b21sX3JlZ3Jlc3Npb25faW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgQGRzbC5waXBlbGluZShuYW1lPSJ0cmFpbl9hdXRvbWxfcmVncmVzc2lvbl9pbl9waXBlbGluZSIpCiAgICAgICAgZGVmIHRyYWluX2F1dG9tbF9yZWdyZXNzaW9uX2luX3BpcGVsaW5lKHJlZ3Jlc3Npb25fdHJhaW5fZGF0YSk6CiAgICAgICAgICAgIHJlZ3Jlc3Npb25fbm9kZSA9IHJlZ3Jlc3Npb24oCiAgICAgICAgICAgICAgICBwcmltYXJ5X21ldHJpYz0icjJfc2NvcmUiLAogICAgICAgICAgICAgICAgdGFyZ2V0X2NvbHVtbl9uYW1lPSJFUlAiLAogICAgICAgICAgICAgICAgdHJhaW5pbmdfZGF0YT1yZWdyZXNzaW9uX3RyYWluX2RhdGEsCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmVncmVzc2lvbl9ub2RlLnNldF9saW1pdHMobWF4X3RyaWFscz0xKQogICAgICAgICAgICByZWdyZXNzaW9uX25vZGUuc2V0X3RyYWluaW5nKGVuYWJsZV9zdGFja19lbnNlbWJsZT1GYWxzZSwgZW5hYmxlX3ZvdGVfZW5zZW1ibGU9RmFsc2UpCiAgICAgICAgICAgIHJlZ3Jlc3Npb25fbm9kZS5zZXRfZmVhdHVyaXphdGlvbihtb2RlPSJhdXRvIikKCiAgICAgICAgcmVncmVzc2lvbl90cmFpbiA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL21hY2hpbmVfZGF0YS90cmFpbiIsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZV9qb2I6IFBpcGVsaW5lSm9iID0gdHJhaW5fYXV0b21sX3JlZ3Jlc3Npb25faW5fcGlwZWxpbmUocmVncmVzc2lvbl90cmFpbikKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gQ1BVX0NMVVNURVIKCiAgICAgICAgZnJvbV9yZXN0X3BpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmVfam9iKQogICAgICAgIGNhbmNlbF9qb2IoY2xpZW50LCBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iKQoKICAgICAgICBhY3R1YWxfZGljdCA9IGZyb21fcmVzdF9waXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpCiAgICAgICAgZmllbGRzX3RvX29taXQgPSBbIm5hbWUiLCAiZGlzcGxheV9uYW1lIiwgImV4cGVyaW1lbnRfbmFtZSIsICJwcm9wZXJ0aWVzIl0KCiAgICAgICAgcmVncmVzc2lvbl9kaWN0ID0gcHlkYXNoLm9taXQoYWN0dWFsX2RpY3RbInByb3BlcnRpZXMiXVsiam9icyJdWyJyZWdyZXNzaW9uX25vZGUiXSwgZmllbGRzX3RvX29taXQpCiAgICAgICAgYXNzZXJ0IHJlZ3Jlc3Npb25fZGljdCA9PSB7CiAgICAgICAgICAgICJ0cmFpbmluZ19kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMucmVncmVzc2lvbl90cmFpbl9kYXRhfX0iLAogICAgICAgICAgICAidGFyZ2V0X2NvbHVtbl9uYW1lIjogIkVSUCIsCiAgICAgICAgICAgICJ0YWdzIjoge30sCiAgICAgICAgICAgICJ0eXBlIjogImF1dG9tbCIsCiAgICAgICAgICAgICJvdXRwdXRzIjoge30sCiAgICAgICAgICAgICJsb2dfdmVyYm9zaXR5IjogImluZm8iLAogICAgICAgICAgICAibGltaXRzIjogeyJtYXhfdHJpYWxzIjogMX0sCiAgICAgICAgICAgICJmZWF0dXJpemF0aW9uIjogeyJtb2RlIjogImF1dG8ifSwKICAgICAgICAgICAgInRyYWluaW5nIjogeyJlbmFibGVfc3RhY2tfZW5zZW1ibGUiOiBGYWxzZSwgImVuYWJsZV92b3RlX2Vuc2VtYmxlIjogRmFsc2V9LAogICAgICAgICAgICAidGFzayI6ICJyZWdyZXNzaW9uIiwKICAgICAgICAgICAgInByaW1hcnlfbWV0cmljIjogInIyX3Njb3JlIiwKICAgICAgICB9CgogICAgZGVmIHRlc3RfYXV0b21sX2ZvcmVjYXN0aW5nX2luX3BpcGVsaW5lKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIEBkc2wucGlwZWxpbmUobmFtZT0idHJhaW5fd2l0aF9hdXRvbWxfaW5fcGlwZWxpbmUiKQogICAgICAgIGRlZiB0cmFpbl9hdXRvbWxfZm9yZWNhc3RpbmdfaW5fcGlwZWxpbmUoCiAgICAgICAgICAgIGZvcmVjYXN0aW5nX3RyYWluX2RhdGEsCiAgICAgICAgKToKICAgICAgICAgICAgZm9yZWNhc3Rpbmdfc2V0dGluZ3MgPSBGb3JlY2FzdGluZ1NldHRpbmdzKHRpbWVfY29sdW1uX25hbWU9IkRBVEUiLCBmb3JlY2FzdF9ob3Jpem9uPTEyLCBmcmVxdWVuY3k9Ik1TIikKCiAgICAgICAgICAgIGZvcmVjYXN0aW5nX25vZGUgPSBmb3JlY2FzdGluZygKICAgICAgICAgICAgICAgIHByaW1hcnlfbWV0cmljPSJub3JtYWxpemVkX3Jvb3RfbWVhbl9zcXVhcmVkX2Vycm9yIiwKICAgICAgICAgICAgICAgIHRhcmdldF9jb2x1bW5fbmFtZT0iQmVlclByb2R1Y3Rpb24iLAogICAgICAgICAgICAgICAgdHJhaW5pbmdfZGF0YT1mb3JlY2FzdGluZ190cmFpbl9kYXRhLAogICAgICAgICAgICAgICAgbl9jcm9zc192YWxpZGF0aW9ucz0yLAogICAgICAgICAgICAgICAgZm9yZWNhc3Rpbmdfc2V0dGluZ3M9Zm9yZWNhc3Rpbmdfc2V0dGluZ3MsCiAgICAgICAgICAgICkKICAgICAgICAgICAgZm9yZWNhc3Rpbmdfbm9kZS5zZXRfbGltaXRzKG1heF90cmlhbHM9MSkKICAgICAgICAgICAgZm9yZWNhc3Rpbmdfbm9kZS5zZXRfdHJhaW5pbmcoZW5hYmxlX3N0YWNrX2Vuc2VtYmxlPUZhbHNlLCBlbmFibGVfdm90ZV9lbnNlbWJsZT1GYWxzZSkKICAgICAgICAgICAgZm9yZWNhc3Rpbmdfbm9kZS5zZXRfZmVhdHVyaXphdGlvbihtb2RlPSJhdXRvIikKCiAgICAgICAgZm9yZWNhc3RpbmdfdHJhaW4gPSBJbnB1dCgKICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgIHBhdGg9dGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2F1dG9tbF9qb2IvdGVzdF9kYXRhc2V0cy9iZWVyX2ZvcmVjYXN0aW5nL3RyYWluIiwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lX2pvYjogUGlwZWxpbmVKb2IgPSB0cmFpbl9hdXRvbWxfZm9yZWNhc3RpbmdfaW5fcGlwZWxpbmUoZm9yZWNhc3RpbmdfdHJhaW5fZGF0YT1mb3JlY2FzdGluZ190cmFpbikKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gQ1BVX0NMVVNURVIKCiAgICAgICAgZnJvbV9yZXN0X3BpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmVfam9iKQogICAgICAgIGNhbmNlbF9qb2IoY2xpZW50LCBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iKQoKICAgICAgICBhY3R1YWxfZGljdCA9IGZyb21fcmVzdF9waXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpCiAgICAgICAgZmllbGRzX3RvX29taXQgPSBbIm5hbWUiLCAiZGlzcGxheV9uYW1lIiwgImV4cGVyaW1lbnRfbmFtZSIsICJwcm9wZXJ0aWVzIl0KCiAgICAgICAgZm9yZWNhc3RpbmdfZGljdCA9IHB5ZGFzaC5vbWl0KGFjdHVhbF9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXVsiZm9yZWNhc3Rpbmdfbm9kZSJdLCBmaWVsZHNfdG9fb21pdCkKICAgICAgICBhc3NlcnQgZm9yZWNhc3RpbmdfZGljdCA9PSB7CiAgICAgICAgICAgICJ0cmFpbmluZ19kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMuZm9yZWNhc3RpbmdfdHJhaW5fZGF0YX19IiwKICAgICAgICAgICAgIm5fY3Jvc3NfdmFsaWRhdGlvbnMiOiAyLAogICAgICAgICAgICAidGFyZ2V0X2NvbHVtbl9uYW1lIjogIkJlZXJQcm9kdWN0aW9uIiwKICAgICAgICAgICAgInRhZ3MiOiB7fSwKICAgICAgICAgICAgInR5cGUiOiAiYXV0b21sIiwKICAgICAgICAgICAgIm91dHB1dHMiOiB7fSwKICAgICAgICAgICAgImxvZ192ZXJib3NpdHkiOiAiaW5mbyIsCiAgICAgICAgICAgICJsaW1pdHMiOiB7Im1heF90cmlhbHMiOiAxfSwKICAgICAgICAgICAgImZlYXR1cml6YXRpb24iOiB7Im1vZGUiOiAiYXV0byJ9LAogICAgICAgICAgICAidHJhaW5pbmciOiB7ImVuYWJsZV9zdGFja19lbnNlbWJsZSI6IEZhbHNlLCAiZW5hYmxlX3ZvdGVfZW5zZW1ibGUiOiBGYWxzZX0sCiAgICAgICAgICAgICJ0YXNrIjogImZvcmVjYXN0aW5nIiwKICAgICAgICAgICAgImZvcmVjYXN0aW5nIjogeyJmb3JlY2FzdF9ob3Jpem9uIjogMTIsICJ0aW1lX2NvbHVtbl9uYW1lIjogIkRBVEUiLCAiZnJlcXVlbmN5IjogIk1TIn0sCiAgICAgICAgICAgICJwcmltYXJ5X21ldHJpYyI6ICJub3JtYWxpemVkX3Jvb3RfbWVhbl9zcXVhcmVkX2Vycm9yIiwKICAgICAgICB9CgogICAgZGVmIHRlc3RfYXV0b21sX3RleHRfY2xhc3NpZmljYXRpb25faW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgQGRzbC5waXBlbGluZShuYW1lPSJ0cmFpbl9hdXRvbWxfdGV4dF9jbGFzc19pbl9waXBlbGluZSIpCiAgICAgICAgZGVmIHRyYWluX2F1dG9tbF90ZXh0X2NsYXNzX2luX3BpcGVsaW5lKAogICAgICAgICAgICB0ZXh0X2NsYXNzaWZpY2F0aW9uX3RyYWluLAogICAgICAgICAgICB0ZXh0X2NsYXNzaWZpY2F0aW9uX3ZhbGlkLAogICAgICAgICk6CiAgICAgICAgICAgIHRleHRfY2xhc3NpZmljYXRpb25fbm9kZSA9IHRleHRfY2xhc3NpZmljYXRpb24oCiAgICAgICAgICAgICAgICB0cmFpbmluZ19kYXRhPXRleHRfY2xhc3NpZmljYXRpb25fdHJhaW4sCiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uX2RhdGE9dGV4dF9jbGFzc2lmaWNhdGlvbl92YWxpZCwKICAgICAgICAgICAgICAgIHRhcmdldF9jb2x1bW5fbmFtZT0ieSIsCiAgICAgICAgICAgICAgICBwcmltYXJ5X21ldHJpYz0iYWNjdXJhY3kiLAogICAgICAgICAgICAgICAgZmVhdHVyaXphdGlvbj1ObHBGZWF0dXJpemF0aW9uU2V0dGluZ3MoZGF0YXNldF9sYW5ndWFnZT0iZW5nIiksCiAgICAgICAgICAgICkKICAgICAgICAgICAgdGV4dF9jbGFzc2lmaWNhdGlvbl9ub2RlLnNldF9saW1pdHMobWF4X2NvbmN1cnJlbnRfdHJpYWxzPTEpCgogICAgICAgIHRleHRfY2xhc3NpZmljYXRpb25fdHJhaW4gPSBJbnB1dCgKICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgIHBhdGg9dGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2F1dG9tbF9qb2IvdGVzdF9kYXRhc2V0cy9uZXdzZ3JvdXAvdHJhaW4iLAogICAgICAgICkKICAgICAgICB0ZXh0X2NsYXNzaWZpY2F0aW9uX3ZhbGlkID0gSW5wdXQoCiAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5NTFRBQkxFLAogICAgICAgICAgICBwYXRoPXRlc3RzX3Jvb3RfZGlyIC8gInRlc3RfY29uZmlncy9hdXRvbWxfam9iL3Rlc3RfZGF0YXNldHMvbmV3c2dyb3VwL3ZhbGlkIiwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lX2pvYjogUGlwZWxpbmVKb2IgPSB0cmFpbl9hdXRvbWxfdGV4dF9jbGFzc19pbl9waXBlbGluZSgKICAgICAgICAgICAgdGV4dF9jbGFzc2lmaWNhdGlvbl90cmFpbiwgdGV4dF9jbGFzc2lmaWNhdGlvbl92YWxpZAogICAgICAgICkKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gR1BVX0NMVVNURVIKICAgICAgICBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZV9qb2IpCiAgICAgICAgY2FuY2VsX2pvYihjbGllbnQsIGZyb21fcmVzdF9waXBlbGluZV9qb2IpCgogICAgICAgIGFjdHVhbF9kaWN0ID0gZnJvbV9yZXN0X3BpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCkKICAgICAgICBmaWVsZHNfdG9fb21pdCA9IFsibmFtZSIsICJkaXNwbGF5X25hbWUiLCAiZXhwZXJpbWVudF9uYW1lIiwgInByb3BlcnRpZXMiXQoKICAgICAgICBqb2JfZGljdCA9IHB5ZGFzaC5vbWl0KGFjdHVhbF9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXVsidGV4dF9jbGFzc2lmaWNhdGlvbl9ub2RlIl0sIGZpZWxkc190b19vbWl0KQogICAgICAgIGFzc2VydCBqb2JfZGljdCA9PSB7CiAgICAgICAgICAgICJ0cmFpbmluZ19kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMudGV4dF9jbGFzc2lmaWNhdGlvbl90cmFpbn19IiwKICAgICAgICAgICAgInZhbGlkYXRpb25fZGF0YSI6ICIke3twYXJlbnQuaW5wdXRzLnRleHRfY2xhc3NpZmljYXRpb25fdmFsaWR9fSIsCiAgICAgICAgICAgICJ0YXJnZXRfY29sdW1uX25hbWUiOiAieSIsCiAgICAgICAgICAgICJ0YWdzIjoge30sCiAgICAgICAgICAgICJ0eXBlIjogImF1dG9tbCIsCiAgICAgICAgICAgICJvdXRwdXRzIjoge30sCiAgICAgICAgICAgICJsaW1pdHMiOiB7Im1heF90cmlhbHMiOiAxLCAibWF4X25vZGVzIjogMSwgIm1heF9jb25jdXJyZW50X3RyaWFscyI6IDF9LAogICAgICAgICAgICAiZmVhdHVyaXphdGlvbiI6IHsiZGF0YXNldF9sYW5ndWFnZSI6ICJlbmcifSwKICAgICAgICAgICAgInRhc2siOiAidGV4dF9jbGFzc2lmaWNhdGlvbiIsCiAgICAgICAgICAgICJwcmltYXJ5X21ldHJpYyI6ICJhY2N1cmFjeSIsCiAgICAgICAgfQoKICAgIGRlZiB0ZXN0X2F1dG9tbF90ZXh0X2NsYXNzaWZpY2F0aW9uX211bHRpbGFiZWxfaW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgQGRzbC5waXBlbGluZShuYW1lPSJ0cmFpbl9hdXRvbWxfdGV4dF9jbGFzc19tdWx0aWxhYmVsX2luX3BpcGVsaW5lIikKICAgICAgICBkZWYgdHJhaW5fYXV0b21sX3RleHRfY2xhc3NfbXVsdGlsYWJlbF9pbl9waXBlbGluZSgKICAgICAgICAgICAgdGV4dF9jbGFzc2lmaWNhdGlvbl9tdWx0aWxhYmVsX3RyYWluLAogICAgICAgICAgICB0ZXh0X2NsYXNzaWZpY2F0aW9uX211bHRpbGFiZWxfdmFsaWQsCiAgICAgICAgKToKICAgICAgICAgICAgdGV4dF9jbGFzc2lmaWNhdGlvbl9tdWx0aWxhYmVsX25vZGUgPSB0ZXh0X2NsYXNzaWZpY2F0aW9uX211bHRpbGFiZWwoCiAgICAgICAgICAgICAgICB0cmFpbmluZ19kYXRhPXRleHRfY2xhc3NpZmljYXRpb25fbXVsdGlsYWJlbF90cmFpbiwKICAgICAgICAgICAgICAgIHZhbGlkYXRpb25fZGF0YT10ZXh0X2NsYXNzaWZpY2F0aW9uX211bHRpbGFiZWxfdmFsaWQsCiAgICAgICAgICAgICAgICB0YXJnZXRfY29sdW1uX25hbWU9InRlcm1zIiwKICAgICAgICAgICAgICAgIHByaW1hcnlfbWV0cmljPSJhY2N1cmFjeSIsCiAgICAgICAgICAgICkKICAgICAgICAgICAgdGV4dF9jbGFzc2lmaWNhdGlvbl9tdWx0aWxhYmVsX25vZGUuc2V0X2xpbWl0cyhtYXhfY29uY3VycmVudF90cmlhbHM9MSkKCiAgICAgICAgdGV4dF9jbGFzc2lmaWNhdGlvbl9tdWx0aWxhYmVsX3RyYWluID0gSW5wdXQoCiAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5NTFRBQkxFLAogICAgICAgICAgICBwYXRoPXRlc3RzX3Jvb3RfZGlyIC8gInRlc3RfY29uZmlncy9hdXRvbWxfam9iL3Rlc3RfZGF0YXNldHMvcGFwZXJfY2F0ZWdvcml6YXRpb24vdHJhaW4iLAogICAgICAgICkKCiAgICAgICAgdGV4dF9jbGFzc2lmaWNhdGlvbl9tdWx0aWxhYmVsX3ZhbGlkID0gSW5wdXQoCiAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5NTFRBQkxFLAogICAgICAgICAgICBwYXRoPXRlc3RzX3Jvb3RfZGlyIC8gInRlc3RfY29uZmlncy9hdXRvbWxfam9iL3Rlc3RfZGF0YXNldHMvcGFwZXJfY2F0ZWdvcml6YXRpb24vdmFsaWQiLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmVfam9iOiBQaXBlbGluZUpvYiA9IHRyYWluX2F1dG9tbF90ZXh0X2NsYXNzX211bHRpbGFiZWxfaW5fcGlwZWxpbmUoCiAgICAgICAgICAgIHRleHRfY2xhc3NpZmljYXRpb25fbXVsdGlsYWJlbF90cmFpbiwgdGV4dF9jbGFzc2lmaWNhdGlvbl9tdWx0aWxhYmVsX3ZhbGlkCiAgICAgICAgKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSBHUFVfQ0xVU1RFUgogICAgICAgIGZyb21fcmVzdF9waXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lX2pvYikKICAgICAgICBjYW5jZWxfam9iKGNsaWVudCwgZnJvbV9yZXN0X3BpcGVsaW5lX2pvYikKCiAgICAgICAgYWN0dWFsX2RpY3QgPSBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKQogICAgICAgIGZpZWxkc190b19vbWl0ID0gWyJuYW1lIiwgImRpc3BsYXlfbmFtZSIsICJleHBlcmltZW50X25hbWUiLCAicHJvcGVydGllcyJdCgogICAgICAgIGpvYl9kaWN0ID0gcHlkYXNoLm9taXQoYWN0dWFsX2RpY3RbInByb3BlcnRpZXMiXVsiam9icyJdWyJ0ZXh0X2NsYXNzaWZpY2F0aW9uX211bHRpbGFiZWxfbm9kZSJdLCBmaWVsZHNfdG9fb21pdCkKICAgICAgICBhc3NlcnQgam9iX2RpY3QgPT0gewogICAgICAgICAgICAidHJhaW5pbmdfZGF0YSI6ICIke3twYXJlbnQuaW5wdXRzLnRleHRfY2xhc3NpZmljYXRpb25fbXVsdGlsYWJlbF90cmFpbn19IiwKICAgICAgICAgICAgInZhbGlkYXRpb25fZGF0YSI6ICIke3twYXJlbnQuaW5wdXRzLnRleHRfY2xhc3NpZmljYXRpb25fbXVsdGlsYWJlbF92YWxpZH19IiwKICAgICAgICAgICAgInRhcmdldF9jb2x1bW5fbmFtZSI6ICJ0ZXJtcyIsCiAgICAgICAgICAgICJ0YWdzIjoge30sCiAgICAgICAgICAgICJ0eXBlIjogImF1dG9tbCIsCiAgICAgICAgICAgICJvdXRwdXRzIjoge30sCiAgICAgICAgICAgICJsaW1pdHMiOiB7Im1heF90cmlhbHMiOiAxLCAibWF4X25vZGVzIjogMSwgIm1heF9jb25jdXJyZW50X3RyaWFscyI6IDF9LAogICAgICAgICAgICAidGFzayI6ICJ0ZXh0X2NsYXNzaWZpY2F0aW9uX211bHRpbGFiZWwiLAogICAgICAgICAgICAicHJpbWFyeV9tZXRyaWMiOiAiYWNjdXJhY3kiLAogICAgICAgIH0KCiAgICBkZWYgdGVzdF9hdXRvbWxfdGV4dF9uZXJfaW5fcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgQGRzbC5waXBlbGluZShuYW1lPSJ0cmFpbl9hdXRvbWxfdGV4dF9uZXJfaW5fcGlwZWxpbmUiKQogICAgICAgIGRlZiB0cmFpbl9hdXRvbWxfdGV4dF9uZXJfaW5fcGlwZWxpbmUoCiAgICAgICAgICAgIHRleHRfbmVyX3RyYWluLAogICAgICAgICAgICB0ZXh0X25lcl92YWxpZCwKICAgICAgICApOgogICAgICAgICAgICB0ZXh0X25lcl9ub2RlID0gdGV4dF9uZXIoCiAgICAgICAgICAgICAgICB0cmFpbmluZ19kYXRhPXRleHRfbmVyX3RyYWluLAogICAgICAgICAgICAgICAgdmFsaWRhdGlvbl9kYXRhPXRleHRfbmVyX3ZhbGlkLAogICAgICAgICAgICAgICAgdGFyZ2V0X2NvbHVtbl9uYW1lPSJsYWJlbCIsCiAgICAgICAgICAgICAgICBwcmltYXJ5X21ldHJpYz0iYWNjdXJhY3kiLAogICAgICAgICAgICApCiAgICAgICAgICAgIHRleHRfbmVyX25vZGUuc2V0X2xpbWl0cyhtYXhfY29uY3VycmVudF90cmlhbHM9MSkKCiAgICAgICAgdGV4dF9uZXJfdHJhaW4gPSBJbnB1dCgKICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgIHBhdGg9dGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2F1dG9tbF9qb2IvdGVzdF9kYXRhc2V0cy9jb25sbDIwMDMvdHJhaW4iLAogICAgICAgICkKICAgICAgICB0ZXh0X25lcl92YWxpZCA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL2NvbmxsMjAwMy92YWxpZCIsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZV9qb2I6IFBpcGVsaW5lSm9iID0gdHJhaW5fYXV0b21sX3RleHRfbmVyX2luX3BpcGVsaW5lKHRleHRfbmVyX3RyYWluLCB0ZXh0X25lcl92YWxpZCkKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gR1BVX0NMVVNURVIKICAgICAgICBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZV9qb2IpCiAgICAgICAgY2FuY2VsX2pvYihjbGllbnQsIGZyb21fcmVzdF9waXBlbGluZV9qb2IpCgogICAgICAgIGFjdHVhbF9kaWN0ID0gZnJvbV9yZXN0X3BpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCkKICAgICAgICBmaWVsZHNfdG9fb21pdCA9IFsibmFtZSIsICJkaXNwbGF5X25hbWUiLCAiZXhwZXJpbWVudF9uYW1lIiwgInByb3BlcnRpZXMiXQoKICAgICAgICBqb2JfZGljdCA9IHB5ZGFzaC5vbWl0KGFjdHVhbF9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXVsidGV4dF9uZXJfbm9kZSJdLCBmaWVsZHNfdG9fb21pdCkKICAgICAgICBhc3NlcnQgam9iX2RpY3QgPT0gewogICAgICAgICAgICAidHJhaW5pbmdfZGF0YSI6ICIke3twYXJlbnQuaW5wdXRzLnRleHRfbmVyX3RyYWlufX0iLAogICAgICAgICAgICAidmFsaWRhdGlvbl9kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMudGV4dF9uZXJfdmFsaWR9fSIsCiAgICAgICAgICAgICJ0YXJnZXRfY29sdW1uX25hbWUiOiAibGFiZWwiLAogICAgICAgICAgICAidGFncyI6IHt9LAogICAgICAgICAgICAidHlwZSI6ICJhdXRvbWwiLAogICAgICAgICAgICAib3V0cHV0cyI6IHt9LAogICAgICAgICAgICAibGltaXRzIjogeyJtYXhfdHJpYWxzIjogMSwgIm1heF9ub2RlcyI6IDEsICJtYXhfY29uY3VycmVudF90cmlhbHMiOiAxfSwKICAgICAgICAgICAgInRhc2siOiAidGV4dF9uZXIiLAogICAgICAgICAgICAicHJpbWFyeV9tZXRyaWMiOiAiYWNjdXJhY3kiLAogICAgICAgIH0KCiAgICBkZWYgdGVzdF9hdXRvbWxfdmlzaW9uX211bHRpY2xhc3Nfbm9kZV9pbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBAZHNsLnBpcGVsaW5lKG5hbWU9InRyYWluX211bHRpY2xhc3Nfd2l0aF9hdXRvbWxfaW5fcGlwZWxpbmUiKQogICAgICAgIGRlZiB0cmFpbl9tdWx0aWNsYXNzX3dpdGhfYXV0b21sX2luX3BpcGVsaW5lKAogICAgICAgICAgICBpbWFnZV9tdWx0aWNsYXNzX3RyYWluX2RhdGEsCiAgICAgICAgICAgIGltYWdlX211bHRpY2xhc3NfdmFsaWRfZGF0YSwKICAgICAgICApOgogICAgICAgICAgICBpbWFnZV9tdWx0aWNsYXNzX25vZGUgPSBhdXRvbWwuaW1hZ2VfY2xhc3NpZmljYXRpb24oCiAgICAgICAgICAgICAgICB0cmFpbmluZ19kYXRhPWltYWdlX211bHRpY2xhc3NfdHJhaW5fZGF0YSwKICAgICAgICAgICAgICAgIHZhbGlkYXRpb25fZGF0YT1pbWFnZV9tdWx0aWNsYXNzX3ZhbGlkX2RhdGEsCiAgICAgICAgICAgICAgICB0YXJnZXRfY29sdW1uX25hbWU9ImxhYmVsIiwKICAgICAgICAgICAgICAgIHByaW1hcnlfbWV0cmljPSJBY2N1cmFjeSIsCiAgICAgICAgICAgICkKICAgICAgICAgICAgaW1hZ2VfbXVsdGljbGFzc19ub2RlLnNldF9saW1pdHMoCiAgICAgICAgICAgICAgICB0aW1lb3V0X21pbnV0ZXM9NjAsCiAgICAgICAgICAgICkKICAgICAgICAgICAgaW1hZ2VfbXVsdGljbGFzc19ub2RlLmV4dGVuZF9zZWFyY2hfc3BhY2UoCiAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgU2VhcmNoU3BhY2UoCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsX25hbWU9Q2hvaWNlKFsidml0czE2cjIyNCJdKSwKICAgICAgICAgICAgICAgICAgICAgICAgbGVhcm5pbmdfcmF0ZT1Vbmlmb3JtKDAuMDAxLCAwLjAxKSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIFNlYXJjaFNwYWNlKAogICAgICAgICAgICAgICAgICAgICAgICBtb2RlbF9uYW1lPUNob2ljZShbInNlcmVzbmV4dCJdKSwKICAgICAgICAgICAgICAgICAgICAgICAgbGVhcm5pbmdfcmF0ZT1Vbmlmb3JtKDAuMDAxLCAwLjAxKSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICApCiAgICAgICAgICAgIGltYWdlX211bHRpY2xhc3Nfbm9kZS5zZXRfc3dlZXAoCiAgICAgICAgICAgICAgICBzYW1wbGluZ19hbGdvcml0aG09IlJhbmRvbSIsCiAgICAgICAgICAgICAgICBlYXJseV90ZXJtaW5hdGlvbj1CYW5kaXRQb2xpY3koZXZhbHVhdGlvbl9pbnRlcnZhbD0yLCBzbGFja19mYWN0b3I9MC4yLCBkZWxheV9ldmFsdWF0aW9uPTYpLAogICAgICAgICAgICApCiAgICAgICAgICAgIGltYWdlX211bHRpY2xhc3Nfbm9kZS5zZXRfbGltaXRzKAogICAgICAgICAgICAgICAgbWF4X3RyaWFscz0xLAogICAgICAgICAgICAgICAgbWF4X2NvbmN1cnJlbnRfdHJpYWxzPTEsCiAgICAgICAgICAgICkKCiAgICAgICAgbXVsdGljbGFzc190cmFpbiA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL2ltYWdlX2NsYXNzaWZpY2F0aW9uL3RyYWluIiwKICAgICAgICApCiAgICAgICAgbXVsdGljbGFzc192YWxpZCA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL2ltYWdlX2NsYXNzaWZpY2F0aW9uL3ZhbGlkIiwKICAgICAgICApCgogICAgICAgIHBpcGVsaW5lX2pvYjogUGlwZWxpbmVKb2IgPSB0cmFpbl9tdWx0aWNsYXNzX3dpdGhfYXV0b21sX2luX3BpcGVsaW5lKG11bHRpY2xhc3NfdHJhaW4sIG11bHRpY2xhc3NfdmFsaWQpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9IEdQVV9DTFVTVEVSCgogICAgICAgIGZyb21fcmVzdF9waXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lX2pvYikKICAgICAgICBjYW5jZWxfam9iKGNsaWVudCwgZnJvbV9yZXN0X3BpcGVsaW5lX2pvYikKCiAgICAgICAgYWN0dWFsX2RpY3QgPSBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKQogICAgICAgIGZpZWxkc190b19vbWl0ID0gWyJuYW1lIiwgImRpc3BsYXlfbmFtZSIsICJleHBlcmltZW50X25hbWUiLCAicHJvcGVydGllcyJdCgogICAgICAgIGltYWdlX211bHRpY2xhc3NfZGljdCA9IHB5ZGFzaC5vbWl0KGFjdHVhbF9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXVsiaW1hZ2VfbXVsdGljbGFzc19ub2RlIl0sIGZpZWxkc190b19vbWl0KQogICAgICAgIGFzc2VydCBpbWFnZV9tdWx0aWNsYXNzX2RpY3QgPT0gewogICAgICAgICAgICAibGltaXRzIjogeyJtYXhfY29uY3VycmVudF90cmlhbHMiOiAxLCAibWF4X3RyaWFscyI6IDEsICJ0aW1lb3V0X21pbnV0ZXMiOiA2MH0sCiAgICAgICAgICAgICJsb2dfdmVyYm9zaXR5IjogImluZm8iLAogICAgICAgICAgICAib3V0cHV0cyI6IHt9LAogICAgICAgICAgICAicHJpbWFyeV9tZXRyaWMiOiAiYWNjdXJhY3kiLAogICAgICAgICAgICAidGFncyI6IHt9LAogICAgICAgICAgICAidGFyZ2V0X2NvbHVtbl9uYW1lIjogImxhYmVsIiwKICAgICAgICAgICAgInRhc2siOiAiaW1hZ2VfY2xhc3NpZmljYXRpb24iLAogICAgICAgICAgICAidHJhaW5pbmdfZGF0YSI6ICIke3twYXJlbnQuaW5wdXRzLmltYWdlX211bHRpY2xhc3NfdHJhaW5fZGF0YX19IiwKICAgICAgICAgICAgInR5cGUiOiAiYXV0b21sIiwKICAgICAgICAgICAgInZhbGlkYXRpb25fZGF0YSI6ICIke3twYXJlbnQuaW5wdXRzLmltYWdlX211bHRpY2xhc3NfdmFsaWRfZGF0YX19IiwKICAgICAgICAgICAgInN3ZWVwIjogewogICAgICAgICAgICAgICAgInNhbXBsaW5nX2FsZ29yaXRobSI6ICJyYW5kb20iLAogICAgICAgICAgICAgICAgImVhcmx5X3Rlcm1pbmF0aW9uIjogewogICAgICAgICAgICAgICAgICAgICJldmFsdWF0aW9uX2ludGVydmFsIjogMiwKICAgICAgICAgICAgICAgICAgICAiZGVsYXlfZXZhbHVhdGlvbiI6IDYsCiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiYmFuZGl0IiwKICAgICAgICAgICAgICAgICAgICAic2xhY2tfZmFjdG9yIjogMC4yLAogICAgICAgICAgICAgICAgICAgICJzbGFja19hbW91bnQiOiAwLjAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICAic2VhcmNoX3NwYWNlIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJsZWFybmluZ19yYXRlIjogInVuaWZvcm0oMC4wMDEsMC4wMSkiLAogICAgICAgICAgICAgICAgICAgICJtb2RlbF9uYW1lIjogImNob2ljZSgndml0czE2cjIyNCcpIiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgImxlYXJuaW5nX3JhdGUiOiAidW5pZm9ybSgwLjAwMSwwLjAxKSIsCiAgICAgICAgICAgICAgICAgICAgIm1vZGVsX25hbWUiOiAiY2hvaWNlKCdzZXJlc25leHQnKSIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICBdLAogICAgICAgIH0KCiAgICBkZWYgdGVzdF9hdXRvbWxfdmlzaW9uX211bHRpbGFiZWxfbm9kZV9pbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBAZHNsLnBpcGVsaW5lKG5hbWU9InRyYWluX211bHRpbGFiZWxfd2l0aF9hdXRvbWxfaW5fcGlwZWxpbmUiKQogICAgICAgIGRlZiB0cmFpbl9tdWx0aWxhYmVsX3dpdGhfYXV0b21sX2luX3BpcGVsaW5lKAogICAgICAgICAgICBpbWFnZV9tdWx0aWxhYmVsX3RyYWluX2RhdGEsCiAgICAgICAgICAgIGltYWdlX211bHRpbGFiZWxfdmFsaWRfZGF0YSwKICAgICAgICApOgogICAgICAgICAgICBpbWFnZV9tdWx0aWxhYmVsX25vZGUgPSBhdXRvbWwuaW1hZ2VfY2xhc3NpZmljYXRpb25fbXVsdGlsYWJlbCgKICAgICAgICAgICAgICAgIHRyYWluaW5nX2RhdGE9aW1hZ2VfbXVsdGlsYWJlbF90cmFpbl9kYXRhLAogICAgICAgICAgICAgICAgdmFsaWRhdGlvbl9kYXRhPWltYWdlX211bHRpbGFiZWxfdmFsaWRfZGF0YSwKICAgICAgICAgICAgICAgIHRhcmdldF9jb2x1bW5fbmFtZT0ibGFiZWwiLAogICAgICAgICAgICAgICAgcHJpbWFyeV9tZXRyaWM9ImlvdSIsCiAgICAgICAgICAgICkKICAgICAgICAgICAgaW1hZ2VfbXVsdGlsYWJlbF9ub2RlLnNldF9saW1pdHMoCiAgICAgICAgICAgICAgICB0aW1lb3V0X21pbnV0ZXM9NjAsCiAgICAgICAgICAgICkKICAgICAgICAgICAgaW1hZ2VfbXVsdGlsYWJlbF9ub2RlLmV4dGVuZF9zZWFyY2hfc3BhY2UoCiAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgU2VhcmNoU3BhY2UoCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsX25hbWU9Q2hvaWNlKFsidml0YjE2cjIyNCJdKSwKICAgICAgICAgICAgICAgICAgICAgICAgbGVhcm5pbmdfcmF0ZT1Vbmlmb3JtKDAuMDAxLCAwLjAxKSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIFNlYXJjaFNwYWNlKAogICAgICAgICAgICAgICAgICAgICAgICBtb2RlbF9uYW1lPUNob2ljZShbInNlcmVzbmV4dCJdKSwKICAgICAgICAgICAgICAgICAgICAgICAgbGVhcm5pbmdfcmF0ZT1Vbmlmb3JtKDAuMDAxLCAwLjAxKSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICApCiAgICAgICAgICAgIGltYWdlX211bHRpbGFiZWxfbm9kZS5zZXRfc3dlZXAoCiAgICAgICAgICAgICAgICBzYW1wbGluZ19hbGdvcml0aG09IlJhbmRvbSIsCiAgICAgICAgICAgICAgICBlYXJseV90ZXJtaW5hdGlvbj1CYW5kaXRQb2xpY3koZXZhbHVhdGlvbl9pbnRlcnZhbD0yLCBzbGFja19mYWN0b3I9MC4yLCBkZWxheV9ldmFsdWF0aW9uPTYpLAogICAgICAgICAgICApCiAgICAgICAgICAgIGltYWdlX211bHRpbGFiZWxfbm9kZS5zZXRfbGltaXRzKAogICAgICAgICAgICAgICAgbWF4X3RyaWFscz0xLAogICAgICAgICAgICAgICAgbWF4X2NvbmN1cnJlbnRfdHJpYWxzPTEsCiAgICAgICAgICAgICkKCiAgICAgICAgbXVsdGlsYWJlbF90cmFpbiA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL2ltYWdlX2NsYXNzaWZpY2F0aW9uX211bHRpbGFiZWwvdHJhaW4iLAogICAgICAgICkKICAgICAgICBtdWx0aWxhYmVsX3ZhbGlkID0gSW5wdXQoCiAgICAgICAgICAgIHR5cGU9QXNzZXRUeXBlcy5NTFRBQkxFLAogICAgICAgICAgICBwYXRoPXRlc3RzX3Jvb3RfZGlyIC8gInRlc3RfY29uZmlncy9hdXRvbWxfam9iL3Rlc3RfZGF0YXNldHMvaW1hZ2VfY2xhc3NpZmljYXRpb25fbXVsdGlsYWJlbC92YWxpZCIsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZV9qb2I6IFBpcGVsaW5lSm9iID0gdHJhaW5fbXVsdGlsYWJlbF93aXRoX2F1dG9tbF9pbl9waXBlbGluZShtdWx0aWxhYmVsX3RyYWluLCBtdWx0aWxhYmVsX3ZhbGlkKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSBHUFVfQ0xVU1RFUgoKICAgICAgICBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iID0gY2xpZW50LmpvYnMuY3JlYXRlX29yX3VwZGF0ZShwaXBlbGluZV9qb2IpCiAgICAgICAgY2FuY2VsX2pvYihjbGllbnQsIGZyb21fcmVzdF9waXBlbGluZV9qb2IpCgogICAgICAgIGFjdHVhbF9kaWN0ID0gZnJvbV9yZXN0X3BpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCkKICAgICAgICBmaWVsZHNfdG9fb21pdCA9IFsibmFtZSIsICJkaXNwbGF5X25hbWUiLCAiZXhwZXJpbWVudF9uYW1lIiwgInByb3BlcnRpZXMiXQoKICAgICAgICBpbWFnZV9tdWx0aWxhYmVsX2RpY3QgPSBweWRhc2gub21pdChhY3R1YWxfZGljdFsicHJvcGVydGllcyJdWyJqb2JzIl1bImltYWdlX211bHRpbGFiZWxfbm9kZSJdLCBmaWVsZHNfdG9fb21pdCkKICAgICAgICBhc3NlcnQgaW1hZ2VfbXVsdGlsYWJlbF9kaWN0ID09IHsKICAgICAgICAgICAgImxpbWl0cyI6IHsibWF4X2NvbmN1cnJlbnRfdHJpYWxzIjogMSwgIm1heF90cmlhbHMiOiAxLCAidGltZW91dF9taW51dGVzIjogNjB9LAogICAgICAgICAgICAibG9nX3ZlcmJvc2l0eSI6ICJpbmZvIiwKICAgICAgICAgICAgIm91dHB1dHMiOiB7fSwKICAgICAgICAgICAgInByaW1hcnlfbWV0cmljIjogImlvdSIsCiAgICAgICAgICAgICJ0YWdzIjoge30sCiAgICAgICAgICAgICJ0YXJnZXRfY29sdW1uX25hbWUiOiAibGFiZWwiLAogICAgICAgICAgICAidGFzayI6ICJpbWFnZV9jbGFzc2lmaWNhdGlvbl9tdWx0aWxhYmVsIiwKICAgICAgICAgICAgInRyYWluaW5nX2RhdGEiOiAiJHt7cGFyZW50LmlucHV0cy5pbWFnZV9tdWx0aWxhYmVsX3RyYWluX2RhdGF9fSIsCiAgICAgICAgICAgICJ0eXBlIjogImF1dG9tbCIsCiAgICAgICAgICAgICJ2YWxpZGF0aW9uX2RhdGEiOiAiJHt7cGFyZW50LmlucHV0cy5pbWFnZV9tdWx0aWxhYmVsX3ZhbGlkX2RhdGF9fSIsCiAgICAgICAgICAgICJzd2VlcCI6IHsKICAgICAgICAgICAgICAgICJzYW1wbGluZ19hbGdvcml0aG0iOiAicmFuZG9tIiwKICAgICAgICAgICAgICAgICJlYXJseV90ZXJtaW5hdGlvbiI6IHsKICAgICAgICAgICAgICAgICAgICAiZXZhbHVhdGlvbl9pbnRlcnZhbCI6IDIsCiAgICAgICAgICAgICAgICAgICAgImRlbGF5X2V2YWx1YXRpb24iOiA2LAogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImJhbmRpdCIsCiAgICAgICAgICAgICAgICAgICAgInNsYWNrX2ZhY3RvciI6IDAuMiwKICAgICAgICAgICAgICAgICAgICAic2xhY2tfYW1vdW50IjogMC4wLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInNlYXJjaF9zcGFjZSI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibW9kZWxfbmFtZSI6ICJjaG9pY2UoJ3ZpdGIxNnIyMjQnKSIsCiAgICAgICAgICAgICAgICAgICAgImxlYXJuaW5nX3JhdGUiOiAidW5pZm9ybSgwLjAwMSwwLjAxKSIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtb2RlbF9uYW1lIjogImNob2ljZSgnc2VyZXNuZXh0JykiLAogICAgICAgICAgICAgICAgICAgICJsZWFybmluZ19yYXRlIjogInVuaWZvcm0oMC4wMDEsMC4wMSkiLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgXSwKICAgICAgICB9CgogICAgZGVmIHRlc3RfYXV0b21sX3Zpc2lvbl9vZF9ub2RlX2luX3BpcGVsaW5lKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIEBkc2wucGlwZWxpbmUobmFtZT0idHJhaW5fb2Rfd2l0aF9hdXRvbWxfaW5fcGlwZWxpbmUiKQogICAgICAgIGRlZiB0cmFpbl9vZF93aXRoX2F1dG9tbF9pbl9waXBlbGluZSgKICAgICAgICAgICAgaW1hZ2Vfb2JqZWN0X2RldGVjdGlvbl90cmFpbl9kYXRhLAogICAgICAgICAgICBpbWFnZV9vYmplY3RfZGV0ZWN0aW9uX3ZhbGlkX2RhdGEsCiAgICAgICAgKToKICAgICAgICAgICAgaW1hZ2Vfb2JqZWN0X2RldGVjdGlvbl9ub2RlID0gYXV0b21sLmltYWdlX29iamVjdF9kZXRlY3Rpb24oCiAgICAgICAgICAgICAgICB0cmFpbmluZ19kYXRhPWltYWdlX29iamVjdF9kZXRlY3Rpb25fdHJhaW5fZGF0YSwKICAgICAgICAgICAgICAgIHZhbGlkYXRpb25fZGF0YT1pbWFnZV9vYmplY3RfZGV0ZWN0aW9uX3ZhbGlkX2RhdGEsCiAgICAgICAgICAgICAgICB0YXJnZXRfY29sdW1uX25hbWU9ImxhYmVsIiwKICAgICAgICAgICAgICAgIHByaW1hcnlfbWV0cmljPSJNZWFuQXZlcmFnZVByZWNpc2lvbiIsCiAgICAgICAgICAgICkKCiAgICAgICAgICAgIGltYWdlX29iamVjdF9kZXRlY3Rpb25fbm9kZS5leHRlbmRfc2VhcmNoX3NwYWNlKAogICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgIFNlYXJjaFNwYWNlKAogICAgICAgICAgICAgICAgICAgICAgICBtb2RlbF9uYW1lPUNob2ljZShbInlvbG92NSJdKSwKICAgICAgICAgICAgICAgICAgICAgICAgbGVhcm5pbmdfcmF0ZT1Vbmlmb3JtKDAuMDAwMSwgMC4wMSksCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsX3NpemU9Q2hvaWNlKFsic21hbGwiLCAibWVkaXVtIl0pLCAgIyBtb2RlbC1zcGVjaWZpYwogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgU2VhcmNoU3BhY2UoCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsX25hbWU9Q2hvaWNlKFsiZmFzdGVycmNubl9yZXNuZXQ1MF9mcG4iXSksCiAgICAgICAgICAgICAgICAgICAgICAgIGxlYXJuaW5nX3JhdGU9VW5pZm9ybSgwLjAwMDEsIDAuMDAxKSwKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW1pemVyPUNob2ljZShbInNnZCIsICJhZGFtIiwgImFkYW13Il0pLAogICAgICAgICAgICAgICAgICAgICAgICBtaW5fc2l6ZT1DaG9pY2UoWzYwMCwgODAwXSksICAjIG1vZGVsLXNwZWNpZmljCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgKQogICAgICAgICAgICBpbWFnZV9vYmplY3RfZGV0ZWN0aW9uX25vZGUuc2V0X3RyYWluaW5nX3BhcmFtZXRlcnMobm1zX2lvdV90aHJlc2hvbGQ9MC43KQogICAgICAgICAgICBpbWFnZV9vYmplY3RfZGV0ZWN0aW9uX25vZGUuc2V0X2xpbWl0cygKICAgICAgICAgICAgICAgIHRpbWVvdXRfbWludXRlcz02MCwKICAgICAgICAgICAgKQogICAgICAgICAgICBpbWFnZV9vYmplY3RfZGV0ZWN0aW9uX25vZGUuc2V0X3N3ZWVwKAogICAgICAgICAgICAgICAgc2FtcGxpbmdfYWxnb3JpdGhtPSJSYW5kb20iLAogICAgICAgICAgICAgICAgZWFybHlfdGVybWluYXRpb249QmFuZGl0UG9saWN5KGV2YWx1YXRpb25faW50ZXJ2YWw9Miwgc2xhY2tfZmFjdG9yPTAuMiwgZGVsYXlfZXZhbHVhdGlvbj02KSwKICAgICAgICAgICAgKQogICAgICAgICAgICBpbWFnZV9vYmplY3RfZGV0ZWN0aW9uX25vZGUuc2V0X2xpbWl0cygKICAgICAgICAgICAgICAgIG1heF90cmlhbHM9MSwKICAgICAgICAgICAgICAgIG1heF9jb25jdXJyZW50X3RyaWFscz0xLAogICAgICAgICAgICApCgogICAgICAgIG9iamVjdF9kZXRlY3Rpb25fdHJhaW4gPSBJbnB1dCgKICAgICAgICAgICAgdHlwZT1Bc3NldFR5cGVzLk1MVEFCTEUsCiAgICAgICAgICAgIHBhdGg9dGVzdHNfcm9vdF9kaXIgLyAidGVzdF9jb25maWdzL2F1dG9tbF9qb2IvdGVzdF9kYXRhc2V0cy9pbWFnZV9vYmplY3RfZGV0ZWN0aW9uL3RyYWluIiwKICAgICAgICApCiAgICAgICAgb2JqZWN0X2RldGVjdGlvbl92YWxpZCA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL2ltYWdlX29iamVjdF9kZXRlY3Rpb24vdmFsaWQiLAogICAgICAgICkKCiAgICAgICAgcGlwZWxpbmVfam9iOiBQaXBlbGluZUpvYiA9IHRyYWluX29kX3dpdGhfYXV0b21sX2luX3BpcGVsaW5lKG9iamVjdF9kZXRlY3Rpb25fdHJhaW4sIG9iamVjdF9kZXRlY3Rpb25fdmFsaWQpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9IEdQVV9DTFVTVEVSCgogICAgICAgIGZyb21fcmVzdF9waXBlbGluZV9qb2IgPSBjbGllbnQuam9icy5jcmVhdGVfb3JfdXBkYXRlKHBpcGVsaW5lX2pvYikKICAgICAgICBjYW5jZWxfam9iKGNsaWVudCwgZnJvbV9yZXN0X3BpcGVsaW5lX2pvYikKCiAgICAgICAgYWN0dWFsX2RpY3QgPSBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKQogICAgICAgIGZpZWxkc190b19vbWl0ID0gWyJuYW1lIiwgImRpc3BsYXlfbmFtZSIsICJleHBlcmltZW50X25hbWUiLCAicHJvcGVydGllcyJdCgogICAgICAgIGltYWdlX29iamVjdF9kZXRlY3Rpb25fZGljdCA9IHB5ZGFzaC5vbWl0KAogICAgICAgICAgICBhY3R1YWxfZGljdFsicHJvcGVydGllcyJdWyJqb2JzIl1bImltYWdlX29iamVjdF9kZXRlY3Rpb25fbm9kZSJdLCBmaWVsZHNfdG9fb21pdAogICAgICAgICkKICAgICAgICBhc3NlcnQgaW1hZ2Vfb2JqZWN0X2RldGVjdGlvbl9kaWN0ID09IHsKICAgICAgICAgICAgImxpbWl0cyI6IHsibWF4X2NvbmN1cnJlbnRfdHJpYWxzIjogMSwgIm1heF90cmlhbHMiOiAxLCAidGltZW91dF9taW51dGVzIjogNjB9LAogICAgICAgICAgICAibG9nX3ZlcmJvc2l0eSI6ICJpbmZvIiwKICAgICAgICAgICAgIm91dHB1dHMiOiB7fSwKICAgICAgICAgICAgInByaW1hcnlfbWV0cmljIjogIm1lYW5fYXZlcmFnZV9wcmVjaXNpb24iLAogICAgICAgICAgICAidGFncyI6IHt9LAogICAgICAgICAgICAidGFyZ2V0X2NvbHVtbl9uYW1lIjogImxhYmVsIiwKICAgICAgICAgICAgInRhc2siOiAiaW1hZ2Vfb2JqZWN0X2RldGVjdGlvbiIsCiAgICAgICAgICAgICJ0cmFpbmluZ19kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMuaW1hZ2Vfb2JqZWN0X2RldGVjdGlvbl90cmFpbl9kYXRhfX0iLAogICAgICAgICAgICAidHlwZSI6ICJhdXRvbWwiLAogICAgICAgICAgICAidmFsaWRhdGlvbl9kYXRhIjogIiR7e3BhcmVudC5pbnB1dHMuaW1hZ2Vfb2JqZWN0X2RldGVjdGlvbl92YWxpZF9kYXRhfX0iLAogICAgICAgICAgICAidHJhaW5pbmdfcGFyYW1ldGVycyI6IHsibm1zX2lvdV90aHJlc2hvbGQiOiAwLjd9LAogICAgICAgICAgICAic3dlZXAiOiB7CiAgICAgICAgICAgICAgICAic2FtcGxpbmdfYWxnb3JpdGhtIjogInJhbmRvbSIsCiAgICAgICAgICAgICAgICAiZWFybHlfdGVybWluYXRpb24iOiB7CiAgICAgICAgICAgICAgICAgICAgImV2YWx1YXRpb25faW50ZXJ2YWwiOiAyLAogICAgICAgICAgICAgICAgICAgICJkZWxheV9ldmFsdWF0aW9uIjogNiwKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJiYW5kaXQiLAogICAgICAgICAgICAgICAgICAgICJzbGFja19mYWN0b3IiOiAwLjIsCiAgICAgICAgICAgICAgICAgICAgInNsYWNrX2Ftb3VudCI6IDAuMCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJzZWFyY2hfc3BhY2UiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgImxlYXJuaW5nX3JhdGUiOiAidW5pZm9ybSgwLjAwMDEsMC4wMSkiLAogICAgICAgICAgICAgICAgICAgICJtb2RlbF9uYW1lIjogImNob2ljZSgneW9sb3Y1JykiLAogICAgICAgICAgICAgICAgICAgICJtb2RlbF9zaXplIjogImNob2ljZSgnc21hbGwnLCdtZWRpdW0nKSIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJsZWFybmluZ19yYXRlIjogInVuaWZvcm0oMC4wMDAxLDAuMDAxKSIsCiAgICAgICAgICAgICAgICAgICAgIm1pbl9zaXplIjogImNob2ljZSg2MDAsODAwKSIsCiAgICAgICAgICAgICAgICAgICAgIm1vZGVsX25hbWUiOiAiY2hvaWNlKCdmYXN0ZXJyY25uX3Jlc25ldDUwX2ZwbicpIiwKICAgICAgICAgICAgICAgICAgICAib3B0aW1pemVyIjogImNob2ljZSgnc2dkJywnYWRhbScsJ2FkYW13JykiLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgXSwKICAgICAgICB9CgogICAgZGVmIHRlc3RfYXV0b21sX3Zpc2lvbl9zZWdtZW50YXRpb25fbm9kZV9pbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBAZHNsLnBpcGVsaW5lKG5hbWU9InRyYWluX3dpdGhfYXV0b21sX2luX3BpcGVsaW5lIikKICAgICAgICBkZWYgdHJhaW5fc2VnbWVudGF0aW9uX3dpdGhfYXV0b21sX2luX3BpcGVsaW5lKAogICAgICAgICAgICBpbWFnZV9pbnN0YW5jZV9zZWdtZW50YXRpb25fdHJhaW5fZGF0YSwKICAgICAgICAgICAgaW1hZ2VfaW5zdGFuY2Vfc2VnbWVudGF0aW9uX3ZhbGlkX2RhdGEsCiAgICAgICAgKToKICAgICAgICAgICAgaW1hZ2VfaW5zdGFuY2Vfc2VnbWVudGF0aW9uX25vZGUgPSBhdXRvbWwuaW1hZ2VfaW5zdGFuY2Vfc2VnbWVudGF0aW9uKAogICAgICAgICAgICAgICAgcHJpbWFyeV9tZXRyaWM9Ik1lYW5BdmVyYWdlUHJlY2lzaW9uIiwKICAgICAgICAgICAgICAgIHRhcmdldF9jb2x1bW5fbmFtZT0ibGFiZWwiLAogICAgICAgICAgICAgICAgdHJhaW5pbmdfZGF0YT1pbWFnZV9pbnN0YW5jZV9zZWdtZW50YXRpb25fdHJhaW5fZGF0YSwKICAgICAgICAgICAgICAgIHZhbGlkYXRpb25fZGF0YT1pbWFnZV9pbnN0YW5jZV9zZWdtZW50YXRpb25fdmFsaWRfZGF0YSwKICAgICAgICAgICAgKQogICAgICAgICAgICBpbWFnZV9pbnN0YW5jZV9zZWdtZW50YXRpb25fbm9kZS5zZXRfbGltaXRzKAogICAgICAgICAgICAgICAgdGltZW91dF9taW51dGVzPTYwLAogICAgICAgICAgICApCiAgICAgICAgICAgIGltYWdlX2luc3RhbmNlX3NlZ21lbnRhdGlvbl9ub2RlLnNldF90cmFpbmluZ19wYXJhbWV0ZXJzKG5tc19pb3VfdGhyZXNob2xkPTAuNykKICAgICAgICAgICAgaW1hZ2VfaW5zdGFuY2Vfc2VnbWVudGF0aW9uX25vZGUuZXh0ZW5kX3NlYXJjaF9zcGFjZSgKICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICBTZWFyY2hTcGFjZSgKICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWxfbmFtZT1DaG9pY2UoWyJtYXNrcmNubl9yZXNuZXQ1MF9mcG4iXSksCiAgICAgICAgICAgICAgICAgICAgICAgIGxlYXJuaW5nX3JhdGU9VW5pZm9ybSgwLjAwMDEsIDAuMDAxKSwKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW1pemVyPUNob2ljZShbInNnZCIsICJhZGFtIiwgImFkYW13Il0pLAogICAgICAgICAgICAgICAgICAgICAgICBtaW5fc2l6ZT1DaG9pY2UoWzYwMCwgODAwXSksCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgKQoKICAgICAgICAgICAgaW1hZ2VfaW5zdGFuY2Vfc2VnbWVudGF0aW9uX25vZGUuc2V0X3N3ZWVwKAogICAgICAgICAgICAgICAgc2FtcGxpbmdfYWxnb3JpdGhtPSJSYW5kb20iLAogICAgICAgICAgICAgICAgZWFybHlfdGVybWluYXRpb249QmFuZGl0UG9saWN5KGV2YWx1YXRpb25faW50ZXJ2YWw9Miwgc2xhY2tfZmFjdG9yPTAuMiwgZGVsYXlfZXZhbHVhdGlvbj02KSwKICAgICAgICAgICAgKQogICAgICAgICAgICBpbWFnZV9pbnN0YW5jZV9zZWdtZW50YXRpb25fbm9kZS5zZXRfbGltaXRzKAogICAgICAgICAgICAgICAgbWF4X3RyaWFscz0xMCwKICAgICAgICAgICAgICAgIG1heF9jb25jdXJyZW50X3RyaWFscz0yLAogICAgICAgICAgICApCgogICAgICAgIGluc3RhbmNlX3NlZ21lbnRhdGlvbl90cmFpbiA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL2ltYWdlX2luc3RhbmNlX3NlZ21lbnRhdGlvbi90cmFpbiIsCiAgICAgICAgKQogICAgICAgIGluc3RhbmNlX3NlZ21lbnRhdGlvbl92YWxpZCA9IElucHV0KAogICAgICAgICAgICB0eXBlPUFzc2V0VHlwZXMuTUxUQUJMRSwKICAgICAgICAgICAgcGF0aD10ZXN0c19yb290X2RpciAvICJ0ZXN0X2NvbmZpZ3MvYXV0b21sX2pvYi90ZXN0X2RhdGFzZXRzL2ltYWdlX2luc3RhbmNlX3NlZ21lbnRhdGlvbi92YWxpZCIsCiAgICAgICAgKQoKICAgICAgICBwaXBlbGluZV9qb2I6IFBpcGVsaW5lSm9iID0gdHJhaW5fc2VnbWVudGF0aW9uX3dpdGhfYXV0b21sX2luX3BpcGVsaW5lKAogICAgICAgICAgICBpbnN0YW5jZV9zZWdtZW50YXRpb25fdHJhaW4sIGluc3RhbmNlX3NlZ21lbnRhdGlvbl92YWxpZAogICAgICAgICkKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gR1BVX0NMVVNURVIKCiAgICAgICAgZnJvbV9yZXN0X3BpcGVsaW5lX2pvYiA9IGNsaWVudC5qb2JzLmNyZWF0ZV9vcl91cGRhdGUocGlwZWxpbmVfam9iKQogICAgICAgIGNhbmNlbF9qb2IoY2xpZW50LCBmcm9tX3Jlc3RfcGlwZWxpbmVfam9iKQoKICAgICAgICBhY3R1YWxfZGljdCA9IGZyb21fcmVzdF9waXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpCiAgICAgICAgZmllbGRzX3RvX29taXQgPSBbIm5hbWUiLCAiZGlzcGxheV9uYW1lIiwgImV4cGVyaW1lbnRfbmFtZSIsICJwcm9wZXJ0aWVzIl0KCiAgICAgICAgaW1hZ2VfaW5zdGFuY2Vfc2VnbWVudGF0aW9uX2RpY3QgPSBweWRhc2gub21pdCgKICAgICAgICAgICAgYWN0dWFsX2RpY3RbInByb3BlcnRpZXMiXVsiam9icyJdWyJpbWFnZV9pbnN0YW5jZV9zZWdtZW50YXRpb25fbm9kZSJdLCBmaWVsZHNfdG9fb21pdAogICAgICAgICkKICAgICAgICBhc3NlcnQgaW1hZ2VfaW5zdGFuY2Vfc2VnbWVudGF0aW9uX2RpY3QgPT0gewogICAgICAgICAgICAibGltaXRzIjogeyJtYXhfY29uY3VycmVudF90cmlhbHMiOiAyLCAibWF4X3RyaWFscyI6IDEwLCAidGltZW91dF9taW51dGVzIjogNjB9LAogICAgICAgICAgICAibG9nX3ZlcmJvc2l0eSI6ICJpbmZvIiwKICAgICAgICAgICAgIm91dHB1dHMiOiB7fSwKICAgICAgICAgICAgInByaW1hcnlfbWV0cmljIjogIm1lYW5fYXZlcmFnZV9wcmVjaXNpb24iLAogICAgICAgICAgICAidGFncyI6IHt9LAogICAgICAgICAgICAidGFyZ2V0X2NvbHVtbl9uYW1lIjogImxhYmVsIiwKICAgICAgICAgICAgInRhc2siOiAiaW1hZ2VfaW5zdGFuY2Vfc2VnbWVudGF0aW9uIiwKICAgICAgICAgICAgInRyYWluaW5nX2RhdGEiOiAiJHt7cGFyZW50LmlucHV0cy5pbWFnZV9pbnN0YW5jZV9zZWdtZW50YXRpb25fdHJhaW5fZGF0YX19IiwKICAgICAgICAgICAgInR5cGUiOiAiYXV0b21sIiwKICAgICAgICAgICAgInZhbGlkYXRpb25fZGF0YSI6ICIke3twYXJlbnQuaW5wdXRzLmltYWdlX2luc3RhbmNlX3NlZ21lbnRhdGlvbl92YWxpZF9kYXRhfX0iLAogICAgICAgICAgICAidHJhaW5pbmdfcGFyYW1ldGVycyI6IHsibm1zX2lvdV90aHJlc2hvbGQiOiAwLjd9LAogICAgICAgICAgICAic3dlZXAiOiB7CiAgICAgICAgICAgICAgICAic2FtcGxpbmdfYWxnb3JpdGhtIjogInJhbmRvbSIsCiAgICAgICAgICAgICAgICAiZWFybHlfdGVybWluYXRpb24iOiB7CiAgICAgICAgICAgICAgICAgICAgImV2YWx1YXRpb25faW50ZXJ2YWwiOiAyLAogICAgICAgICAgICAgICAgICAgICJkZWxheV9ldmFsdWF0aW9uIjogNiwKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJiYW5kaXQiLAogICAgICAgICAgICAgICAgICAgICJzbGFja19mYWN0b3IiOiAwLjIsCiAgICAgICAgICAgICAgICAgICAgInNsYWNrX2Ftb3VudCI6IDAuMCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJzZWFyY2hfc3BhY2UiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgImxlYXJuaW5nX3JhdGUiOiAidW5pZm9ybSgwLjAwMDEsMC4wMDEpIiwKICAgICAgICAgICAgICAgICAgICAibW9kZWxfbmFtZSI6ICJjaG9pY2UoJ21hc2tyY25uX3Jlc25ldDUwX2ZwbicpIiwKICAgICAgICAgICAgICAgICAgICAib3B0aW1pemVyIjogImNob2ljZSgnc2dkJywnYWRhbScsJ2FkYW13JykiLAogICAgICAgICAgICAgICAgICAgICJtaW5fc2l6ZSI6ICJjaG9pY2UoNjAwLDgwMCkiLAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgIH0K",
      "StatusCode": 201,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Content-MD5": "7KSIc2nEWBWtt/xkdXjRWw==",
        "Date": "Tue, 30 May 2023 07:29:02 GMT",
        "ETag": "\u00220x8DB60DF8B16E277\u0022",
        "Last-Modified": "Tue, 30 May 2023 07:29:03 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-content-crc64": "cwNop4tXhvc=",
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://amltest5899420437.blob.core.windows.net/azureml-blobstore-0bdd51b6-cd9c-4978-b870-99997b393b81/LocalUpload/00000000000000000000000000000000/e2etests/test_controlflow_pipeline.py",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "44729",
        "Content-MD5": "0Yg5NKHT8G0ZIFsOlwemMA==",
        "Content-Type": "application/octet-stream",
        "If-None-Match": "*",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)",
        "x-ms-blob-type": "BlockBlob",
        "x-ms-date": "Tue, 30 May 2023 07:28:59 GMT",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": "ZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCgppbXBvcnQgcHl0ZXN0CmZyb20gZGV2dG9vbHNfdGVzdHV0aWxzIGltcG9ydCBBenVyZVJlY29yZGVkVGVzdENhc2UsIGlzX2xpdmUKZnJvbSB0ZXN0X3V0aWxpdGllcy51dGlscyBpbXBvcnQgX1BZVEVTVF9USU1FT1VUX01FVEhPRCwgYXNzZXJ0X2pvYl9jYW5jZWwsIG9taXRfd2l0aF93aWxkY2FyZAoKZnJvbSBhenVyZS5haS5tbCBpbXBvcnQgSW5wdXQsIE1MQ2xpZW50LCBPdXRwdXQsIGxvYWRfY29tcG9uZW50CmZyb20gYXp1cmUuYWkubWwuZHNsIGltcG9ydCBwaXBlbGluZQpmcm9tIGF6dXJlLmFpLm1sLmRzbC5fY29uZGl0aW9uIGltcG9ydCBjb25kaXRpb24KZnJvbSBhenVyZS5haS5tbC5kc2wuX2RvX3doaWxlIGltcG9ydCBkb193aGlsZQpmcm9tIGF6dXJlLmFpLm1sLmRzbC5fZ3JvdXBfZGVjb3JhdG9yIGltcG9ydCBncm91cApmcm9tIGF6dXJlLmFpLm1sLmRzbC5fcGFyYWxsZWxfZm9yIGltcG9ydCBwYXJhbGxlbF9mb3IKCmZyb20gLi5fdXRpbCBpbXBvcnQgX0RTTF9USU1FT1VUX1NFQ09ORCwgaW5jbHVkZV9wcml2YXRlX3ByZXZpZXdfbm9kZXNfaW5fcGlwZWxpbmUKCnRlc3RfaW5wdXQgPSBJbnB1dCgKICAgIHR5cGU9InVyaV9maWxlIiwKICAgIHBhdGg9Imh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IiwKKQoKb21pdF9maWVsZHMgPSBbCiAgICAibmFtZSIsCiAgICAicHJvcGVydGllcy5kaXNwbGF5X25hbWUiLAogICAgInByb3BlcnRpZXMuam9icy4qLmNvbXBvbmVudElkIiwKICAgICJwcm9wZXJ0aWVzLnNldHRpbmdzIiwKXQoKCkBweXRlc3QubWFyay51c2VmaXh0dXJlcygKICAgICJlbmFibGVfcHJpdmF0ZV9wcmV2aWV3X3NjaGVtYV9mZWF0dXJlcyIsCiAgICAiZW5hYmxlX2Vudmlyb25tZW50X2lkX2FybV9leHBhbnNpb24iLAogICAgImVuYWJsZV9waXBlbGluZV9wcml2YXRlX3ByZXZpZXdfZmVhdHVyZXMiLAogICAgIm1vY2tfY29kZV9oYXNoIiwKICAgICJtb2NrX2Fzc2V0X25hbWUiLAogICAgIm1vY2tfY29tcG9uZW50X2hhc2giLAogICAgIm1vY2tfc2V0X2hlYWRlcnNfd2l0aF91c2VyX2FtbF90b2tlbiIsCiAgICAicmVjb3JkZWRfdGVzdCIsCiAgICAidXNlX3B5dGhvbl9hbWxpZ25vcmVfZHVyaW5nX3VwbG9hZCIsCikKQHB5dGVzdC5tYXJrLnRpbWVvdXQodGltZW91dD1fRFNMX1RJTUVPVVRfU0VDT05ELCBtZXRob2Q9X1BZVEVTVF9USU1FT1VUX01FVEhPRCkKQHB5dGVzdC5tYXJrLmUyZXRlc3QKQHB5dGVzdC5tYXJrLnBpcGVsaW5lX3Rlc3QKY2xhc3MgVGVzdENvbnRyb2xGbG93UGlwZWxpbmUoQXp1cmVSZWNvcmRlZFRlc3RDYXNlKToKICAgIHBhc3MKCgpAcHl0ZXN0Lm1hcmsudXNlZml4dHVyZXMoIm1vY2tfYW5vbl9jb21wb25lbnRfdmVyc2lvbiIpCmNsYXNzIFRlc3RJZkVsc2UoVGVzdENvbnRyb2xGbG93UGlwZWxpbmUpOgogICAgZGVmIHRlc3RfZHNsX2NvbmRpdGlvbl9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICAjIHVwZGF0ZSBqb2JzIGZpZWxkIHRvIGluY2x1ZGUgcHJpdmF0ZSBwcmV2aWV3IG5vZGVzCgogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9ub19wYXRocyA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICBzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnRfbm9fcGF0aHMueW1sIgogICAgICAgICkKICAgICAgICBiYXNpY19jb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudCgKICAgICAgICAgICAgc291cmNlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2NvbXBvbmVudF93aXRoX2NvbmRpdGlvbmFsX291dHB1dC9zcGVjLnlhbWwiCiAgICAgICAgKQoKICAgICAgICBAcGlwZWxpbmUoCiAgICAgICAgICAgIG5hbWU9InRlc3RfbWxkZXNpZ25lcl9jb21wb25lbnRfd2l0aF9jb25kaXRpb25hbF9vdXRwdXQiLAogICAgICAgICAgICBjb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgKQogICAgICAgIGRlZiBjb25kaXRpb25fcGlwZWxpbmUoKToKICAgICAgICAgICAgcmVzdWx0ID0gYmFzaWNfY29tcG9uZW50KCkKCiAgICAgICAgICAgIG5vZGUxID0gaGVsbG9fd29ybGRfY29tcG9uZW50X25vX3BhdGhzKGNvbXBvbmVudF9pbl9udW1iZXI9MSkKICAgICAgICAgICAgbm9kZTIgPSBoZWxsb193b3JsZF9jb21wb25lbnRfbm9fcGF0aHMoY29tcG9uZW50X2luX251bWJlcj0yKQogICAgICAgICAgICBjb25kaXRpb24oY29uZGl0aW9uPXJlc3VsdC5vdXRwdXRzLm91dHB1dCwgZmFsc2VfYmxvY2s9bm9kZTEsIHRydWVfYmxvY2s9bm9kZTIpCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNvbmRpdGlvbl9waXBlbGluZSgpCgogICAgICAgICMgaW5jbHVkZSBwcml2YXRlIHByZXZpZXcgbm9kZXMKICAgICAgICB3aXRoIGluY2x1ZGVfcHJpdmF0ZV9wcmV2aWV3X25vZGVzX2luX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHBpcGVsaW5lX2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQoKICAgICAgICBkc2xfcGlwZWxpbmVfam9iX2RpY3QgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKSwgKm9taXRfZmllbGRzKQogICAgICAgIGFzc2VydCBkc2xfcGlwZWxpbmVfam9iX2RpY3RbInByb3BlcnRpZXMiXVsiam9icyJdID09IHsKICAgICAgICAgICAgImNvbmRpdGlvbm5vZGUiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJEU0wiLAogICAgICAgICAgICAgICAgImNvbmRpdGlvbiI6ICIke3twYXJlbnQuam9icy5yZXN1bHQub3V0cHV0cy5vdXRwdXR9fSIsCiAgICAgICAgICAgICAgICAiZmFsc2VfYmxvY2siOiAiJHt7cGFyZW50LmpvYnMubm9kZTF9fSIsCiAgICAgICAgICAgICAgICAidHJ1ZV9ibG9jayI6ICIke3twYXJlbnQuam9icy5ub2RlMn19IiwKICAgICAgICAgICAgICAgICJ0eXBlIjogImlmX2Vsc2UiLAogICAgICAgICAgICB9LAogICAgICAgICAgICAibm9kZTEiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJSRU1PVEUuV09SS1NQQUNFLkNPTVBPTkVOVCIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogeyJjb21wb25lbnRfaW5fbnVtYmVyIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjEifX0sCiAgICAgICAgICAgICAgICAibmFtZSI6ICJub2RlMSIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm5vZGUyIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiUkVNT1RFLldPUktTUEFDRS5DT01QT05FTlQiLAogICAgICAgICAgICAgICAgImlucHV0cyI6IHsiY29tcG9uZW50X2luX251bWJlciI6IHsiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIyIn19LAogICAgICAgICAgICAgICAgIm5hbWUiOiAibm9kZTIiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJyZXN1bHQiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJSRU1PVEUuV09SS1NQQUNFLkNPTVBPTkVOVCIsCiAgICAgICAgICAgICAgICAibmFtZSI6ICJyZXN1bHQiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgfQoKICAgIGRlZiB0ZXN0X2RzbF9jb25kaXRpb25fcGlwZWxpbmVfd2l0aF9wcmltaXRpdmVfaW5wdXQoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X25vX3BhdGhzID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgIHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudF9ub19wYXRocy55bWwiCiAgICAgICAgKQoKICAgICAgICBAcGlwZWxpbmUoCiAgICAgICAgICAgIG5hbWU9InRlc3RfbWxkZXNpZ25lcl9jb21wb25lbnRfd2l0aF9jb25kaXRpb25hbF9vdXRwdXQiLAogICAgICAgICAgICBjb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgKQogICAgICAgIGRlZiBjb25kaXRpb25fcGlwZWxpbmUoKToKICAgICAgICAgICAgbm9kZTEgPSBoZWxsb193b3JsZF9jb21wb25lbnRfbm9fcGF0aHMoY29tcG9uZW50X2luX251bWJlcj0xKQogICAgICAgICAgICBub2RlMiA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudF9ub19wYXRocyhjb21wb25lbnRfaW5fbnVtYmVyPTIpCiAgICAgICAgICAgIGNvbmRpdGlvbihjb25kaXRpb249VHJ1ZSwgZmFsc2VfYmxvY2s9bm9kZTEsIHRydWVfYmxvY2s9bm9kZTIpCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNvbmRpdGlvbl9waXBlbGluZSgpCiAgICAgICAgd2l0aCBpbmNsdWRlX3ByaXZhdGVfcHJldmlld19ub2Rlc19pbl9waXBlbGluZSgpOgogICAgICAgICAgICByZXN0X2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQoKICAgICAgICBkc2xfcGlwZWxpbmVfam9iX2RpY3QgPSBvbWl0X3dpdGhfd2lsZGNhcmQocmVzdF9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpLCAqb21pdF9maWVsZHMpCiAgICAgICAgYXNzZXJ0IGRzbF9waXBlbGluZV9qb2JfZGljdFsicHJvcGVydGllcyJdWyJqb2JzIl0gPT0gewogICAgICAgICAgICAiY29uZGl0aW9ubm9kZSI6IHsKICAgICAgICAgICAgICAgICJfc291cmNlIjogIkRTTCIsCiAgICAgICAgICAgICAgICAiY29uZGl0aW9uIjogVHJ1ZSwKICAgICAgICAgICAgICAgICJmYWxzZV9ibG9jayI6ICIke3twYXJlbnQuam9icy5ub2RlMX19IiwKICAgICAgICAgICAgICAgICJ0cnVlX2Jsb2NrIjogIiR7e3BhcmVudC5qb2JzLm5vZGUyfX0iLAogICAgICAgICAgICAgICAgInR5cGUiOiAiaWZfZWxzZSIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJub2RlMSI6IHsKICAgICAgICAgICAgICAgICJfc291cmNlIjogIlJFTU9URS5XT1JLU1BBQ0UuQ09NUE9ORU5UIiwKICAgICAgICAgICAgICAgICJpbnB1dHMiOiB7ImNvbXBvbmVudF9pbl9udW1iZXIiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiMSJ9fSwKICAgICAgICAgICAgICAgICJuYW1lIjogIm5vZGUxIiwKICAgICAgICAgICAgICAgICJ0eXBlIjogImNvbW1hbmQiLAogICAgICAgICAgICB9LAogICAgICAgICAgICAibm9kZTIiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJSRU1PVEUuV09SS1NQQUNFLkNPTVBPTkVOVCIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogeyJjb21wb25lbnRfaW5fbnVtYmVyIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjIifX0sCiAgICAgICAgICAgICAgICAibmFtZSI6ICJub2RlMiIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgfSwKICAgICAgICB9CgogICAgZGVmIHRlc3RfZHNsX2NvbmRpdGlvbl9waXBlbGluZV93aXRoX29uZV9icmFuY2goc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X25vX3BhdGhzID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgIHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudF9ub19wYXRocy55bWwiCiAgICAgICAgKQoKICAgICAgICBAcGlwZWxpbmUoCiAgICAgICAgICAgIGNvbXB1dGU9ImNwdS1jbHVzdGVyIiwKICAgICAgICApCiAgICAgICAgZGVmIGNvbmRpdGlvbl9waXBlbGluZSgpOgogICAgICAgICAgICBub2RlMSA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudF9ub19wYXRocyhjb21wb25lbnRfaW5fbnVtYmVyPTEpCiAgICAgICAgICAgIGNvbmRpdGlvbihjb25kaXRpb249VHJ1ZSwgZmFsc2VfYmxvY2s9bm9kZTEpCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IGNvbmRpdGlvbl9waXBlbGluZSgpCiAgICAgICAgd2l0aCBpbmNsdWRlX3ByaXZhdGVfcHJldmlld19ub2Rlc19pbl9waXBlbGluZSgpOgogICAgICAgICAgICByZXN0X2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQoKICAgICAgICBkc2xfcGlwZWxpbmVfam9iX2RpY3QgPSBvbWl0X3dpdGhfd2lsZGNhcmQocmVzdF9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpLCAqb21pdF9maWVsZHMpCiAgICAgICAgYXNzZXJ0IGRzbF9waXBlbGluZV9qb2JfZGljdFsicHJvcGVydGllcyJdWyJqb2JzIl0gPT0gewogICAgICAgICAgICAiY29uZGl0aW9ubm9kZSI6IHsKICAgICAgICAgICAgICAgICJfc291cmNlIjogIkRTTCIsCiAgICAgICAgICAgICAgICAiY29uZGl0aW9uIjogVHJ1ZSwKICAgICAgICAgICAgICAgICJmYWxzZV9ibG9jayI6ICIke3twYXJlbnQuam9icy5ub2RlMX19IiwKICAgICAgICAgICAgICAgICJ0eXBlIjogImlmX2Vsc2UiLAogICAgICAgICAgICB9LAogICAgICAgICAgICAibm9kZTEiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJSRU1PVEUuV09SS1NQQUNFLkNPTVBPTkVOVCIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogeyJjb21wb25lbnRfaW5fbnVtYmVyIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjEifX0sCiAgICAgICAgICAgICAgICAibmFtZSI6ICJub2RlMSIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgfSwKICAgICAgICB9CgogICAgZGVmIHRlc3RfcmVnaXN0ZXJlZF9jb21wb25lbnRfaXNfY29udHJvbChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBwcmltaXRpdmVfY29tcG9uZW50X3dpdGhfbm9ybWFsX2lucHV0X291dHB1dF92MiA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICBzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvZG9fd2hpbGVfdGVzdC9wcmltaXRpdmVfY29tcG9uZW50X3dpdGhfbm9ybWFsX2lucHV0X291dHB1dF92Mi55YW1sIgogICAgICAgICkKICAgICAgICBwcmltaXRpdmVfY29tcG9uZW50X3dpdGhfbm9ybWFsX2lucHV0X291dHB1dF92Mi5vdXRwdXRzWyJib29sX3BhcmFtX291dHB1dCJdLmVhcmx5X2F2YWlsYWJsZSA9IFRydWUKICAgICAgICByZWdpc3RlcmVkX2NvbXBvbmVudCA9IGNsaWVudC5jb21wb25lbnRzLmNyZWF0ZV9vcl91cGRhdGUocHJpbWl0aXZlX2NvbXBvbmVudF93aXRoX25vcm1hbF9pbnB1dF9vdXRwdXRfdjIpCiAgICAgICAgcmVzdF9kaWN0ID0gcmVnaXN0ZXJlZF9jb21wb25lbnQuX3RvX2RpY3QoKQogICAgICAgICMgQXNzZXJ0IGlzX2NvbnRyb2wgd2l0aCBjb3JyZWN0IGJvb2wgdHlwZQogICAgICAgIGV4cGVjdGVkX2RpY3QgPSB7CiAgICAgICAgICAgICJvdXRwdXRfZGF0YSI6IHsidHlwZSI6ICJ1cmlfZm9sZGVyIn0sCiAgICAgICAgICAgICJib29sX3BhcmFtX291dHB1dCI6IHsidHlwZSI6ICJib29sZWFuIiwgImlzX2NvbnRyb2wiOiBUcnVlLCAiZWFybHlfYXZhaWxhYmxlIjogVHJ1ZX0sCiAgICAgICAgICAgICJpbnRfcGFyYW1fb3V0cHV0IjogeyJ0eXBlIjogImludGVnZXIiLCAiaXNfY29udHJvbCI6IFRydWV9LAogICAgICAgICAgICAiZmxvYXRfcGFyYW1fb3V0cHV0IjogeyJ0eXBlIjogIm51bWJlciIsICJpc19jb250cm9sIjogVHJ1ZX0sCiAgICAgICAgICAgICJzdHJfcGFyYW1fb3V0cHV0IjogeyJ0eXBlIjogInN0cmluZyIsICJpc19jb250cm9sIjogVHJ1ZX0sCiAgICAgICAgfQogICAgICAgIGFzc2VydCByZXN0X2RpY3RbIm91dHB1dHMiXSA9PSBleHBlY3RlZF9kaWN0CgogICAgICAgICMgQXNzZXJ0IG9uIHBpcGVsaW5lIGNvbXBvbmVudAogICAgICAgIEBncm91cAogICAgICAgIGNsYXNzIENvbnRyb2xPdXRwdXRHcm91cDoKICAgICAgICAgICAgb3V0cHV0X2RhdGE6IE91dHB1dCh0eXBlPSJ1cmlfZm9sZGVyIikKICAgICAgICAgICAgZmxvYXRfcGFyYW1fb3V0cHV0OiBPdXRwdXQodHlwZT0ibnVtYmVyIiwgaXNfY29udHJvbD1UcnVlKQogICAgICAgICAgICBpbnRfcGFyYW1fb3V0cHV0OiBPdXRwdXQodHlwZT0iaW50ZWdlciIsIGlzX2NvbnRyb2w9VHJ1ZSkKICAgICAgICAgICAgYm9vbF9wYXJhbV9vdXRwdXQ6IE91dHB1dCh0eXBlPSJib29sZWFuIiwgaXNfY29udHJvbD1UcnVlKQogICAgICAgICAgICBzdHJfcGFyYW1fb3V0cHV0OiBPdXRwdXQodHlwZT0ic3RyaW5nIiwgaXNfY29udHJvbD1UcnVlKQoKICAgICAgICBAcGlwZWxpbmUoKQogICAgICAgIGRlZiB0ZXN0X3BpcGVsaW5lX2NvbXBvbmVudF9jb250cm9sX291dHB1dCgpIC0\u002BIENvbnRyb2xPdXRwdXRHcm91cDoKICAgICAgICAgICAgbm9kZSA9IHByaW1pdGl2ZV9jb21wb25lbnRfd2l0aF9ub3JtYWxfaW5wdXRfb3V0cHV0X3YyKAogICAgICAgICAgICAgICAgaW5wdXRfZGF0YT10ZXN0X2lucHV0LCBwYXJhbWJvb2w9VHJ1ZSwgcGFyYW1pbnQ9MiwgcGFyYW1mbG9hdD0yLjIsIHBhcmFtc3RyPSJ0ZXN0IgogICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiBub2RlLm91dHB1dHMKCiAgICAgICAgcmVnaXN0ZXJlZF9waXBlbGluZV9jb21wb25lbnQgPSBjbGllbnQuY29tcG9uZW50cy5jcmVhdGVfb3JfdXBkYXRlKHRlc3RfcGlwZWxpbmVfY29tcG9uZW50X2NvbnRyb2xfb3V0cHV0KQogICAgICAgIHJlc3RfZGljdCA9IHJlZ2lzdGVyZWRfcGlwZWxpbmVfY29tcG9uZW50Ll90b19kaWN0KCkKICAgICAgICBhc3NlcnQgcmVzdF9kaWN0WyJvdXRwdXRzIl0gPT0gZXhwZWN0ZWRfZGljdAoKICAgIGRlZiB0ZXN0X2RvX3doaWxlX2NvbWJpbmVkX2lmX2Vsc2Uoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgZG9fd2hpbGVfYm9keV9jb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudCgKICAgICAgICAgICAgc291cmNlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2RvX3doaWxlX3Rlc3QvZG9fd2hpbGVfYm9keV9jb21wb25lbnQueWFtbCIKICAgICAgICApCiAgICAgICAgcHJpbWl0aXZlX2NvbXBvbmVudF93aXRoX25vcm1hbF9pbnB1dF9vdXRwdXRfdjIgPSBsb2FkX2NvbXBvbmVudCgKICAgICAgICAgICAgc291cmNlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2RvX3doaWxlX3Rlc3QvcHJpbWl0aXZlX2NvbXBvbmVudF93aXRoX25vcm1hbF9pbnB1dF9vdXRwdXRfdjIueWFtbCIKICAgICAgICApCgogICAgICAgIEBwaXBlbGluZShkZWZhdWx0X2NvbXB1dGVfdGFyZ2V0PSJjcHUtY2x1c3RlciIsIGNvbnRpbnVlX29uX3N0ZXBfZmFpbHVyZT1UcnVlKQogICAgICAgIGRlZiB0ZXN0X3BpcGVsaW5lKGlucHV0X2RhdGEsIGludF9wYXJhbSwgYm9vbF9wYXJhbSwgZmxvYXRfcGFyYW0sIHN0cl9wYXJhbSk6CiAgICAgICAgICAgIGRvX3doaWxlX2JvZHlfZnVuYyA9IGRvX3doaWxlX2JvZHlfY29tcG9uZW50KAogICAgICAgICAgICAgICAgaW5wdXRfMT1pbnB1dF9kYXRhLAogICAgICAgICAgICAgICAgaW5wdXRfMj1pbnB1dF9kYXRhLAogICAgICAgICAgICAgICAgaW50X3BhcmFtPWludF9wYXJhbSwKICAgICAgICAgICAgICAgIGJvb2xfcGFyYW09Ym9vbF9wYXJhbSwKICAgICAgICAgICAgICAgIGZsb2F0X3BhcmFtPWZsb2F0X3BhcmFtLAogICAgICAgICAgICAgICAgc3RyX3BhcmFtPXN0cl9wYXJhbSwKICAgICAgICAgICAgKQoKICAgICAgICAgICAgZG9fd2hpbGUoCiAgICAgICAgICAgICAgICBib2R5PWRvX3doaWxlX2JvZHlfZnVuYywKICAgICAgICAgICAgICAgIGNvbmRpdGlvbj1kb193aGlsZV9ib2R5X2Z1bmMub3V0cHV0cy5jb25kaXRpb24sCiAgICAgICAgICAgICAgICBtYXBwaW5nPXsKICAgICAgICAgICAgICAgICAgICBkb193aGlsZV9ib2R5X2Z1bmMub3V0cHV0cy5vdXRwdXRfMTogZG9fd2hpbGVfYm9keV9mdW5jLmlucHV0cy5pbnB1dF8xLAogICAgICAgICAgICAgICAgICAgIGRvX3doaWxlX2JvZHlfZnVuYy5vdXRwdXRzLm91dHB1dF8yOiBkb193aGlsZV9ib2R5X2Z1bmMuaW5wdXRzLmlucHV0XzIsCiAgICAgICAgICAgICAgICAgICAgZG9fd2hpbGVfYm9keV9mdW5jLm91dHB1dHMuaW50X3BhcmFtX291dHB1dDogZG9fd2hpbGVfYm9keV9mdW5jLmlucHV0cy5pbnRfcGFyYW0sCiAgICAgICAgICAgICAgICAgICAgZG9fd2hpbGVfYm9keV9mdW5jLm91dHB1dHMuYm9vbF9wYXJhbV9vdXRwdXQ6IGRvX3doaWxlX2JvZHlfZnVuYy5pbnB1dHMuYm9vbF9wYXJhbSwKICAgICAgICAgICAgICAgICAgICBkb193aGlsZV9ib2R5X2Z1bmMub3V0cHV0cy5mbG9hdF9wYXJhbV9vdXRwdXQ6IGRvX3doaWxlX2JvZHlfZnVuYy5pbnB1dHMuZmxvYXRfcGFyYW0sCiAgICAgICAgICAgICAgICAgICAgZG9fd2hpbGVfYm9keV9mdW5jLm91dHB1dHMuc3RyX3BhcmFtX291dHB1dDogZG9fd2hpbGVfYm9keV9mdW5jLmlucHV0cy5zdHJfcGFyYW0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWF4X2l0ZXJhdGlvbl9jb3VudD0zLAogICAgICAgICAgICApCgogICAgICAgICAgICBwcmltaXRpdmVfb3V0cHV0X2NvbXBvbmVudF90cnVlID0gcHJpbWl0aXZlX2NvbXBvbmVudF93aXRoX25vcm1hbF9pbnB1dF9vdXRwdXRfdjIoCiAgICAgICAgICAgICAgICBpbnB1dF9kYXRhPWRvX3doaWxlX2JvZHlfZnVuYy5vdXRwdXRzLm91dHB1dF8xLAogICAgICAgICAgICAgICAgcGFyYW1ib29sPWRvX3doaWxlX2JvZHlfZnVuYy5vdXRwdXRzLmJvb2xfcGFyYW1fb3V0cHV0LAogICAgICAgICAgICAgICAgcGFyYW1pbnQ9ZG9fd2hpbGVfYm9keV9mdW5jLm91dHB1dHMuaW50X3BhcmFtX291dHB1dCwKICAgICAgICAgICAgICAgIHBhcmFtZmxvYXQ9ZG9fd2hpbGVfYm9keV9mdW5jLm91dHB1dHMuZmxvYXRfcGFyYW1fb3V0cHV0LAogICAgICAgICAgICAgICAgcGFyYW1zdHI9ZG9fd2hpbGVfYm9keV9mdW5jLm91dHB1dHMuc3RyX3BhcmFtX291dHB1dCwKICAgICAgICAgICAgKQoKICAgICAgICAgICAgY29uZGl0aW9uKGNvbmRpdGlvbj1kb193aGlsZV9ib2R5X2Z1bmMub3V0cHV0cy5jb25kaXRpb24sIHRydWVfYmxvY2s9cHJpbWl0aXZlX291dHB1dF9jb21wb25lbnRfdHJ1ZSkKCiAgICAgICAgcGlwZWxpbmVfam9iID0gdGVzdF9waXBlbGluZSgKICAgICAgICAgICAgaW5wdXRfZGF0YT10ZXN0X2lucHV0LCBpbnRfcGFyYW09NCwgYm9vbF9wYXJhbT1UcnVlLCBmbG9hdF9wYXJhbT0yMi4wLCBzdHJfcGFyYW09InN0cmluZ19wYXJhbV9ub19zcGFjZSIKICAgICAgICApCgogICAgICAgIHdpdGggaW5jbHVkZV9wcml2YXRlX3ByZXZpZXdfbm9kZXNfaW5fcGlwZWxpbmUoKToKICAgICAgICAgICAgcmVzdF9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZV9qb2IsIGNsaWVudCkKCiAgICAgICAgZHNsX3BpcGVsaW5lX2pvYl9kaWN0ID0gb21pdF93aXRoX3dpbGRjYXJkKHJlc3Rfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKSwgKm9taXRfZmllbGRzKQogICAgICAgIGFzc2VydCBkc2xfcGlwZWxpbmVfam9iX2RpY3RbInByb3BlcnRpZXMiXVsiam9icyJdID09IHsKICAgICAgICAgICAgImNvbmRpdGlvbm5vZGUiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJEU0wiLAogICAgICAgICAgICAgICAgImNvbmRpdGlvbiI6ICIke3twYXJlbnQuam9icy5kb193aGlsZV9ib2R5X2Z1bmMub3V0cHV0cy5jb25kaXRpb259fSIsCiAgICAgICAgICAgICAgICAidHJ1ZV9ibG9jayI6ICIke3twYXJlbnQuam9icy5wcmltaXRpdmVfb3V0cHV0X2NvbXBvbmVudF90cnVlfX0iLAogICAgICAgICAgICAgICAgInR5cGUiOiAiaWZfZWxzZSIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJkb193aGlsZV9ib2R5X2Z1bmMiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJSRU1PVEUuV09SS1NQQUNFLkNPTVBPTkVOVCIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJib29sX3BhcmFtIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuYm9vbF9wYXJhbX19In0sCiAgICAgICAgICAgICAgICAgICAgImZsb2F0X3BhcmFtIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuZmxvYXRfcGFyYW19fSJ9LAogICAgICAgICAgICAgICAgICAgICJpbnB1dF8xIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuaW5wdXRfZGF0YX19In0sCiAgICAgICAgICAgICAgICAgICAgImlucHV0XzIiOiB7ImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50LmlucHV0cy5pbnB1dF9kYXRhfX0ifSwKICAgICAgICAgICAgICAgICAgICAiaW50X3BhcmFtIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuaW50X3BhcmFtfX0ifSwKICAgICAgICAgICAgICAgICAgICAic3RyX3BhcmFtIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5pbnB1dHMuc3RyX3BhcmFtfX0ifSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibmFtZSI6ICJkb193aGlsZV9ib2R5X2Z1bmMiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJkb3doaWxlIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiRFNMIiwKICAgICAgICAgICAgICAgICJib2R5IjogIiR7e3BhcmVudC5qb2JzLmRvX3doaWxlX2JvZHlfZnVuY319IiwKICAgICAgICAgICAgICAgICJjb25kaXRpb24iOiAiY29uZGl0aW9uIiwKICAgICAgICAgICAgICAgICJsaW1pdHMiOiB7Im1heF9pdGVyYXRpb25fY291bnQiOiAzfSwKICAgICAgICAgICAgICAgICJtYXBwaW5nIjogewogICAgICAgICAgICAgICAgICAgICJib29sX3BhcmFtX291dHB1dCI6IFsiYm9vbF9wYXJhbSJdLAogICAgICAgICAgICAgICAgICAgICJmbG9hdF9wYXJhbV9vdXRwdXQiOiBbImZsb2F0X3BhcmFtIl0sCiAgICAgICAgICAgICAgICAgICAgImludF9wYXJhbV9vdXRwdXQiOiBbImludF9wYXJhbSJdLAogICAgICAgICAgICAgICAgICAgICJvdXRwdXRfMSI6IFsiaW5wdXRfMSJdLAogICAgICAgICAgICAgICAgICAgICJvdXRwdXRfMiI6IFsiaW5wdXRfMiJdLAogICAgICAgICAgICAgICAgICAgICJzdHJfcGFyYW1fb3V0cHV0IjogWyJzdHJfcGFyYW0iXSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidHlwZSI6ICJkb193aGlsZSIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJwcmltaXRpdmVfb3V0cHV0X2NvbXBvbmVudF90cnVlIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiUkVNT1RFLldPUktTUEFDRS5DT01QT05FTlQiLAogICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAiaW5wdXRfZGF0YSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmpvYnMuZG9fd2hpbGVfYm9keV9mdW5jLm91dHB1dHMub3V0cHV0XzF9fSIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAicGFyYW1ib29sIjogewogICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuam9icy5kb193aGlsZV9ib2R5X2Z1bmMub3V0cHV0cy5ib29sX3BhcmFtX291dHB1dH19IiwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJwYXJhbWZsb2F0IjogewogICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAibGl0ZXJhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICIke3twYXJlbnQuam9icy5kb193aGlsZV9ib2R5X2Z1bmMub3V0cHV0cy5mbG9hdF9wYXJhbV9vdXRwdXR9fSIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAicGFyYW1pbnQiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5qb2JzLmRvX3doaWxlX2JvZHlfZnVuYy5vdXRwdXRzLmludF9wYXJhbV9vdXRwdXR9fSIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAicGFyYW1zdHIiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5qb2JzLmRvX3doaWxlX2JvZHlfZnVuYy5vdXRwdXRzLnN0cl9wYXJhbV9vdXRwdXR9fSIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibmFtZSI6ICJwcmltaXRpdmVfb3V0cHV0X2NvbXBvbmVudF90cnVlIiwKICAgICAgICAgICAgICAgICJ0eXBlIjogImNvbW1hbmQiLAogICAgICAgICAgICB9LAogICAgICAgIH0KCiAgICBkZWYgdGVzdF9pZl9lbHNlX211bHRpcGxlX2Jsb2NrcyhzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnRfbm9fcGF0aHMgPSBsb2FkX2NvbXBvbmVudCgKICAgICAgICAgICAgc291cmNlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50X25vX3BhdGhzLnltbCIKICAgICAgICApCiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50ID0gbG9hZF9jb21wb25lbnQoc291cmNlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50LnltbCIpCiAgICAgICAgYmFzaWNfY29tcG9uZW50ID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgIHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9jb21wb25lbnRfd2l0aF9jb25kaXRpb25hbF9vdXRwdXQvc3BlYy55YW1sIgogICAgICAgICkKCiAgICAgICAgQHBpcGVsaW5lKAogICAgICAgICAgICBjb21wdXRlPSJjcHUtY2x1c3RlciIsCiAgICAgICAgKQogICAgICAgIGRlZiBjb25kaXRpb25fcGlwZWxpbmUoKToKICAgICAgICAgICAgcmVzdWx0ID0gYmFzaWNfY29tcG9uZW50KCkKCiAgICAgICAgICAgIG5vZGUxID0gaGVsbG9fd29ybGRfY29tcG9uZW50X25vX3BhdGhzKGNvbXBvbmVudF9pbl9udW1iZXI9MSkKCiAgICAgICAgICAgIG5vZGUyID0gaGVsbG9fd29ybGRfY29tcG9uZW50X25vX3BhdGhzKGNvbXBvbmVudF9pbl9udW1iZXI9MikKICAgICAgICAgICAgbm9kZTMgPSBoZWxsb193b3JsZF9jb21wb25lbnQoY29tcG9uZW50X2luX251bWJlcj0zLCBjb21wb25lbnRfaW5fcGF0aD10ZXN0X2lucHV0KQogICAgICAgICAgICBub2RlNCA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudChjb21wb25lbnRfaW5fbnVtYmVyPTQsIGNvbXBvbmVudF9pbl9wYXRoPXRlc3RfaW5wdXQpCiAgICAgICAgICAgIGNvbmRpdGlvbihjb25kaXRpb249cmVzdWx0Lm91dHB1dHMub3V0cHV0LCBmYWxzZV9ibG9jaz1bbm9kZTEsIG5vZGUzXSwgdHJ1ZV9ibG9jaz1bbm9kZTIsIG5vZGU0XSkKCiAgICAgICAgcGlwZWxpbmVfam9iID0gY29uZGl0aW9uX3BpcGVsaW5lKCkKICAgICAgICB3aXRoIGluY2x1ZGVfcHJpdmF0ZV9wcmV2aWV3X25vZGVzX2luX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHBpcGVsaW5lX2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQoKICAgICAgICBkc2xfcGlwZWxpbmVfam9iX2RpY3QgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKSwgKm9taXRfZmllbGRzKQogICAgICAgIGFzc2VydCBkc2xfcGlwZWxpbmVfam9iX2RpY3RbInByb3BlcnRpZXMiXVsiam9icyJdWyJjb25kaXRpb25ub2RlIl0gPT0gewogICAgICAgICAgICAiX3NvdXJjZSI6ICJEU0wiLAogICAgICAgICAgICAiY29uZGl0aW9uIjogIiR7e3BhcmVudC5qb2JzLnJlc3VsdC5vdXRwdXRzLm91dHB1dH19IiwKICAgICAgICAgICAgImZhbHNlX2Jsb2NrIjogWyIke3twYXJlbnQuam9icy5ub2RlMX19IiwgIiR7e3BhcmVudC5qb2JzLm5vZGUzfX0iXSwKICAgICAgICAgICAgInRydWVfYmxvY2siOiBbIiR7e3BhcmVudC5qb2JzLm5vZGUyfX0iLCAiJHt7cGFyZW50LmpvYnMubm9kZTR9fSJdLAogICAgICAgICAgICAidHlwZSI6ICJpZl9lbHNlIiwKICAgICAgICB9CgogICAgQHB5dGVzdC5tYXJrLnNraXBpZihjb25kaXRpb249bm90IGlzX2xpdmUoKSwgcmVhc29uPSJUT0RPKDIxNzczNTMpOiBjaGVjayB3aHkgcmVjb3JkZWQgdGVzdHMgZmFpbHVyZS4iKQogICAgZGVmIHRlc3RfaWZfZWxzZV9tdWx0aXBsZV9ibG9ja3Nfc3ViZ3JhcGgoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50X25vX3BhdGhzID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgIHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudF9ub19wYXRocy55bWwiCiAgICAgICAgKQogICAgICAgIGJhc2ljX2NvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICBzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvY29tcG9uZW50X3dpdGhfY29uZGl0aW9uYWxfb3V0cHV0L3NwZWMueWFtbCIKICAgICAgICApCgogICAgICAgIEBwaXBlbGluZSgpCiAgICAgICAgZGVmIHN1YmdyYXBoKCk6CiAgICAgICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudF9ub19wYXRocyhjb21wb25lbnRfaW5fbnVtYmVyPTIpCgogICAgICAgIEBwaXBlbGluZSgKICAgICAgICAgICAgY29tcHV0ZT0iY3B1LWNsdXN0ZXIiLAogICAgICAgICkKICAgICAgICBkZWYgY29uZGl0aW9uX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHJlc3VsdCA9IGJhc2ljX2NvbXBvbmVudCgpCgogICAgICAgICAgICBub2RlMSA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudF9ub19wYXRocyhjb21wb25lbnRfaW5fbnVtYmVyPTEpCgogICAgICAgICAgICBub2RlMiA9IHN1YmdyYXBoKCkKCiAgICAgICAgICAgIGNvbmRpdGlvbihjb25kaXRpb249cmVzdWx0Lm91dHB1dHMub3V0cHV0LCB0cnVlX2Jsb2NrPVtub2RlMSwgbm9kZTJdKQoKICAgICAgICBwaXBlbGluZV9qb2IgPSBjb25kaXRpb25fcGlwZWxpbmUoKQogICAgICAgIHdpdGggaW5jbHVkZV9wcml2YXRlX3ByZXZpZXdfbm9kZXNfaW5fcGlwZWxpbmUoKToKICAgICAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCgogICAgICAgIGRzbF9waXBlbGluZV9qb2JfZGljdCA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpLCAqb21pdF9maWVsZHMpCiAgICAgICAgYXNzZXJ0IGRzbF9waXBlbGluZV9qb2JfZGljdFsicHJvcGVydGllcyJdWyJqb2JzIl1bImNvbmRpdGlvbm5vZGUiXSA9PSB7CiAgICAgICAgICAgICJfc291cmNlIjogIkRTTCIsCiAgICAgICAgICAgICJjb25kaXRpb24iOiAiJHt7cGFyZW50LmpvYnMucmVzdWx0Lm91dHB1dHMub3V0cHV0fX0iLAogICAgICAgICAgICAidHJ1ZV9ibG9jayI6IFsiJHt7cGFyZW50LmpvYnMubm9kZTF9fSIsICIke3twYXJlbnQuam9icy5ub2RlMn19Il0sCiAgICAgICAgICAgICJ0eXBlIjogImlmX2Vsc2UiLAogICAgICAgIH0KCgpAcHl0ZXN0Lm1hcmsudXNlZml4dHVyZXMoIm1vY2tfYW5vbl9jb21wb25lbnRfdmVyc2lvbiIpCmNsYXNzIFRlc3REb1doaWxlUGlwZWxpbmUoVGVzdENvbnRyb2xGbG93UGlwZWxpbmUpOgogICAgQHByb3BlcnR5CiAgICBkZWYgX2Jhc2ljX2NvbXBvbmVudF9mdW5jKHNlbGYpOgogICAgICAgIHJldHVybiBsb2FkX2NvbXBvbmVudCgiLi90ZXN0cy90ZXN0X2NvbmZpZ3MvZHNsX3BpcGVsaW5lL2RvX3doaWxlL2Jhc2ljX2NvbXBvbmVudC9jb21wb25lbnQueW1sIikKCiAgICBAcHl0ZXN0Lm1hcmsuc2tpcGlmKAogICAgICAgIGNvbmRpdGlvbj1ub3QgaXNfbGl2ZSgpLAogICAgICAgIHJlYXNvbj0iVE9ETyAoMjM3NDYxMCk6IGhhc2ggc2FuaXRpemVyIGlzIGJlaW5nIGFwcGxpZWQgdW5uZWNlc3NhcmlseSBhbmQgZm9yY2luZyBwbGF5YmFjayBmYWlsdXJlcyIsCiAgICApCiAgICBAcHl0ZXN0Lm1hcmsudXNlZml4dHVyZXMoIm1vY2tfYW5vbl9jb21wb25lbnRfdmVyc2lvbiIpCiAgICBkZWYgdGVzdF9kb193aGlsZV9waXBlbGluZShzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBAcGlwZWxpbmUKICAgICAgICBkZWYgZG9fd2hpbGVfYm9keV9waXBlbGluZV9jb21wb25lbnQoCiAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI6IElucHV0KHR5cGU9ImludGVnZXIiLCBvcHRpb25hbD1UcnVlKSwKICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg6IElucHV0KHR5cGU9InVyaV9mb2xkZXIiKSwKICAgICAgICApOgogICAgICAgICAgICAjIENhbGwgY29tcG9uZW50IG9iaiBhcyBmdW5jdGlvbjogYXBwbHkgZ2l2ZW4gaW5wdXRzICYgcGFyYW1ldGVycyB0byBjcmVhdGUgYSBub2RlIGluIHBpcGVsaW5lCiAgICAgICAgICAgIGJhc2ljX2NvbXBvbmVudCA9IHNlbGYuX2Jhc2ljX2NvbXBvbmVudF9mdW5jKAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcj1jb21wb25lbnRfaW5fbnVtYmVyLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2luX3BhdGgsCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIGJhc2ljX2NvbXBvbmVudC5vdXRwdXRzCgogICAgICAgIEBwaXBlbGluZQogICAgICAgIGRlZiBwaXBlbGluZV93aXRoX2RvX3doaWxlKAogICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyOiBJbnB1dCh0eXBlPSJpbnRlZ2VyIiksCiAgICAgICAgICAgIGNvbXBvbmVudF9pbl9wYXRoOiBJbnB1dCh0eXBlPSJ1cmlfZm9sZGVyIiksCiAgICAgICAgKToKICAgICAgICAgICAgIyBEbyB3aGlsZSBub2RlIHdpdGggcGlwZWxpbmUgY29tcG9uZW50CiAgICAgICAgICAgIGRvX3doaWxlX2JvZHlfcGlwZWxpbmUgPSBkb193aGlsZV9ib2R5X3BpcGVsaW5lX2NvbXBvbmVudCgKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9Y29tcG9uZW50X2luX251bWJlciwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbl9wYXRoLAogICAgICAgICAgICApCiAgICAgICAgICAgIGRvX3doaWxlX3dpdGhfcGlwZWxpbmUgPSBkb193aGlsZSggICMgbm9xYTogRjg0MQogICAgICAgICAgICAgICAgYm9keT1kb193aGlsZV9ib2R5X3BpcGVsaW5lLAogICAgICAgICAgICAgICAgY29uZGl0aW9uPWRvX3doaWxlX2JvZHlfcGlwZWxpbmUub3V0cHV0cy5pc19udW1iZXJfbGFyZ2VyX3RoYW5femVybywKICAgICAgICAgICAgICAgIG1hcHBpbmc9ewogICAgICAgICAgICAgICAgICAgIGRvX3doaWxlX2JvZHlfcGlwZWxpbmUub3V0cHV0cy5vdXRwdXRfaW5fcGF0aDogZG9fd2hpbGVfYm9keV9waXBlbGluZS5pbnB1dHMuY29tcG9uZW50X2luX3BhdGgsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWF4X2l0ZXJhdGlvbl9jb3VudD01LAogICAgICAgICAgICApCgogICAgICAgICAgICBjb21tYW5kX2NvbXBvbmVudCA9IHNlbGYuX2Jhc2ljX2NvbXBvbmVudF9mdW5jKAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcj1jb21wb25lbnRfaW5fbnVtYmVyLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2luX3BhdGgsCiAgICAgICAgICAgICkKICAgICAgICAgICAgZG9fd2hpbGVfd2l0aF9jb21tYW5kX2NvbXBvbmVudCA9IGRvX3doaWxlKCAgIyBub3FhOiBGODQxCiAgICAgICAgICAgICAgICBib2R5PWNvbW1hbmRfY29tcG9uZW50LAogICAgICAgICAgICAgICAgY29uZGl0aW9uPWNvbW1hbmRfY29tcG9uZW50Lm91dHB1dHMuaXNfbnVtYmVyX2xhcmdlcl90aGFuX3plcm8sCiAgICAgICAgICAgICAgICBtYXBwaW5nPXsKICAgICAgICAgICAgICAgICAgICAib3V0cHV0X2luX251bWJlciI6IGNvbW1hbmRfY29tcG9uZW50LmlucHV0cy5jb21wb25lbnRfaW5fbnVtYmVyLAogICAgICAgICAgICAgICAgICAgIGNvbW1hbmRfY29tcG9uZW50Lm91dHB1dHMub3V0cHV0X2luX3BhdGg6IGNvbW1hbmRfY29tcG9uZW50LmlucHV0cy5jb21wb25lbnRfaW5fcGF0aCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBtYXhfaXRlcmF0aW9uX2NvdW50PTUsCiAgICAgICAgICAgICkKCiAgICAgICAgICAgICMgVXNlIHRoZSBvdXRwdXRzIG9mIGRvX3doaWxlIG5vZGUKICAgICAgICAgICAgYmFzaWNfY29tcG9uZW50ID0gZG9fd2hpbGVfYm9keV9waXBlbGluZV9jb21wb25lbnQoCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyPU5vbmUsCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fcGF0aD1jb21tYW5kX2NvbXBvbmVudC5vdXRwdXRzLm91dHB1dF9pbl9wYXRoLAogICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiB7Im91dHB1dF9pbl9wYXRoIjogYmFzaWNfY29tcG9uZW50Lm91dHB1dHMub3V0cHV0X2luX3BhdGh9CgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBpcGVsaW5lX3dpdGhfZG9fd2hpbGUoCiAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9MiwKICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9SW5wdXQodHlwZT0idXJpX2ZvbGRlciIsIHBhdGg9c3RyKFBhdGgoX19maWxlX18pLnBhcmVudCkpLAogICAgICAgICkKICAgICAgICAjIHNldCBwaXBlbGluZSBsZXZlbCBjb21wdXRlCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKCiAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCgogICAgZGVmIHRlc3RfZG9fd2hpbGVfcGlwZWxpbmVfd2l0aF9wcmltaXRpdmVfaW5wdXRzKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIEBwaXBlbGluZQogICAgICAgIGRlZiBkb193aGlsZV9ib2R5X3BpcGVsaW5lX2NvbXBvbmVudCgKICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcjogSW5wdXQodHlwZT0iaW50ZWdlciIpLAogICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyXzE6IElucHV0KHR5cGU9ImludGVnZXIiKSwKICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg6IElucHV0KHR5cGU9InVyaV9mb2xkZXIiKSwKICAgICAgICApOgogICAgICAgICAgICAiIiJFMkUgZHVtbXkgdHJhaW4tc2NvcmUtZXZhbCBwaXBlbGluZSB3aXRoIGNvbXBvbmVudHMgZGVmaW5lZCB2aWEgeWFtbC4iIiIKICAgICAgICAgICAgIyBDYWxsIGNvbXBvbmVudCBvYmogYXMgZnVuY3Rpb246IGFwcGx5IGdpdmVuIGlucHV0cyAmIHBhcmFtZXRlcnMgdG8gY3JlYXRlIGEgbm9kZSBpbiBwaXBlbGluZQogICAgICAgICAgICB0cmFpbl93aXRoX3NhbXBsZV9kYXRhID0gc2VsZi5fYmFzaWNfY29tcG9uZW50X2Z1bmMoCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyPWNvbXBvbmVudF9pbl9udW1iZXIsCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyXzE9Y29tcG9uZW50X2luX251bWJlcl8xLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2luX3BhdGgsCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIHRyYWluX3dpdGhfc2FtcGxlX2RhdGEub3V0cHV0cwoKICAgICAgICBAcGlwZWxpbmUKICAgICAgICBkZWYgcGlwZWxpbmVfd2l0aF9kb193aGlsZSgKICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcjogSW5wdXQodHlwZT0iaW50ZWdlciIpLAogICAgICAgICAgICBjb21wb25lbnRfaW5fcGF0aDogSW5wdXQodHlwZT0idXJpX2ZvbGRlciIpLAogICAgICAgICk6CiAgICAgICAgICAgICMgRG8gd2hpbGUgbm9kZSB3aXRoIHBpcGVsaW5lIGNvbXBvbmVudAogICAgICAgICAgICBkb193aGlsZV9ib2R5X3BpcGVsaW5lID0gZG9fd2hpbGVfYm9keV9waXBlbGluZV9jb21wb25lbnQoCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyPWNvbXBvbmVudF9pbl9udW1iZXIsCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fbnVtYmVyXzE9Y29tcG9uZW50X2luX251bWJlciwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9wYXRoPWNvbXBvbmVudF9pbl9wYXRoLAogICAgICAgICAgICApCiAgICAgICAgICAgIGRvX3doaWxlX3dpdGhfcGlwZWxpbmUgPSBkb193aGlsZSggICMgbm9xYTogRjg0MQogICAgICAgICAgICAgICAgYm9keT1kb193aGlsZV9ib2R5X3BpcGVsaW5lLAogICAgICAgICAgICAgICAgY29uZGl0aW9uPWRvX3doaWxlX2JvZHlfcGlwZWxpbmUub3V0cHV0cy5pc19udW1iZXJfbGFyZ2VyX3RoYW5femVybywKICAgICAgICAgICAgICAgIG1hcHBpbmc9ewogICAgICAgICAgICAgICAgICAgIGRvX3doaWxlX2JvZHlfcGlwZWxpbmUub3V0cHV0cy5vdXRwdXRfaW5fbnVtYmVyOiBbCiAgICAgICAgICAgICAgICAgICAgICAgIGRvX3doaWxlX2JvZHlfcGlwZWxpbmUuaW5wdXRzLmNvbXBvbmVudF9pbl9udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIGRvX3doaWxlX2JvZHlfcGlwZWxpbmUuaW5wdXRzLmNvbXBvbmVudF9pbl9udW1iZXJfMSwKICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICJvdXRwdXRfaW5fcGF0aCI6IGRvX3doaWxlX2JvZHlfcGlwZWxpbmUuaW5wdXRzLmNvbXBvbmVudF9pbl9wYXRoLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG1heF9pdGVyYXRpb25fY291bnQ9NSwKICAgICAgICAgICAgKQoKICAgICAgICAgICAgY29tbWFuZF9jb21wb25lbnQgPSBzZWxmLl9iYXNpY19jb21wb25lbnRfZnVuYygKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXI9Y29tcG9uZW50X2luX251bWJlciwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXJfMT1jb21wb25lbnRfaW5fbnVtYmVyLAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9Y29tcG9uZW50X2luX3BhdGgsCiAgICAgICAgICAgICkKICAgICAgICAgICAgZG9fd2hpbGVfd2l0aF9jb21tYW5kX2NvbXBvbmVudCA9IGRvX3doaWxlKCAgIyBub3FhOiBGODQxCiAgICAgICAgICAgICAgICBib2R5PWNvbW1hbmRfY29tcG9uZW50LAogICAgICAgICAgICAgICAgY29uZGl0aW9uPWNvbW1hbmRfY29tcG9uZW50Lm91dHB1dHMuaXNfbnVtYmVyX2xhcmdlcl90aGFuX3plcm8sCiAgICAgICAgICAgICAgICBtYXBwaW5nPXsKICAgICAgICAgICAgICAgICAgICAib3V0cHV0X2luX251bWJlciI6IFsKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZF9jb21wb25lbnQuaW5wdXRzLmNvbXBvbmVudF9pbl9udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRfY29tcG9uZW50LmlucHV0cy5jb21wb25lbnRfaW5fbnVtYmVyXzEsCiAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICAib3V0cHV0X2luX3BhdGgiOiBjb21tYW5kX2NvbXBvbmVudC5pbnB1dHMuY29tcG9uZW50X2luX3BhdGgsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWF4X2l0ZXJhdGlvbl9jb3VudD01LAogICAgICAgICAgICApCgogICAgICAgICAgICAjIFVzZSB0aGUgb3V0cHV0cyBvZiBkb193aGlsZSBub2RlCiAgICAgICAgICAgIGJhc2ljX2NvbXBvbmVudCA9IGRvX3doaWxlX2JvZHlfcGlwZWxpbmVfY29tcG9uZW50KAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcj1kb193aGlsZV9ib2R5X3BpcGVsaW5lLm91dHB1dHMub3V0cHV0X2luX251bWJlciwKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9udW1iZXJfMT1jb21tYW5kX2NvbXBvbmVudC5vdXRwdXRzLm91dHB1dF9pbl9udW1iZXIsCiAgICAgICAgICAgICAgICBjb21wb25lbnRfaW5fcGF0aD1kb193aGlsZV9ib2R5X3BpcGVsaW5lLm91dHB1dHMub3V0cHV0X2luX3BhdGgsCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIHsib3V0cHV0X2luX3BhdGgiOiBiYXNpY19jb21wb25lbnQub3V0cHV0cy5vdXRwdXRfaW5fcGF0aH0KCiAgICAgICAgcGlwZWxpbmVfam9iID0gcGlwZWxpbmVfd2l0aF9kb193aGlsZSgKICAgICAgICAgICAgY29tcG9uZW50X2luX251bWJlcj0yLAogICAgICAgICAgICBjb21wb25lbnRfaW5fcGF0aD1JbnB1dCh0eXBlPSJ1cmlfZm9sZGVyIiwgcGF0aD1zdHIoUGF0aChfX2ZpbGVfXykucGFyZW50KSksCiAgICAgICAgKQogICAgICAgICMgc2V0IHBpcGVsaW5lIGxldmVsIGNvbXB1dGUKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImNwdS1jbHVzdGVyIgoKICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZV9qb2IsIGNsaWVudCkKCgpAcHl0ZXN0Lm1hcmsuc2tpcGlmKAogICAgY29uZGl0aW9uPWlzX2xpdmUoKSwKICAgICMgVE9ETzogcmVvcGVuIGxpdmUgdGVzdCB3aGVuIHBhcmFsbGVsX2ZvciBkZXBsb3llZCB0byBjYW5hcnkKICAgIHJlYXNvbj0icGFyYWxsZWxfZm9yIGlzIG5vdCBhdmFpbGFibGUgaW4gY2FuYXJ5LiIsCikKY2xhc3MgVGVzdFBhcmFsbGVsRm9yUGlwZWxpbmUoVGVzdENvbnRyb2xGbG93UGlwZWxpbmUpOgogICAgZGVmIHRlc3Rfc2ltcGxlX2RzbF9wYXJhbGxlbF9mb3JfcGlwZWxpbmUoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50ID0gbG9hZF9jb21wb25lbnQoc291cmNlPSIuL3Rlc3RzL3Rlc3RfY29uZmlncy9jb21wb25lbnRzL2hlbGxvd29ybGRfY29tcG9uZW50LnltbCIpCgogICAgICAgIEBwaXBlbGluZQogICAgICAgIGRlZiBwYXJhbGxlbF9mb3JfcGlwZWxpbmUoKToKICAgICAgICAgICAgcGFyYWxsZWxfYm9keSA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD10ZXN0X2lucHV0KQogICAgICAgICAgICBwYXJhbGxlbF9ub2RlID0gcGFyYWxsZWxfZm9yKAogICAgICAgICAgICAgICAgYm9keT1wYXJhbGxlbF9ib2R5LAogICAgICAgICAgICAgICAgaXRlbXM9WwogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDF9LAogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDJ9LAogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgKQogICAgICAgICAgICBhZnRlcl9ub2RlID0gaGVsbG9fd29ybGRfY29tcG9uZW50KAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9cGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwKICAgICAgICAgICAgKQogICAgICAgICAgICBhZnRlcl9ub2RlLmNvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBhcmFsbGVsX2Zvcl9waXBlbGluZSgpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKCiAgICAgICAgd2l0aCBpbmNsdWRlX3ByaXZhdGVfcHJldmlld19ub2Rlc19pbl9waXBlbGluZSgpOgogICAgICAgICAgICBwaXBlbGluZV9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZV9qb2IsIGNsaWVudCkKCiAgICAgICAgZHNsX3BpcGVsaW5lX2pvYl9kaWN0ID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCksICpvbWl0X2ZpZWxkcykKICAgICAgICBhc3NlcnQgZHNsX3BpcGVsaW5lX2pvYl9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXSA9PSB7CiAgICAgICAgICAgICJhZnRlcl9ub2RlIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiUkVNT1RFLldPUktTUEFDRS5DT01QT05FTlQiLAogICAgICAgICAgICAgICAgImNvbXB1dGVJZCI6ICJjcHUtY2x1c3RlciIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmpvYnMucGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH19IiwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm5hbWUiOiAiYWZ0ZXJfbm9kZSIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInBhcmFsbGVsX2JvZHkiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJSRU1PVEUuV09SS1NQQUNFLkNPTVBPTkVOVCIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogInVyaV9maWxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgInVyaSI6ICJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJuYW1lIjogInBhcmFsbGVsX2JvZHkiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJwYXJhbGxlbF9ub2RlIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiRFNMIiwKICAgICAgICAgICAgICAgICJib2R5IjogIiR7e3BhcmVudC5qb2JzLnBhcmFsbGVsX2JvZHl9fSIsCiAgICAgICAgICAgICAgICAiaXRlbXMiOiAnW3siY29tcG9uZW50X2luX251bWJlciI6IDF9LCAnICd7ImNvbXBvbmVudF9pbl9udW1iZXIiOiAyfV0nLAogICAgICAgICAgICAgICAgInR5cGUiOiAicGFyYWxsZWxfZm9yIiwKICAgICAgICAgICAgfSwKICAgICAgICB9CgogICAgZGVmIHRlc3RfZHNsX3BhcmFsbGVsX2Zvcl9waXBlbGluZV91bnByb3ZpZGVkX2lucHV0KHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudF9hbHQxLnltbCIpCgogICAgICAgIEBwaXBlbGluZQogICAgICAgIGRlZiBwYXJhbGxlbF9mb3JfcGlwZWxpbmUoKToKICAgICAgICAgICAgcGFyYWxsZWxfYm9keSA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD10ZXN0X2lucHV0KQogICAgICAgICAgICBwYXJhbGxlbF9ub2RlID0gcGFyYWxsZWxfZm9yKAogICAgICAgICAgICAgICAgYm9keT1wYXJhbGxlbF9ib2R5LAogICAgICAgICAgICAgICAgaXRlbXM9WwogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDF9LAogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDJ9LAogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgKQogICAgICAgICAgICBhZnRlcl9ub2RlID0gaGVsbG9fd29ybGRfY29tcG9uZW50KAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9cGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwgY29tcG9uZW50X2luX251bWJlcj0xCiAgICAgICAgICAgICkKICAgICAgICAgICAgYWZ0ZXJfbm9kZS5jb21wdXRlID0gImNwdS1jbHVzdGVyIgoKICAgICAgICBwaXBlbGluZV9qb2IgPSBwYXJhbGxlbF9mb3JfcGlwZWxpbmUoKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCgogICAgICAgIHdpdGggaW5jbHVkZV9wcml2YXRlX3ByZXZpZXdfbm9kZXNfaW5fcGlwZWxpbmUoKToKICAgICAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCiAgICAgICAgZHNsX3BpcGVsaW5lX2pvYl9kaWN0ID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCksICpvbWl0X2ZpZWxkcykKICAgICAgICBhc3NlcnQgZHNsX3BpcGVsaW5lX2pvYl9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXSA9PSB7CiAgICAgICAgICAgICJhZnRlcl9ub2RlIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiUkVNT1RFLldPUktTUEFDRS5DT01QT05FTlQiLAogICAgICAgICAgICAgICAgImNvbXB1dGVJZCI6ICJjcHUtY2x1c3RlciIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fbnVtYmVyIjogeyJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIjEifSwKICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX3BhdGgiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5qb2JzLnBhcmFsbGVsX25vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9fSIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibmFtZSI6ICJhZnRlcl9ub2RlIiwKICAgICAgICAgICAgICAgICJ0eXBlIjogImNvbW1hbmQiLAogICAgICAgICAgICB9LAogICAgICAgICAgICAicGFyYWxsZWxfYm9keSI6IHsKICAgICAgICAgICAgICAgICJfc291cmNlIjogIlJFTU9URS5XT1JLU1BBQ0UuQ09NUE9ORU5UIiwKICAgICAgICAgICAgICAgICJpbnB1dHMiOiB7CiAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9pbl9wYXRoIjogewogICAgICAgICAgICAgICAgICAgICAgICAiam9iX2lucHV0X3R5cGUiOiAidXJpX2ZpbGUiLAogICAgICAgICAgICAgICAgICAgICAgICAidXJpIjogImh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IiwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm5hbWUiOiAicGFyYWxsZWxfYm9keSIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInBhcmFsbGVsX25vZGUiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJEU0wiLAogICAgICAgICAgICAgICAgImJvZHkiOiAiJHt7cGFyZW50LmpvYnMucGFyYWxsZWxfYm9keX19IiwKICAgICAgICAgICAgICAgICJpdGVtcyI6ICdbeyJjb21wb25lbnRfaW5fbnVtYmVyIjogMX0sICcgJ3siY29tcG9uZW50X2luX251bWJlciI6IDJ9XScsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJwYXJhbGxlbF9mb3IiLAogICAgICAgICAgICB9LAogICAgICAgIH0KCiAgICBkZWYgdGVzdF9wYXJhbGxlbF9mb3JfcGlwZWxpbmVfd2l0aF9zdWJncmFwaChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnQueW1sIikKCiAgICAgICAgQHBpcGVsaW5lCiAgICAgICAgZGVmIHN1Yl9ncmFwaChjb21wb25lbnRfaW5fbnVtYmVyOiBpbnQgPSAxMCk6CiAgICAgICAgICAgIG5vZGUgPSBoZWxsb193b3JsZF9jb21wb25lbnQoY29tcG9uZW50X2luX3BhdGg9dGVzdF9pbnB1dCwgY29tcG9uZW50X2luX251bWJlcj1jb21wb25lbnRfaW5fbnVtYmVyKQogICAgICAgICAgICByZXR1cm4geyJjb21wb25lbnRfb3V0X3BhdGgiOiBub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRofQoKICAgICAgICBAcGlwZWxpbmUKICAgICAgICBkZWYgcGFyYWxsZWxfZm9yX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHBhcmFsbGVsX2JvZHkgPSBzdWJfZ3JhcGgoKQogICAgICAgICAgICBwYXJhbGxlbF9ub2RlID0gcGFyYWxsZWxfZm9yKAogICAgICAgICAgICAgICAgYm9keT1wYXJhbGxlbF9ib2R5LAogICAgICAgICAgICAgICAgaXRlbXM9WwogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDF9LAogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDJ9LAogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgKQogICAgICAgICAgICBhZnRlcl9ub2RlID0gaGVsbG9fd29ybGRfY29tcG9uZW50KAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9cGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwKICAgICAgICAgICAgKQogICAgICAgICAgICBhZnRlcl9ub2RlLmNvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBhcmFsbGVsX2Zvcl9waXBlbGluZSgpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKCiAgICAgICAgd2l0aCBpbmNsdWRlX3ByaXZhdGVfcHJldmlld19ub2Rlc19pbl9waXBlbGluZSgpOgogICAgICAgICAgICBwaXBlbGluZV9qb2IgPSBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZV9qb2IsIGNsaWVudCkKCiAgICAgICAgZHNsX3BpcGVsaW5lX2pvYl9kaWN0ID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCksICpvbWl0X2ZpZWxkcykKICAgICAgICBhc3NlcnQgZHNsX3BpcGVsaW5lX2pvYl9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXSA9PSB7CiAgICAgICAgICAgICJhZnRlcl9ub2RlIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiUkVNT1RFLldPUktTUEFDRS5DT01QT05FTlQiLAogICAgICAgICAgICAgICAgImNvbXB1dGVJZCI6ICJjcHUtY2x1c3RlciIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogImxpdGVyYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiJHt7cGFyZW50LmpvYnMucGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH19IiwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm5hbWUiOiAiYWZ0ZXJfbm9kZSIsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJjb21tYW5kIiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInBhcmFsbGVsX2JvZHkiOiB7Il9zb3VyY2UiOiAiUkVNT1RFLldPUktTUEFDRS5DT01QT05FTlQiLCAibmFtZSI6ICJwYXJhbGxlbF9ib2R5IiwgInR5cGUiOiAicGlwZWxpbmUifSwKICAgICAgICAgICAgInBhcmFsbGVsX25vZGUiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJEU0wiLAogICAgICAgICAgICAgICAgImJvZHkiOiAiJHt7cGFyZW50LmpvYnMucGFyYWxsZWxfYm9keX19IiwKICAgICAgICAgICAgICAgICJpdGVtcyI6ICdbeyJjb21wb25lbnRfaW5fbnVtYmVyIjogMX0sICcgJ3siY29tcG9uZW50X2luX251bWJlciI6IDJ9XScsCiAgICAgICAgICAgICAgICAidHlwZSI6ICJwYXJhbGxlbF9mb3IiLAogICAgICAgICAgICB9LAogICAgICAgIH0KCiAgICBkZWYgdGVzdF9wYXJhbGxlbF9mb3JfcGlwZWxpbmVfc3ViZ3JhcGhfdW5wcm92aWRlZF9pbnB1dChzZWxmLCBjbGllbnQ6IE1MQ2xpZW50KToKICAgICAgICBoZWxsb193b3JsZF9jb21wb25lbnQgPSBsb2FkX2NvbXBvbmVudChzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnQueW1sIikKCiAgICAgICAgQHBpcGVsaW5lCiAgICAgICAgZGVmIHN1Yl9ncmFwaChjb21wb25lbnRfaW5fbnVtYmVyOiBpbnQpOgogICAgICAgICAgICBub2RlID0gaGVsbG9fd29ybGRfY29tcG9uZW50KGNvbXBvbmVudF9pbl9wYXRoPXRlc3RfaW5wdXQsIGNvbXBvbmVudF9pbl9udW1iZXI9Y29tcG9uZW50X2luX251bWJlcikKICAgICAgICAgICAgcmV0dXJuIHsiY29tcG9uZW50X291dF9wYXRoIjogbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH0KCiAgICAgICAgQHBpcGVsaW5lCiAgICAgICAgZGVmIHBhcmFsbGVsX2Zvcl9waXBlbGluZSgpOgogICAgICAgICAgICBwYXJhbGxlbF9ib2R5ID0gc3ViX2dyYXBoKCkKICAgICAgICAgICAgcGFyYWxsZWxfbm9kZSA9IHBhcmFsbGVsX2ZvcigKICAgICAgICAgICAgICAgIGJvZHk9cGFyYWxsZWxfYm9keSwKICAgICAgICAgICAgICAgIGl0ZW1zPVsKICAgICAgICAgICAgICAgICAgICB7ImNvbXBvbmVudF9pbl9udW1iZXIiOiAxfSwKICAgICAgICAgICAgICAgICAgICB7ImNvbXBvbmVudF9pbl9udW1iZXIiOiAyfSwKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICkKICAgICAgICAgICAgYWZ0ZXJfbm9kZSA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudCgKICAgICAgICAgICAgICAgIGNvbXBvbmVudF9pbl9wYXRoPXBhcmFsbGVsX25vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgsCiAgICAgICAgICAgICkKICAgICAgICAgICAgYWZ0ZXJfbm9kZS5jb21wdXRlID0gImNwdS1jbHVzdGVyIgoKICAgICAgICBwaXBlbGluZV9qb2IgPSBwYXJhbGxlbF9mb3JfcGlwZWxpbmUoKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCgogICAgICAgIHdpdGggaW5jbHVkZV9wcml2YXRlX3ByZXZpZXdfbm9kZXNfaW5fcGlwZWxpbmUoKToKICAgICAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCgogICAgICAgIGRzbF9waXBlbGluZV9qb2JfZGljdCA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpLCAqb21pdF9maWVsZHMpCiAgICAgICAgYXNzZXJ0IGRzbF9waXBlbGluZV9qb2JfZGljdFsicHJvcGVydGllcyJdWyJqb2JzIl0gPT0gewogICAgICAgICAgICAiYWZ0ZXJfbm9kZSI6IHsKICAgICAgICAgICAgICAgICJfc291cmNlIjogIlJFTU9URS5XT1JLU1BBQ0UuQ09NUE9ORU5UIiwKICAgICAgICAgICAgICAgICJjb21wdXRlSWQiOiAiY3B1LWNsdXN0ZXIiLAogICAgICAgICAgICAgICAgImlucHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X2luX3BhdGgiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfaW5wdXRfdHlwZSI6ICJsaXRlcmFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIiR7e3BhcmVudC5qb2JzLnBhcmFsbGVsX25vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9fSIsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJuYW1lIjogImFmdGVyX25vZGUiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJwYXJhbGxlbF9ib2R5IjogeyJfc291cmNlIjogIlJFTU9URS5XT1JLU1BBQ0UuQ09NUE9ORU5UIiwgIm5hbWUiOiAicGFyYWxsZWxfYm9keSIsICJ0eXBlIjogInBpcGVsaW5lIn0sCiAgICAgICAgICAgICJwYXJhbGxlbF9ub2RlIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiRFNMIiwKICAgICAgICAgICAgICAgICJib2R5IjogIiR7e3BhcmVudC5qb2JzLnBhcmFsbGVsX2JvZHl9fSIsCiAgICAgICAgICAgICAgICAiaXRlbXMiOiAnW3siY29tcG9uZW50X2luX251bWJlciI6IDF9LCAnICd7ImNvbXBvbmVudF9pbl9udW1iZXIiOiAyfV0nLAogICAgICAgICAgICAgICAgInR5cGUiOiAicGFyYWxsZWxfZm9yIiwKICAgICAgICAgICAgfSwKICAgICAgICB9CgogICAgZGVmIHRlc3RfcGFyYWxsZWxfZm9yX3BpcGVsaW5lX3dpdGhfcG9ydF9vdXRwdXRzKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICBzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnQueW1sIiwKICAgICAgICAgICAgcGFyYW1zX292ZXJyaWRlPVsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAib3V0cHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHsidHlwZSI6ICJ1cmlfZm9sZGVyIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfb3V0X2ZpbGUiOiB7InR5cGUiOiAidXJpX2ZpbGUifSwKICAgICAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfdGFibGUiOiB7InR5cGUiOiAibWx0YWJsZSJ9LAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICApCgogICAgICAgIEBwaXBlbGluZQogICAgICAgIGRlZiBwYXJhbGxlbF9mb3JfcGlwZWxpbmUoKToKICAgICAgICAgICAgcGFyYWxsZWxfYm9keSA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD10ZXN0X2lucHV0KQogICAgICAgICAgICBwYXJhbGxlbF9ub2RlID0gcGFyYWxsZWxfZm9yKAogICAgICAgICAgICAgICAgYm9keT1wYXJhbGxlbF9ib2R5LAogICAgICAgICAgICAgICAgaXRlbXM9WwogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDN9LAogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDR9LAogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHBhcmFsbGVsX25vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgsCiAgICAgICAgICAgICAgICAiY29tcG9uZW50X291dF9maWxlIjogcGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfZmlsZSwKICAgICAgICAgICAgICAgICJjb21wb25lbnRfb3V0X3RhYmxlIjogcGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfdGFibGUsCiAgICAgICAgICAgIH0KCiAgICAgICAgcGlwZWxpbmVfam9iID0gcGFyYWxsZWxfZm9yX3BpcGVsaW5lKCkKICAgICAgICBwaXBlbGluZV9qb2Iuc2V0dGluZ3MuZGVmYXVsdF9jb21wdXRlID0gImNwdS1jbHVzdGVyIgoKICAgICAgICB3aXRoIGluY2x1ZGVfcHJpdmF0ZV9wcmV2aWV3X25vZGVzX2luX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHBpcGVsaW5lX2pvYiA9IGFzc2VydF9qb2JfY2FuY2VsKHBpcGVsaW5lX2pvYiwgY2xpZW50KQoKICAgICAgICBkc2xfcGlwZWxpbmVfam9iX2RpY3QgPSBvbWl0X3dpdGhfd2lsZGNhcmQocGlwZWxpbmVfam9iLl90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKSwgKm9taXRfZmllbGRzKQogICAgICAgIGFzc2VydCBkc2xfcGlwZWxpbmVfam9iX2RpY3RbInByb3BlcnRpZXMiXVsiam9icyJdID09IHsKICAgICAgICAgICAgInBhcmFsbGVsX2JvZHkiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJSRU1PVEUuV09SS1NQQUNFLkNPTVBPTkVOVCIsCiAgICAgICAgICAgICAgICAiaW5wdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfaW5fcGF0aCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9pbnB1dF90eXBlIjogInVyaV9maWxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgInVyaSI6ICJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJuYW1lIjogInBhcmFsbGVsX2JvZHkiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiY29tbWFuZCIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJwYXJhbGxlbF9ub2RlIjogewogICAgICAgICAgICAgICAgIl9zb3VyY2UiOiAiRFNMIiwKICAgICAgICAgICAgICAgICJib2R5IjogIiR7e3BhcmVudC5qb2JzLnBhcmFsbGVsX2JvZHl9fSIsCiAgICAgICAgICAgICAgICAiaXRlbXMiOiAnW3siY29tcG9uZW50X2luX251bWJlciI6IDN9LCAnICd7ImNvbXBvbmVudF9pbl9udW1iZXIiOiA0fV0nLAogICAgICAgICAgICAgICAgInR5cGUiOiAicGFyYWxsZWxfZm9yIiwKICAgICAgICAgICAgICAgICJvdXRwdXRzIjogewogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfb3V0X2ZpbGUiOiB7InR5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy5jb21wb25lbnRfb3V0X2ZpbGV9fSJ9LAogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfb3V0X3BhdGgiOiB7InR5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9fSJ9LAogICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRfb3V0X3RhYmxlIjogeyJ0eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50Lm91dHB1dHMuY29tcG9uZW50X291dF90YWJsZX19In0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgIH0KICAgICAgICBhc3NlcnQgZHNsX3BpcGVsaW5lX2pvYl9kaWN0WyJwcm9wZXJ0aWVzIl1bIm91dHB1dHMiXSA9PSB7CiAgICAgICAgICAgICJjb21wb25lbnRfb3V0X2ZpbGUiOiB7ImpvYl9vdXRwdXRfdHlwZSI6ICJtbHRhYmxlIiwgIm1vZGUiOiAiUmVhZFdyaXRlTW91bnQifSwKICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHsiam9iX291dHB1dF90eXBlIjogIm1sdGFibGUiLCAibW9kZSI6ICJSZWFkV3JpdGVNb3VudCJ9LAogICAgICAgICAgICAiY29tcG9uZW50X291dF90YWJsZSI6IHsiam9iX291dHB1dF90eXBlIjogIm1sdGFibGUiLCAibW9kZSI6ICJSZWFkV3JpdGVNb3VudCJ9LAogICAgICAgIH0KCiAgICAgICAgIyBwYXJhbGxlbCBmb3IgcGlwZWxpbmUgY29tcG9uZW50IGlzIGNvcnJlY3RseSBnZW5lcmF0ZWQKICAgICAgICBAcGlwZWxpbmUKICAgICAgICBkZWYgcGFyZW50X3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHBhcmFsbGVsX2Zvcl9waXBlbGluZSgpCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBhcmVudF9waXBlbGluZSgpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKCiAgICAgICAgcmVzdF9waXBlbGluZV9jb21wb25lbnQgPSBwaXBlbGluZV9qb2Iuam9ic1sicGFyYWxsZWxfZm9yX3BpcGVsaW5lIl0uY29tcG9uZW50Ll90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKQogICAgICAgIGFzc2VydCByZXN0X3BpcGVsaW5lX2NvbXBvbmVudFsicHJvcGVydGllcyJdWyJjb21wb25lbnRfc3BlYyJdWyJvdXRwdXRzIl0gPT0gewogICAgICAgICAgICAiY29tcG9uZW50X291dF9maWxlIjogeyJ0eXBlIjogIm1sdGFibGUifSwKICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHsidHlwZSI6ICJtbHRhYmxlIn0sCiAgICAgICAgICAgICJjb21wb25lbnRfb3V0X3RhYmxlIjogeyJ0eXBlIjogIm1sdGFibGUifSwKICAgICAgICB9CiAgICAgICAgYXNzZXJ0IHJlc3RfcGlwZWxpbmVfY29tcG9uZW50WyJwcm9wZXJ0aWVzIl1bImNvbXBvbmVudF9zcGVjIl1bImpvYnMiXVsicGFyYWxsZWxfbm9kZSJdID09IHsKICAgICAgICAgICAgImJvZHkiOiAiJHt7cGFyZW50LmpvYnMucGFyYWxsZWxfYm9keX19IiwKICAgICAgICAgICAgIml0ZW1zIjogJ1t7ImNvbXBvbmVudF9pbl9udW1iZXIiOiAzfSwgeyJjb21wb25lbnRfaW5fbnVtYmVyIjogNH1dJywKICAgICAgICAgICAgIm91dHB1dHMiOiB7CiAgICAgICAgICAgICAgICAiY29tcG9uZW50X291dF9maWxlIjogeyJ0eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50Lm91dHB1dHMuY29tcG9uZW50X291dF9maWxlfX0ifSwKICAgICAgICAgICAgICAgICJjb21wb25lbnRfb3V0X3BhdGgiOiB7InR5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGh9fSJ9LAogICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfdGFibGUiOiB7InR5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy5jb21wb25lbnRfb3V0X3RhYmxlfX0ifSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInR5cGUiOiAicGFyYWxsZWxfZm9yIiwKICAgICAgICAgICAgIl9zb3VyY2UiOiAiRFNMIiwKICAgICAgICB9CgogICAgICAgIHdpdGggaW5jbHVkZV9wcml2YXRlX3ByZXZpZXdfbm9kZXNfaW5fcGlwZWxpbmUoKToKICAgICAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCgogICAgZGVmIHRlc3RfcGFyYWxsZWxfZm9yX3BpcGVsaW5lX3dpdGhfcHJpbWl0aXZlX291dHB1dHMoc2VsZiwgY2xpZW50OiBNTENsaWVudCk6CiAgICAgICAgaGVsbG9fd29ybGRfY29tcG9uZW50ID0gbG9hZF9jb21wb25lbnQoCiAgICAgICAgICAgIHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiLAogICAgICAgICAgICBwYXJhbXNfb3ZlcnJpZGU9WwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJvdXRwdXRzIjogewogICAgICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X291dF9wYXRoIjogeyJ0eXBlIjogInVyaV9mb2xkZXIifSwKICAgICAgICAgICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfbnVtYmVyIjogeyJ0eXBlIjogIm51bWJlciJ9LAogICAgICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X291dF9ib29sZWFuIjogeyJ0eXBlIjogImJvb2xlYW4iLCAiaXNfY29udHJvbCI6IFRydWV9LAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICApCgogICAgICAgIEBwaXBlbGluZQogICAgICAgIGRlZiBwYXJhbGxlbF9mb3JfcGlwZWxpbmUoKToKICAgICAgICAgICAgcGFyYWxsZWxfYm9keSA9IGhlbGxvX3dvcmxkX2NvbXBvbmVudChjb21wb25lbnRfaW5fcGF0aD10ZXN0X2lucHV0KQogICAgICAgICAgICBwYXJhbGxlbF9ub2RlID0gcGFyYWxsZWxfZm9yKAogICAgICAgICAgICAgICAgYm9keT1wYXJhbGxlbF9ib2R5LAogICAgICAgICAgICAgICAgaXRlbXM9WwogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDF9LAogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDJ9LAogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHBhcmFsbGVsX25vZGUub3V0cHV0cy5jb21wb25lbnRfb3V0X3BhdGgsCiAgICAgICAgICAgICAgICAiY29tcG9uZW50X291dF9udW1iZXIiOiBwYXJhbGxlbF9ub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9udW1iZXIsCiAgICAgICAgICAgICAgICAiY29tcG9uZW50X291dF9ib29sZWFuIjogcGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfYm9vbGVhbiwKICAgICAgICAgICAgfQoKICAgICAgICBAcGlwZWxpbmUKICAgICAgICBkZWYgcGFyZW50X3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHBhcmFsbGVsX2Zvcl9waXBlbGluZSgpCgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBhcmVudF9waXBlbGluZSgpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKCiAgICAgICAgcmVzdF9waXBlbGluZV9jb21wb25lbnQgPSBwaXBlbGluZV9qb2Iuam9ic1sicGFyYWxsZWxfZm9yX3BpcGVsaW5lIl0uY29tcG9uZW50Ll90b19yZXN0X29iamVjdCgpLmFzX2RpY3QoKQogICAgICAgIGFzc2VydCByZXN0X3BpcGVsaW5lX2NvbXBvbmVudFsicHJvcGVydGllcyJdWyJjb21wb25lbnRfc3BlYyJdWyJvdXRwdXRzIl0gPT0gewogICAgICAgICAgICAiY29tcG9uZW50X291dF9ib29sZWFuIjogeyJpc19jb250cm9sIjogVHJ1ZSwgInR5cGUiOiAic3RyaW5nIn0sCiAgICAgICAgICAgICJjb21wb25lbnRfb3V0X251bWJlciI6IHsidHlwZSI6ICJzdHJpbmcifSwKICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHsidHlwZSI6ICJtbHRhYmxlIn0sCiAgICAgICAgfQoKICAgICAgICBhc3NlcnQgcmVzdF9waXBlbGluZV9jb21wb25lbnRbInByb3BlcnRpZXMiXVsiY29tcG9uZW50X3NwZWMiXVsiam9icyJdWyJwYXJhbGxlbF9ub2RlIl0gPT0gewogICAgICAgICAgICAiYm9keSI6ICIke3twYXJlbnQuam9icy5wYXJhbGxlbF9ib2R5fX0iLAogICAgICAgICAgICAiaXRlbXMiOiAnW3siY29tcG9uZW50X2luX251bWJlciI6IDF9LCB7ImNvbXBvbmVudF9pbl9udW1iZXIiOiAyfV0nLAogICAgICAgICAgICAib3V0cHV0cyI6IHsKICAgICAgICAgICAgICAgICJjb21wb25lbnRfb3V0X2Jvb2xlYW4iOiB7InR5cGUiOiAibGl0ZXJhbCIsICJ2YWx1ZSI6ICIke3twYXJlbnQub3V0cHV0cy5jb21wb25lbnRfb3V0X2Jvb2xlYW59fSJ9LAogICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfbnVtYmVyIjogeyJ0eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50Lm91dHB1dHMuY29tcG9uZW50X291dF9udW1iZXJ9fSJ9LAogICAgICAgICAgICAgICAgImNvbXBvbmVudF9vdXRfcGF0aCI6IHsidHlwZSI6ICJsaXRlcmFsIiwgInZhbHVlIjogIiR7e3BhcmVudC5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aH19In0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJ0eXBlIjogInBhcmFsbGVsX2ZvciIsCiAgICAgICAgICAgICJfc291cmNlIjogIkRTTCIsCiAgICAgICAgfQoKICAgICAgICAjIHBhcmFsbGVsIGZvciBwaXBlbGluZSBjb21wb25lbnQgaXMgY29ycmVjdGx5IGdlbmVyYXRlZAogICAgICAgIHdpdGggaW5jbHVkZV9wcml2YXRlX3ByZXZpZXdfbm9kZXNfaW5fcGlwZWxpbmUoKToKICAgICAgICAgICAgYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCgogICAgZGVmIHRlc3RfcGFyYWxsZWxfZm9yX3BpcGVsaW5lX3dpdGhfZW1wdHlfaW5wdXRzKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KAogICAgICAgICAgICBzb3VyY2U9Ii4vdGVzdHMvdGVzdF9jb25maWdzL2NvbXBvbmVudHMvaGVsbG93b3JsZF9jb21wb25lbnRfbm9faW5wdXRzLnltbCIsCiAgICAgICAgKQoKICAgICAgICBAcGlwZWxpbmUKICAgICAgICBkZWYgcGFyYWxsZWxfZm9yX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHBhcmFsbGVsX2JvZHkgPSBoZWxsb193b3JsZF9jb21wb25lbnQoKQogICAgICAgICAgICBmb3JlYWNoX2NvbmZpZyA9IHt9CiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDEwKToKICAgICAgICAgICAgICAgIGZvcmVhY2hfY29uZmlnW2Yic2lsb197aX0iXSA9IHt9CiAgICAgICAgICAgIHBhcmFsbGVsX25vZGUgPSBwYXJhbGxlbF9mb3IoYm9keT1wYXJhbGxlbF9ib2R5LCBpdGVtcz1mb3JlYWNoX2NvbmZpZykKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJjb21wb25lbnRfb3V0X3BhdGgiOiBwYXJhbGxlbF9ub2RlLm91dHB1dHMuY29tcG9uZW50X291dF9wYXRoLAogICAgICAgICAgICB9CgogICAgICAgIHBpcGVsaW5lX2pvYiA9IHBhcmFsbGVsX2Zvcl9waXBlbGluZSgpCiAgICAgICAgcGlwZWxpbmVfam9iLnNldHRpbmdzLmRlZmF1bHRfY29tcHV0ZSA9ICJjcHUtY2x1c3RlciIKCiAgICAgICAgd2l0aCBpbmNsdWRlX3ByaXZhdGVfcHJldmlld19ub2Rlc19pbl9waXBlbGluZSgpOgogICAgICAgICAgICBhc3NlcnRfam9iX2NhbmNlbChwaXBlbGluZV9qb2IsIGNsaWVudCkKCiAgICAgICAgZHNsX3BpcGVsaW5lX2pvYl9kaWN0ID0gb21pdF93aXRoX3dpbGRjYXJkKHBpcGVsaW5lX2pvYi5fdG9fcmVzdF9vYmplY3QoKS5hc19kaWN0KCksICpvbWl0X2ZpZWxkcykKICAgICAgICBhc3NlcnQgZHNsX3BpcGVsaW5lX2pvYl9kaWN0WyJwcm9wZXJ0aWVzIl1bImpvYnMiXSA9PSB7CiAgICAgICAgICAgICJwYXJhbGxlbF9ib2R5IjogeyJfc291cmNlIjogIllBTUwuQ09NUE9ORU5UIiwgIm5hbWUiOiAicGFyYWxsZWxfYm9keSIsICJ0eXBlIjogImNvbW1hbmQifSwKICAgICAgICAgICAgInBhcmFsbGVsX25vZGUiOiB7CiAgICAgICAgICAgICAgICAiX3NvdXJjZSI6ICJEU0wiLAogICAgICAgICAgICAgICAgImJvZHkiOiAiJHt7cGFyZW50LmpvYnMucGFyYWxsZWxfYm9keX19IiwKICAgICAgICAgICAgICAgICJpdGVtcyI6ICd7InNpbG9fMCI6IHt9LCAic2lsb18xIjoge30sICJzaWxvXzIiOiB7fSwgJwogICAgICAgICAgICAgICAgJyJzaWxvXzMiOiB7fSwgInNpbG9fNCI6IHt9LCAic2lsb181Ijoge30sICcKICAgICAgICAgICAgICAgICcic2lsb182Ijoge30sICJzaWxvXzciOiB7fSwgInNpbG9fOCI6IHt9LCAnCiAgICAgICAgICAgICAgICAnInNpbG9fOSI6IHt9fScsCiAgICAgICAgICAgICAgICAib3V0cHV0cyI6IHsKICAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50X291dF9wYXRoIjogeyJ0eXBlIjogImxpdGVyYWwiLCAidmFsdWUiOiAiJHt7cGFyZW50Lm91dHB1dHMuY29tcG9uZW50X291dF9wYXRofX0ifQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ0eXBlIjogInBhcmFsbGVsX2ZvciIsCiAgICAgICAgICAgIH0sCiAgICAgICAgfQoKICAgIGRlZiB0ZXN0X3BhcmFsbGVsX2Zvcl9waXBlbGluZV93aXRoX2Fzc2V0X2l0ZW1zKHNlbGYsIGNsaWVudDogTUxDbGllbnQpOgogICAgICAgIGhlbGxvX3dvcmxkX2NvbXBvbmVudCA9IGxvYWRfY29tcG9uZW50KHNvdXJjZT0iLi90ZXN0cy90ZXN0X2NvbmZpZ3MvY29tcG9uZW50cy9oZWxsb3dvcmxkX2NvbXBvbmVudC55bWwiKQoKICAgICAgICBAcGlwZWxpbmUKICAgICAgICBkZWYgcGFyYWxsZWxfZm9yX3BpcGVsaW5lKCk6CiAgICAgICAgICAgIHBhcmFsbGVsX2JvZHkgPSBoZWxsb193b3JsZF9jb21wb25lbnQoKQogICAgICAgICAgICBwYXJhbGxlbF9ub2RlID0gcGFyYWxsZWxfZm9yKAogICAgICAgICAgICAgICAgYm9keT1wYXJhbGxlbF9ib2R5LAogICAgICAgICAgICAgICAgaXRlbXM9WwogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDEsICJjb21wb25lbnRfaW5fcGF0aCI6IHRlc3RfaW5wdXR9LAogICAgICAgICAgICAgICAgICAgIHsiY29tcG9uZW50X2luX251bWJlciI6IDIsICJjb21wb25lbnRfaW5fcGF0aCI6IHRlc3RfaW5wdXR9LAogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgKQogICAgICAgICAgICBhZnRlcl9ub2RlID0gaGVsbG9fd29ybGRfY29tcG9uZW50KAogICAgICAgICAgICAgICAgY29tcG9uZW50X2luX3BhdGg9cGFyYWxsZWxfbm9kZS5vdXRwdXRzLmNvbXBvbmVudF9vdXRfcGF0aCwKICAgICAgICAgICAgKQoKICAgICAgICBwaXBlbGluZV9qb2IgPSBwYXJhbGxlbF9mb3JfcGlwZWxpbmUoKQogICAgICAgIHBpcGVsaW5lX2pvYi5zZXR0aW5ncy5kZWZhdWx0X2NvbXB1dGUgPSAiY3B1LWNsdXN0ZXIiCgogICAgICAgIHdpdGggaW5jbHVkZV9wcml2YXRlX3ByZXZpZXdfbm9kZXNfaW5fcGlwZWxpbmUoKToKICAgICAgICAgICAgcGlwZWxpbmVfam9iID0gYXNzZXJ0X2pvYl9jYW5jZWwocGlwZWxpbmVfam9iLCBjbGllbnQpCgogICAgICAgIGRzbF9waXBlbGluZV9qb2JfZGljdCA9IG9taXRfd2l0aF93aWxkY2FyZChwaXBlbGluZV9qb2IuX3RvX3Jlc3Rfb2JqZWN0KCkuYXNfZGljdCgpLCAqb21pdF9maWVsZHMpCiAgICAgICAgYXNzZXJ0IGRzbF9waXBlbGluZV9qb2JfZGljdFsicHJvcGVydGllcyJdWyJqb2JzIl1bInBhcmFsbGVsX25vZGUiXSA9PSB7CiAgICAgICAgICAgICJib2R5IjogIiR7e3BhcmVudC5qb2JzLnBhcmFsbGVsX2JvZHl9fSIsCiAgICAgICAgICAgICJpdGVtcyI6ICdbeyJjb21wb25lbnRfaW5fcGF0aCI6IHsidXJpIjogJwogICAgICAgICAgICAnImh0dHBzOi8vZHByZXBkYXRhLmJsb2IuY29yZS53aW5kb3dzLm5ldC9kZW1vL1RpdGFuaWMuY3N2IiwgJwogICAgICAgICAgICAnImpvYl9pbnB1dF90eXBlIjogInVyaV9maWxlIn0sICcKICAgICAgICAgICAgJyJjb21wb25lbnRfaW5fbnVtYmVyIjogMX0sIHsiY29tcG9uZW50X2luX3BhdGgiOiAnCiAgICAgICAgICAgICd7InVyaSI6ICcKICAgICAgICAgICAgJyJodHRwczovL2RwcmVwZGF0YS5ibG9iLmNvcmUud2luZG93cy5uZXQvZGVtby9UaXRhbmljLmNzdiIsICcKICAgICAgICAgICAgJyJqb2JfaW5wdXRfdHlwZSI6ICJ1cmlfZmlsZSJ9LCAnCiAgICAgICAgICAgICciY29tcG9uZW50X2luX251bWJlciI6IDJ9XScsCiAgICAgICAgICAgICJ0eXBlIjogInBhcmFsbGVsX2ZvciIsCiAgICAgICAgICAgICJfc291cmNlIjogIkRTTCIsCiAgICAgICAgfQo=",
      "StatusCode": 201,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Content-MD5": "0Yg5NKHT8G0ZIFsOlwemMA==",
        "Date": "Tue, 30 May 2023 07:29:03 GMT",
        "ETag": "\u00220x8DB60DF8B38E45F\u0022",
        "Last-Modified": "Tue, 30 May 2023 07:29:03 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-content-crc64": "egOK8PjHmdE=",
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://amltest5899420437.blob.core.windows.net/azureml-blobstore-0bdd51b6-cd9c-4978-b870-99997b393b81/LocalUpload/00000000000000000000000000000000/e2etests/__init__.py?comp=metadata",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/xml",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "0",
        "User-Agent": "azsdk-python-storage-blob/12.16.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)",
        "x-ms-date": "Tue, 30 May 2023 07:29:01 GMT",
        "x-ms-meta-name": "4b21f2c9-b56f-4516-af22-4e9639fee990",
        "x-ms-meta-upload_status": "completed",
        "x-ms-meta-version": "ee5444b3-4c3e-48e9-b4b3-bea247a1c903",
        "x-ms-version": "2022-11-02"
      },
      "RequestBody": null,
      "StatusCode": 200,
      "ResponseHeaders": {
        "Content-Length": "0",
        "Date": "Tue, 30 May 2023 07:29:03 GMT",
        "ETag": "\u00220x8DB60DF8B5C93AF\u0022",
        "Last-Modified": "Tue, 30 May 2023 07:29:03 GMT",
        "Server": [
          "Windows-Azure-Blob/1.0",
          "Microsoft-HTTPAPI/2.0"
        ],
        "x-ms-request-server-encrypted": "true",
        "x-ms-version": "2022-11-02"
      },
      "ResponseBody": null
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/jobs/000000000000000000000?api-version=2023-04-01-preview",
      "RequestMethod": "PUT",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "3487",
        "Content-Type": "application/json",
        "User-Agent": "azure-ai-ml/1.8.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)"
      },
      "RequestBody": {
        "properties": {
          "properties": {},
          "tags": {},
          "displayName": "pipeline_with_do_while",
          "experimentName": "azure-ai-ml",
          "isArchived": false,
          "jobType": "Pipeline",
          "inputs": {
            "component_in_number": {
              "jobInputType": "literal",
              "value": "2"
            },
            "component_in_path": {
              "uri": "azureml://datastores/workspaceblobstore/paths/LocalUpload/00000000000000000000000000000000/e2etests/",
              "jobInputType": "uri_folder"
            }
          },
          "jobs": {
            "do_while_body_pipeline": {
              "name": "do_while_body_pipeline",
              "type": "pipeline",
              "inputs": {
                "component_in_number": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_number}}"
                },
                "component_in_number_1": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_number}}"
                },
                "component_in_path": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_path}}"
                }
              },
              "_source": "DSL",
              "componentId": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/ae52818b-d81e-44df-aef4-fc6cc33a9d40"
            },
            "do_while_with_pipeline": {
              "body": "${{parent.jobs.do_while_body_pipeline}}",
              "type": "do_while",
              "condition": "is_number_larger_than_zero",
              "mapping": {
                "${{parent.jobs.do_while_body_pipeline.outputs.output_in_number}}": [
                  "component_in_number",
                  "component_in_number_1"
                ],
                "output_in_path": [
                  "component_in_path"
                ]
              },
              "limits": {
                "max_iteration_count": 5
              },
              "_source": "DSL"
            },
            "command_component": {
              "name": "command_component",
              "type": "command",
              "inputs": {
                "component_in_number": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_number}}"
                },
                "component_in_number_1": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_number}}"
                },
                "component_in_path": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_path}}"
                }
              },
              "_source": "YAML.COMPONENT",
              "componentId": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/744e2b52-597b-47b6-b06b-2cebd143bcdf"
            },
            "do_while_with_command_component": {
              "body": "${{parent.jobs.command_component}}",
              "type": "do_while",
              "condition": "is_number_larger_than_zero",
              "mapping": {
                "output_in_number": [
                  "component_in_number",
                  "component_in_number_1"
                ],
                "output_in_path": [
                  "component_in_path"
                ]
              },
              "limits": {
                "max_iteration_count": 5
              },
              "_source": "DSL"
            },
            "basic_component": {
              "name": "basic_component",
              "type": "pipeline",
              "inputs": {
                "component_in_number": {
                  "job_input_type": "literal",
                  "value": "${{parent.jobs.do_while_body_pipeline.outputs.output_in_number}}"
                },
                "component_in_number_1": {
                  "job_input_type": "literal",
                  "value": "${{parent.jobs.command_component.outputs.output_in_number}}"
                },
                "component_in_path": {
                  "job_input_type": "literal",
                  "value": "${{parent.jobs.do_while_body_pipeline.outputs.output_in_path}}"
                }
              },
              "outputs": {
                "output_in_path": {
                  "value": "${{parent.outputs.output_in_path}}",
                  "type": "literal"
                }
              },
              "_source": "DSL",
              "componentId": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/ae52818b-d81e-44df-aef4-fc6cc33a9d40"
            }
          },
          "outputs": {
            "output_in_path": {
              "jobOutputType": "uri_folder"
            }
          },
          "settings": {
            "default_compute": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/computes/cpu-cluster",
            "_source": "DSL"
          }
        }
      },
      "StatusCode": 201,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "6879",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Tue, 30 May 2023 07:29:04 GMT",
        "Expires": "-1",
        "Location": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/jobs/000000000000000000000?api-version=2023-04-01-preview",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-012a1b62fda8fc189f5a99bd20a8ed5b-5d1fa42560b93afa-01\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus2-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "9b5933d7-b7b7-461d-87a4-2aebceea5223",
        "x-ms-ratelimit-remaining-subscription-writes": "1192",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "JAPANEAST:20230530T072905Z:9b5933d7-b7b7-461d-87a4-2aebceea5223",
        "x-request-time": "1.370"
      },
      "ResponseBody": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/jobs/000000000000000000000",
        "name": "000000000000000000000",
        "type": "Microsoft.MachineLearningServices/workspaces/jobs",
        "properties": {
          "description": null,
          "tags": {},
          "properties": {
            "azureml.DevPlatv2": "true",
            "azureml.DatasetAccessMode": "Asset",
            "azureml.runsource": "azureml.PipelineRun",
            "runSource": "MFE",
            "runType": "HTTP",
            "azureml.parameters": "{\u0022component_in_number\u0022:\u00222\u0022}",
            "azureml.continue_on_step_failure": "True",
            "azureml.continue_on_failed_optional_input": "True",
            "azureml.enforceRerun": "False",
            "azureml.defaultComputeName": "cpu-cluster",
            "azureml.defaultDataStoreName": "workspaceblobstore",
            "azureml.pipelineComponent": "pipelinerun"
          },
          "displayName": "pipeline_with_do_while",
          "status": "Preparing",
          "experimentName": "azure-ai-ml",
          "services": {
            "Tracking": {
              "jobServiceType": "Tracking",
              "port": null,
              "endpoint": "azureml://eastus2.api.azureml.ms/mlflow/v1.0/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000?",
              "status": null,
              "errorMessage": null,
              "properties": null,
              "nodes": null
            },
            "Studio": {
              "jobServiceType": "Studio",
              "port": null,
              "endpoint": "https://ml.azure.com/runs/000000000000000000000?wsid=/subscriptions/00000000-0000-0000-0000-000000000/resourcegroups/00000/workspaces/00000",
              "status": null,
              "errorMessage": null,
              "properties": null,
              "nodes": null
            }
          },
          "computeId": null,
          "isArchived": false,
          "identity": null,
          "componentId": null,
          "notificationSetting": null,
          "secretsConfiguration": null,
          "jobType": "Pipeline",
          "settings": {
            "default_compute": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/computes/cpu-cluster",
            "_source": "DSL"
          },
          "jobs": {
            "do_while_body_pipeline": {
              "name": "do_while_body_pipeline",
              "type": "pipeline",
              "inputs": {
                "component_in_number": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_number}}"
                },
                "component_in_number_1": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_number}}"
                },
                "component_in_path": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_path}}"
                }
              },
              "_source": "DSL",
              "componentId": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/ae52818b-d81e-44df-aef4-fc6cc33a9d40"
            },
            "do_while_with_pipeline": {
              "body": "${{parent.jobs.do_while_body_pipeline}}",
              "type": "do_while",
              "condition": "is_number_larger_than_zero",
              "mapping": {
                "${{parent.jobs.do_while_body_pipeline.outputs.output_in_number}}": [
                  "component_in_number",
                  "component_in_number_1"
                ],
                "output_in_path": [
                  "component_in_path"
                ]
              },
              "limits": {
                "max_iteration_count": 5
              },
              "_source": "DSL"
            },
            "command_component": {
              "name": "command_component",
              "type": "command",
              "inputs": {
                "component_in_number": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_number}}"
                },
                "component_in_number_1": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_number}}"
                },
                "component_in_path": {
                  "job_input_type": "literal",
                  "value": "${{parent.inputs.component_in_path}}"
                }
              },
              "_source": "YAML.COMPONENT",
              "componentId": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/744e2b52-597b-47b6-b06b-2cebd143bcdf"
            },
            "do_while_with_command_component": {
              "body": "${{parent.jobs.command_component}}",
              "type": "do_while",
              "condition": "is_number_larger_than_zero",
              "mapping": {
                "output_in_number": [
                  "component_in_number",
                  "component_in_number_1"
                ],
                "output_in_path": [
                  "component_in_path"
                ]
              },
              "limits": {
                "max_iteration_count": 5
              },
              "_source": "DSL"
            },
            "basic_component": {
              "name": "basic_component",
              "type": "pipeline",
              "inputs": {
                "component_in_number": {
                  "job_input_type": "literal",
                  "value": "${{parent.jobs.do_while_body_pipeline.outputs.output_in_number}}"
                },
                "component_in_number_1": {
                  "job_input_type": "literal",
                  "value": "${{parent.jobs.command_component.outputs.output_in_number}}"
                },
                "component_in_path": {
                  "job_input_type": "literal",
                  "value": "${{parent.jobs.do_while_body_pipeline.outputs.output_in_path}}"
                }
              },
              "outputs": {
                "output_in_path": {
                  "value": "${{parent.outputs.output_in_path}}",
                  "type": "literal"
                }
              },
              "_source": "DSL",
              "componentId": "/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/components/azureml_anonymous/versions/ae52818b-d81e-44df-aef4-fc6cc33a9d40"
            }
          },
          "inputs": {
            "component_in_number": {
              "description": null,
              "jobInputType": "literal",
              "value": "2"
            },
            "component_in_path": {
              "description": null,
              "uri": "azureml://datastores/workspaceblobstore/paths/LocalUpload/00000000000000000000000000000000/e2etests/",
              "mode": "ReadOnlyMount",
              "jobInputType": "uri_folder"
            }
          },
          "outputs": {
            "output_in_path": {
              "description": null,
              "uri": null,
              "assetName": null,
              "assetVersion": null,
              "mode": "ReadWriteMount",
              "autoDeleteSetting": null,
              "jobOutputType": "uri_folder"
            }
          },
          "sourceJobId": null
        },
        "systemData": {
          "createdAt": "2023-05-30T07:29:05.1551035\u002B00:00",
          "createdBy": "Chenyang Zhang",
          "createdByType": "User"
        }
      }
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/resourceGroups/00000/providers/Microsoft.MachineLearningServices/workspaces/00000/jobs/000000000000000000000/cancel?api-version=2023-04-01-preview",
      "RequestMethod": "POST",
      "RequestHeaders": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "0",
        "User-Agent": "azure-ai-ml/1.8.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)"
      },
      "RequestBody": null,
      "StatusCode": 202,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "4",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Tue, 30 May 2023 07:29:07 GMT",
        "Expires": "-1",
        "Location": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/providers/Microsoft.MachineLearningServices/locations/eastus2/mfeOperationResults/jc:0bdd51b6-cd9c-4978-b870-99997b393b81:000000000000000000000?api-version=2023-04-01-preview",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus2-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-async-operation-timeout": "PT1H",
        "x-ms-correlation-request-id": "47d56798-d815-4649-967a-4f536fd81b83",
        "x-ms-ratelimit-remaining-subscription-writes": "1198",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "JAPANEAST:20230530T072908Z:47d56798-d815-4649-967a-4f536fd81b83",
        "x-request-time": "0.561"
      },
      "ResponseBody": "null"
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/providers/Microsoft.MachineLearningServices/locations/eastus2/mfeOperationResults/jc:0bdd51b6-cd9c-4978-b870-99997b393b81:000000000000000000000?api-version=2023-04-01-preview",
      "RequestMethod": "GET",
      "RequestHeaders": {
        "Accept": "*/*",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "User-Agent": "azure-ai-ml/1.8.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)"
      },
      "RequestBody": null,
      "StatusCode": 202,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "2",
        "Content-Type": "application/json; charset=utf-8",
        "Date": "Tue, 30 May 2023 07:29:07 GMT",
        "Expires": "-1",
        "Location": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/providers/Microsoft.MachineLearningServices/locations/eastus2/mfeOperationResults/jc:0bdd51b6-cd9c-4978-b870-99997b393b81:000000000000000000000?api-version=2023-04-01-preview",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus2-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "693c6203-2c77-4f8f-a3e5-e440f9f49dda",
        "x-ms-ratelimit-remaining-subscription-reads": "11997",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "JAPANEAST:20230530T072908Z:693c6203-2c77-4f8f-a3e5-e440f9f49dda",
        "x-request-time": "0.025"
      },
      "ResponseBody": {}
    },
    {
      "RequestUri": "https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000/providers/Microsoft.MachineLearningServices/locations/eastus2/mfeOperationResults/jc:0bdd51b6-cd9c-4978-b870-99997b393b81:000000000000000000000?api-version=2023-04-01-preview",
      "RequestMethod": "GET",
      "RequestHeaders": {
        "Accept": "*/*",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "User-Agent": "azure-ai-ml/1.8.0 azsdk-python-mgmt-machinelearningservices/0.1.0 Python/3.8.12 (Windows-10-10.0.22621-SP0)"
      },
      "RequestBody": null,
      "StatusCode": 200,
      "ResponseHeaders": {
        "Cache-Control": "no-cache",
        "Content-Length": "0",
        "Date": "Tue, 30 May 2023 07:29:38 GMT",
        "Expires": "-1",
        "Pragma": "no-cache",
        "Request-Context": "appId=cid-v1:2d2e8e63-272e-4b3c-8598-4ee570a0e70d",
        "Server-Timing": "traceparent;desc=\u002200-bc70a2570d5be96e0891db9523f87efa-1db67e0fcf557fe1-00\u0022",
        "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
        "x-aml-cluster": "vienna-eastus2-01",
        "X-Content-Type-Options": "nosniff",
        "x-ms-correlation-request-id": "51a8eed5-4590-4ce0-96ce-c34bedf99fcb",
        "x-ms-ratelimit-remaining-subscription-reads": "11996",
        "x-ms-response-type": "standard",
        "x-ms-routing-request-id": "JAPANEAST:20230530T072939Z:51a8eed5-4590-4ce0-96ce-c34bedf99fcb",
        "x-request-time": "0.056"
      },
      "ResponseBody": null
    }
  ],
  "Variables": {}
}
