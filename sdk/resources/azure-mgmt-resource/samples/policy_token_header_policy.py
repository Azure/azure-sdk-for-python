# pylint: disable=line-too-long,useless-suppression
# coding=utf-8
# --------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for license information.
# Code generated by Microsoft (R) AutoRest Code Generator.
# Changes may cause incorrect behavior and will be lost if the code is regenerated.
# --------------------------------------------------------------------------

import os
from azure.identity import DefaultAzureCredential
from dotenv import load_dotenv
from azure.mgmt.resource.resources import ResourceManagementClient


import sys
import logging

logging.basicConfig(
    level=logging.DEBUG, format="%(asctime)s - %(name)s - %(levelname)s - %(message)s", stream=sys.stdout
)


def check_policy_token_header_exist(request):
    if request.http_request.method != "GET":
        assert "x-ms-policy-external-evaluations" in request.http_request.headers


load_dotenv()
client = ResourceManagementClient(
    credential=DefaultAzureCredential(), subscription_id=os.getenv("AZURE_SUBSCRIPTION_ID", ""), logging_enable=True
)

# resource_group_name="test-resource-group-yyc5"
# response = client.resource_groups.create_or_update(
#     resource_group_name=resource_group_name,
#     parameters={"location": "eastus"},
#     # raw_request_hook=check_policy_token_header_exist,
#     # acquire_policy_token=True,
# )
# print(response)

client.resources.check_existence_by_id(
    resource_id="test",
    api_version="2021-04-01",
    acquire_policy_token=True,
)
