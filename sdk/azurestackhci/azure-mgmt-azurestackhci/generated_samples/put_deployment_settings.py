# pylint: disable=line-too-long,useless-suppression
# coding=utf-8
# --------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for license information.
# Code generated by Microsoft (R) AutoRest Code Generator.
# Changes may cause incorrect behavior and will be lost if the code is regenerated.
# --------------------------------------------------------------------------

from azure.identity import DefaultAzureCredential

from azure.mgmt.azurestackhci import AzureStackHCIClient

"""
# PREREQUISITES
    pip install azure-identity
    pip install azure-mgmt-azurestackhci
# USAGE
    python put_deployment_settings.py

    Before run the sample, please set the values of the client ID, tenant ID and client secret
    of the AAD application as environment variables: AZURE_CLIENT_ID, AZURE_TENANT_ID,
    AZURE_CLIENT_SECRET. For more info about how to get the value, please see:
    https://docs.microsoft.com/azure/active-directory/develop/howto-create-service-principal-portal
"""


def main():
    client = AzureStackHCIClient(
        credential=DefaultAzureCredential(),
        subscription_id="fd3c3665-1729-4b7b-9a38-238e83b0f98b",
    )

    response = client.deployment_settings.begin_create_or_update(
        resource_group_name="test-rg",
        cluster_name="myCluster",
        resource={
            "properties": {
                "arcNodeResourceIds": [
                    "/subscriptions/fd3c3665-1729-4b7b-9a38-238e83b0f98b/resourceGroups/ArcInstance-rg/providers/Microsoft.HybridCompute/machines/Node-1",
                    "/subscriptions/fd3c3665-1729-4b7b-9a38-238e83b0f98b/resourceGroups/ArcInstance-rg/providers/Microsoft.HybridCompute/machines/Node-2",
                ],
                "deploymentConfiguration": {
                    "scaleUnits": [
                        {
                            "deploymentData": {
                                "adouPath": "OU=ms169,DC=ASZ1PLab8,DC=nttest,DC=microsoft,DC=com",
                                "cluster": {
                                    "azureServiceEndpoint": "core.windows.net",
                                    "cloudAccountName": "myasestoragacct",
                                    "name": "testHCICluster",
                                    "witnessPath": "Cloud",
                                    "witnessType": "Cloud",
                                },
                                "domainFqdn": "ASZ1PLab8.nttest.microsoft.com",
                                "hostNetwork": {
                                    "intents": [
                                        {
                                            "adapter": ["Port2"],
                                            "adapterPropertyOverrides": {
                                                "jumboPacket": "1514",
                                                "networkDirect": "Enabled",
                                                "networkDirectTechnology": "iWARP",
                                            },
                                            "name": "Compute_Management",
                                            "overrideAdapterProperty": False,
                                            "overrideQosPolicy": False,
                                            "overrideVirtualSwitchConfiguration": False,
                                            "qosPolicyOverrides": {
                                                "bandwidthPercentage_SMB": "50",
                                                "priorityValue8021Action_Cluster": "7",
                                                "priorityValue8021Action_SMB": "3",
                                            },
                                            "trafficType": ["Compute", "Management"],
                                            "virtualSwitchConfigurationOverrides": {
                                                "enableIov": "True",
                                                "loadBalancingAlgorithm": "HyperVPort",
                                            },
                                        }
                                    ],
                                    "storageConnectivitySwitchless": True,
                                    "storageNetworks": [
                                        {"name": "Storage1Network", "networkAdapterName": "Port3", "vlanId": "5"}
                                    ],
                                },
                                "infrastructureNetwork": [
                                    {
                                        "dnsServers": ["10.57.50.90"],
                                        "gateway": "255.255.248.0",
                                        "ipPools": [{"endingAddress": "10.57.48.66", "startingAddress": "10.57.48.60"}],
                                        "subnetMask": "255.255.248.0",
                                    }
                                ],
                                "namingPrefix": "ms169",
                                "observability": {
                                    "episodicDataUpload": True,
                                    "euLocation": False,
                                    "streamingDataClient": True,
                                },
                                "optionalServices": {"customLocation": "customLocationName"},
                                "physicalNodes": [
                                    {"ipv4Address": "10.57.51.224", "name": "ms169host"},
                                    {"ipv4Address": "10.57.53.236", "name": "ms154host"},
                                ],
                                "secretsLocation": "/subscriptions/db4e2fdb-6d80-4e6e-b7cd-xxxxxxx/resourceGroups/test-rg/providers/Microsoft.KeyVault/vaults/abcd123",
                                "securitySettings": {
                                    "bitlockerBootVolume": True,
                                    "bitlockerDataVolumes": True,
                                    "credentialGuardEnforced": False,
                                    "driftControlEnforced": True,
                                    "drtmProtection": True,
                                    "hvciProtection": True,
                                    "sideChannelMitigationEnforced": True,
                                    "smbClusterEncryption": False,
                                    "smbSigningEnforced": True,
                                    "wdacEnforced": True,
                                },
                                "storage": {"configurationMode": "Express"},
                            }
                        }
                    ],
                    "version": "string",
                },
                "deploymentMode": "Deploy",
            }
        },
    ).result()
    print(response)


# x-ms-original-file: specification/azurestackhci/resource-manager/Microsoft.AzureStackHCI/stable/2024-01-01/examples/PutDeploymentSettings.json
if __name__ == "__main__":
    main()
