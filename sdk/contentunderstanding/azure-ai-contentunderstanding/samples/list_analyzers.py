# pylint: disable=line-too-long,useless-suppression

# coding=utf-8
# --------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for license information.
# Code generated by Microsoft (R) Python Code Generator.
# Changes may cause incorrect behavior and will be lost if the code is regenerated.
# --------------------------------------------------------------------------

import asyncio
import os

from azure.ai.contentunderstanding.aio import ContentUnderstandingClient

from azure.core.credentials import AzureKeyCredential
from azure.identity.aio import DefaultAzureCredential

from dotenv import load_dotenv

load_dotenv()

"""
Prerequisites:
    pip install azure-ai-contentunderstanding python-dotenv
    az login  # Used for DefaultAzureCredential(). Alternatively, set the AZURE_CONTENT_UNDERSTANDING_KEY environment variable

Environment variables:
    AZURE_CONTENT_UNDERSTANDING_ENDPOINT   (required)
    AZURE_CONTENT_UNDERSTANDING_KEY        (optional - DefaultAzureCredential() will be used if not set)
    These variables can be set in a .env file in the samples directory for repeated use. Please see env.sample for an example.

Run:
    python list_analyzers.py
"""


async def main():
    """
    List all available analyzers using list API.

    High-level steps:
    1. Connect to Azure AI Content Understanding
    2. List all available analyzers
    3. Display detailed information about each analyzer
    4. Show summary statistics
    """
    endpoint = os.getenv("AZURE_CONTENT_UNDERSTANDING_ENDPOINT") or ""
    print(f"Using endpoint: {endpoint}")
    # Return AzureKeyCredential if AZURE_CONTENT_UNDERSTANDING_KEY is set, otherwise DefaultAzureCredential
    key = os.getenv("AZURE_CONTENT_UNDERSTANDING_KEY")
    credential = AzureKeyCredential(key) if key else DefaultAzureCredential()

    async with ContentUnderstandingClient(endpoint=endpoint, credential=credential) as client:
        print(f"Listing all available analyzers...")

        # List all analyzers
        response = client.list_analyzers()
        analyzers = [analyzer async for analyzer in response]

        print(f"Found {len(analyzers)} analyzers")
        print()

        # Display detailed information about each analyzer
        for i, analyzer in enumerate(analyzers, 1):
            print(f"Analyzer {i}:")
            print(f"   ID: {analyzer.analyzer_id}")
            print(f"   Description: {analyzer.description}")
            print(f"   Status: {analyzer.status}")
            print(f"   Created at: {analyzer.created_at}")

            # Check if it's a prebuilt analyzer
            if analyzer.analyzer_id.startswith("prebuilt-"):
                print(f"   Type: Prebuilt analyzer")
            else:
                print(f"   Type: Custom analyzer")

            # Show tags if available
            if hasattr(analyzer, "tags") and analyzer.tags:
                print(f"   Tags: {analyzer.tags}")

            # Get full analyzer details including config using get API
            try:
                full_analyzer = await client.get_analyzer(analyzer_id=analyzer.analyzer_id)
                if full_analyzer.config:
                    print(f"   Config: {full_analyzer.config}")
                if full_analyzer.base_analyzer_id:
                    print(f"   Base analyzer ID: {full_analyzer.base_analyzer_id}")
                if full_analyzer.field_schema:
                    print(f"   Field schema: {full_analyzer.field_schema.name if hasattr(full_analyzer.field_schema, 'name') else 'Available'}")
                    if hasattr(full_analyzer.field_schema, 'fields') and full_analyzer.field_schema.fields:
                        print(f"   Number of fields: {len(full_analyzer.field_schema.fields)}")
                if full_analyzer.models:
                    print(f"   Models: {full_analyzer.models}")
            except Exception as e:
                print(f"   Error getting analyzer details: {e}")

            print()

        # Check for specific prebuilt analyzers
        prebuilt_ids = [analyzer.analyzer_id for analyzer in analyzers if analyzer.analyzer_id.startswith("prebuilt-")]
        if "prebuilt-document" in prebuilt_ids:
            print(f"   prebuilt-document is available")
        if "prebuilt-videoSearch" in prebuilt_ids:
            print(f"   prebuilt-videoSearch is available")

    # x-ms-original-file: 2025-11-01/ContentAnalyzers_List.json
    # Manually close DefaultAzureCredential if it was used
    if isinstance(credential, DefaultAzureCredential):
        await credential.close()


if __name__ == "__main__":
    asyncio.run(main())
