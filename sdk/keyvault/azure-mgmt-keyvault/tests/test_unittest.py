# coding=utf-8
# --------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for license information.
# Code generated by Microsoft (R) AutoRest Code Generator.
# Changes may cause incorrect behavior and will be lost if the code is regenerated.
# --------------------------------------------------------------------------
from azure.mgmt.keyvault.models import Key, KeyAttributes, KeyProperties
from azure.core.serialization import attribute_list


def test_model_initialization():
    key = Key(kty="EC", attributes=KeyAttributes(enabled=True), key_ops=["encrypt", "decrypt"])
    assert key.kty == "EC"
    assert key.properties.kty == "EC"
    assert key.attributes.enabled is True
    assert key.properties.attributes.enabled is True
    assert "encrypt" in key.key_ops
    assert "decrypt" in key.key_ops
    assert "encrypt" in key.properties.key_ops
    assert "decrypt" in key.properties.key_ops


def test_model_attribute_list_for_compatibility():
    # if none of attributes in properties of model instance is assigned, attribute_list will return top-level attributes
    assert {"id", "name", "type", "system_data", "properties", "location", "tags"} == set(attribute_list(Key()))

    # if any attribute in properties of model instance is assigned, attribute_list will return flattened attributes
    expected_attributes = {
        "id",
        "name",
        "type",
        "system_data",
        "attributes",
        "kty",
        "key_ops",
        "key_size",
        "curve_name",
        "key_uri",
        "key_uri_with_version",
        "rotation_policy",
        "release_policy",
        "location",
        "tags",
    }
    assert expected_attributes == set(attribute_list(Key(properties=KeyProperties(kty="RSA"))))
    assert expected_attributes == set(attribute_list(Key(kty="RSA")))
