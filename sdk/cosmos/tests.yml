trigger: none
resources:
  repositories:
  - repository: azure-sdk-tools
    type: github
    name: Azure/azure-sdk-tools
    endpoint: azure
jobs:
- template: ../../eng/pipelines/templates/jobs/archetype-sdk-tests.yml
  parameters:
    AllocateResourceGroup: "false"
    MaxParallel: 1
    ServiceDirectory: cosmos
    TestMarkArgument: not globaldb
    EnvVars:
      ACCOUNT_KEY: $(python-cosmos-live-account-key)
      ACCOUNT_HOST: $(python-cosmos-live-account-host)
    BeforeTestSteps:
    - pwsh: |
        $testDatabaseId = "Python Test Database " + (New-Guid).ToString()
        Write-Host Test Database ID: $testDatabaseId
        Write-Host "##vso[task.setvariable variable=COSMOS_TEST_DATABASE_ID]$testDatabaseId"
      displayName: Set COSMOS_TEST_DATABASE_ID
    AfterTestSteps:
    - pwsh: |
        az cosmosdb sql database delete --db-name $env:COSMOS_TEST_DATABASE_ID --url-connection $(python-cosmos-live-account-host) --key $(python-cosmos-live-account-key)
      ignoreLASTEXITCODE: true
      condition: always()
      displayName: Cleanup test database
