# NOTE: Please refer to https://aka.ms/azsdk/engsys/ci-yaml before editing this file.
trigger:
  branches:
    include:
    - main
    - hotfix/*
    - release/*
    - restapi*
  paths:
    include:
    - sdk/cosmos/

pr:
  branches:
    include:
    - main
    - feature/*
    - hotfix/*
    - release/*
    - restapi*
  paths:
    include:
    - sdk/cosmos/

stages:
  - stage: Test_Emulator
    dependsOn: []
    jobs:
    - job: Emulator
      strategy:
        matrix:
          Windows_Python36:
            OSVmImage: 'windows-2022'
            PythonVersion: '3.6'
      pool:
        vmImage: $(OSVmImage)

      steps:
        - template: /eng/common/pipelines/templates/steps/cosmos-emulator.yml
          parameters:
            EmulatorMsiUrl: ${{ parameters.EmulatorMsiUrl }}
            StartParameters: ${{ parameters.EmulatorStartParameters }}

        - template: /eng/pipelines/templates/steps/build-test.yml
          parameters:
            TestMarkArgument: not globaldb
            EnvVars:
              ACCOUNT_HOST: https://localhost:8081/
            ServiceDirectory: ${{ parameters.ServiceDirectory }}
            PythonVersion: $(PythonVersion)
            OSVmImage: $(OSVmImage)
            ToxTestEnv: 'whl,sdist'
            InjectedPackages: ${{parameters.InjectedPackages}}
