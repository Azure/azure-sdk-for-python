# NOTE: Please refer to https://aka.ms/azsdk/engsys/ci-yaml before editing this file.
trigger:
  branches:
    include:
    - main
    - hotfix/*
    - release/*
    - restapi*
  paths:
    include:
    - sdk/cosmos/

pr:
  branches:
    include:
    - main
    - feature/*
    - hotfix/*
    - release/*
    - restapi*
  paths:
    include:
    - sdk/cosmos/

variables:
  ACCOUNT_HOST: https://localhost:8081/
  PythonVersion: 3.9
  Pool: azsdk-pool-mms-ubuntu-2004-general
  OSVmImage: MMSUbuntu20.04
  toxenv: 'whl,sdist'

stages:
  - stage: Test_Emulator
    dependsOn: []
    jobs:
    - template: /eng/pipelines/templates/jobs/ci.tests.yml
      parameters:
        ServiceDirectory: cosmos
        BeforeTestSteps:
          - template: /eng/common/pipelines/templates/steps/cosmos-emulator.yml
            parameters:
              StartParameters: '/noexplorer /noui /enablepreview /EnableSqlComputeEndpoint /SqlComputePort=9999 /disableratelimiting /partitioncount=50 /consistency=Strong'
        BuildTargetingString: azure-cosmos
        TestMarkArgument: not globaldb
