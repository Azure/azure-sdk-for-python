interactions:
- request:
    body: null
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      Connection:
      - keep-alive
      User-Agent:
      - azsdk-python-mgmt-sql/0.9.0 Python/3.6.9 (Linux-4.9.184-linuxkit-x86_64-with-Ubuntu-18.04-bionic)
    method: GET
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.Sql/managedInstances/testinstancexxy?api-version=2020-02-02-preview
  response:
    body:
      string: '{"identity":{"principalId":"22f7e1f4-d363-4489-ba33-1002c93f6b55","type":"SystemAssigned","tenantId":"00000000-0000-0000-0000-000000000000"},"sku":{"name":"GP_Gen5","tier":"GeneralPurpose","family":"Gen5","capacity":8},"properties":{"provisioningState":"Succeeded","fullyQualifiedDomainName":"testinstancexxy.32ece7f5a2d6.database.windows.net","administratorLogin":"dummylogin","subnetId":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.Network/virtualNetworks/vnet-testinstancexxy/subnets/ManagedInstance","state":"Ready","licenseType":"LicenseIncluded","vCores":8,"storageSizeInGB":256,"collation":"SQL_Latin1_General_CP1_CI_AS","dnsZone":"32ece7f5a2d6","publicDataEndpointEnabled":false,"proxyOverride":"Proxy","timezoneId":"UTC","privateEndpointConnections":[],"minimalTlsVersion":"1.2","storageAccountType":"GRS"},"location":"eastus","tags":{},"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.Sql/managedInstances/testinstancexxy","name":"testinstancexxy","type":"Microsoft.Sql/managedInstances"}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '1125'
      content-type:
      - application/json; charset=utf-8
      date:
      - Thu, 24 Sep 2020 06:14:49 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      server:
      - Microsoft-HTTPAPI/2.0
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      transfer-encoding:
      - chunked
      vary:
      - Accept-Encoding
      x-content-type-options:
      - nosniff
    status:
      code: 200
      message: OK
- request:
    body: 'b''{"location": "eastus", "properties": {"tenantId": "00000000-0000-0000-0000-000000000000",
      "sku": {"family": "A", "name": "standard"}, "accessPolicies": [{"tenantId":
      "00000000-0000-0000-0000-000000000000", "objectId": "123743cc-88ef-49ee-920e-13958fe5697d",
      "permissions": {"keys": ["get", "create", "delete", "list", "update", "import",
      "backup", "restore", "recover"], "secrets": ["get", "list", "set", "delete",
      "backup", "restore", "recover"], "certificates": ["get", "list", "delete", "create",
      "import", "update", "managecontacts", "getissuers", "listissuers", "setissuers",
      "deleteissuers", "manageissuers", "recover"], "storage": ["get", "list", "delete",
      "set", "update", "regeneratekey", "setsas", "listsas", "getsas", "deletesas"]}},
      {"tenantId": "00000000-0000-0000-0000-000000000000", "objectId": "22f7e1f4-d363-4489-ba33-1002c93f6b55",
      "permissions": {"keys": ["unwrapKey", "get", "wrapKey", "list"]}}], "enabledForDiskEncryption":
      true, "enableSoftDelete": true, "softDeleteRetentionInDays": 90}}'''
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      Connection:
      - keep-alive
      Content-Length:
      - '1011'
      Content-Type:
      - application/json
      User-Agent:
      - azsdk-python-azure-mgmt-keyvault/7.0.0 Python/3.6.9 (Linux-4.9.184-linuxkit-x86_64-with-Ubuntu-18.04-bionic)
    method: PUT
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.KeyVault/vaults/keyvaultxmmxh52551076?api-version=2019-09-01
  response:
    body:
      string: '{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.KeyVault/vaults/keyvaultxmmxh52551076","name":"keyvaultxmmxh52551076","type":"Microsoft.KeyVault/vaults","location":"eastus","tags":{},"properties":{"sku":{"family":"A","name":"standard"},"tenantId":"00000000-0000-0000-0000-000000000000","accessPolicies":[{"tenantId":"00000000-0000-0000-0000-000000000000","objectId":"123743cc-88ef-49ee-920e-13958fe5697d","permissions":{"keys":["get","create","delete","list","update","import","backup","restore","recover"],"secrets":["get","list","set","delete","backup","restore","recover"],"certificates":["get","list","delete","create","import","update","managecontacts","getissuers","listissuers","setissuers","deleteissuers","manageissuers","recover"],"storage":["get","list","delete","set","update","regeneratekey","setsas","listsas","getsas","deletesas"]}},{"tenantId":"00000000-0000-0000-0000-000000000000","objectId":"22f7e1f4-d363-4489-ba33-1002c93f6b55","permissions":{"keys":["unwrapKey","get","wrapKey","list"]}}],"enabledForDeployment":false,"enabledForDiskEncryption":true,"enableSoftDelete":true,"softDeleteRetentionInDays":90,"vaultUri":"https://keyvaultxmmxh52551076.vault.azure.net","provisioningState":"RegisteringDns"}}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '1290'
      content-type:
      - application/json; charset=utf-8
      date:
      - Thu, 24 Sep 2020 06:15:00 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      server:
      - Microsoft-IIS/10.0
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      transfer-encoding:
      - chunked
      vary:
      - Accept-Encoding
      x-aspnet-version:
      - 4.0.30319
      x-content-type-options:
      - nosniff
      x-ms-keyvault-service-version:
      - 1.1.55.0
      x-ms-ratelimit-remaining-subscription-writes:
      - '1199'
      x-powered-by:
      - ASP.NET
    status:
      code: 200
      message: OK
- request:
    body: null
    headers:
      Accept:
      - '*/*'
      Accept-Encoding:
      - gzip, deflate
      Connection:
      - keep-alive
      User-Agent:
      - azsdk-python-azure-mgmt-keyvault/7.0.0 Python/3.6.9 (Linux-4.9.184-linuxkit-x86_64-with-Ubuntu-18.04-bionic)
    method: GET
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.KeyVault/vaults/keyvaultxmmxh52551076?api-version=2019-09-01
  response:
    body:
      string: '{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.KeyVault/vaults/keyvaultxmmxh52551076","name":"keyvaultxmmxh52551076","type":"Microsoft.KeyVault/vaults","location":"eastus","tags":{},"properties":{"sku":{"family":"A","name":"standard"},"tenantId":"00000000-0000-0000-0000-000000000000","accessPolicies":[{"tenantId":"00000000-0000-0000-0000-000000000000","objectId":"123743cc-88ef-49ee-920e-13958fe5697d","permissions":{"keys":["get","create","delete","list","update","import","backup","restore","recover"],"secrets":["get","list","set","delete","backup","restore","recover"],"certificates":["get","list","delete","create","import","update","managecontacts","getissuers","listissuers","setissuers","deleteissuers","manageissuers","recover"],"storage":["get","list","delete","set","update","regeneratekey","setsas","listsas","getsas","deletesas"]}},{"tenantId":"00000000-0000-0000-0000-000000000000","objectId":"22f7e1f4-d363-4489-ba33-1002c93f6b55","permissions":{"keys":["unwrapKey","get","wrapKey","list"]}}],"enabledForDeployment":false,"enabledForDiskEncryption":true,"enableSoftDelete":true,"softDeleteRetentionInDays":90,"vaultUri":"https://keyvaultxmmxh52551076.vault.azure.net/","provisioningState":"Succeeded"}}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '1286'
      content-type:
      - application/json; charset=utf-8
      date:
      - Thu, 24 Sep 2020 06:15:31 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      server:
      - Microsoft-IIS/10.0
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      transfer-encoding:
      - chunked
      vary:
      - Accept-Encoding
      x-aspnet-version:
      - 4.0.30319
      x-content-type-options:
      - nosniff
      x-ms-keyvault-service-version:
      - 1.1.55.0
      x-powered-by:
      - ASP.NET
    status:
      code: 200
      message: OK
- request:
    body: null
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      Connection:
      - keep-alive
      Content-Length:
      - '0'
      Content-Type:
      - application/json
      User-Agent:
      - azsdk-python-keyvault-keys/4.2.0 Python/3.6.9 (Linux-4.9.184-linuxkit-x86_64-with-Ubuntu-18.04-bionic)
    method: POST
    uri: https://keyvaultxmmxh52551076.vault.azure.net/keys/testkey/create?api-version=7.1
  response:
    body:
      string: '{"error":{"code":"Unauthorized","message":"Request is missing a Bearer
        or PoP token."}}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '87'
      content-type:
      - application/json; charset=utf-8
      date:
      - Thu, 24 Sep 2020 06:15:34 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000;includeSubDomains
      www-authenticate:
      - Bearer authorization="https://login.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47",
        resource="https://vault.azure.net"
      x-aspnet-version:
      - 4.0.30319
      x-content-type-options:
      - nosniff
      x-ms-keyvault-network-info:
      - conn_type=Ipv4;addr=167.220.255.83;act_addr_fam=InterNetwork;
      x-ms-keyvault-region:
      - eastus
      x-ms-keyvault-service-version:
      - 1.1.60.0
      x-powered-by:
      - ASP.NET
    status:
      code: 401
      message: Unauthorized
- request:
    body: '{"kty": "RSA", "key_size": 2048, "attributes": {"exp": 2527401600}}'
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      Connection:
      - keep-alive
      Content-Length:
      - '67'
      Content-Type:
      - application/json
      User-Agent:
      - azsdk-python-keyvault-keys/4.2.0 Python/3.6.9 (Linux-4.9.184-linuxkit-x86_64-with-Ubuntu-18.04-bionic)
    method: POST
    uri: https://keyvaultxmmxh52551076.vault.azure.net/keys/testkey/create?api-version=7.1
  response:
    body:
      string: '{"key":{"kid":"https://keyvaultxmmxh52551076.vault.azure.net/keys/testkey/031d056f626a46749541c66665f582c6","kty":"RSA","key_ops":["encrypt","decrypt","sign","verify","wrapKey","unwrapKey"],"n":"43gRyR1GHNbTSqlNJsX5wu_coqqirI8Zl2ujv6SmNckvphhb88gfokUdx9sMr3SlfPcJ-HYAynHgeXDG1OlwdEPgQz2bZQYo34KDSdx_BRKrMurR79HhlSI6HcLyiqBZ6yimPWLVa70utS0T9LU6_JaUFgZu6-wiQWMHvr3B6WsnMK1JzU-fcfHbSiAtpzMkLMBHKxjL-CHneaqBsNl5-7nRMUL-VOSHZLoF3xhMVJDNCTARM2WcISt_gXth8xJZbNijjn-e9aTvUmILK3o4Rp6cYz3DDJJKUJuUWGstyhedbmgzBUX5RNToKusjRToyI4FU17FlltPsbmWb5j-6aw","e":"AQAB"},"attributes":{"enabled":true,"exp":2527401600,"created":1600928135,"updated":1600928135,"recoveryLevel":"Recoverable+Purgeable","recoverableDays":90}}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '701'
      content-type:
      - application/json; charset=utf-8
      date:
      - Thu, 24 Sep 2020 06:15:35 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000;includeSubDomains
      x-aspnet-version:
      - 4.0.30319
      x-content-type-options:
      - nosniff
      x-ms-keyvault-network-info:
      - conn_type=Ipv4;addr=167.220.255.83;act_addr_fam=InterNetwork;
      x-ms-keyvault-region:
      - eastus
      x-ms-keyvault-service-version:
      - 1.1.60.0
      x-powered-by:
      - ASP.NET
    status:
      code: 200
      message: OK
- request:
    body: '{"properties": {"serverKeyType": "AzureKeyVault", "uri": "https://keyvaultxmmxh52551076.vault.azure.net/keys/testkey/031d056f626a46749541c66665f582c6"}}'
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      Connection:
      - keep-alive
      Content-Length:
      - '152'
      Content-Type:
      - application/json
      User-Agent:
      - azsdk-python-mgmt-sql/0.9.0 Python/3.6.9 (Linux-4.9.184-linuxkit-x86_64-with-Ubuntu-18.04-bionic)
    method: PUT
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.Sql/managedInstances/testinstancexxy/keys/keyvaultxmmxh52551076_testkey_000?api-version=2017-10-01-preview
  response:
    body:
      string: '{"operation":"UpsertManagedServerEncryptionKeys","startTime":"2020-09-24T06:15:37.363Z"}'
    headers:
      azure-asyncoperation:
      - https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.Sql/locations/eastus/managedInstanceKeyAzureAsyncOperation/3e1f33cc-9334-455a-8939-81d97d103e75?api-version=2017-10-01-preview
      cache-control:
      - no-cache
      content-length:
      - '88'
      content-type:
      - application/json; charset=utf-8
      date:
      - Thu, 24 Sep 2020 06:15:36 GMT
      expires:
      - '-1'
      location:
      - https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.Sql/locations/eastus/managedInstanceKeyOperationResults/3e1f33cc-9334-455a-8939-81d97d103e75?api-version=2017-10-01-preview
      pragma:
      - no-cache
      server:
      - Microsoft-HTTPAPI/2.0
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-content-type-options:
      - nosniff
      x-ms-ratelimit-remaining-subscription-writes:
      - '1198'
    status:
      code: 202
      message: Accepted
- request:
    body: null
    headers:
      Accept:
      - '*/*'
      Accept-Encoding:
      - gzip, deflate
      Connection:
      - keep-alive
      User-Agent:
      - azsdk-python-mgmt-sql/0.9.0 Python/3.6.9 (Linux-4.9.184-linuxkit-x86_64-with-Ubuntu-18.04-bionic)
    method: GET
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.Sql/locations/eastus/managedInstanceKeyAzureAsyncOperation/3e1f33cc-9334-455a-8939-81d97d103e75?api-version=2017-10-01-preview
  response:
    body:
      string: '{"name":"3e1f33cc-9334-455a-8939-81d97d103e75","status":"Succeeded","startTime":"2020-09-24T06:15:37.363Z"}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '107'
      content-type:
      - application/json; charset=utf-8
      date:
      - Thu, 24 Sep 2020 06:15:38 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      server:
      - Microsoft-HTTPAPI/2.0
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      transfer-encoding:
      - chunked
      vary:
      - Accept-Encoding
      x-content-type-options:
      - nosniff
    status:
      code: 200
      message: OK
- request:
    body: null
    headers:
      Accept:
      - '*/*'
      Accept-Encoding:
      - gzip, deflate
      Connection:
      - keep-alive
      User-Agent:
      - azsdk-python-mgmt-sql/0.9.0 Python/3.6.9 (Linux-4.9.184-linuxkit-x86_64-with-Ubuntu-18.04-bionic)
    method: GET
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.Sql/managedInstances/testinstancexxy/keys/keyvaultxmmxh52551076_testkey_000?api-version=2017-10-01-preview
  response:
    body:
      string: '{"kind":"azurekeyvault","properties":{"serverKeyType":"AzureKeyVault","uri":"https://keyvaultxmmxh52551076.vault.azure.net/keys/testkey/031d056f626a46749541c66665f582c6","thumbprint":"25F55D027A4D1D26251825ADD9035CE561D8970C","creationDate":"2020-09-24T06:15:38.287Z"},"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.Sql/managedInstances/testinstancexxy/keys/keyvaultxmmxh52551076_testkey_000","name":"keyvaultxmmxh52551076_testkey_000","type":"Microsoft.Sql/managedInstances/keys"}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '605'
      content-type:
      - application/json; charset=utf-8
      date:
      - Thu, 24 Sep 2020 06:15:38 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      server:
      - Microsoft-HTTPAPI/2.0
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      transfer-encoding:
      - chunked
      vary:
      - Accept-Encoding
      x-content-type-options:
      - nosniff
    status:
      code: 200
      message: OK
- request:
    body: null
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      Connection:
      - keep-alive
      User-Agent:
      - azsdk-python-mgmt-sql/0.9.0 Python/3.6.9 (Linux-4.9.184-linuxkit-x86_64-with-Ubuntu-18.04-bionic)
    method: GET
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.Sql/managedInstances/testinstancexxy/keys/keyvaultxmmxh52551076_testkey_000?api-version=2017-10-01-preview
  response:
    body:
      string: '{"kind":"azurekeyvault","properties":{"serverKeyType":"AzureKeyVault","uri":"https://keyvaultxmmxh52551076.vault.azure.net/keys/testkey/031d056f626a46749541c66665f582c6","thumbprint":"25F55D027A4D1D26251825ADD9035CE561D8970C","creationDate":"2020-09-24T06:15:38.287Z"},"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.Sql/managedInstances/testinstancexxy/keys/keyvaultxmmxh52551076_testkey_000","name":"keyvaultxmmxh52551076_testkey_000","type":"Microsoft.Sql/managedInstances/keys"}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '605'
      content-type:
      - application/json; charset=utf-8
      date:
      - Thu, 24 Sep 2020 06:15:38 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      server:
      - Microsoft-HTTPAPI/2.0
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      transfer-encoding:
      - chunked
      vary:
      - Accept-Encoding
      x-content-type-options:
      - nosniff
    status:
      code: 200
      message: OK
- request:
    body: null
    headers:
      Accept:
      - '*/*'
      Accept-Encoding:
      - gzip, deflate
      Connection:
      - keep-alive
      Content-Length:
      - '0'
      User-Agent:
      - azsdk-python-mgmt-sql/0.9.0 Python/3.6.9 (Linux-4.9.184-linuxkit-x86_64-with-Ubuntu-18.04-bionic)
    method: DELETE
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.Sql/managedInstances/testinstancexxy/keys/keyvaultxmmxh52551076_testkey_000?api-version=2017-10-01-preview
  response:
    body:
      string: '{"operation":"DeleteManagedServerEncryptionKeys","startTime":"2020-09-24T06:15:40.037Z"}'
    headers:
      azure-asyncoperation:
      - https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.Sql/locations/eastus/managedInstanceKeyAzureAsyncOperation/3fe505ef-9f2b-4f20-b5c2-da5dddba7e96?api-version=2017-10-01-preview
      cache-control:
      - no-cache
      content-length:
      - '88'
      content-type:
      - application/json; charset=utf-8
      date:
      - Thu, 24 Sep 2020 06:15:39 GMT
      expires:
      - '-1'
      location:
      - https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.Sql/locations/eastus/managedInstanceKeyOperationResults/3fe505ef-9f2b-4f20-b5c2-da5dddba7e96?api-version=2017-10-01-preview
      pragma:
      - no-cache
      server:
      - Microsoft-HTTPAPI/2.0
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-content-type-options:
      - nosniff
      x-ms-ratelimit-remaining-subscription-deletes:
      - '14999'
    status:
      code: 202
      message: Accepted
- request:
    body: null
    headers:
      Accept:
      - '*/*'
      Accept-Encoding:
      - gzip, deflate
      Connection:
      - keep-alive
      User-Agent:
      - azsdk-python-mgmt-sql/0.9.0 Python/3.6.9 (Linux-4.9.184-linuxkit-x86_64-with-Ubuntu-18.04-bionic)
    method: GET
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testManagedInstance/providers/Microsoft.Sql/locations/eastus/managedInstanceKeyAzureAsyncOperation/3fe505ef-9f2b-4f20-b5c2-da5dddba7e96?api-version=2017-10-01-preview
  response:
    body:
      string: '{"name":"3fe505ef-9f2b-4f20-b5c2-da5dddba7e96","status":"Succeeded","startTime":"2020-09-24T06:15:40.037Z"}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '107'
      content-type:
      - application/json; charset=utf-8
      date:
      - Thu, 24 Sep 2020 06:15:40 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      server:
      - Microsoft-HTTPAPI/2.0
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      transfer-encoding:
      - chunked
      vary:
      - Accept-Encoding
      x-content-type-options:
      - nosniff
    status:
      code: 200
      message: OK
version: 1
