parameters:
  EnvVars: {}
  InjectedPackages: ''

stages:
  - template: /eng/pipelines/templates/stages/archetype-sdk-tests.yml
    parameters:
      AllocateResourceGroup: 'false'
      JobName: Test_Blob
      ServiceDirectory: storage
      EnvVars: ${{ parameters.EnvVars }}
      InjectedPackages: ${{ parameters.InjectedPackages }}
      MatrixConfigs:
        - Name: Storage_live_test
          Path: eng/pipelines/templates/stages/platform-matrix.json
          Selection: sparse
          GenerateMultiple:
            - BuildTargetingString: "azure-storage-blob"
            - BuildTargetingString: "azure-storage-blob-changefeed"
            - BuildTargetingString: "azure-storage-queue"
            - BuildTargetingString: "azure-storage-file-datalake"

        - Name: Storage_blob_changefeed_live_test
          Path: eng/pipelines/templates/stages/platform-matrix.json
          Selection: sparse
          Transform: |
            $_.parameters["BuildTargetingString"] = "azure-storage-blob-changefeed"
