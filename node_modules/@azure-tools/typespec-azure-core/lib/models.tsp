import "@typespec/http";
import "@typespec/rest";
import "./traits.tsp";

using TypeSpec.Http;
using TypeSpec.Rest;

namespace Azure.Core;

/**
 * Describes a page of resource object.
 * @template TResource The resource type.
 */
@pagedResult
@friendlyName("Paged{name}", TResource)
@doc("Paged collection of {name} items", TResource)
model Page<TResource extends TypeSpec.Reflection.Model> {
  @doc("The {name} items on this page", TResource)
  @items
  value: TResource[];

  @doc("The link to the next page of items")
  @nextLink
  nextLink?: ResourceLocation<TResource>;
}

/**
 * Defines a property as a request parameter.
 * @template T The parameter name.
 */
@Foundations.requestParameter(T)
model RequestParameter<T extends valueof string> {}

/**
 * Defines a property as a response header.
 * @template T The header name.
 */
@Foundations.responseProperty(T)
model ResponseProperty<T extends valueof string> {}

/**
 * @dev Provides the status of a resource operation.
 * @template TResource The resource type.
 * @template TStatusResult Model describing the status result object. If not specified, the default is the resource type.
 * @template TStatusError Model describing the status error object. If not specified, the default is the Foundations.Error.
 */
@resource("operations")
@parentResource(TResource)
model ResourceOperationStatus<
  TResource extends TypeSpec.Reflection.Model,
  TStatusResult = TResource,
  TStatusError = Foundations.Error
> is Azure.Core.Foundations.OperationStatus<TStatusResult, TStatusError>;

#suppress "@azure-tools/typespec-providerhub/no-inline-model" "This is acceptable in Azure.Core."
alias ResourceOperationStatusResponse<
  TResource extends TypeSpec.Reflection.Model,
  TStatusResult,
  TStatusError
> = ResourceOperationStatus<TResource, TStatusResult, TStatusError>;

@doc("Provides the standard 'top' query parameter for list operations.")
model TopQueryParameter {
  @query
  @doc("The number of result items to return.")
  top?: int32;
}

@doc("Provides the standard 'skip' query parameter for list operations.")
model SkipQueryParameter {
  @query
  @doc("The number of result items to skip.")
  skip?: int32 = 0;
}

@doc("Provides the standard 'maxpagesize' query parameter for list operations.")
model MaxPageSizeQueryParameter {
  @query
  @doc("The maximum number of result items per page.")
  maxpagesize?: int32;
}

@doc("Provides the standard 'orderby' query parameter for list operations.")
model OrderByQueryParameter {
  #suppress "@azure-tools/typespec-azure-core/prefer-csv-collection-format" "By design"
  @query({
    format: "multi",
  })
  @doc("Expressions that specify the order of returned results.")
  orderby?: string[];
}

@doc("Provides the standard 'filter' query parameter for list operations.")
model FilterQueryParameter {
  @query
  @doc("Filter the result list using the given expression.")
  filter?: string;
}

@doc("Provides the standard 'select' query parameter for list operations.")
model SelectQueryParameter {
  #suppress "@azure-tools/typespec-azure-core/prefer-csv-collection-format" "By design"
  @query({
    format: "multi",
  })
  @doc("Select the specified fields to be included in the response.")
  select?: string[];
}

@doc("Provides the standard 'expand' query parameter for list operations.")
model ExpandQueryParameter {
  #suppress "@azure-tools/typespec-azure-core/prefer-csv-collection-format" "By design"
  @query({
    format: "multi",
  })
  @doc("Expand the indicated resources into the response.")
  expand?: string[];
}

@doc("Provides the most common query parameters for list operations.")
model StandardListQueryParameters {
  ...TopQueryParameter;
  ...SkipQueryParameter;
  ...MaxPageSizeQueryParameter;
}

// https://github.com/microsoft/api-guidelines/blob/vNext/azure/Guidelines.md#conditional-requests

@doc("Provides the 'If-*' headers to enable conditional (cached) responses")
model ConditionalRequestHeaders {
  @visibility("read", "query", "create", "update", "delete")
  @header("If-Match")
  @doc("The request should only proceed if an entity matches this string.")
  ifMatch?: string;

  @visibility("read", "query", "create", "update", "delete")
  @header("If-None-Match")
  @doc("The request should only proceed if no entity matches this string.")
  ifNoneMatch?: string;

  @visibility("read", "query", "create", "update", "delete")
  @header("If-Unmodified-Since")
  @doc("The request should only proceed if the entity was not modified after this time.")
  ifUnmodifiedSince?: utcDateTime;

  @visibility("read", "query", "create", "update", "delete")
  @header("If-Modified-Since")
  @doc("The request should only proceed if the entity was modified after this time.")
  ifModifiedSince?: utcDateTime;
}

@doc("""
Provides the 'ETag' field to enable conditional (cached) requests.  This model can be spread
into responses and item models to convey the ETag when it cannot simply conveyed in a header.
""")
model EtagProperty {
  @visibility("read")
  @doc("The entity tag for this resource.")
  etag: eTag;
}

@doc("Provides the 'ETag' header to enable conditional (cached) requests")
model EtagResponseEnvelope {
  @header("ETag")
  @visibility("read")
  @doc("The entity tag for the response.")
  etagHeader?: string;
}

// https://github.com/microsoft/api-guidelines/blob/vNext/azure/Guidelines.md#repeatability-of-requests

@doc("Provides the 'Repeatability-*' headers to enable repeatable requests.")
model RepeatabilityRequestHeaders {
  @visibility("create", "update", "delete")
  @header("Repeatability-Request-ID")
  @doc("An opaque, globally-unique, client-generated string identifier for the request.")
  repeatabilityRequestId?: string;

  @visibility("create", "update", "delete")
  @doc("Specifies the date and time at which the request was first created.")
  @header("Repeatability-First-Sent")
  repeatabilityFirstSent?: utcDateTime;
}

@doc("Provides the 'Repeatability-*' headers to enable repeatable requests.")
model RepeatabilityResponseHeaders {
  @visibility("read")
  @header("Repeatability-Result")
  @doc("Indicates whether the repeatable request was accepted or rejected.")
  repeatabilityResult?: "accepted" | "rejected";
}

// https://github.com/microsoft/api-guidelines/blob/vNext/azure/Guidelines.md#distributed-tracing--telemetry

@doc("Provides the 'x-ms-client-request-id' header to enable request correlation in requests and responses.")
model ClientRequestIdHeader {
  @header("x-ms-client-request-id")
  @doc("An opaque, globally-unique, client-generated string identifier for the request.")
  clientRequestId?: uuid;
}

@doc("Provides the 'x-ms-request-id' header to enable request correlation in responses.")
model RequestIdResponseHeader {
  @visibility("read")
  @header("x-ms-request-id")
  @doc("An opaque, globally-unique, server-generated string identifier for the request.")
  requestId?: uuid;
}

/**
 * Universally Unique Identifier
 *
 * @example
 *
 * ```
 * 123e4567-e89b-12d3-a456-426614174000
 * ```
 */
@format("uuid")
scalar uuid extends string;

/**
 * Represent an IP V4 address serialized as a string.
 *
 * It is formatted as four 8-bit fields separated by periods.
 *
 * @example
 *
 * ```
 * 129.144.50.56
 * ```
 */
@format("ipV4Address")
scalar ipV4Address extends string;

/**
 * Represent an IP V6 address serialized as a string.
 *
 * It is formatted as eight hex decimal values(16-bit) between 0 and FFFF separated by colon. (i.e. `y:y:y:y:y:y:y:y`)
 *
 * @example
 *
 * ```
 * 2001:db8:3333:4444:CCCC:DDDD:EEEE:FFFF
 * ```
 */
@format("ipV6Address")
scalar ipV6Address extends string;

/**
 * The ETag (or entity tag) HTTP response header is an identifier for a specific version of a resource.
 * It lets caches be more efficient and save bandwidth, as a web server does not need to resend a full response if the content was not changed.
 *
 * It is a string of ASCII characters placed between double quotes, like "675af34563dc-tr34".
 *
 * @example In `ETag` header
 *
 * ```
 * ETag: "675af34563dc-tr34"
 * ```
 */
@format("eTag")
scalar eTag extends string;
