resources:
  repositories:
    - repository: AzureCLI
      type: github
      name: azure/azure-cli
      endpoint: Azure
      ref: refs/heads/dev

parameters:
  - name: TargetRepoPackages
    type: object
    default: 
      - 'sdk/core/azure-core'
# a list of any resolvable pip install. EG:
# - https://<path-to-blobstorage>/blah.whl
# - <packagename>==<version>
  - name: InjectedPackages
    type: object
    default: []
  - name: PythonVersion
    type: string
    default: "3.9"

jobs:
  - job:
    displayName: 'Run AZDev Tests'

    variables:
      - template: ../variables/globals.yml

    strategy:
      matrix:
        linux:
          imageName: 'ubuntu-20.04'
          poolName: 'azsdk-pool-mms-ubuntu-2004-general'
        mac:
          imageName: 'windows-2019'
          poolName: 'azsdk-pool-mms-win-2019-general'
        windows:
          imageName: 'macOS-10.15'
          poolName: 'Azure Pipelines'

    pool:
      vmImage: $(imageName)
      name: '$(poolName)'

    steps:
      - checkout: self
        path: 's'

      - checkout: AzureCLI
        fetchDepth: 1
        path: 'cli'

      - pwsh: |
          Write-Host "Hello World"
        displayName: "Greetings"

      - pwsh: |
          Get-ChildItem -Name -Force -Path "$(Agent.BuildDirectory)"
        displayName: "Examining Build Directory"

      - pwsh: |
          Get-ChildItem -Name -Force -Path "$(Build.SourcesDirectory)"
        displayName: "Examining Sources Directory"

      - pwsh: |
          Write-Host "Hello World"
        displayName: "Greetings"

      - pwsh: |
          Get-ChildItem -Name -Force -Path "$(Agent.BuildDirectory)/cli"
        displayName: "cli dump"

      - template: /eng/pipelines/templates/steps/use-python-version.yml
        parameters:
          versionSpec: '${{ parameters.PythonVersion }}'

      - template: .azure-pipelines/templates/azdev_setup.yml@AzureCLI
        parameters:
          CLIRepoPath: $(Agent.BuildDirectory)/cli
