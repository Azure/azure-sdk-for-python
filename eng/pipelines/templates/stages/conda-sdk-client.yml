parameters:
- name: release_azure_core
  displayName: 'azure-core'
  type: boolean
  default: true
- name: release_azure_storage
  displayName: 'azure-storage'
  type: boolean
  default: true

variables:
  - template: /eng/pipelines/templates/variables/globals.yml

stages:
  - stage: Build
    displayName: Build Conda Artifacts
    jobs:
    - job: 'Build'
      timeoutInMinutes: 90
        
      pool:
        name: azsdk-pool-mms-ubuntu-2004-general
        vmImage: MMSUbuntu20.04

      steps:
        - template: ../steps/build-conda-artifacts.yml
          parameters:
            CondaArtifacts:
              - name: azure-core
                common_root: azure
                inBatch: ${{ parameters.release_azure_core }}
                checkout:
                - package: azure-core
                  checkout_path: sdk/core
                  version: 1.24.0

              - name: azure-storage
                common_root: azure
                inBatch: ${{ parameters.release_azure_storage }}
                checkout:
                - package: azure-storage-blob
                  checkout_path: sdk/storage
                  version: 12.12.0
                - package: azure-storage-queue
                  checkout_path: sdk/storage
                  version: 12.3.0
                - package: azure-storage-file-share
                  checkout_path: sdk/storage
                  version: 12.8.0
                - package: azure-storage-file-datalake
                  checkout_path: sdk/storage
                  version: 12.7.0

  # - ${{if and(ne(variables['Build.Reason'], 'PullRequest'), eq(variables['System.TeamProject'], 'internal'))}}:
  #   - template: archetype-conda-release.yml
  #     parameters:
  #       DependsOn: Build
  #       CondaArtifacts: $(CondaArtifacts)