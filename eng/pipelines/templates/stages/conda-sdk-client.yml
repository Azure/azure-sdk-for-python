parameters:
- name: release_azure_core
  displayName: 'azure-core'
  type: boolean
  default: true
- name: release_azure_storage
  displayName: 'azure-storage'
  type: boolean
  default: true

variables:
  CondaArtifacts:
  - name: azure-core
    common_root: azure
    inBatch: ${{ parameters.release_azure_core }}
  - name: azure-storage
    common_root: azure
    inBatch: ${{ parameters.release_azure_storage }}

stages:
  - stage: Build
    displayName: Build Conda Artifacts
    jobs:
    - template: ../steps/build-conda-artifacts.yml
      parameters:
        CondaArtifacts: $(CondaArtifacts)

  - ${{if and(ne(variables['Build.Reason'], 'PullRequest'), eq(variables['System.TeamProject'], 'internal'))}}:
    - template: archetype-conda-release.yml
      parameters:
        DependsOn: Build
        CondaArtifacts: $(CondaArtifacts)