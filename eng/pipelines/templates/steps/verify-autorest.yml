parameters:
  - name: ServiceToTest
    type: string
    default: ''
  - name: SDKType
    type: string
    default: 'client'
  - name: ServiceDirectory
    type: string

variables:
  NodeVersion: '12.x'
  PythonVersion: '3.9'
  auto_rest_clone_url: 'https://github.com/Azure/autorest.python.git'

steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '$(PythonVersion)'

  - task: NodeTool@0
    displayName: 'Install Node.js'
    inputs:
      versionSpec: '$(NodeVersion_'

  - script: |
      npm install -g autorest
      autorest --help
    displayName: "Install autorest"

  - script: |
      pip install -r eng/autorest_req.txt
      git clone $(auto_rest_clone_url)
      cd autorest.python
      git checkout $(repo_branch)
      npm install
    displayName: 'Prepare Environment'

  - script: |
      python scripts/devops_tasks/verify_autorest.py service_directory ${{ parameters.ServiceDirectory }}
