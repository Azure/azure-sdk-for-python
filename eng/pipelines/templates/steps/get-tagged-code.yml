parameters:
  - name: DestinationDirectory
    type: string
    default: ''
  - name: Package
    type: string
    default: ''
  - name: CheckoutPath
    type: string
    default: ''
  - name: Version
    type: string
    default: ''
          
steps:
    # TODO, re-use eng/common sparse-checkout.yml
    - pwsh: |
        $targetPath = $(Agent.TempDirectory)/cln
        Remove-Item -Path $targetPath/* -Recurse
        
        git clone --no-checkout --filter=tree:0 git://github.com/Azure/azure-sdk-for-python $targetPath
        cd $targetPath
        git sparse-checkout init
        git sparse-checkout set ${{ parameters.CheckoutPath }}/${{ parameters.Package }}
        git checkout ${{ parameters.Package }}_${{ parameters.Version }}

        ##vso[task.setvariable variable=Package.Clone]$targetPath
      displayName: 'Sparse Checkout Code into Temp Directory'

  - pwsh: |
      $pathForCopy = Join-Path -Path $(Package.Clone) -ChildPath "${{ parameters.CheckoutPath }}/${{ parameters.Package }}"
      
      Write-Host $pathForCopy
      Write-Host ${{ parameters.DestinationDirectory }}

      Copy-Item -Path $copyTarget -Destination ${{ parameters.DestinationDirectory }} -Recurse 
    displayName: 'Copy Source to Target Directory'
