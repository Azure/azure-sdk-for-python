parameters:
  ServiceDirectory: ''
  WheelDirectory: ''

# `$(TargetingString)` is set by a prior resolution step.
steps:
  - pwsh: |
      python ./scripts/devops_tasks/replace_requirements.py --service "${{ parameters.ServiceDirectory }}" -w "${{ parameters.WheelDirectory }}" $(TargetingString)
    displayName: Pre-Build Dev Requirements

  - pwsh: |
      ./eng/scripts/invoke-tox-parallel.ps1 `
        -TargetingString "$(TargetingString)" `
        -RepoRoot "$(Build.Sourcesdirectory)" `
        -ServiceDirectory "${{ parameters.ServiceDirectory }}" `
        -WheelDirectory "${{ parameters.WheelDirectory }}"
      Write-Host $LASTEXITCODE
    displayName: 'Run Sphinx Environments'
