trigger: none

variables:
  PythonVersion: '3.6'

jobs:
  - job: 'Generate_Documentation_Index'

    variables:
      skipComponentGovernanceDetection: true
  
    timeoutInMinutes: 120
  
    pool:
      vmImage: 'vs2017-win2016'

    steps:
      - pwsh: |
          Invoke-WebRequest -MaximumRetryCount 10 -Uri "https://github.com/dotnet/docfx/releases/download/v2.43.2/docfx.zip" `
          -OutFile "docfx.zip" | Wait-Process; Expand-Archive -Path "docfx.zip" -DestinationPath "./docfx/"
          echo "##vso[task.setvariable variable=docfxPath;isOutput=true]$(Build.SourcesDirectory)/docfx/docfx.exe"
        workingDirectory: $(Build.SourcesDirectory)
        displayName: Download and Extract DocFX
        name: setupDocfxTool
      - task: PowerShell@2
        displayName: "Generate Doc Index"
        inputs:
          pwsh: true
          filePath: $(Build.SourcesDirectory)/eng/docgeneration/Generate-DocIndex.ps1
          arguments: >
            -Docfx $(setupDocfxTool.docfxPath)
            -RepoRoot $(Build.SourcesDirectory)
            -DocGenDir "$(Build.SourcesDirectory)/eng/docgeneration"
            -verbose
            
      - upload: $(Build.ArtifactStagingDirectory)
        artifact: docfolder
        condition: succeededOrFailed()
        displayName: 'Publish Artifacts'
