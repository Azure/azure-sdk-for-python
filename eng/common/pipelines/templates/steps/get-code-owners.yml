
parameters: 
  TargetUserVariable: ''
  TargetTeamVariable: ''
  TargetLabelVariable: ''
  ServiceDirectory: ''
  DevOpsFeed: "https://pkgs.dev.azure.com/azure-sdk/public/_packaging/azure-sdk-for-net/nuget/v3/index.json"

steps:
  - pwsh: |
      Write-Host "$(RetrieveCodeOwnerToolVersion)"
      Write-Host "$(RetrieveCodeOwnerToolName)"
      dotnet tool install --tool-path . --add-source "${{ parameters.DevOpsFeed }}" --version "$(RetrieveCodeOwnerToolVersion)" "$(RetrieveCodeOwnerToolName)"
    displayName: 'Install tool RetrieveCodeOwners'
    workingDirectory: '$(Agent.ToolsDirectory)'

  - pwsh: |
      Push-Location '$(Agent.ToolsDirectory)'
      .\retrieve-codeowners `
        --target-directory "/sdk/${{ parameters.ServiceDirectory }}/" `
        --root-directory "$(Build.SourcesDirectory)" `
        --vso-owning-users "${{ parameters.TargetUserVariable }}" `
        --vso-owning-teams "${{ parameters.TargetTeamVariable }}" `
        --vso-owning-labels "${{ parameters.TargetLabelVariable }}"
      Pop-Location
    displayName: 'Add CodeOwners if Present'