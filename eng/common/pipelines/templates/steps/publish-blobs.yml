parameters:
  FolderForUpload: ''
  BlobSASKey: ''
  TargetLanguage: ''
  BlobName: ''
  ScriptPath: ''
  RepoId: ''
  ArtifactLocation: 'not-specified'
  PackageRepository: 'not-specified'
  ReleaseSha: 'not-specified'
  WorkingDirectory: ''

steps:
- pwsh: |
    Invoke-WebRequest -MaximumRetryCount 10 -Uri "https://aka.ms/downloadazcopy-v10-windows" -OutFile "azcopy.zip" | Wait-Process;
    Expand-Archive -Path "azcopy.zip" -DestinationPath "$(Build.BinariesDirectory)/azcopy/"
  workingDirectory: $(Build.BinariesDirectory)
  displayName: Download and Extract azcopy Zip

- task: Powershell@2
  inputs:
    filePath: ${{ parameters.ScriptPath }}
    arguments: >
      -artifactLocation ${{ parameters.ArtifactLocation }}
      -packageRepository ${{ parameters.PackageRepository }}
      -releaseSha ${{ parameters.ReleaseSha }}
      -AzCopy $(Resolve-Path "$(Build.BinariesDirectory)/azcopy/azcopy_windows_amd64_*/azcopy.exe")[0]
      -DocLocation "${{ parameters.FolderForUpload }}"
      -SASKey "${{ parameters.BlobSASKey }}"
      -Language "${{ parameters.TargetLanguage }}"
      -BlobName "${{ parameters.BlobName }}"
      -RepoReplaceRegex "(https://github.com/${{ parameters.RepoId }}/(?:blob|tree)/)master(/.*)"
      -workingDirectory '${{ parameters.WorkingDirectory }}'
    pwsh: true
    workingDirectory: $(Pipeline.Workspace)
  displayName: Copy Docs to Blob
  continueOnError: false